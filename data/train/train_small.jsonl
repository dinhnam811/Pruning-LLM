{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-permissions/src/main/java/org/apereo/portal/permission/target/EntityTargetProviderImpl.java", "func_name": "EntityTargetProviderImpl.getTarget", "original_string": "@Override\n    public IPermissionTarget getTarget(String key) {\n\n        /*\n         * If the specified key matches one of the \"all entity\" style targets,\n         * just return the appropriate target.\n         */\n        switch (key) {\n            case IPermission.ALL_CATEGORIES_TARGET:\n                return ALL_CATEGORIES_TARGET;\n            case IPermission.ALL_PORTLETS_TARGET:\n                return ALL_PORTLETS_TARGET;\n            case IPermission.ALL_GROUPS_TARGET:\n                return ALL_GROUPS_TARGET;\n                // Else just fall through...\n        }\n\n        /*\n         * Attempt to find a matching entity for each allowed entity type.  This\n         * implementation will return the first entity that it finds. If the\n         * portal contains duplicate entity keys across multiple types, it's\n         * possible that this implementation would demonstrate inconsistent\n         * behavior.\n         */\n        for (TargetType targetType : allowedTargetTypes) {\n            JsonEntityBean entity = groupListHelper.getEntity(targetType.toString(), key, false);\n            if (entity != null) {\n                IPermissionTarget target =\n                        new PermissionTargetImpl(entity.getId(), entity.getName(), targetType);\n                return target;\n            }\n        }\n\n        return null;\n    }", "language": "java", "code": "@Override\n    public IPermissionTarget getTarget(String key) {\n\n        /*\n         * If the specified key matches one of the \"all entity\" style targets,\n         * just return the appropriate target.\n         */\n        switch (key) {\n            case IPermission.ALL_CATEGORIES_TARGET:\n                return ALL_CATEGORIES_TARGET;\n            case IPermission.ALL_PORTLETS_TARGET:\n                return ALL_PORTLETS_TARGET;\n            case IPermission.ALL_GROUPS_TARGET:\n                return ALL_GROUPS_TARGET;\n                // Else just fall through...\n        }\n\n        /*\n         * Attempt to find a matching entity for each allowed entity type.  This\n         * implementation will return the first entity that it finds. If the\n         * portal contains duplicate entity keys across multiple types, it's\n         * possible that this implementation would demonstrate inconsistent\n         * behavior.\n         */\n        for (TargetType targetType : allowedTargetTypes) {\n            JsonEntityBean entity = groupListHelper.getEntity(targetType.toString(), key, false);\n            if (entity != null) {\n                IPermissionTarget target =\n                        new PermissionTargetImpl(entity.getId(), entity.getName(), targetType);\n                return target;\n            }\n        }\n\n        return null;\n    }", "code_tokens": ["@", "Override", "public", "IPermissionTarget", "getTarget", "(", "String", "key", ")", "{", "/*\n         * If the specified key matches one of the \"all entity\" style targets,\n         * just return the appropriate target.\n         */", "switch", "(", "key", ")", "{", "case", "IPermission", ".", "ALL_CATEGORIES_TARGET", ":", "return", "ALL_CATEGORIES_TARGET", ";", "case", "IPermission", ".", "ALL_PORTLETS_TARGET", ":", "return", "ALL_PORTLETS_TARGET", ";", "case", "IPermission", ".", "ALL_GROUPS_TARGET", ":", "return", "ALL_GROUPS_TARGET", ";", "// Else just fall through...", "}", "/*\n         * Attempt to find a matching entity for each allowed entity type.  This\n         * implementation will return the first entity that it finds. If the\n         * portal contains duplicate entity keys across multiple types, it's\n         * possible that this implementation would demonstrate inconsistent\n         * behavior.\n         */", "for", "(", "TargetType", "targetType", ":", "allowedTargetTypes", ")", "{", "JsonEntityBean", "entity", "=", "groupListHelper", ".", "getEntity", "(", "targetType", ".", "toString", "(", ")", ",", "key", ",", "false", ")", ";", "if", "(", "entity", "!=", "null", ")", "{", "IPermissionTarget", "target", "=", "new", "PermissionTargetImpl", "(", "entity", ".", "getId", "(", ")", ",", "entity", ".", "getName", "(", ")", ",", "targetType", ")", ";", "return", "target", ";", "}", "}", "return", "null", ";", "}"], "docstring": "The <code>key</code> parameter <em>should</em> specify a unique entity across all 4 supported\ntypes: people, groups, portlets, and categories.\n\n<p>Concrete examples of working keys:\n\n<ul>\n<li>admin (user)\n<li>local.0 (group)\n<li>PORTLET_ID.82 (portlet)\n<li>local.1 (category)\n</ul>", "docstring_tokens": ["The", "<code", ">", "key<", "/", "code", ">", "parameter", "<em", ">", "should<", "/", "em", ">", "specify", "a", "unique", "entity", "across", "all", "4", "supported", "types", ":", "people", "groups", "portlets", "and", "categories", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-permissions/src/main/java/org/apereo/portal/permission/target/EntityTargetProviderImpl.java#L116-L150", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-permissions/src/main/java/org/apereo/portal/permission/target/EntityTargetProviderImpl.java", "func_name": "EntityTargetProviderImpl.searchTargets", "original_string": "@Override\n    public Collection<IPermissionTarget> searchTargets(String term) {\n\n        // Initialize a new collection of matching targets.  We use a HashSet\n        // implementation here to prevent duplicate target entries.\n        Collection<IPermissionTarget> matching = new HashSet<IPermissionTarget>();\n\n        /*\n         * Attempt to find matching entities for each allowed entity type.\n         * Any matching entities will be added to our collection.\n         */\n        for (TargetType targetType : allowedTargetTypes) {\n            Set<JsonEntityBean> entities = groupListHelper.search(targetType.toString(), term);\n            for (JsonEntityBean entity : entities) {\n                IPermissionTarget target =\n                        new PermissionTargetImpl(entity.getId(), entity.getName(), targetType);\n                matching.add(target);\n            }\n        }\n\n        if (IPermission.ALL_CATEGORIES_TARGET.contains(term)) {\n            matching.add(ALL_CATEGORIES_TARGET);\n        } else if (IPermission.ALL_PORTLETS_TARGET.contains(term)) {\n            matching.add(ALL_PORTLETS_TARGET);\n        } else if (IPermission.ALL_GROUPS_TARGET.contains(term)) {\n            matching.add(ALL_GROUPS_TARGET);\n        }\n\n        // return the list of matching targets\n        return matching;\n    }", "language": "java", "code": "@Override\n    public Collection<IPermissionTarget> searchTargets(String term) {\n\n        // Initialize a new collection of matching targets.  We use a HashSet\n        // implementation here to prevent duplicate target entries.\n        Collection<IPermissionTarget> matching = new HashSet<IPermissionTarget>();\n\n        /*\n         * Attempt to find matching entities for each allowed entity type.\n         * Any matching entities will be added to our collection.\n         */\n        for (TargetType targetType : allowedTargetTypes) {\n            Set<JsonEntityBean> entities = groupListHelper.search(targetType.toString(), term);\n            for (JsonEntityBean entity : entities) {\n                IPermissionTarget target =\n                        new PermissionTargetImpl(entity.getId(), entity.getName(), targetType);\n                matching.add(target);\n            }\n        }\n\n        if (IPermission.ALL_CATEGORIES_TARGET.contains(term)) {\n            matching.add(ALL_CATEGORIES_TARGET);\n        } else if (IPermission.ALL_PORTLETS_TARGET.contains(term)) {\n            matching.add(ALL_PORTLETS_TARGET);\n        } else if (IPermission.ALL_GROUPS_TARGET.contains(term)) {\n            matching.add(ALL_GROUPS_TARGET);\n        }\n\n        // return the list of matching targets\n        return matching;\n    }", "code_tokens": ["@", "Override", "public", "Collection", "<", "IPermissionTarget", ">", "searchTargets", "(", "String", "term", ")", "{", "// Initialize a new collection of matching targets.  We use a HashSet", "// implementation here to prevent duplicate target entries.", "Collection", "<", "IPermissionTarget", ">", "matching", "=", "new", "HashSet", "<", "IPermissionTarget", ">", "(", ")", ";", "/*\n         * Attempt to find matching entities for each allowed entity type.\n         * Any matching entities will be added to our collection.\n         */", "for", "(", "TargetType", "targetType", ":", "allowedTargetTypes", ")", "{", "Set", "<", "JsonEntityBean", ">", "entities", "=", "groupListHelper", ".", "search", "(", "targetType", ".", "toString", "(", ")", ",", "term", ")", ";", "for", "(", "JsonEntityBean", "entity", ":", "entities", ")", "{", "IPermissionTarget", "target", "=", "new", "PermissionTargetImpl", "(", "entity", ".", "getId", "(", ")", ",", "entity", ".", "getName", "(", ")", ",", "targetType", ")", ";", "matching", ".", "add", "(", "target", ")", ";", "}", "}", "if", "(", "IPermission", ".", "ALL_CATEGORIES_TARGET", ".", "contains", "(", "term", ")", ")", "{", "matching", ".", "add", "(", "ALL_CATEGORIES_TARGET", ")", ";", "}", "else", "if", "(", "IPermission", ".", "ALL_PORTLETS_TARGET", ".", "contains", "(", "term", ")", ")", "{", "matching", ".", "add", "(", "ALL_PORTLETS_TARGET", ")", ";", "}", "else", "if", "(", "IPermission", ".", "ALL_GROUPS_TARGET", ".", "contains", "(", "term", ")", ")", "{", "matching", ".", "add", "(", "ALL_GROUPS_TARGET", ")", ";", "}", "// return the list of matching targets", "return", "matching", ";", "}"], "docstring": "/*\n(non-Javadoc)\n@see org.apereo.portal.permission.target.IPermissionTargetProvider#searchTargets(java.lang.String)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-permissions/src/main/java/org/apereo/portal/permission/target/EntityTargetProviderImpl.java#L156-L186", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/favorites/AbstractFavoritesController.java", "func_name": "AbstractFavoritesController.setMarketplaceFName", "original_string": "@Value(\"${org.apereo.portal.portlets.favorites.MarketplaceFunctionalName:null}\")\n    public void setMarketplaceFName(String marketplaceFunctionalName) {\n\n        // interpret null, non-text-having, or literal \"null\" as\n        // signaling lack of Marketplace functional name.\n        if (!StringUtils.hasText(marketplaceFunctionalName)\n                || \"null\".equalsIgnoreCase(marketplaceFunctionalName)) {\n            marketplaceFunctionalName = null;\n        }\n\n        this.marketplaceFName = marketplaceFunctionalName;\n    }", "language": "java", "code": "@Value(\"${org.apereo.portal.portlets.favorites.MarketplaceFunctionalName:null}\")\n    public void setMarketplaceFName(String marketplaceFunctionalName) {\n\n        // interpret null, non-text-having, or literal \"null\" as\n        // signaling lack of Marketplace functional name.\n        if (!StringUtils.hasText(marketplaceFunctionalName)\n                || \"null\".equalsIgnoreCase(marketplaceFunctionalName)) {\n            marketplaceFunctionalName = null;\n        }\n\n        this.marketplaceFName = marketplaceFunctionalName;\n    }", "code_tokens": ["@", "Value", "(", "\"${org.apereo.portal.portlets.favorites.MarketplaceFunctionalName:null}\"", ")", "public", "void", "setMarketplaceFName", "(", "String", "marketplaceFunctionalName", ")", "{", "// interpret null, non-text-having, or literal \"null\" as", "// signaling lack of Marketplace functional name.", "if", "(", "!", "StringUtils", ".", "hasText", "(", "marketplaceFunctionalName", ")", "||", "\"null\"", ".", "equalsIgnoreCase", "(", "marketplaceFunctionalName", ")", ")", "{", "marketplaceFunctionalName", "=", "null", ";", "}", "this", ".", "marketplaceFName", "=", "marketplaceFunctionalName", ";", "}"], "docstring": "Configures FavoritesController to include a Marketplace portlet functional name in the Model,\nwhich ultimately signals and enables the View to include convenient link to Marketplace for\nuser to add new favorites.\n\n<p>When set to null, signals Favorites portlet to suppress links to Marketplace. Setting to\nthe empty String or to the literal value \"null\" (ignoring case) is equivalent to setting to\nnull.\n\n<p>This is for convenience in expressing no-marketplace-fname-available via injected value\nfrom properties file. Defaults to the value of the property\n\"org.apereo.portal.portlets.favorites.MarketplaceFunctionalName\", or null if that property is\nnot set.\n\n<p>The functional name can technically be the fname of any portlet. It doesn't have to be The\nMarketplace Portlet. Perhaps you've got your own take on Marketplace.\n\n<p>This allows Favorites to support integration with Marketplace without requiring a\nMarketplace, gracefully degrading when no Marketplace available.\n\n@param marketplaceFunctionalName String fname of a marketplace portlet, or null.", "docstring_tokens": ["Configures", "FavoritesController", "to", "include", "a", "Marketplace", "portlet", "functional", "name", "in", "the", "Model", "which", "ultimately", "signals", "and", "enables", "the", "View", "to", "include", "convenient", "link", "to", "Marketplace", "for", "user", "to", "add", "new", "favorites", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/favorites/AbstractFavoritesController.java#L76-L87", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.setSearchTabs", "original_string": "@SuppressWarnings(\"unchecked\")\n    @Resource(name = \"searchTabs\")\n    // Map of tab-key to string or collection<string> of search result types\n    public void setSearchTabs(Map<String, Object> searchTabMappings) {\n        final Map<String, Set<String>> resultTypeMappingsBuilder = new LinkedHashMap<>();\n        final List<String> tabKeysBuilder = new ArrayList<>(searchTabMappings.size());\n\n        for (final Map.Entry<String, Object> tabMapping : searchTabMappings.entrySet()) {\n            final String tabKey = tabMapping.getKey();\n            tabKeysBuilder.add(tabKey);\n\n            final Object resultTypes = tabMapping.getValue();\n            if (resultTypes instanceof Collection) {\n                for (final String resultType : (Collection<String>) resultTypes) {\n                    addTabKey(resultTypeMappingsBuilder, tabKey, resultType);\n                }\n            } else {\n                final String resultType = (String) resultTypes;\n                addTabKey(resultTypeMappingsBuilder, tabKey, resultType);\n            }\n        }\n\n        this.resultTypeMappings = resultTypeMappingsBuilder;\n        this.tabKeys = tabKeysBuilder;\n    }", "language": "java", "code": "@SuppressWarnings(\"unchecked\")\n    @Resource(name = \"searchTabs\")\n    // Map of tab-key to string or collection<string> of search result types\n    public void setSearchTabs(Map<String, Object> searchTabMappings) {\n        final Map<String, Set<String>> resultTypeMappingsBuilder = new LinkedHashMap<>();\n        final List<String> tabKeysBuilder = new ArrayList<>(searchTabMappings.size());\n\n        for (final Map.Entry<String, Object> tabMapping : searchTabMappings.entrySet()) {\n            final String tabKey = tabMapping.getKey();\n            tabKeysBuilder.add(tabKey);\n\n            final Object resultTypes = tabMapping.getValue();\n            if (resultTypes instanceof Collection) {\n                for (final String resultType : (Collection<String>) resultTypes) {\n                    addTabKey(resultTypeMappingsBuilder, tabKey, resultType);\n                }\n            } else {\n                final String resultType = (String) resultTypes;\n                addTabKey(resultTypeMappingsBuilder, tabKey, resultType);\n            }\n        }\n\n        this.resultTypeMappings = resultTypeMappingsBuilder;\n        this.tabKeys = tabKeysBuilder;\n    }", "code_tokens": ["@", "SuppressWarnings", "(", "\"unchecked\"", ")", "@", "Resource", "(", "name", "=", "\"searchTabs\"", ")", "// Map of tab-key to string or collection<string> of search result types", "public", "void", "setSearchTabs", "(", "Map", "<", "String", ",", "Object", ">", "searchTabMappings", ")", "{", "final", "Map", "<", "String", ",", "Set", "<", "String", ">", ">", "resultTypeMappingsBuilder", "=", "new", "LinkedHashMap", "<>", "(", ")", ";", "final", "List", "<", "String", ">", "tabKeysBuilder", "=", "new", "ArrayList", "<>", "(", "searchTabMappings", ".", "size", "(", ")", ")", ";", "for", "(", "final", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "tabMapping", ":", "searchTabMappings", ".", "entrySet", "(", ")", ")", "{", "final", "String", "tabKey", "=", "tabMapping", ".", "getKey", "(", ")", ";", "tabKeysBuilder", ".", "add", "(", "tabKey", ")", ";", "final", "Object", "resultTypes", "=", "tabMapping", ".", "getValue", "(", ")", ";", "if", "(", "resultTypes", "instanceof", "Collection", ")", "{", "for", "(", "final", "String", "resultType", ":", "(", "Collection", "<", "String", ">", ")", "resultTypes", ")", "{", "addTabKey", "(", "resultTypeMappingsBuilder", ",", "tabKey", ",", "resultType", ")", ";", "}", "}", "else", "{", "final", "String", "resultType", "=", "(", "String", ")", "resultTypes", ";", "addTabKey", "(", "resultTypeMappingsBuilder", ",", "tabKey", ",", "resultType", ")", ";", "}", "}", "this", ".", "resultTypeMappings", "=", "resultTypeMappingsBuilder", ";", "this", ".", "tabKeys", "=", "tabKeysBuilder", ";", "}"], "docstring": "Set the mappings from TabKey to ResultType. The map keys must be strings but the values can\nbe either String or Collection<String>", "docstring_tokens": ["Set", "the", "mappings", "from", "TabKey", "to", "ResultType", ".", "The", "map", "keys", "must", "be", "strings", "but", "the", "values", "can", "be", "either", "String", "or", "Collection<String", ">"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L194-L218", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.handleSearchRequest", "original_string": "@SuppressWarnings(\"unchecked\")\n    @EventMapping(SearchConstants.SEARCH_REQUEST_QNAME_STRING)\n    public void handleSearchRequest(EventRequest request, EventResponse response) {\n        // UP-3887 Design flaw.  Both the searchLauncher portlet instance and the search portlet\n        // instance receive\n        // searchRequest and searchResult events because they are in the same portlet code base (to\n        // share\n        // autosuggest_handler.jsp and because we have to calculate the search portlet url for the\n        // ajax call)\n        // and share the portlet.xml which defines the event handling behavior.\n        // If this instance is the searchLauncher, ignore the searchResult. The search was submitted\n        // to the search\n        // portlet instance.\n        final String searchLaunchFname =\n                request.getPreferences().getValue(SEARCH_LAUNCH_FNAME, null);\n        if (searchLaunchFname != null) {\n            // Noisy in debug mode so commented out log statement\n            // logger.debug(\"SearchLauncher does not participate in SearchRequest events so\n            // discarding message\");\n            return;\n        }\n\n        final Event event = request.getEvent();\n        final SearchRequest searchQuery = (SearchRequest) event.getValue();\n\n        // Map used to track searches that have been handled, used so that one search doesn't get\n        // duplicate results\n        ConcurrentMap<String, Boolean> searchHandledCache;\n        final PortletSession session = request.getPortletSession();\n        synchronized (org.springframework.web.portlet.util.PortletUtils.getSessionMutex(session)) {\n            searchHandledCache =\n                    (ConcurrentMap<String, Boolean>)\n                            session.getAttribute(\n                                    SEARCH_HANDLED_CACHE_NAME, PortletSession.APPLICATION_SCOPE);\n            if (searchHandledCache == null) {\n                searchHandledCache =\n                        CacheBuilder.newBuilder()\n                                .maximumSize(20)\n                                .expireAfterAccess(5, TimeUnit.MINUTES)\n                                .<String, Boolean>build()\n                                .asMap();\n                session.setAttribute(\n                        SEARCH_HANDLED_CACHE_NAME,\n                        searchHandledCache,\n                        PortletSession.APPLICATION_SCOPE);\n            }\n        }\n\n        final String queryId = searchQuery.getQueryId();\n        if (searchHandledCache.putIfAbsent(queryId, Boolean.TRUE) != null) {\n            // Already handled this search request\n            return;\n        }\n\n        // Create the results\n        final SearchResults results = new SearchResults();\n        results.setQueryId(queryId);\n        results.setWindowId(request.getWindowID());\n        final List<SearchResult> searchResultList = results.getSearchResult();\n\n        // Run the search for each service appending the results\n        for (IPortalSearchService searchService : searchServices) {\n            try {\n                logger.debug(\n                        \"For queryId {}, query '{}', searching search service {}\",\n                        queryId,\n                        searchQuery.getSearchTerms(),\n                        searchService.getClass().toString());\n                final SearchResults serviceResults =\n                        searchService.getSearchResults(request, searchQuery);\n                logger.debug(\n                        \"For queryId {}, obtained {} results from search service {}\",\n                        queryId,\n                        serviceResults.getSearchResult().size(),\n                        searchService.getClass().toString());\n                searchResultList.addAll(serviceResults.getSearchResult());\n            } catch (Exception e) {\n                logger.warn(\n                        searchService.getClass()\n                                + \" threw an exception when searching, it will be ignored. \"\n                                + searchQuery,\n                        e);\n            }\n        }\n\n        // Respond with a results event if results were found\n        if (!searchResultList.isEmpty()) {\n            response.setEvent(SearchConstants.SEARCH_RESULTS_QNAME, results);\n        }\n    }", "language": "java", "code": "@SuppressWarnings(\"unchecked\")\n    @EventMapping(SearchConstants.SEARCH_REQUEST_QNAME_STRING)\n    public void handleSearchRequest(EventRequest request, EventResponse response) {\n        // UP-3887 Design flaw.  Both the searchLauncher portlet instance and the search portlet\n        // instance receive\n        // searchRequest and searchResult events because they are in the same portlet code base (to\n        // share\n        // autosuggest_handler.jsp and because we have to calculate the search portlet url for the\n        // ajax call)\n        // and share the portlet.xml which defines the event handling behavior.\n        // If this instance is the searchLauncher, ignore the searchResult. The search was submitted\n        // to the search\n        // portlet instance.\n        final String searchLaunchFname =\n                request.getPreferences().getValue(SEARCH_LAUNCH_FNAME, null);\n        if (searchLaunchFname != null) {\n            // Noisy in debug mode so commented out log statement\n            // logger.debug(\"SearchLauncher does not participate in SearchRequest events so\n            // discarding message\");\n            return;\n        }\n\n        final Event event = request.getEvent();\n        final SearchRequest searchQuery = (SearchRequest) event.getValue();\n\n        // Map used to track searches that have been handled, used so that one search doesn't get\n        // duplicate results\n        ConcurrentMap<String, Boolean> searchHandledCache;\n        final PortletSession session = request.getPortletSession();\n        synchronized (org.springframework.web.portlet.util.PortletUtils.getSessionMutex(session)) {\n            searchHandledCache =\n                    (ConcurrentMap<String, Boolean>)\n                            session.getAttribute(\n                                    SEARCH_HANDLED_CACHE_NAME, PortletSession.APPLICATION_SCOPE);\n            if (searchHandledCache == null) {\n                searchHandledCache =\n                        CacheBuilder.newBuilder()\n                                .maximumSize(20)\n                                .expireAfterAccess(5, TimeUnit.MINUTES)\n                                .<String, Boolean>build()\n                                .asMap();\n                session.setAttribute(\n                        SEARCH_HANDLED_CACHE_NAME,\n                        searchHandledCache,\n                        PortletSession.APPLICATION_SCOPE);\n            }\n        }\n\n        final String queryId = searchQuery.getQueryId();\n        if (searchHandledCache.putIfAbsent(queryId, Boolean.TRUE) != null) {\n            // Already handled this search request\n            return;\n        }\n\n        // Create the results\n        final SearchResults results = new SearchResults();\n        results.setQueryId(queryId);\n        results.setWindowId(request.getWindowID());\n        final List<SearchResult> searchResultList = results.getSearchResult();\n\n        // Run the search for each service appending the results\n        for (IPortalSearchService searchService : searchServices) {\n            try {\n                logger.debug(\n                        \"For queryId {}, query '{}', searching search service {}\",\n                        queryId,\n                        searchQuery.getSearchTerms(),\n                        searchService.getClass().toString());\n                final SearchResults serviceResults =\n                        searchService.getSearchResults(request, searchQuery);\n                logger.debug(\n                        \"For queryId {}, obtained {} results from search service {}\",\n                        queryId,\n                        serviceResults.getSearchResult().size(),\n                        searchService.getClass().toString());\n                searchResultList.addAll(serviceResults.getSearchResult());\n            } catch (Exception e) {\n                logger.warn(\n                        searchService.getClass()\n                                + \" threw an exception when searching, it will be ignored. \"\n                                + searchQuery,\n                        e);\n            }\n        }\n\n        // Respond with a results event if results were found\n        if (!searchResultList.isEmpty()) {\n            response.setEvent(SearchConstants.SEARCH_RESULTS_QNAME, results);\n        }\n    }", "code_tokens": ["@", "SuppressWarnings", "(", "\"unchecked\"", ")", "@", "EventMapping", "(", "SearchConstants", ".", "SEARCH_REQUEST_QNAME_STRING", ")", "public", "void", "handleSearchRequest", "(", "EventRequest", "request", ",", "EventResponse", "response", ")", "{", "// UP-3887 Design flaw.  Both the searchLauncher portlet instance and the search portlet", "// instance receive", "// searchRequest and searchResult events because they are in the same portlet code base (to", "// share", "// autosuggest_handler.jsp and because we have to calculate the search portlet url for the", "// ajax call)", "// and share the portlet.xml which defines the event handling behavior.", "// If this instance is the searchLauncher, ignore the searchResult. The search was submitted", "// to the search", "// portlet instance.", "final", "String", "searchLaunchFname", "=", "request", ".", "getPreferences", "(", ")", ".", "getValue", "(", "SEARCH_LAUNCH_FNAME", ",", "null", ")", ";", "if", "(", "searchLaunchFname", "!=", "null", ")", "{", "// Noisy in debug mode so commented out log statement", "// logger.debug(\"SearchLauncher does not participate in SearchRequest events so", "// discarding message\");", "return", ";", "}", "final", "Event", "event", "=", "request", ".", "getEvent", "(", ")", ";", "final", "SearchRequest", "searchQuery", "=", "(", "SearchRequest", ")", "event", ".", "getValue", "(", ")", ";", "// Map used to track searches that have been handled, used so that one search doesn't get", "// duplicate results", "ConcurrentMap", "<", "String", ",", "Boolean", ">", "searchHandledCache", ";", "final", "PortletSession", "session", "=", "request", ".", "getPortletSession", "(", ")", ";", "synchronized", "(", "org", ".", "springframework", ".", "web", ".", "portlet", ".", "util", ".", "PortletUtils", ".", "getSessionMutex", "(", "session", ")", ")", "{", "searchHandledCache", "=", "(", "ConcurrentMap", "<", "String", ",", "Boolean", ">", ")", "session", ".", "getAttribute", "(", "SEARCH_HANDLED_CACHE_NAME", ",", "PortletSession", ".", "APPLICATION_SCOPE", ")", ";", "if", "(", "searchHandledCache", "==", "null", ")", "{", "searchHandledCache", "=", "CacheBuilder", ".", "newBuilder", "(", ")", ".", "maximumSize", "(", "20", ")", ".", "expireAfterAccess", "(", "5", ",", "TimeUnit", ".", "MINUTES", ")", ".", "<", "String", ",", "Boolean", ">", "build", "(", ")", ".", "asMap", "(", ")", ";", "session", ".", "setAttribute", "(", "SEARCH_HANDLED_CACHE_NAME", ",", "searchHandledCache", ",", "PortletSession", ".", "APPLICATION_SCOPE", ")", ";", "}", "}", "final", "String", "queryId", "=", "searchQuery", ".", "getQueryId", "(", ")", ";", "if", "(", "searchHandledCache", ".", "putIfAbsent", "(", "queryId", ",", "Boolean", ".", "TRUE", ")", "!=", "null", ")", "{", "// Already handled this search request", "return", ";", "}", "// Create the results", "final", "SearchResults", "results", "=", "new", "SearchResults", "(", ")", ";", "results", ".", "setQueryId", "(", "queryId", ")", ";", "results", ".", "setWindowId", "(", "request", ".", "getWindowID", "(", ")", ")", ";", "final", "List", "<", "SearchResult", ">", "searchResultList", "=", "results", ".", "getSearchResult", "(", ")", ";", "// Run the search for each service appending the results", "for", "(", "IPortalSearchService", "searchService", ":", "searchServices", ")", "{", "try", "{", "logger", ".", "debug", "(", "\"For queryId {}, query '{}', searching search service {}\"", ",", "queryId", ",", "searchQuery", ".", "getSearchTerms", "(", ")", ",", "searchService", ".", "getClass", "(", ")", ".", "toString", "(", ")", ")", ";", "final", "SearchResults", "serviceResults", "=", "searchService", ".", "getSearchResults", "(", "request", ",", "searchQuery", ")", ";", "logger", ".", "debug", "(", "\"For queryId {}, obtained {} results from search service {}\"", ",", "queryId", ",", "serviceResults", ".", "getSearchResult", "(", ")", ".", "size", "(", ")", ",", "searchService", ".", "getClass", "(", ")", ".", "toString", "(", ")", ")", ";", "searchResultList", ".", "addAll", "(", "serviceResults", ".", "getSearchResult", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "warn", "(", "searchService", ".", "getClass", "(", ")", "+", "\" threw an exception when searching, it will be ignored. \"", "+", "searchQuery", ",", "e", ")", ";", "}", "}", "// Respond with a results event if results were found", "if", "(", "!", "searchResultList", ".", "isEmpty", "(", ")", ")", "{", "response", ".", "setEvent", "(", "SearchConstants", ".", "SEARCH_RESULTS_QNAME", ",", "results", ")", ";", "}", "}"], "docstring": "Performs a search of the explicitly configured {@link IPortalSearchService}s. This is done as\nan event handler so that it can run concurrently with the other portlets handling the search\nrequest", "docstring_tokens": ["Performs", "a", "search", "of", "the", "explicitly", "configured", "{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L372-L461", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.handleSearchResult", "original_string": "@EventMapping(SearchConstants.SEARCH_RESULTS_QNAME_STRING)\n    public void handleSearchResult(EventRequest request) {\n\n        // UP-3887 Design flaw.  Both the searchLauncher portlet instance and the search portlet\n        // instance receive\n        // searchRequest and searchResult events because they are in the same portlet code base (to\n        // share\n        // autosuggest_handler.jsp and because we have to calculate the search portlet url for the\n        // ajax call)\n        // and share the portlet.xml which defines the event handling behavior.\n        // If this instance is the searchLauncher, ignore the searchResult. The search was submitted\n        // to the search\n        // portlet instance.\n        final String searchLaunchFname =\n                request.getPreferences().getValue(SEARCH_LAUNCH_FNAME, null);\n        if (searchLaunchFname != null) {\n            // Noisy in debug mode so commenting out debug message\n            // logger.debug(\"SearchLauncher does not process SearchResponse events so discarding\n            // message\");\n            return;\n        }\n\n        final Event event = request.getEvent();\n        final SearchResults portletSearchResults = (SearchResults) event.getValue();\n\n        // get the existing portal search result from the session and append\n        // the results for this event\n        final String queryId = portletSearchResults.getQueryId();\n        final PortalSearchResults results = this.getPortalSearchResults(request, queryId);\n        if (results == null) {\n            this.logger.warn(\n                    \"No PortalSearchResults found for queryId {}, ignoring search results from {}\",\n                    queryId,\n                    getSearchResultsSource(portletSearchResults));\n            return;\n        }\n\n        if (logger.isDebugEnabled()) {\n            logger.debug(\n                    \"For queryId {}, adding {} search results from {}\",\n                    queryId,\n                    portletSearchResults.getSearchResult().size(),\n                    getSearchResultsSource(portletSearchResults));\n        }\n\n        final String windowId = portletSearchResults.getWindowId();\n        final HttpServletRequest httpServletRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPortletWindowId portletWindowId =\n                this.portletWindowRegistry.getPortletWindowId(httpServletRequest, windowId);\n\n        // Add the other portlet's results to the main search results object\n        this.addSearchResults(portletSearchResults, results, httpServletRequest, portletWindowId);\n    }", "language": "java", "code": "@EventMapping(SearchConstants.SEARCH_RESULTS_QNAME_STRING)\n    public void handleSearchResult(EventRequest request) {\n\n        // UP-3887 Design flaw.  Both the searchLauncher portlet instance and the search portlet\n        // instance receive\n        // searchRequest and searchResult events because they are in the same portlet code base (to\n        // share\n        // autosuggest_handler.jsp and because we have to calculate the search portlet url for the\n        // ajax call)\n        // and share the portlet.xml which defines the event handling behavior.\n        // If this instance is the searchLauncher, ignore the searchResult. The search was submitted\n        // to the search\n        // portlet instance.\n        final String searchLaunchFname =\n                request.getPreferences().getValue(SEARCH_LAUNCH_FNAME, null);\n        if (searchLaunchFname != null) {\n            // Noisy in debug mode so commenting out debug message\n            // logger.debug(\"SearchLauncher does not process SearchResponse events so discarding\n            // message\");\n            return;\n        }\n\n        final Event event = request.getEvent();\n        final SearchResults portletSearchResults = (SearchResults) event.getValue();\n\n        // get the existing portal search result from the session and append\n        // the results for this event\n        final String queryId = portletSearchResults.getQueryId();\n        final PortalSearchResults results = this.getPortalSearchResults(request, queryId);\n        if (results == null) {\n            this.logger.warn(\n                    \"No PortalSearchResults found for queryId {}, ignoring search results from {}\",\n                    queryId,\n                    getSearchResultsSource(portletSearchResults));\n            return;\n        }\n\n        if (logger.isDebugEnabled()) {\n            logger.debug(\n                    \"For queryId {}, adding {} search results from {}\",\n                    queryId,\n                    portletSearchResults.getSearchResult().size(),\n                    getSearchResultsSource(portletSearchResults));\n        }\n\n        final String windowId = portletSearchResults.getWindowId();\n        final HttpServletRequest httpServletRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPortletWindowId portletWindowId =\n                this.portletWindowRegistry.getPortletWindowId(httpServletRequest, windowId);\n\n        // Add the other portlet's results to the main search results object\n        this.addSearchResults(portletSearchResults, results, httpServletRequest, portletWindowId);\n    }", "code_tokens": ["@", "EventMapping", "(", "SearchConstants", ".", "SEARCH_RESULTS_QNAME_STRING", ")", "public", "void", "handleSearchResult", "(", "EventRequest", "request", ")", "{", "// UP-3887 Design flaw.  Both the searchLauncher portlet instance and the search portlet", "// instance receive", "// searchRequest and searchResult events because they are in the same portlet code base (to", "// share", "// autosuggest_handler.jsp and because we have to calculate the search portlet url for the", "// ajax call)", "// and share the portlet.xml which defines the event handling behavior.", "// If this instance is the searchLauncher, ignore the searchResult. The search was submitted", "// to the search", "// portlet instance.", "final", "String", "searchLaunchFname", "=", "request", ".", "getPreferences", "(", ")", ".", "getValue", "(", "SEARCH_LAUNCH_FNAME", ",", "null", ")", ";", "if", "(", "searchLaunchFname", "!=", "null", ")", "{", "// Noisy in debug mode so commenting out debug message", "// logger.debug(\"SearchLauncher does not process SearchResponse events so discarding", "// message\");", "return", ";", "}", "final", "Event", "event", "=", "request", ".", "getEvent", "(", ")", ";", "final", "SearchResults", "portletSearchResults", "=", "(", "SearchResults", ")", "event", ".", "getValue", "(", ")", ";", "// get the existing portal search result from the session and append", "// the results for this event", "final", "String", "queryId", "=", "portletSearchResults", ".", "getQueryId", "(", ")", ";", "final", "PortalSearchResults", "results", "=", "this", ".", "getPortalSearchResults", "(", "request", ",", "queryId", ")", ";", "if", "(", "results", "==", "null", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"No PortalSearchResults found for queryId {}, ignoring search results from {}\"", ",", "queryId", ",", "getSearchResultsSource", "(", "portletSearchResults", ")", ")", ";", "return", ";", "}", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "logger", ".", "debug", "(", "\"For queryId {}, adding {} search results from {}\"", ",", "queryId", ",", "portletSearchResults", ".", "getSearchResult", "(", ")", ".", "size", "(", ")", ",", "getSearchResultsSource", "(", "portletSearchResults", ")", ")", ";", "}", "final", "String", "windowId", "=", "portletSearchResults", ".", "getWindowId", "(", ")", ";", "final", "HttpServletRequest", "httpServletRequest", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "request", ")", ";", "final", "IPortletWindowId", "portletWindowId", "=", "this", ".", "portletWindowRegistry", ".", "getPortletWindowId", "(", "httpServletRequest", ",", "windowId", ")", ";", "// Add the other portlet's results to the main search results object", "this", ".", "addSearchResults", "(", "portletSearchResults", ",", "results", ",", "httpServletRequest", ",", "portletWindowId", ")", ";", "}"], "docstring": "Handles all the SearchResults events coming back from portlets", "docstring_tokens": ["Handles", "all", "the", "SearchResults", "events", "coming", "back", "from", "portlets"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L464-L517", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.getSearchResultsSource", "original_string": "private String getSearchResultsSource(SearchResults portletSearchResults) {\n        // Return the first source in the result.\n        List<SearchResult> portletResults = portletSearchResults.getSearchResult();\n        String source = \"unknown\";\n        if (portletResults.size() > 0\n                && portletResults.get(0).getType() != null\n                && !portletResults.get(0).getType().isEmpty()) {\n            source = portletResults.get(0).getType().get(0);\n        }\n        return source;\n    }", "language": "java", "code": "private String getSearchResultsSource(SearchResults portletSearchResults) {\n        // Return the first source in the result.\n        List<SearchResult> portletResults = portletSearchResults.getSearchResult();\n        String source = \"unknown\";\n        if (portletResults.size() > 0\n                && portletResults.get(0).getType() != null\n                && !portletResults.get(0).getType().isEmpty()) {\n            source = portletResults.get(0).getType().get(0);\n        }\n        return source;\n    }", "code_tokens": ["private", "String", "getSearchResultsSource", "(", "SearchResults", "portletSearchResults", ")", "{", "// Return the first source in the result.", "List", "<", "SearchResult", ">", "portletResults", "=", "portletSearchResults", ".", "getSearchResult", "(", ")", ";", "String", "source", "=", "\"unknown\"", ";", "if", "(", "portletResults", ".", "size", "(", ")", ">", "0", "&&", "portletResults", ".", "get", "(", "0", ")", ".", "getType", "(", ")", "!=", "null", "&&", "!", "portletResults", ".", "get", "(", "0", ")", ".", "getType", "(", ")", ".", "isEmpty", "(", ")", ")", "{", "source", "=", "portletResults", ".", "get", "(", "0", ")", ".", "getType", "(", ")", ".", "get", "(", "0", ")", ";", "}", "return", "source", ";", "}"], "docstring": "Return the first search source (type string) in the result, else the string 'unknown'.\n\n@param portletSearchResults Search results\n@return String identifying the search result source if it was populated, else 'unknown'", "docstring_tokens": ["Return", "the", "first", "search", "source", "(", "type", "string", ")", "in", "the", "result", "else", "the", "string", "unknown", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L525-L535", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.showSearchForm", "original_string": "@RequestMapping\n    public ModelAndView showSearchForm(RenderRequest request, RenderResponse response) {\n        final Map<String, Object> model = new HashMap<>();\n\n        String viewName;\n        // Determine if the new REST search should be used\n        if (isRestSearch(request)) {\n            viewName = \"/jsp/Search/searchRest\";\n        } else {\n            // Determine if this portlet displays the search launch view or regular search view.\n            final boolean isMobile = isMobile(request);\n            viewName = isMobile ? \"/jsp/Search/mobileSearch\" : \"/jsp/Search/search\";\n        }\n\n        // If this search portlet is configured to be the searchLauncher, calculate the URLs to the\n        // indicated\n        // search portlet.\n        PortletPreferences prefs = request.getPreferences();\n        final String searchLaunchFname = prefs.getValue(SEARCH_LAUNCH_FNAME, null);\n        if (searchLaunchFname != null) {\n            model.put(\"searchLaunchUrl\", calculateSearchLaunchUrl(request, response));\n            model.put(\"autocompleteUrl\", calculateAutocompleteResourceUrl(request, response));\n            viewName = \"/jsp/Search/searchLauncher\";\n        }\n        return new ModelAndView(viewName, model);\n    }", "language": "java", "code": "@RequestMapping\n    public ModelAndView showSearchForm(RenderRequest request, RenderResponse response) {\n        final Map<String, Object> model = new HashMap<>();\n\n        String viewName;\n        // Determine if the new REST search should be used\n        if (isRestSearch(request)) {\n            viewName = \"/jsp/Search/searchRest\";\n        } else {\n            // Determine if this portlet displays the search launch view or regular search view.\n            final boolean isMobile = isMobile(request);\n            viewName = isMobile ? \"/jsp/Search/mobileSearch\" : \"/jsp/Search/search\";\n        }\n\n        // If this search portlet is configured to be the searchLauncher, calculate the URLs to the\n        // indicated\n        // search portlet.\n        PortletPreferences prefs = request.getPreferences();\n        final String searchLaunchFname = prefs.getValue(SEARCH_LAUNCH_FNAME, null);\n        if (searchLaunchFname != null) {\n            model.put(\"searchLaunchUrl\", calculateSearchLaunchUrl(request, response));\n            model.put(\"autocompleteUrl\", calculateAutocompleteResourceUrl(request, response));\n            viewName = \"/jsp/Search/searchLauncher\";\n        }\n        return new ModelAndView(viewName, model);\n    }", "code_tokens": ["@", "RequestMapping", "public", "ModelAndView", "showSearchForm", "(", "RenderRequest", "request", ",", "RenderResponse", "response", ")", "{", "final", "Map", "<", "String", ",", "Object", ">", "model", "=", "new", "HashMap", "<>", "(", ")", ";", "String", "viewName", ";", "// Determine if the new REST search should be used", "if", "(", "isRestSearch", "(", "request", ")", ")", "{", "viewName", "=", "\"/jsp/Search/searchRest\"", ";", "}", "else", "{", "// Determine if this portlet displays the search launch view or regular search view.", "final", "boolean", "isMobile", "=", "isMobile", "(", "request", ")", ";", "viewName", "=", "isMobile", "?", "\"/jsp/Search/mobileSearch\"", ":", "\"/jsp/Search/search\"", ";", "}", "// If this search portlet is configured to be the searchLauncher, calculate the URLs to the", "// indicated", "// search portlet.", "PortletPreferences", "prefs", "=", "request", ".", "getPreferences", "(", ")", ";", "final", "String", "searchLaunchFname", "=", "prefs", ".", "getValue", "(", "SEARCH_LAUNCH_FNAME", ",", "null", ")", ";", "if", "(", "searchLaunchFname", "!=", "null", ")", "{", "model", ".", "put", "(", "\"searchLaunchUrl\"", ",", "calculateSearchLaunchUrl", "(", "request", ",", "response", ")", ")", ";", "model", ".", "put", "(", "\"autocompleteUrl\"", ",", "calculateAutocompleteResourceUrl", "(", "request", ",", "response", ")", ")", ";", "viewName", "=", "\"/jsp/Search/searchLauncher\"", ";", "}", "return", "new", "ModelAndView", "(", "viewName", ",", "model", ")", ";", "}"], "docstring": "Display a search form", "docstring_tokens": ["Display", "a", "search", "form"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L538-L563", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.calculateSearchLaunchUrl", "original_string": "private String calculateSearchLaunchUrl(RenderRequest request, RenderResponse response) {\n        final HttpServletRequest httpRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPortalUrlBuilder portalUrlBuilder =\n                this.portalUrlProvider.getPortalUrlBuilderByPortletFName(\n                        httpRequest, \"search\", UrlType.ACTION);\n        return portalUrlBuilder.getUrlString();\n    }", "language": "java", "code": "private String calculateSearchLaunchUrl(RenderRequest request, RenderResponse response) {\n        final HttpServletRequest httpRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPortalUrlBuilder portalUrlBuilder =\n                this.portalUrlProvider.getPortalUrlBuilderByPortletFName(\n                        httpRequest, \"search\", UrlType.ACTION);\n        return portalUrlBuilder.getUrlString();\n    }", "code_tokens": ["private", "String", "calculateSearchLaunchUrl", "(", "RenderRequest", "request", ",", "RenderResponse", "response", ")", "{", "final", "HttpServletRequest", "httpRequest", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "request", ")", ";", "final", "IPortalUrlBuilder", "portalUrlBuilder", "=", "this", ".", "portalUrlProvider", ".", "getPortalUrlBuilderByPortletFName", "(", "httpRequest", ",", "\"search\"", ",", "UrlType", ".", "ACTION", ")", ";", "return", "portalUrlBuilder", ".", "getUrlString", "(", ")", ";", "}"], "docstring": "Create an actionUrl for the indicated portlet The resource URL is for the ajax typing search\nresults response.\n\n@param request render request\n@param response render response", "docstring_tokens": ["Create", "an", "actionUrl", "for", "the", "indicated", "portlet", "The", "resource", "URL", "is", "for", "the", "ajax", "typing", "search", "results", "response", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L572-L579", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.calculateAutocompleteResourceUrl", "original_string": "private String calculateAutocompleteResourceUrl(\n            RenderRequest request, RenderResponse response) {\n        final HttpServletRequest httpRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPortalUrlBuilder portalUrlBuilder =\n                this.portalUrlProvider.getPortalUrlBuilderByPortletFName(\n                        httpRequest, \"search\", UrlType.RESOURCE);\n        final IPortletUrlBuilder portletUrlBuilder =\n                portalUrlBuilder.getPortletUrlBuilder(portalUrlBuilder.getTargetPortletWindowId());\n        portletUrlBuilder.setResourceId(AJAX_RESPONSE_RESOURCE_ID);\n        return portletUrlBuilder.getPortalUrlBuilder().getUrlString();\n    }", "language": "java", "code": "private String calculateAutocompleteResourceUrl(\n            RenderRequest request, RenderResponse response) {\n        final HttpServletRequest httpRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPortalUrlBuilder portalUrlBuilder =\n                this.portalUrlProvider.getPortalUrlBuilderByPortletFName(\n                        httpRequest, \"search\", UrlType.RESOURCE);\n        final IPortletUrlBuilder portletUrlBuilder =\n                portalUrlBuilder.getPortletUrlBuilder(portalUrlBuilder.getTargetPortletWindowId());\n        portletUrlBuilder.setResourceId(AJAX_RESPONSE_RESOURCE_ID);\n        return portletUrlBuilder.getPortalUrlBuilder().getUrlString();\n    }", "code_tokens": ["private", "String", "calculateAutocompleteResourceUrl", "(", "RenderRequest", "request", ",", "RenderResponse", "response", ")", "{", "final", "HttpServletRequest", "httpRequest", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "request", ")", ";", "final", "IPortalUrlBuilder", "portalUrlBuilder", "=", "this", ".", "portalUrlProvider", ".", "getPortalUrlBuilderByPortletFName", "(", "httpRequest", ",", "\"search\"", ",", "UrlType", ".", "RESOURCE", ")", ";", "final", "IPortletUrlBuilder", "portletUrlBuilder", "=", "portalUrlBuilder", ".", "getPortletUrlBuilder", "(", "portalUrlBuilder", ".", "getTargetPortletWindowId", "(", ")", ")", ";", "portletUrlBuilder", ".", "setResourceId", "(", "AJAX_RESPONSE_RESOURCE_ID", ")", ";", "return", "portletUrlBuilder", ".", "getPortalUrlBuilder", "(", ")", ".", "getUrlString", "(", ")", ";", "}"], "docstring": "Create a resourceUrl for <code>AJAX_RESPONSE_RESOURCE_ID</code>. The resource URL is for the\najax typing search results response.\n\n@param request render request\n@param response render response", "docstring_tokens": ["Create", "a", "resourceUrl", "for", "<code", ">", "AJAX_RESPONSE_RESOURCE_ID<", "/", "code", ">", ".", "The", "resource", "URL", "is", "for", "the", "ajax", "typing", "search", "results", "response", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L588-L599", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.showSearchResults", "original_string": "@RequestMapping(params = {\"query\", \"queryId\"})\n    public ModelAndView showSearchResults(\n            PortletRequest request,\n            @RequestParam(value = \"query\") String query,\n            @RequestParam(value = \"queryId\") String queryId) {\n\n        final Map<String, Object> model = new HashMap<>();\n        model.put(\"query\", query);\n\n        // Determine if the new REST search should be used\n        if (isRestSearch(request)) {\n            // we only need query, so the model at this point is sufficient\n            return new ModelAndView(\"/jsp/Search/searchRest\", model);\n        }\n\n        ConcurrentMap<String, List<Tuple<SearchResult, String>>> results =\n                new ConcurrentHashMap<>();\n        final PortalSearchResults portalSearchResults =\n                this.getPortalSearchResults(request, queryId);\n        if (portalSearchResults != null) {\n            results = portalSearchResults.getResults();\n        }\n\n        results.forEach(\n                (key, value) -> {\n                    value.sort(Comparator.comparingInt(tuple -> tuple.first.getRank()));\n                });\n\n        logger.debug(\"Search results for query '{}' are:  {}\", query, results);\n\n        model.put(\"results\", results);\n        model.put(\"defaultTabKey\", this.defaultTabKey);\n        model.put(\"tabKeys\", this.tabKeys);\n\n        final boolean isMobile = isMobile(request);\n        String viewName = isMobile ? \"/jsp/Search/mobileSearch\" : \"/jsp/Search/search\";\n\n        return new ModelAndView(viewName, model);\n    }", "language": "java", "code": "@RequestMapping(params = {\"query\", \"queryId\"})\n    public ModelAndView showSearchResults(\n            PortletRequest request,\n            @RequestParam(value = \"query\") String query,\n            @RequestParam(value = \"queryId\") String queryId) {\n\n        final Map<String, Object> model = new HashMap<>();\n        model.put(\"query\", query);\n\n        // Determine if the new REST search should be used\n        if (isRestSearch(request)) {\n            // we only need query, so the model at this point is sufficient\n            return new ModelAndView(\"/jsp/Search/searchRest\", model);\n        }\n\n        ConcurrentMap<String, List<Tuple<SearchResult, String>>> results =\n                new ConcurrentHashMap<>();\n        final PortalSearchResults portalSearchResults =\n                this.getPortalSearchResults(request, queryId);\n        if (portalSearchResults != null) {\n            results = portalSearchResults.getResults();\n        }\n\n        results.forEach(\n                (key, value) -> {\n                    value.sort(Comparator.comparingInt(tuple -> tuple.first.getRank()));\n                });\n\n        logger.debug(\"Search results for query '{}' are:  {}\", query, results);\n\n        model.put(\"results\", results);\n        model.put(\"defaultTabKey\", this.defaultTabKey);\n        model.put(\"tabKeys\", this.tabKeys);\n\n        final boolean isMobile = isMobile(request);\n        String viewName = isMobile ? \"/jsp/Search/mobileSearch\" : \"/jsp/Search/search\";\n\n        return new ModelAndView(viewName, model);\n    }", "code_tokens": ["@", "RequestMapping", "(", "params", "=", "{", "\"query\"", ",", "\"queryId\"", "}", ")", "public", "ModelAndView", "showSearchResults", "(", "PortletRequest", "request", ",", "@", "RequestParam", "(", "value", "=", "\"query\"", ")", "String", "query", ",", "@", "RequestParam", "(", "value", "=", "\"queryId\"", ")", "String", "queryId", ")", "{", "final", "Map", "<", "String", ",", "Object", ">", "model", "=", "new", "HashMap", "<>", "(", ")", ";", "model", ".", "put", "(", "\"query\"", ",", "query", ")", ";", "// Determine if the new REST search should be used", "if", "(", "isRestSearch", "(", "request", ")", ")", "{", "// we only need query, so the model at this point is sufficient", "return", "new", "ModelAndView", "(", "\"/jsp/Search/searchRest\"", ",", "model", ")", ";", "}", "ConcurrentMap", "<", "String", ",", "List", "<", "Tuple", "<", "SearchResult", ",", "String", ">", ">", ">", "results", "=", "new", "ConcurrentHashMap", "<>", "(", ")", ";", "final", "PortalSearchResults", "portalSearchResults", "=", "this", ".", "getPortalSearchResults", "(", "request", ",", "queryId", ")", ";", "if", "(", "portalSearchResults", "!=", "null", ")", "{", "results", "=", "portalSearchResults", ".", "getResults", "(", ")", ";", "}", "results", ".", "forEach", "(", "(", "key", ",", "value", ")", "->", "{", "value", ".", "sort", "(", "Comparator", ".", "comparingInt", "(", "tuple", "->", "tuple", ".", "first", ".", "getRank", "(", ")", ")", ")", ";", "}", ")", ";", "logger", ".", "debug", "(", "\"Search results for query '{}' are:  {}\"", ",", "query", ",", "results", ")", ";", "model", ".", "put", "(", "\"results\"", ",", "results", ")", ";", "model", ".", "put", "(", "\"defaultTabKey\"", ",", "this", ".", "defaultTabKey", ")", ";", "model", ".", "put", "(", "\"tabKeys\"", ",", "this", ".", "tabKeys", ")", ";", "final", "boolean", "isMobile", "=", "isMobile", "(", "request", ")", ";", "String", "viewName", "=", "isMobile", "?", "\"/jsp/Search/mobileSearch\"", ":", "\"/jsp/Search/search\"", ";", "return", "new", "ModelAndView", "(", "viewName", ",", "model", ")", ";", "}"], "docstring": "Display search results", "docstring_tokens": ["Display", "search", "results"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L602-L640", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.showSearchError", "original_string": "@RequestMapping(params = {\"query\", \"hitMaxQueries\"})\n    public ModelAndView showSearchError(\n            PortletRequest request,\n            @RequestParam(value = \"query\") String query,\n            @RequestParam(value = \"hitMaxQueries\") boolean hitMaxQueries) {\n\n        final Map<String, Object> model = new HashMap<>();\n        model.put(\"query\", query);\n        model.put(\"hitMaxQueries\", hitMaxQueries);\n\n        final boolean isMobile = isMobile(request);\n        String viewName = isMobile ? \"/jsp/Search/mobileSearch\" : \"/jsp/Search/search\";\n\n        return new ModelAndView(viewName, model);\n    }", "language": "java", "code": "@RequestMapping(params = {\"query\", \"hitMaxQueries\"})\n    public ModelAndView showSearchError(\n            PortletRequest request,\n            @RequestParam(value = \"query\") String query,\n            @RequestParam(value = \"hitMaxQueries\") boolean hitMaxQueries) {\n\n        final Map<String, Object> model = new HashMap<>();\n        model.put(\"query\", query);\n        model.put(\"hitMaxQueries\", hitMaxQueries);\n\n        final boolean isMobile = isMobile(request);\n        String viewName = isMobile ? \"/jsp/Search/mobileSearch\" : \"/jsp/Search/search\";\n\n        return new ModelAndView(viewName, model);\n    }", "code_tokens": ["@", "RequestMapping", "(", "params", "=", "{", "\"query\"", ",", "\"hitMaxQueries\"", "}", ")", "public", "ModelAndView", "showSearchError", "(", "PortletRequest", "request", ",", "@", "RequestParam", "(", "value", "=", "\"query\"", ")", "String", "query", ",", "@", "RequestParam", "(", "value", "=", "\"hitMaxQueries\"", ")", "boolean", "hitMaxQueries", ")", "{", "final", "Map", "<", "String", ",", "Object", ">", "model", "=", "new", "HashMap", "<>", "(", ")", ";", "model", ".", "put", "(", "\"query\"", ",", "query", ")", ";", "model", ".", "put", "(", "\"hitMaxQueries\"", ",", "hitMaxQueries", ")", ";", "final", "boolean", "isMobile", "=", "isMobile", "(", "request", ")", ";", "String", "viewName", "=", "isMobile", "?", "\"/jsp/Search/mobileSearch\"", ":", "\"/jsp/Search/search\"", ";", "return", "new", "ModelAndView", "(", "viewName", ",", "model", ")", ";", "}"], "docstring": "Display search results", "docstring_tokens": ["Display", "search", "results"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L643-L657", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.showJSONSearchResults", "original_string": "@ResourceMapping(value = \"retrieveSearchJSONResults\")\n    public ModelAndView showJSONSearchResults(PortletRequest request) {\n\n        PortletPreferences prefs = request.getPreferences();\n        int maxTextLength =\n                Integer.parseInt(prefs.getValue(AUTOCOMPLETE_MAX_TEXT_LENGTH_PREF_NAME, \"180\"));\n\n        final Map<String, Object> model = new HashMap<>();\n        List<AutocompleteResultsModel> results = new ArrayList<>();\n\n        final PortletSession session = request.getPortletSession();\n        String queryId = (String) session.getAttribute(SEARCH_LAST_QUERY_ID);\n        if (queryId != null) {\n            final PortalSearchResults portalSearchResults =\n                    this.getPortalSearchResults(request, queryId);\n            if (portalSearchResults != null) {\n                final ConcurrentMap<String, List<Tuple<SearchResult, String>>> resultsMap =\n                        portalSearchResults.getResults();\n                results = collateResultsForAutoCompleteResponse(resultsMap, maxTextLength);\n            }\n        }\n        model.put(\"results\", results);\n        model.put(\"count\", results.size());\n        return new ModelAndView(\"json\", model);\n    }", "language": "java", "code": "@ResourceMapping(value = \"retrieveSearchJSONResults\")\n    public ModelAndView showJSONSearchResults(PortletRequest request) {\n\n        PortletPreferences prefs = request.getPreferences();\n        int maxTextLength =\n                Integer.parseInt(prefs.getValue(AUTOCOMPLETE_MAX_TEXT_LENGTH_PREF_NAME, \"180\"));\n\n        final Map<String, Object> model = new HashMap<>();\n        List<AutocompleteResultsModel> results = new ArrayList<>();\n\n        final PortletSession session = request.getPortletSession();\n        String queryId = (String) session.getAttribute(SEARCH_LAST_QUERY_ID);\n        if (queryId != null) {\n            final PortalSearchResults portalSearchResults =\n                    this.getPortalSearchResults(request, queryId);\n            if (portalSearchResults != null) {\n                final ConcurrentMap<String, List<Tuple<SearchResult, String>>> resultsMap =\n                        portalSearchResults.getResults();\n                results = collateResultsForAutoCompleteResponse(resultsMap, maxTextLength);\n            }\n        }\n        model.put(\"results\", results);\n        model.put(\"count\", results.size());\n        return new ModelAndView(\"json\", model);\n    }", "code_tokens": ["@", "ResourceMapping", "(", "value", "=", "\"retrieveSearchJSONResults\"", ")", "public", "ModelAndView", "showJSONSearchResults", "(", "PortletRequest", "request", ")", "{", "PortletPreferences", "prefs", "=", "request", ".", "getPreferences", "(", ")", ";", "int", "maxTextLength", "=", "Integer", ".", "parseInt", "(", "prefs", ".", "getValue", "(", "AUTOCOMPLETE_MAX_TEXT_LENGTH_PREF_NAME", ",", "\"180\"", ")", ")", ";", "final", "Map", "<", "String", ",", "Object", ">", "model", "=", "new", "HashMap", "<>", "(", ")", ";", "List", "<", "AutocompleteResultsModel", ">", "results", "=", "new", "ArrayList", "<>", "(", ")", ";", "final", "PortletSession", "session", "=", "request", ".", "getPortletSession", "(", ")", ";", "String", "queryId", "=", "(", "String", ")", "session", ".", "getAttribute", "(", "SEARCH_LAST_QUERY_ID", ")", ";", "if", "(", "queryId", "!=", "null", ")", "{", "final", "PortalSearchResults", "portalSearchResults", "=", "this", ".", "getPortalSearchResults", "(", "request", ",", "queryId", ")", ";", "if", "(", "portalSearchResults", "!=", "null", ")", "{", "final", "ConcurrentMap", "<", "String", ",", "List", "<", "Tuple", "<", "SearchResult", ",", "String", ">", ">", ">", "resultsMap", "=", "portalSearchResults", ".", "getResults", "(", ")", ";", "results", "=", "collateResultsForAutoCompleteResponse", "(", "resultsMap", ",", "maxTextLength", ")", ";", "}", "}", "model", ".", "put", "(", "\"results\"", ",", "results", ")", ";", "model", ".", "put", "(", "\"count\"", ",", "results", ".", "size", "(", ")", ")", ";", "return", "new", "ModelAndView", "(", "\"json\"", ",", "model", ")", ";", "}"], "docstring": "Display AJAX autocomplete search results for the last query", "docstring_tokens": ["Display", "AJAX", "autocomplete", "search", "results", "for", "the", "last", "query"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L660-L684", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.collateResultsForAutoCompleteResponse", "original_string": "private List<AutocompleteResultsModel> collateResultsForAutoCompleteResponse(\n            ConcurrentMap<String, List<Tuple<SearchResult, String>>> resultsMap,\n            int maxTextLength) {\n        SortedMap<Integer, List<AutocompleteResultsModel>> prioritizedResultsMap =\n                getCleanedAndSortedMapResults(resultsMap, maxTextLength);\n\n        // Consolidate the results into a single, ordered list of max entries.\n        List<AutocompleteResultsModel> results = new ArrayList<>();\n        for (List<AutocompleteResultsModel> items : prioritizedResultsMap.values()) {\n            results.addAll(items);\n            if (results.size() >= maxAutocompleteSearchResults) {\n                break;\n            }\n        }\n        return results.subList(\n                0,\n                results.size() > maxAutocompleteSearchResults\n                        ? maxAutocompleteSearchResults\n                        : results.size());\n    }", "language": "java", "code": "private List<AutocompleteResultsModel> collateResultsForAutoCompleteResponse(\n            ConcurrentMap<String, List<Tuple<SearchResult, String>>> resultsMap,\n            int maxTextLength) {\n        SortedMap<Integer, List<AutocompleteResultsModel>> prioritizedResultsMap =\n                getCleanedAndSortedMapResults(resultsMap, maxTextLength);\n\n        // Consolidate the results into a single, ordered list of max entries.\n        List<AutocompleteResultsModel> results = new ArrayList<>();\n        for (List<AutocompleteResultsModel> items : prioritizedResultsMap.values()) {\n            results.addAll(items);\n            if (results.size() >= maxAutocompleteSearchResults) {\n                break;\n            }\n        }\n        return results.subList(\n                0,\n                results.size() > maxAutocompleteSearchResults\n                        ? maxAutocompleteSearchResults\n                        : results.size());\n    }", "code_tokens": ["private", "List", "<", "AutocompleteResultsModel", ">", "collateResultsForAutoCompleteResponse", "(", "ConcurrentMap", "<", "String", ",", "List", "<", "Tuple", "<", "SearchResult", ",", "String", ">", ">", ">", "resultsMap", ",", "int", "maxTextLength", ")", "{", "SortedMap", "<", "Integer", ",", "List", "<", "AutocompleteResultsModel", ">", ">", "prioritizedResultsMap", "=", "getCleanedAndSortedMapResults", "(", "resultsMap", ",", "maxTextLength", ")", ";", "// Consolidate the results into a single, ordered list of max entries.", "List", "<", "AutocompleteResultsModel", ">", "results", "=", "new", "ArrayList", "<>", "(", ")", ";", "for", "(", "List", "<", "AutocompleteResultsModel", ">", "items", ":", "prioritizedResultsMap", ".", "values", "(", ")", ")", "{", "results", ".", "addAll", "(", "items", ")", ";", "if", "(", "results", ".", "size", "(", ")", ">=", "maxAutocompleteSearchResults", ")", "{", "break", ";", "}", "}", "return", "results", ".", "subList", "(", "0", ",", "results", ".", "size", "(", ")", ">", "maxAutocompleteSearchResults", "?", "maxAutocompleteSearchResults", ":", "results", ".", "size", "(", ")", ")", ";", "}"], "docstring": "Accepts a map (tab name, List of tuple search results) and returns a prioritized list of\nresults for the ajax autocomplete feature. The computing impact of moving the list items\naround should be fairly small since there are not too many search results (unless we get a\nlot of search providers, in which case the results could be put into the appropriate format\nin the Event SEARCH_RESULTS_QNAME_STRING handling).\n\n<p>Note that the method (as well as the SearchResults Event handler) do not impose a\nconsistent ordering on results. The results are ordered by priority, but within a particular\npriority the same search may have results ordered differently based upon when the\nSearchResults Event handler receives the search results event list. Also if a search result\nis in multiple category types, even within the same priority, the search result will show up\nmultiple times. Currently all results are in a single category so it is not worth adding\nextra complexity to handle a situation that is not present.\n\n<p>This method also cleans up and trims down the amount of data shipped so the feature is\nmore responsive, especially on mobile networks.\n\n@param resultsMap\n@return", "docstring_tokens": ["Accepts", "a", "map", "(", "tab", "name", "List", "of", "tuple", "search", "results", ")", "and", "returns", "a", "prioritized", "list", "of", "results", "for", "the", "ajax", "autocomplete", "feature", ".", "The", "computing", "impact", "of", "moving", "the", "list", "items", "around", "should", "be", "fairly", "small", "since", "there", "are", "not", "too", "many", "search", "results", "(", "unless", "we", "get", "a", "lot", "of", "search", "providers", "in", "which", "case", "the", "results", "could", "be", "put", "into", "the", "appropriate", "format", "in", "the", "Event", "SEARCH_RESULTS_QNAME_STRING", "handling", ")", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L707-L726", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.getCleanedAndSortedMapResults", "original_string": "private SortedMap<Integer, List<AutocompleteResultsModel>> getCleanedAndSortedMapResults(\n            ConcurrentMap<String, List<Tuple<SearchResult, String>>> resultsMap,\n            int maxTextLength) {\n        SortedMap<Integer, List<AutocompleteResultsModel>> prioritizedResultsMap =\n                createAutocompletePriorityMap();\n\n        // Put the results into the map of <priority,list>\n        for (Map.Entry<String, List<Tuple<SearchResult, String>>> entry : resultsMap.entrySet()) {\n            for (Tuple<SearchResult, String> tupleSearchResult : entry.getValue()) {\n                SearchResult searchResult = tupleSearchResult.getFirst();\n                List<String> resultTypes = searchResult.getType();\n                // If the search result doesn't have a type defined, use the undefined result type.\n                if (resultTypes.size() == 0) {\n                    resultTypes = UNDEFINED_SEARCH_RESULT_TYPE;\n                }\n                for (String category : resultTypes) {\n                    // Exclude the result if it is a result type that's in the ignore list.\n                    if (!autocompleteIgnoreResultTypes.contains(category)) {\n                        int priority = calculatePriorityFromCategory(category);\n                        AutocompleteResultsModel result =\n                                new AutocompleteResultsModel(\n                                        cleanAndTrimString(searchResult.getTitle(), maxTextLength),\n                                        cleanAndTrimString(\n                                                searchResult.getSummary(), maxTextLength),\n                                        tupleSearchResult.getSecond(),\n                                        category);\n                        prioritizedResultsMap.get(priority).add(result);\n                    }\n                }\n            }\n        }\n        return prioritizedResultsMap;\n    }", "language": "java", "code": "private SortedMap<Integer, List<AutocompleteResultsModel>> getCleanedAndSortedMapResults(\n            ConcurrentMap<String, List<Tuple<SearchResult, String>>> resultsMap,\n            int maxTextLength) {\n        SortedMap<Integer, List<AutocompleteResultsModel>> prioritizedResultsMap =\n                createAutocompletePriorityMap();\n\n        // Put the results into the map of <priority,list>\n        for (Map.Entry<String, List<Tuple<SearchResult, String>>> entry : resultsMap.entrySet()) {\n            for (Tuple<SearchResult, String> tupleSearchResult : entry.getValue()) {\n                SearchResult searchResult = tupleSearchResult.getFirst();\n                List<String> resultTypes = searchResult.getType();\n                // If the search result doesn't have a type defined, use the undefined result type.\n                if (resultTypes.size() == 0) {\n                    resultTypes = UNDEFINED_SEARCH_RESULT_TYPE;\n                }\n                for (String category : resultTypes) {\n                    // Exclude the result if it is a result type that's in the ignore list.\n                    if (!autocompleteIgnoreResultTypes.contains(category)) {\n                        int priority = calculatePriorityFromCategory(category);\n                        AutocompleteResultsModel result =\n                                new AutocompleteResultsModel(\n                                        cleanAndTrimString(searchResult.getTitle(), maxTextLength),\n                                        cleanAndTrimString(\n                                                searchResult.getSummary(), maxTextLength),\n                                        tupleSearchResult.getSecond(),\n                                        category);\n                        prioritizedResultsMap.get(priority).add(result);\n                    }\n                }\n            }\n        }\n        return prioritizedResultsMap;\n    }", "code_tokens": ["private", "SortedMap", "<", "Integer", ",", "List", "<", "AutocompleteResultsModel", ">", ">", "getCleanedAndSortedMapResults", "(", "ConcurrentMap", "<", "String", ",", "List", "<", "Tuple", "<", "SearchResult", ",", "String", ">", ">", ">", "resultsMap", ",", "int", "maxTextLength", ")", "{", "SortedMap", "<", "Integer", ",", "List", "<", "AutocompleteResultsModel", ">", ">", "prioritizedResultsMap", "=", "createAutocompletePriorityMap", "(", ")", ";", "// Put the results into the map of <priority,list>", "for", "(", "Map", ".", "Entry", "<", "String", ",", "List", "<", "Tuple", "<", "SearchResult", ",", "String", ">", ">", ">", "entry", ":", "resultsMap", ".", "entrySet", "(", ")", ")", "{", "for", "(", "Tuple", "<", "SearchResult", ",", "String", ">", "tupleSearchResult", ":", "entry", ".", "getValue", "(", ")", ")", "{", "SearchResult", "searchResult", "=", "tupleSearchResult", ".", "getFirst", "(", ")", ";", "List", "<", "String", ">", "resultTypes", "=", "searchResult", ".", "getType", "(", ")", ";", "// If the search result doesn't have a type defined, use the undefined result type.", "if", "(", "resultTypes", ".", "size", "(", ")", "==", "0", ")", "{", "resultTypes", "=", "UNDEFINED_SEARCH_RESULT_TYPE", ";", "}", "for", "(", "String", "category", ":", "resultTypes", ")", "{", "// Exclude the result if it is a result type that's in the ignore list.", "if", "(", "!", "autocompleteIgnoreResultTypes", ".", "contains", "(", "category", ")", ")", "{", "int", "priority", "=", "calculatePriorityFromCategory", "(", "category", ")", ";", "AutocompleteResultsModel", "result", "=", "new", "AutocompleteResultsModel", "(", "cleanAndTrimString", "(", "searchResult", ".", "getTitle", "(", ")", ",", "maxTextLength", ")", ",", "cleanAndTrimString", "(", "searchResult", ".", "getSummary", "(", ")", ",", "maxTextLength", ")", ",", "tupleSearchResult", ".", "getSecond", "(", ")", ",", "category", ")", ";", "prioritizedResultsMap", ".", "get", "(", "priority", ")", ".", "add", "(", "result", ")", ";", "}", "}", "}", "}", "return", "prioritizedResultsMap", ";", "}"], "docstring": "Return the search results in a sorted map based on priority of the search result type\n\n@param resultsMap Search results map\n@return Sorted map of search results ordered on search result type priority", "docstring_tokens": ["Return", "the", "search", "results", "in", "a", "sorted", "map", "based", "on", "priority", "of", "the", "search", "result", "type"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L734-L766", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.cleanAndTrimString", "original_string": "private String cleanAndTrimString(String text, int maxTextLength) {\n        if (StringUtils.isNotBlank(text)) {\n            String cleaned = text.trim().replaceAll(\"[\\\\s]+\", \" \");\n            return cleaned.length() <= maxTextLength\n                    ? cleaned\n                    : cleaned.substring(0, maxTextLength) + \" ...\";\n        }\n        return text;\n    }", "language": "java", "code": "private String cleanAndTrimString(String text, int maxTextLength) {\n        if (StringUtils.isNotBlank(text)) {\n            String cleaned = text.trim().replaceAll(\"[\\\\s]+\", \" \");\n            return cleaned.length() <= maxTextLength\n                    ? cleaned\n                    : cleaned.substring(0, maxTextLength) + \" ...\";\n        }\n        return text;\n    }", "code_tokens": ["private", "String", "cleanAndTrimString", "(", "String", "text", ",", "int", "maxTextLength", ")", "{", "if", "(", "StringUtils", ".", "isNotBlank", "(", "text", ")", ")", "{", "String", "cleaned", "=", "text", ".", "trim", "(", ")", ".", "replaceAll", "(", "\"[\\\\s]+\"", ",", "\" \"", ")", ";", "return", "cleaned", ".", "length", "(", ")", "<=", "maxTextLength", "?", "cleaned", ":", "cleaned", ".", "substring", "(", "0", ",", "maxTextLength", ")", "+", "\" ...\"", ";", "}", "return", "text", ";", "}"], "docstring": "for slower network connections and makes autocomplete UI results smaller/shorter.", "docstring_tokens": ["for", "slower", "network", "connections", "and", "makes", "autocomplete", "UI", "results", "smaller", "/", "shorter", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L771-L779", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.getPortalSearchResults", "original_string": "private PortalSearchResults getPortalSearchResults(PortletRequest request, String queryId) {\n        final PortletSession session = request.getPortletSession();\n        @SuppressWarnings(\"unchecked\")\n        final Cache<String, PortalSearchResults> searchResultsCache =\n                (Cache<String, PortalSearchResults>)\n                        session.getAttribute(SEARCH_RESULTS_CACHE_NAME);\n        if (searchResultsCache == null) {\n            return null;\n        }\n\n        return searchResultsCache.getIfPresent(queryId);\n    }", "language": "java", "code": "private PortalSearchResults getPortalSearchResults(PortletRequest request, String queryId) {\n        final PortletSession session = request.getPortletSession();\n        @SuppressWarnings(\"unchecked\")\n        final Cache<String, PortalSearchResults> searchResultsCache =\n                (Cache<String, PortalSearchResults>)\n                        session.getAttribute(SEARCH_RESULTS_CACHE_NAME);\n        if (searchResultsCache == null) {\n            return null;\n        }\n\n        return searchResultsCache.getIfPresent(queryId);\n    }", "code_tokens": ["private", "PortalSearchResults", "getPortalSearchResults", "(", "PortletRequest", "request", ",", "String", "queryId", ")", "{", "final", "PortletSession", "session", "=", "request", ".", "getPortletSession", "(", ")", ";", "@", "SuppressWarnings", "(", "\"unchecked\"", ")", "final", "Cache", "<", "String", ",", "PortalSearchResults", ">", "searchResultsCache", "=", "(", "Cache", "<", "String", ",", "PortalSearchResults", ">", ")", "session", ".", "getAttribute", "(", "SEARCH_RESULTS_CACHE_NAME", ")", ";", "if", "(", "searchResultsCache", "==", "null", ")", "{", "return", "null", ";", "}", "return", "searchResultsCache", ".", "getIfPresent", "(", "queryId", ")", ";", "}"], "docstring": "Get the {@link PortalSearchResults} for the specified query id from the session. If there are\nno results null is returned.", "docstring_tokens": ["Get", "the", "{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L802-L813", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.modifySearchResultLinkTitle", "original_string": "protected void modifySearchResultLinkTitle(\n            SearchResult result,\n            final HttpServletRequest httpServletRequest,\n            final IPortletWindowId portletWindowId) {\n        // If the title contains a SpEL expression, parse it with the portlet definition in the\n        // evaluation context.\n        if (result.getType().size() > 0 && result.getTitle().contains(\"${\")) {\n            final IPortletWindow portletWindow =\n                    this.portletWindowRegistry.getPortletWindow(\n                            httpServletRequest, portletWindowId);\n            final IPortletEntity portletEntity = portletWindow.getPortletEntity();\n            final IPortletDefinition portletDefinition = portletEntity.getPortletDefinition();\n            final SpELEnvironmentRoot spelEnvironment = new SpELEnvironmentRoot(portletDefinition);\n            try {\n                result.setTitle(spELService.getValue(result.getTitle(), spelEnvironment));\n            } catch (SpelParseException | SpelEvaluationException e) {\n                result.setTitle(\"(Invalid portlet title) - see details in log file\");\n                logger.error(\n                        \"Invalid Spring EL expression {} in search result portlet title\",\n                        result.getTitle(),\n                        e);\n            }\n        }\n    }", "language": "java", "code": "protected void modifySearchResultLinkTitle(\n            SearchResult result,\n            final HttpServletRequest httpServletRequest,\n            final IPortletWindowId portletWindowId) {\n        // If the title contains a SpEL expression, parse it with the portlet definition in the\n        // evaluation context.\n        if (result.getType().size() > 0 && result.getTitle().contains(\"${\")) {\n            final IPortletWindow portletWindow =\n                    this.portletWindowRegistry.getPortletWindow(\n                            httpServletRequest, portletWindowId);\n            final IPortletEntity portletEntity = portletWindow.getPortletEntity();\n            final IPortletDefinition portletDefinition = portletEntity.getPortletDefinition();\n            final SpELEnvironmentRoot spelEnvironment = new SpELEnvironmentRoot(portletDefinition);\n            try {\n                result.setTitle(spELService.getValue(result.getTitle(), spelEnvironment));\n            } catch (SpelParseException | SpelEvaluationException e) {\n                result.setTitle(\"(Invalid portlet title) - see details in log file\");\n                logger.error(\n                        \"Invalid Spring EL expression {} in search result portlet title\",\n                        result.getTitle(),\n                        e);\n            }\n        }\n    }", "code_tokens": ["protected", "void", "modifySearchResultLinkTitle", "(", "SearchResult", "result", ",", "final", "HttpServletRequest", "httpServletRequest", ",", "final", "IPortletWindowId", "portletWindowId", ")", "{", "// If the title contains a SpEL expression, parse it with the portlet definition in the", "// evaluation context.", "if", "(", "result", ".", "getType", "(", ")", ".", "size", "(", ")", ">", "0", "&&", "result", ".", "getTitle", "(", ")", ".", "contains", "(", "\"${\"", ")", ")", "{", "final", "IPortletWindow", "portletWindow", "=", "this", ".", "portletWindowRegistry", ".", "getPortletWindow", "(", "httpServletRequest", ",", "portletWindowId", ")", ";", "final", "IPortletEntity", "portletEntity", "=", "portletWindow", ".", "getPortletEntity", "(", ")", ";", "final", "IPortletDefinition", "portletDefinition", "=", "portletEntity", ".", "getPortletDefinition", "(", ")", ";", "final", "SpELEnvironmentRoot", "spelEnvironment", "=", "new", "SpELEnvironmentRoot", "(", "portletDefinition", ")", ";", "try", "{", "result", ".", "setTitle", "(", "spELService", ".", "getValue", "(", "result", ".", "getTitle", "(", ")", ",", "spelEnvironment", ")", ")", ";", "}", "catch", "(", "SpelParseException", "|", "SpelEvaluationException", "e", ")", "{", "result", ".", "setTitle", "(", "\"(Invalid portlet title) - see details in log file\"", ")", ";", "logger", ".", "error", "(", "\"Invalid Spring EL expression {} in search result portlet title\"", ",", "result", ".", "getTitle", "(", ")", ",", "e", ")", ";", "}", "}", "}"], "docstring": "Since portlets don't have access to the portlet definition to create a useful search results\nlink using something like the portlet definition's title, post-process the link text and for\nthose portlets whose type is present in the substitution set, replace the title with the\nportlet definition's title.\n\n@param result Search results object (may be modified)\n@param httpServletRequest HttpServletRequest\n@param portletWindowId Portlet Window ID", "docstring_tokens": ["Since", "portlets", "don", "t", "have", "access", "to", "the", "portlet", "definition", "to", "create", "a", "useful", "search", "results", "link", "using", "something", "like", "the", "portlet", "definition", "s", "title", "post", "-", "process", "the", "link", "text", "and", "for", "those", "portlets", "whose", "type", "is", "present", "in", "the", "substitution", "set", "replace", "the", "title", "with", "the", "portlet", "definition", "s", "title", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L845-L868", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.getResultUrl", "original_string": "protected String getResultUrl(\n            HttpServletRequest httpServletRequest,\n            SearchResult result,\n            IPortletWindowId portletWindowId) {\n        final String externalUrl = result.getExternalUrl();\n        if (externalUrl != null) {\n            return externalUrl;\n        }\n\n        UrlType urlType = UrlType.RENDER;\n\n        final PortletUrl portletUrl = result.getPortletUrl();\n        if (portletUrl != null) {\n            final PortletUrlType type = portletUrl.getType();\n            if (type != null) {\n                switch (type) {\n                    case ACTION:\n                        {\n                            urlType = UrlType.ACTION;\n                            break;\n                        }\n                    default:\n                    case RENDER:\n                        {\n                            urlType = UrlType.RENDER;\n                            break;\n                        }\n                    case RESOURCE:\n                        {\n                            urlType = UrlType.RESOURCE;\n                            break;\n                        }\n                }\n            }\n        }\n\n        final IPortalUrlBuilder portalUrlBuilder =\n                this.portalUrlProvider.getPortalUrlBuilderByPortletWindow(\n                        httpServletRequest, portletWindowId, urlType);\n        final IPortletUrlBuilder portletUrlBuilder =\n                portalUrlBuilder.getTargetedPortletUrlBuilder();\n\n        if (portletUrl != null) {\n            final String portletMode = portletUrl.getPortletMode();\n            if (portletMode != null) {\n                portletUrlBuilder.setPortletMode(PortletUtils.getPortletMode(portletMode));\n            }\n            final String windowState = portletUrl.getWindowState();\n            if (windowState != null) {\n                portletUrlBuilder.setWindowState(PortletUtils.getWindowState(windowState));\n            }\n            for (final PortletUrlParameter param : portletUrl.getParam()) {\n                final String name = param.getName();\n                final List<String> values = param.getValue();\n                portletUrlBuilder.addParameter(name, values.toArray(new String[values.size()]));\n            }\n        }\n\n        return portalUrlBuilder.getUrlString();\n    }", "language": "java", "code": "protected String getResultUrl(\n            HttpServletRequest httpServletRequest,\n            SearchResult result,\n            IPortletWindowId portletWindowId) {\n        final String externalUrl = result.getExternalUrl();\n        if (externalUrl != null) {\n            return externalUrl;\n        }\n\n        UrlType urlType = UrlType.RENDER;\n\n        final PortletUrl portletUrl = result.getPortletUrl();\n        if (portletUrl != null) {\n            final PortletUrlType type = portletUrl.getType();\n            if (type != null) {\n                switch (type) {\n                    case ACTION:\n                        {\n                            urlType = UrlType.ACTION;\n                            break;\n                        }\n                    default:\n                    case RENDER:\n                        {\n                            urlType = UrlType.RENDER;\n                            break;\n                        }\n                    case RESOURCE:\n                        {\n                            urlType = UrlType.RESOURCE;\n                            break;\n                        }\n                }\n            }\n        }\n\n        final IPortalUrlBuilder portalUrlBuilder =\n                this.portalUrlProvider.getPortalUrlBuilderByPortletWindow(\n                        httpServletRequest, portletWindowId, urlType);\n        final IPortletUrlBuilder portletUrlBuilder =\n                portalUrlBuilder.getTargetedPortletUrlBuilder();\n\n        if (portletUrl != null) {\n            final String portletMode = portletUrl.getPortletMode();\n            if (portletMode != null) {\n                portletUrlBuilder.setPortletMode(PortletUtils.getPortletMode(portletMode));\n            }\n            final String windowState = portletUrl.getWindowState();\n            if (windowState != null) {\n                portletUrlBuilder.setWindowState(PortletUtils.getWindowState(windowState));\n            }\n            for (final PortletUrlParameter param : portletUrl.getParam()) {\n                final String name = param.getName();\n                final List<String> values = param.getValue();\n                portletUrlBuilder.addParameter(name, values.toArray(new String[values.size()]));\n            }\n        }\n\n        return portalUrlBuilder.getUrlString();\n    }", "code_tokens": ["protected", "String", "getResultUrl", "(", "HttpServletRequest", "httpServletRequest", ",", "SearchResult", "result", ",", "IPortletWindowId", "portletWindowId", ")", "{", "final", "String", "externalUrl", "=", "result", ".", "getExternalUrl", "(", ")", ";", "if", "(", "externalUrl", "!=", "null", ")", "{", "return", "externalUrl", ";", "}", "UrlType", "urlType", "=", "UrlType", ".", "RENDER", ";", "final", "PortletUrl", "portletUrl", "=", "result", ".", "getPortletUrl", "(", ")", ";", "if", "(", "portletUrl", "!=", "null", ")", "{", "final", "PortletUrlType", "type", "=", "portletUrl", ".", "getType", "(", ")", ";", "if", "(", "type", "!=", "null", ")", "{", "switch", "(", "type", ")", "{", "case", "ACTION", ":", "{", "urlType", "=", "UrlType", ".", "ACTION", ";", "break", ";", "}", "default", ":", "case", "RENDER", ":", "{", "urlType", "=", "UrlType", ".", "RENDER", ";", "break", ";", "}", "case", "RESOURCE", ":", "{", "urlType", "=", "UrlType", ".", "RESOURCE", ";", "break", ";", "}", "}", "}", "}", "final", "IPortalUrlBuilder", "portalUrlBuilder", "=", "this", ".", "portalUrlProvider", ".", "getPortalUrlBuilderByPortletWindow", "(", "httpServletRequest", ",", "portletWindowId", ",", "urlType", ")", ";", "final", "IPortletUrlBuilder", "portletUrlBuilder", "=", "portalUrlBuilder", ".", "getTargetedPortletUrlBuilder", "(", ")", ";", "if", "(", "portletUrl", "!=", "null", ")", "{", "final", "String", "portletMode", "=", "portletUrl", ".", "getPortletMode", "(", ")", ";", "if", "(", "portletMode", "!=", "null", ")", "{", "portletUrlBuilder", ".", "setPortletMode", "(", "PortletUtils", ".", "getPortletMode", "(", "portletMode", ")", ")", ";", "}", "final", "String", "windowState", "=", "portletUrl", ".", "getWindowState", "(", ")", ";", "if", "(", "windowState", "!=", "null", ")", "{", "portletUrlBuilder", ".", "setWindowState", "(", "PortletUtils", ".", "getWindowState", "(", "windowState", ")", ")", ";", "}", "for", "(", "final", "PortletUrlParameter", "param", ":", "portletUrl", ".", "getParam", "(", ")", ")", "{", "final", "String", "name", "=", "param", ".", "getName", "(", ")", ";", "final", "List", "<", "String", ">", "values", "=", "param", ".", "getValue", "(", ")", ";", "portletUrlBuilder", ".", "addParameter", "(", "name", ",", "values", ".", "toArray", "(", "new", "String", "[", "values", ".", "size", "(", ")", "]", ")", ")", ";", "}", "}", "return", "portalUrlBuilder", ".", "getUrlString", "(", ")", ";", "}"], "docstring": "Determine the url for the search result", "docstring_tokens": ["Determine", "the", "url", "for", "the", "search", "result"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L871-L930", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-ldap/src/main/java/org/apereo/portal/groups/ldap/LDAPGroupStore.java", "func_name": "LDAPGroupStore.contains", "original_string": "@Override\n    public boolean contains(IEntityGroup group, IGroupMember member) throws GroupsException {\n        boolean found = false;\n        Iterator itr = (member.isGroup()) ? findMemberGroups(group) : findEntitiesForGroup(group);\n        while (itr.hasNext() && !found) {\n            found = member.equals(itr.next());\n        }\n        return found;\n    }", "language": "java", "code": "@Override\n    public boolean contains(IEntityGroup group, IGroupMember member) throws GroupsException {\n        boolean found = false;\n        Iterator itr = (member.isGroup()) ? findMemberGroups(group) : findEntitiesForGroup(group);\n        while (itr.hasNext() && !found) {\n            found = member.equals(itr.next());\n        }\n        return found;\n    }", "code_tokens": ["@", "Override", "public", "boolean", "contains", "(", "IEntityGroup", "group", ",", "IGroupMember", "member", ")", "throws", "GroupsException", "{", "boolean", "found", "=", "false", ";", "Iterator", "itr", "=", "(", "member", ".", "isGroup", "(", ")", ")", "?", "findMemberGroups", "(", "group", ")", ":", "findEntitiesForGroup", "(", "group", ")", ";", "while", "(", "itr", ".", "hasNext", "(", ")", "&&", "!", "found", ")", "{", "found", "=", "member", ".", "equals", "(", "itr", ".", "next", "(", ")", ")", ";", "}", "return", "found", ";", "}"], "docstring": "Answers if <code>group</code> contains <code>member</code>.\n\n@return boolean\n@param group org.apereo.portal.groups.IEntityGroup\n@param member org.apereo.portal.groups.IGroupMember", "docstring_tokens": ["Answers", "if", "<code", ">", "group<", "/", "code", ">", "contains", "<code", ">", "member<", "/", "code", ">", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-ldap/src/main/java/org/apereo/portal/groups/ldap/LDAPGroupStore.java#L709-L717", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/dlm/FragmentChannelInfo.java", "func_name": "FragmentChannelInfo.getParameterValue", "original_string": "public String getParameterValue(String name) {\n        NodeList parms = node.getChildNodes();\n\n        for (int i = 0; i < parms.getLength(); i++) {\n            Element parm = (Element) parms.item(i);\n            if (parm.getTagName().equals(Constants.ELM_PARAMETER)) {\n                String parmName = parm.getAttribute(Constants.ATT_NAME);\n                if (parmName.equals(name)) {\n                    return parm.getAttribute(Constants.ATT_VALUE);\n                }\n            }\n        }\n        // if we get here then neither the fragment  nor the channel definition\n        // provided this parameter\n        return null;\n    }", "language": "java", "code": "public String getParameterValue(String name) {\n        NodeList parms = node.getChildNodes();\n\n        for (int i = 0; i < parms.getLength(); i++) {\n            Element parm = (Element) parms.item(i);\n            if (parm.getTagName().equals(Constants.ELM_PARAMETER)) {\n                String parmName = parm.getAttribute(Constants.ATT_NAME);\n                if (parmName.equals(name)) {\n                    return parm.getAttribute(Constants.ATT_VALUE);\n                }\n            }\n        }\n        // if we get here then neither the fragment  nor the channel definition\n        // provided this parameter\n        return null;\n    }", "code_tokens": ["public", "String", "getParameterValue", "(", "String", "name", ")", "{", "NodeList", "parms", "=", "node", ".", "getChildNodes", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "parms", ".", "getLength", "(", ")", ";", "i", "++", ")", "{", "Element", "parm", "=", "(", "Element", ")", "parms", ".", "item", "(", "i", ")", ";", "if", "(", "parm", ".", "getTagName", "(", ")", ".", "equals", "(", "Constants", ".", "ELM_PARAMETER", ")", ")", "{", "String", "parmName", "=", "parm", ".", "getAttribute", "(", "Constants", ".", "ATT_NAME", ")", ";", "if", "(", "parmName", ".", "equals", "(", "name", ")", ")", "{", "return", "parm", ".", "getAttribute", "(", "Constants", ".", "ATT_VALUE", ")", ";", "}", "}", "}", "// if we get here then neither the fragment  nor the channel definition", "// provided this parameter", "return", "null", ";", "}"], "docstring": "Returns the value of an parameter or null if such a parameter is not defined on the\nunderlying channel element.", "docstring_tokens": ["Returns", "the", "value", "of", "an", "parameter", "or", "null", "if", "such", "a", "parameter", "is", "not", "defined", "on", "the", "underlying", "channel", "element", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/dlm/FragmentChannelInfo.java#L37-L52", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/oauth/OidcUserInfoController.java", "func_name": "OidcUserInfoController.userInfo", "original_string": "@RequestMapping(\n            value = USERINFO_ENDPOINT_URI,\n            produces = USERINFO_CONTENT_TYPE,\n            method = {RequestMethod.GET, RequestMethod.POST})\n    public String userInfo(\n            HttpServletRequest request,\n            @RequestParam(value = \"claims\", required = false) String claims,\n            @RequestParam(value = \"groups\", required = false) String groups) {\n\n        final IPerson person = personManager.getPerson(request);\n        return createToken(person, claims, groups);\n    }", "language": "java", "code": "@RequestMapping(\n            value = USERINFO_ENDPOINT_URI,\n            produces = USERINFO_CONTENT_TYPE,\n            method = {RequestMethod.GET, RequestMethod.POST})\n    public String userInfo(\n            HttpServletRequest request,\n            @RequestParam(value = \"claims\", required = false) String claims,\n            @RequestParam(value = \"groups\", required = false) String groups) {\n\n        final IPerson person = personManager.getPerson(request);\n        return createToken(person, claims, groups);\n    }", "code_tokens": ["@", "RequestMapping", "(", "value", "=", "USERINFO_ENDPOINT_URI", ",", "produces", "=", "USERINFO_CONTENT_TYPE", ",", "method", "=", "{", "RequestMethod", ".", "GET", ",", "RequestMethod", ".", "POST", "}", ")", "public", "String", "userInfo", "(", "HttpServletRequest", "request", ",", "@", "RequestParam", "(", "value", "=", "\"claims\"", ",", "required", "=", "false", ")", "String", "claims", ",", "@", "RequestParam", "(", "value", "=", "\"groups\"", ",", "required", "=", "false", ")", "String", "groups", ")", "{", "final", "IPerson", "person", "=", "personManager", ".", "getPerson", "(", "request", ")", ";", "return", "createToken", "(", "person", ",", "claims", ",", "groups", ")", ";", "}"], "docstring": "Obtain an OIDC Id token for the current user.", "docstring_tokens": ["Obtain", "an", "OIDC", "Id", "token", "for", "the", "current", "user", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/oauth/OidcUserInfoController.java#L92-L103", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/oauth/OidcUserInfoController.java", "func_name": "OidcUserInfoController.oauthToken", "original_string": "@PostMapping(value = TOKEN_ENDPOINT_URI, produces = MediaType.APPLICATION_JSON_VALUE)\n    public ResponseEntity oauthToken(\n            @RequestParam(value = \"client_id\") String clientId,\n            @RequestParam(value = \"client_secret\") String clientSecret,\n            @RequestParam(\n                            value = \"grant_type\",\n                            required = false,\n                            defaultValue = \"client_credentials\")\n                    String grantType,\n            @RequestParam(value = \"scope\", required = false, defaultValue = \"/all\") String scope,\n            @RequestParam(value = \"claims\", required = false) String claims,\n            @RequestParam(value = \"groups\", required = false) String groups) {\n\n        /*\n         * NB:  Several of this method's parameters are not consumed (yet) in any way.  They are\n         * defined to match a two-legged OAuth strategy and for future use.\n         */\n\n        final String msg =\n                \"Processing request for OAuth access token;  client_id='{}', client_secret='{}', \"\n                        + \"grant_type='{}', scope='{}', claims='{}', groups='{}'\";\n        logger.debug(\n                msg,\n                clientId,\n                StringUtils.repeat(\"*\", clientSecret.length()),\n                grantType,\n                scope,\n                claims,\n                groups);\n\n        // STEP 1:  identify the client\n        final OAuthClient oAuthClient = clientMap.get(clientId);\n        if (oAuthClient == null) {\n            return ResponseEntity.status(HttpStatus.FORBIDDEN)\n                    .body(Collections.singletonMap(\"message\", \"client_id not found\"));\n        }\n\n        logger.debug(\n                \"Selected known OAuthClient with client_id='{}' for access token request\",\n                oAuthClient.getClientId());\n\n        // STEP 2:  validate the client_secret\n        if (!oAuthClient.getClientSecret().equals(clientSecret)) {\n            return ResponseEntity.status(HttpStatus.FORBIDDEN)\n                    .body(Collections.singletonMap(\"message\", \"authentication failed\"));\n        }\n\n        // STEP 3:  obtain the specified user\n        final IPerson person = personService.getPerson(oAuthClient.getPortalUserAccount());\n        if (person == null) {\n            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)\n                    .body(\n                            Collections.singletonMap(\n                                    \"message\",\n                                    \"portal user account not found: \"\n                                            + oAuthClient.getPortalUserAccount()));\n        }\n\n        logger.debug(\n                \"Selected portal Person with username='{}' for client_id='{}'\",\n                person.getUserName(),\n                oAuthClient.getClientId());\n\n        // STEP 4:  build a standard OAuth2 access token response\n        final String token = createToken(person, claims, groups);\n        final Map<String, Object> rslt = new HashMap<>();\n        rslt.put(\"access_token\", token);\n        rslt.put(\"token_type\", \"bearer\");\n        rslt.put(\n                \"expires_in\",\n                timeoutSeconds > 2 ? timeoutSeconds - 2L /* fudge factor */ : timeoutSeconds);\n        rslt.put(\"scope\", scope);\n\n        logger.debug(\n                \"Produced the following access token for client_id='{}':  {}\",\n                oAuthClient.getClientId(),\n                rslt);\n\n        return ResponseEntity.ok(rslt);\n    }", "language": "java", "code": "@PostMapping(value = TOKEN_ENDPOINT_URI, produces = MediaType.APPLICATION_JSON_VALUE)\n    public ResponseEntity oauthToken(\n            @RequestParam(value = \"client_id\") String clientId,\n            @RequestParam(value = \"client_secret\") String clientSecret,\n            @RequestParam(\n                            value = \"grant_type\",\n                            required = false,\n                            defaultValue = \"client_credentials\")\n                    String grantType,\n            @RequestParam(value = \"scope\", required = false, defaultValue = \"/all\") String scope,\n            @RequestParam(value = \"claims\", required = false) String claims,\n            @RequestParam(value = \"groups\", required = false) String groups) {\n\n        /*\n         * NB:  Several of this method's parameters are not consumed (yet) in any way.  They are\n         * defined to match a two-legged OAuth strategy and for future use.\n         */\n\n        final String msg =\n                \"Processing request for OAuth access token;  client_id='{}', client_secret='{}', \"\n                        + \"grant_type='{}', scope='{}', claims='{}', groups='{}'\";\n        logger.debug(\n                msg,\n                clientId,\n                StringUtils.repeat(\"*\", clientSecret.length()),\n                grantType,\n                scope,\n                claims,\n                groups);\n\n        // STEP 1:  identify the client\n        final OAuthClient oAuthClient = clientMap.get(clientId);\n        if (oAuthClient == null) {\n            return ResponseEntity.status(HttpStatus.FORBIDDEN)\n                    .body(Collections.singletonMap(\"message\", \"client_id not found\"));\n        }\n\n        logger.debug(\n                \"Selected known OAuthClient with client_id='{}' for access token request\",\n                oAuthClient.getClientId());\n\n        // STEP 2:  validate the client_secret\n        if (!oAuthClient.getClientSecret().equals(clientSecret)) {\n            return ResponseEntity.status(HttpStatus.FORBIDDEN)\n                    .body(Collections.singletonMap(\"message\", \"authentication failed\"));\n        }\n\n        // STEP 3:  obtain the specified user\n        final IPerson person = personService.getPerson(oAuthClient.getPortalUserAccount());\n        if (person == null) {\n            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)\n                    .body(\n                            Collections.singletonMap(\n                                    \"message\",\n                                    \"portal user account not found: \"\n                                            + oAuthClient.getPortalUserAccount()));\n        }\n\n        logger.debug(\n                \"Selected portal Person with username='{}' for client_id='{}'\",\n                person.getUserName(),\n                oAuthClient.getClientId());\n\n        // STEP 4:  build a standard OAuth2 access token response\n        final String token = createToken(person, claims, groups);\n        final Map<String, Object> rslt = new HashMap<>();\n        rslt.put(\"access_token\", token);\n        rslt.put(\"token_type\", \"bearer\");\n        rslt.put(\n                \"expires_in\",\n                timeoutSeconds > 2 ? timeoutSeconds - 2L /* fudge factor */ : timeoutSeconds);\n        rslt.put(\"scope\", scope);\n\n        logger.debug(\n                \"Produced the following access token for client_id='{}':  {}\",\n                oAuthClient.getClientId(),\n                rslt);\n\n        return ResponseEntity.ok(rslt);\n    }", "code_tokens": ["@", "PostMapping", "(", "value", "=", "TOKEN_ENDPOINT_URI", ",", "produces", "=", "MediaType", ".", "APPLICATION_JSON_VALUE", ")", "public", "ResponseEntity", "oauthToken", "(", "@", "RequestParam", "(", "value", "=", "\"client_id\"", ")", "String", "clientId", ",", "@", "RequestParam", "(", "value", "=", "\"client_secret\"", ")", "String", "clientSecret", ",", "@", "RequestParam", "(", "value", "=", "\"grant_type\"", ",", "required", "=", "false", ",", "defaultValue", "=", "\"client_credentials\"", ")", "String", "grantType", ",", "@", "RequestParam", "(", "value", "=", "\"scope\"", ",", "required", "=", "false", ",", "defaultValue", "=", "\"/all\"", ")", "String", "scope", ",", "@", "RequestParam", "(", "value", "=", "\"claims\"", ",", "required", "=", "false", ")", "String", "claims", ",", "@", "RequestParam", "(", "value", "=", "\"groups\"", ",", "required", "=", "false", ")", "String", "groups", ")", "{", "/*\n         * NB:  Several of this method's parameters are not consumed (yet) in any way.  They are\n         * defined to match a two-legged OAuth strategy and for future use.\n         */", "final", "String", "msg", "=", "\"Processing request for OAuth access token;  client_id='{}', client_secret='{}', \"", "+", "\"grant_type='{}', scope='{}', claims='{}', groups='{}'\"", ";", "logger", ".", "debug", "(", "msg", ",", "clientId", ",", "StringUtils", ".", "repeat", "(", "\"*\"", ",", "clientSecret", ".", "length", "(", ")", ")", ",", "grantType", ",", "scope", ",", "claims", ",", "groups", ")", ";", "// STEP 1:  identify the client", "final", "OAuthClient", "oAuthClient", "=", "clientMap", ".", "get", "(", "clientId", ")", ";", "if", "(", "oAuthClient", "==", "null", ")", "{", "return", "ResponseEntity", ".", "status", "(", "HttpStatus", ".", "FORBIDDEN", ")", ".", "body", "(", "Collections", ".", "singletonMap", "(", "\"message\"", ",", "\"client_id not found\"", ")", ")", ";", "}", "logger", ".", "debug", "(", "\"Selected known OAuthClient with client_id='{}' for access token request\"", ",", "oAuthClient", ".", "getClientId", "(", ")", ")", ";", "// STEP 2:  validate the client_secret", "if", "(", "!", "oAuthClient", ".", "getClientSecret", "(", ")", ".", "equals", "(", "clientSecret", ")", ")", "{", "return", "ResponseEntity", ".", "status", "(", "HttpStatus", ".", "FORBIDDEN", ")", ".", "body", "(", "Collections", ".", "singletonMap", "(", "\"message\"", ",", "\"authentication failed\"", ")", ")", ";", "}", "// STEP 3:  obtain the specified user", "final", "IPerson", "person", "=", "personService", ".", "getPerson", "(", "oAuthClient", ".", "getPortalUserAccount", "(", ")", ")", ";", "if", "(", "person", "==", "null", ")", "{", "return", "ResponseEntity", ".", "status", "(", "HttpStatus", ".", "INTERNAL_SERVER_ERROR", ")", ".", "body", "(", "Collections", ".", "singletonMap", "(", "\"message\"", ",", "\"portal user account not found: \"", "+", "oAuthClient", ".", "getPortalUserAccount", "(", ")", ")", ")", ";", "}", "logger", ".", "debug", "(", "\"Selected portal Person with username='{}' for client_id='{}'\"", ",", "person", ".", "getUserName", "(", ")", ",", "oAuthClient", ".", "getClientId", "(", ")", ")", ";", "// STEP 4:  build a standard OAuth2 access token response", "final", "String", "token", "=", "createToken", "(", "person", ",", "claims", ",", "groups", ")", ";", "final", "Map", "<", "String", ",", "Object", ">", "rslt", "=", "new", "HashMap", "<>", "(", ")", ";", "rslt", ".", "put", "(", "\"access_token\"", ",", "token", ")", ";", "rslt", ".", "put", "(", "\"token_type\"", ",", "\"bearer\"", ")", ";", "rslt", ".", "put", "(", "\"expires_in\"", ",", "timeoutSeconds", ">", "2", "?", "timeoutSeconds", "-", "2L", "/* fudge factor */", ":", "timeoutSeconds", ")", ";", "rslt", ".", "put", "(", "\"scope\"", ",", "scope", ")", ";", "logger", ".", "debug", "(", "\"Produced the following access token for client_id='{}':  {}\"", ",", "oAuthClient", ".", "getClientId", "(", ")", ",", "rslt", ")", ";", "return", "ResponseEntity", ".", "ok", "(", "rslt", ")", ";", "}"], "docstring": "Obtain an OIDC Id token for the specified <code>client_id</code>. At least one bean of type\n{@link OAuthClient} is required to use this endpoint.\n\n<p>This token strategy supports Spring's <code>OAuth2RestTemplate</code> for accessing\nuPortal REST APIs from external systems. Use a <code>ClientCredentialsResourceDetails</code>\nwith <code>clientAuthenticationScheme=AuthenticationScheme.form</code>, together with a\n<code>ClientCredentialsAccessTokenProvider</code>.\n\n@since 5.5", "docstring_tokens": ["Obtain", "an", "OIDC", "Id", "token", "for", "the", "specified", "<code", ">", "client_id<", "/", "code", ">", ".", "At", "least", "one", "bean", "of", "type", "{", "@link", "OAuthClient", "}", "is", "required", "to", "use", "this", "endpoint", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/oauth/OidcUserInfoController.java#L116-L195", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-web/src/main/java/org/apereo/portal/portlet/delegation/PortletDelegationLocatorImpl.java", "func_name": "PortletDelegationLocatorImpl.createRequestDispatcher", "original_string": "@Override\n    public PortletDelegationDispatcher createRequestDispatcher(\n            PortletRequest portletRequest, String fName) {\n        final IPortletDefinition portletDefinition =\n                this.portletDefinitionRegistry.getPortletDefinitionByFname(fName);\n        final IPortletDefinitionId portletDefinitionId = portletDefinition.getPortletDefinitionId();\n\n        return this.createRequestDispatcher(portletRequest, portletDefinitionId);\n    }", "language": "java", "code": "@Override\n    public PortletDelegationDispatcher createRequestDispatcher(\n            PortletRequest portletRequest, String fName) {\n        final IPortletDefinition portletDefinition =\n                this.portletDefinitionRegistry.getPortletDefinitionByFname(fName);\n        final IPortletDefinitionId portletDefinitionId = portletDefinition.getPortletDefinitionId();\n\n        return this.createRequestDispatcher(portletRequest, portletDefinitionId);\n    }", "code_tokens": ["@", "Override", "public", "PortletDelegationDispatcher", "createRequestDispatcher", "(", "PortletRequest", "portletRequest", ",", "String", "fName", ")", "{", "final", "IPortletDefinition", "portletDefinition", "=", "this", ".", "portletDefinitionRegistry", ".", "getPortletDefinitionByFname", "(", "fName", ")", ";", "final", "IPortletDefinitionId", "portletDefinitionId", "=", "portletDefinition", ".", "getPortletDefinitionId", "(", ")", ";", "return", "this", ".", "createRequestDispatcher", "(", "portletRequest", ",", "portletDefinitionId", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.api.portlet.PortletDelegationLocator#createRequestDispatcher(java.lang.String)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-web/src/main/java/org/apereo/portal/portlet/delegation/PortletDelegationLocatorImpl.java#L93-L101", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-web/src/main/java/org/apereo/portal/portlet/delegation/PortletDelegationLocatorImpl.java", "func_name": "PortletDelegationLocatorImpl.createRequestDispatcher", "original_string": "@Override\n    public PortletDelegationDispatcher createRequestDispatcher(\n            PortletRequest portletRequest, IPortletDefinitionId delegatePortletDefinitionId) {\n        final HttpServletRequest request =\n                this.portalRequestUtils.getPortletHttpRequest(portletRequest);\n\n        final String windowID = portletRequest.getWindowID();\n        final IPortletWindowId parentPortletWindowId =\n                this.portletWindowRegistry.getPortletWindowId(request, windowID);\n\n        final IPortletEntity delegatePortletEntity =\n                this.portletEntityRegistry.getOrCreateDelegatePortletEntity(\n                        request, parentPortletWindowId, delegatePortletDefinitionId);\n        final IPortletEntityId delegatePortletEntityId = delegatePortletEntity.getPortletEntityId();\n\n        final IPortletWindow delegatePortletWindow =\n                this.portletWindowRegistry.createDelegatePortletWindow(\n                        request, delegatePortletEntityId, parentPortletWindowId);\n\n        final IPerson person = this.personManager.getPerson(request);\n        final int userId = person.getID();\n\n        return new PortletDelegationDispatcherImpl(\n                delegatePortletWindow,\n                userId,\n                portalRequestUtils,\n                personManager,\n                portletRenderer,\n                portalUrlProvider,\n                portletDelegationManager);\n    }", "language": "java", "code": "@Override\n    public PortletDelegationDispatcher createRequestDispatcher(\n            PortletRequest portletRequest, IPortletDefinitionId delegatePortletDefinitionId) {\n        final HttpServletRequest request =\n                this.portalRequestUtils.getPortletHttpRequest(portletRequest);\n\n        final String windowID = portletRequest.getWindowID();\n        final IPortletWindowId parentPortletWindowId =\n                this.portletWindowRegistry.getPortletWindowId(request, windowID);\n\n        final IPortletEntity delegatePortletEntity =\n                this.portletEntityRegistry.getOrCreateDelegatePortletEntity(\n                        request, parentPortletWindowId, delegatePortletDefinitionId);\n        final IPortletEntityId delegatePortletEntityId = delegatePortletEntity.getPortletEntityId();\n\n        final IPortletWindow delegatePortletWindow =\n                this.portletWindowRegistry.createDelegatePortletWindow(\n                        request, delegatePortletEntityId, parentPortletWindowId);\n\n        final IPerson person = this.personManager.getPerson(request);\n        final int userId = person.getID();\n\n        return new PortletDelegationDispatcherImpl(\n                delegatePortletWindow,\n                userId,\n                portalRequestUtils,\n                personManager,\n                portletRenderer,\n                portalUrlProvider,\n                portletDelegationManager);\n    }", "code_tokens": ["@", "Override", "public", "PortletDelegationDispatcher", "createRequestDispatcher", "(", "PortletRequest", "portletRequest", ",", "IPortletDefinitionId", "delegatePortletDefinitionId", ")", "{", "final", "HttpServletRequest", "request", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "portletRequest", ")", ";", "final", "String", "windowID", "=", "portletRequest", ".", "getWindowID", "(", ")", ";", "final", "IPortletWindowId", "parentPortletWindowId", "=", "this", ".", "portletWindowRegistry", ".", "getPortletWindowId", "(", "request", ",", "windowID", ")", ";", "final", "IPortletEntity", "delegatePortletEntity", "=", "this", ".", "portletEntityRegistry", ".", "getOrCreateDelegatePortletEntity", "(", "request", ",", "parentPortletWindowId", ",", "delegatePortletDefinitionId", ")", ";", "final", "IPortletEntityId", "delegatePortletEntityId", "=", "delegatePortletEntity", ".", "getPortletEntityId", "(", ")", ";", "final", "IPortletWindow", "delegatePortletWindow", "=", "this", ".", "portletWindowRegistry", ".", "createDelegatePortletWindow", "(", "request", ",", "delegatePortletEntityId", ",", "parentPortletWindowId", ")", ";", "final", "IPerson", "person", "=", "this", ".", "personManager", ".", "getPerson", "(", "request", ")", ";", "final", "int", "userId", "=", "person", ".", "getID", "(", ")", ";", "return", "new", "PortletDelegationDispatcherImpl", "(", "delegatePortletWindow", ",", "userId", ",", "portalRequestUtils", ",", "personManager", ",", "portletRenderer", ",", "portalUrlProvider", ",", "portletDelegationManager", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.api.portlet.PortletDelegationLocator#createRequestDispatcher(org.apereo.portal.portlet.om.IPortletDefinitionId)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-web/src/main/java/org/apereo/portal/portlet/delegation/PortletDelegationLocatorImpl.java#L106-L136", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-web/src/main/java/org/apereo/portal/portlet/delegation/PortletDelegationLocatorImpl.java", "func_name": "PortletDelegationLocatorImpl.getRequestDispatcher", "original_string": "@Override\n    public PortletDelegationDispatcher getRequestDispatcher(\n            PortletRequest portletRequest, IPortletWindowId portletWindowId) {\n        final HttpServletRequest request =\n                this.portalRequestUtils.getPortletHttpRequest(portletRequest);\n        final IPerson person = this.personManager.getPerson(request);\n\n        final IPortletWindow portletWindow =\n                this.portletWindowRegistry.getPortletWindow(request, portletWindowId);\n\n        final IPortletWindowId delegationParentId = portletWindow.getDelegationParentId();\n        if (delegationParentId == null) {\n            throw new IllegalArgumentException(\n                    \"Portlet window '\"\n                            + portletWindow\n                            + \"' is not a delegate window and cannot be delgated to.\");\n        }\n\n        return new PortletDelegationDispatcherImpl(\n                portletWindow,\n                person.getID(),\n                this.portalRequestUtils,\n                this.personManager,\n                this.portletRenderer,\n                this.portalUrlProvider,\n                this.portletDelegationManager);\n    }", "language": "java", "code": "@Override\n    public PortletDelegationDispatcher getRequestDispatcher(\n            PortletRequest portletRequest, IPortletWindowId portletWindowId) {\n        final HttpServletRequest request =\n                this.portalRequestUtils.getPortletHttpRequest(portletRequest);\n        final IPerson person = this.personManager.getPerson(request);\n\n        final IPortletWindow portletWindow =\n                this.portletWindowRegistry.getPortletWindow(request, portletWindowId);\n\n        final IPortletWindowId delegationParentId = portletWindow.getDelegationParentId();\n        if (delegationParentId == null) {\n            throw new IllegalArgumentException(\n                    \"Portlet window '\"\n                            + portletWindow\n                            + \"' is not a delegate window and cannot be delgated to.\");\n        }\n\n        return new PortletDelegationDispatcherImpl(\n                portletWindow,\n                person.getID(),\n                this.portalRequestUtils,\n                this.personManager,\n                this.portletRenderer,\n                this.portalUrlProvider,\n                this.portletDelegationManager);\n    }", "code_tokens": ["@", "Override", "public", "PortletDelegationDispatcher", "getRequestDispatcher", "(", "PortletRequest", "portletRequest", ",", "IPortletWindowId", "portletWindowId", ")", "{", "final", "HttpServletRequest", "request", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "portletRequest", ")", ";", "final", "IPerson", "person", "=", "this", ".", "personManager", ".", "getPerson", "(", "request", ")", ";", "final", "IPortletWindow", "portletWindow", "=", "this", ".", "portletWindowRegistry", ".", "getPortletWindow", "(", "request", ",", "portletWindowId", ")", ";", "final", "IPortletWindowId", "delegationParentId", "=", "portletWindow", ".", "getDelegationParentId", "(", ")", ";", "if", "(", "delegationParentId", "==", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"Portlet window '\"", "+", "portletWindow", "+", "\"' is not a delegate window and cannot be delgated to.\"", ")", ";", "}", "return", "new", "PortletDelegationDispatcherImpl", "(", "portletWindow", ",", "person", ".", "getID", "(", ")", ",", "this", ".", "portalRequestUtils", ",", "this", ".", "personManager", ",", "this", ".", "portletRenderer", ",", "this", ".", "portalUrlProvider", ",", "this", ".", "portletDelegationManager", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.api.portlet.PortletDelegationLocator#getRequestDispatcher(org.apereo.portal.portlet.om.IPortletWindowId)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-web/src/main/java/org/apereo/portal/portlet/delegation/PortletDelegationLocatorImpl.java#L141-L167", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-core/src/main/java/org/apereo/portal/groups/LockableEntityGroupImpl.java", "func_name": "LockableEntityGroupImpl.primUpdate", "original_string": "private void primUpdate(boolean renewLock) throws GroupsException {\n        getLockableGroupService().updateGroup(this, renewLock);\n        clearPendingUpdates();\n        this.invalidateInParentGroupsCache(Collections.singleton((IGroupMember) this));\n    }", "language": "java", "code": "private void primUpdate(boolean renewLock) throws GroupsException {\n        getLockableGroupService().updateGroup(this, renewLock);\n        clearPendingUpdates();\n        this.invalidateInParentGroupsCache(Collections.singleton((IGroupMember) this));\n    }", "code_tokens": ["private", "void", "primUpdate", "(", "boolean", "renewLock", ")", "throws", "GroupsException", "{", "getLockableGroupService", "(", ")", ".", "updateGroup", "(", "this", ",", "renewLock", ")", ";", "clearPendingUpdates", "(", ")", ";", "this", ".", "invalidateInParentGroupsCache", "(", "Collections", ".", "singleton", "(", "(", "IGroupMember", ")", "this", ")", ")", ";", "}"], "docstring": "Ask the service to update this group (in the store), update the back-pointers of the updated\nmembers, and force the retrieval of containing groups in case the memberships of THIS group\nhave changed during the time the group has been locked.", "docstring_tokens": ["Ask", "the", "service", "to", "update", "this", "group", "(", "in", "the", "store", ")", "update", "the", "back", "-", "pointers", "of", "the", "updated", "members", "and", "force", "the", "retrieval", "of", "containing", "groups", "in", "case", "the", "memberships", "of", "THIS", "group", "have", "changed", "during", "the", "time", "the", "group", "has", "been", "locked", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-core/src/main/java/org/apereo/portal/groups/LockableEntityGroupImpl.java#L60-L64", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-core/src/main/java/org/apereo/portal/groups/LockableEntityGroupImpl.java", "func_name": "LockableEntityGroupImpl.primUpdateMembers", "original_string": "private void primUpdateMembers(boolean renewLock) throws GroupsException {\n        getLockableGroupService().updateGroupMembers(this, renewLock);\n        clearPendingUpdates();\n        this.invalidateInParentGroupsCache(Collections.singleton((IGroupMember) this));\n    }", "language": "java", "code": "private void primUpdateMembers(boolean renewLock) throws GroupsException {\n        getLockableGroupService().updateGroupMembers(this, renewLock);\n        clearPendingUpdates();\n        this.invalidateInParentGroupsCache(Collections.singleton((IGroupMember) this));\n    }", "code_tokens": ["private", "void", "primUpdateMembers", "(", "boolean", "renewLock", ")", "throws", "GroupsException", "{", "getLockableGroupService", "(", ")", ".", "updateGroupMembers", "(", "this", ",", "renewLock", ")", ";", "clearPendingUpdates", "(", ")", ";", "this", ".", "invalidateInParentGroupsCache", "(", "Collections", ".", "singleton", "(", "(", "IGroupMember", ")", "this", ")", ")", ";", "}"], "docstring": "Ask the service to update this group (in the store), update the back-pointers of the updated\nmembers, and force the retrieval of containing groups in case the memberships of THIS group\nhave changed during the time the group has been locked.", "docstring_tokens": ["Ask", "the", "service", "to", "update", "this", "group", "(", "in", "the", "store", ")", "update", "the", "back", "-", "pointers", "of", "the", "updated", "members", "and", "force", "the", "retrieval", "of", "containing", "groups", "in", "case", "the", "memberships", "of", "THIS", "group", "have", "changed", "during", "the", "time", "the", "group", "has", "been", "locked", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-core/src/main/java/org/apereo/portal/groups/LockableEntityGroupImpl.java#L71-L75", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-permissions/src/main/java/org/apereo/portal/permission/target/SimpleStringTargetProviderImpl.java", "func_name": "SimpleStringTargetProviderImpl.setTargets", "original_string": "public void setTargets(Collection<IPermissionTarget> targets) {\n\n        // clear out any existing targets\n        targetMap.clear();\n\n        // add each target to the internal map and index it by the target key\n        for (IPermissionTarget target : targets) {\n            targetMap.put(target.getKey(), target);\n        }\n    }", "language": "java", "code": "public void setTargets(Collection<IPermissionTarget> targets) {\n\n        // clear out any existing targets\n        targetMap.clear();\n\n        // add each target to the internal map and index it by the target key\n        for (IPermissionTarget target : targets) {\n            targetMap.put(target.getKey(), target);\n        }\n    }", "code_tokens": ["public", "void", "setTargets", "(", "Collection", "<", "IPermissionTarget", ">", "targets", ")", "{", "// clear out any existing targets", "targetMap", ".", "clear", "(", ")", ";", "// add each target to the internal map and index it by the target key", "for", "(", "IPermissionTarget", "target", ":", "targets", ")", "{", "targetMap", ".", "put", "(", "target", ".", "getKey", "(", ")", ",", "target", ")", ";", "}", "}"], "docstring": "Set the permission targets for this provider.\n\n@param targets collection of targets", "docstring_tokens": ["Set", "the", "permission", "targets", "for", "this", "provider", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-permissions/src/main/java/org/apereo/portal/permission/target/SimpleStringTargetProviderImpl.java#L48-L57", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-persondir/src/main/java/org/apereo/portal/persondir/PortalRootPersonAttributeDao.java", "func_name": "PortalRootPersonAttributeDao.getPerson", "original_string": "@Override\n    public IPersonAttributes getPerson(String uid) {\n\n        final IPersonAttributes rslt = delegatePersonAttributeDao.getPerson(uid);\n        if (rslt == null) {\n            // Nothing we can do with that\n            return null;\n        }\n\n        return postProcessPerson(rslt, uid);\n    }", "language": "java", "code": "@Override\n    public IPersonAttributes getPerson(String uid) {\n\n        final IPersonAttributes rslt = delegatePersonAttributeDao.getPerson(uid);\n        if (rslt == null) {\n            // Nothing we can do with that\n            return null;\n        }\n\n        return postProcessPerson(rslt, uid);\n    }", "code_tokens": ["@", "Override", "public", "IPersonAttributes", "getPerson", "(", "String", "uid", ")", "{", "final", "IPersonAttributes", "rslt", "=", "delegatePersonAttributeDao", ".", "getPerson", "(", "uid", ")", ";", "if", "(", "rslt", "==", "null", ")", "{", "// Nothing we can do with that", "return", "null", ";", "}", "return", "postProcessPerson", "(", "rslt", ",", "uid", ")", ";", "}"], "docstring": "This method is for \"filling\" a specific individual.\n\n@param uid The username (identity) of a known individual\n@return A completely \"filled\" person, including overrides, or <code>null</code> if the person\nis unknown", "docstring_tokens": ["This", "method", "is", "for", "filling", "a", "specific", "individual", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-persondir/src/main/java/org/apereo/portal/persondir/PortalRootPersonAttributeDao.java#L110-L120", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-persondir/src/main/java/org/apereo/portal/persondir/PortalRootPersonAttributeDao.java", "func_name": "PortalRootPersonAttributeDao.getPeopleWithMultivaluedAttributes", "original_string": "@Override\n    public Set<IPersonAttributes> getPeopleWithMultivaluedAttributes(\n            Map<String, List<Object>> query) {\n        final Set<IPersonAttributes> people =\n                delegatePersonAttributeDao.getPeopleWithMultivaluedAttributes(query);\n        if (people == null) {\n            return null;\n        }\n\n        final Set<IPersonAttributes> modifiedPeople = new LinkedHashSet<>();\n\n        for (final IPersonAttributes person : people) {\n            /*\n             * WARNING:  Not safe to pass uidInQuery in this scenario;  results will be \"filled\" by\n             * getPerson(uid) subsequently.\n             */\n            final IPersonAttributes mergedPerson = postProcessPerson(person, null);\n            modifiedPeople.add(mergedPerson);\n        }\n\n        return modifiedPeople;\n    }", "language": "java", "code": "@Override\n    public Set<IPersonAttributes> getPeopleWithMultivaluedAttributes(\n            Map<String, List<Object>> query) {\n        final Set<IPersonAttributes> people =\n                delegatePersonAttributeDao.getPeopleWithMultivaluedAttributes(query);\n        if (people == null) {\n            return null;\n        }\n\n        final Set<IPersonAttributes> modifiedPeople = new LinkedHashSet<>();\n\n        for (final IPersonAttributes person : people) {\n            /*\n             * WARNING:  Not safe to pass uidInQuery in this scenario;  results will be \"filled\" by\n             * getPerson(uid) subsequently.\n             */\n            final IPersonAttributes mergedPerson = postProcessPerson(person, null);\n            modifiedPeople.add(mergedPerson);\n        }\n\n        return modifiedPeople;\n    }", "code_tokens": ["@", "Override", "public", "Set", "<", "IPersonAttributes", ">", "getPeopleWithMultivaluedAttributes", "(", "Map", "<", "String", ",", "List", "<", "Object", ">", ">", "query", ")", "{", "final", "Set", "<", "IPersonAttributes", ">", "people", "=", "delegatePersonAttributeDao", ".", "getPeopleWithMultivaluedAttributes", "(", "query", ")", ";", "if", "(", "people", "==", "null", ")", "{", "return", "null", ";", "}", "final", "Set", "<", "IPersonAttributes", ">", "modifiedPeople", "=", "new", "LinkedHashSet", "<>", "(", ")", ";", "for", "(", "final", "IPersonAttributes", "person", ":", "people", ")", "{", "/*\n             * WARNING:  Not safe to pass uidInQuery in this scenario;  results will be \"filled\" by\n             * getPerson(uid) subsequently.\n             */", "final", "IPersonAttributes", "mergedPerson", "=", "postProcessPerson", "(", "person", ",", "null", ")", ";", "modifiedPeople", ".", "add", "(", "mergedPerson", ")", ";", "}", "return", "modifiedPeople", ";", "}"], "docstring": "This method is for matching a search query. Each matching item will subsequently be passed to\n<code>getPerson(uid)</code> for \"filling.\"", "docstring_tokens": ["This", "method", "is", "for", "matching", "a", "search", "query", ".", "Each", "matching", "item", "will", "subsequently", "be", "passed", "to", "<code", ">", "getPerson", "(", "uid", ")", "<", "/", "code", ">", "for", "filling", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-persondir/src/main/java/org/apereo/portal/persondir/PortalRootPersonAttributeDao.java#L126-L147", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-persondir/src/main/java/org/apereo/portal/persondir/PortalRootPersonAttributeDao.java", "func_name": "PortalRootPersonAttributeDao.postProcessPerson", "original_string": "private IPersonAttributes postProcessPerson(IPersonAttributes person, String uidInQuery) {\n\n        // Verify the person has a name\n        final String name = person.getName();\n        if (name == null) {\n            logger.warn(\"IPerson '{}' has no name and therefore cannot be post-processed\", person);\n            return person;\n        }\n\n        // First apply specified overrides\n        IPersonAttributes rslt =\n                applyOverridesIfPresent(person); // default -- won't normally need to do anything\n\n        /*\n         * And secondly there are two attributes in uPortal that cause havoc if they're missing:\n         *\n         *   - username\n         *   - displayName\n         *\n         * We need to do our best to provide these if the external data sources don't cover it.\n         */\n        rslt = selectUsernameIfAbsent(rslt);\n        rslt = selectDisplayNameIfAbsent(rslt);\n\n        logger.debug(\n                \"Post-processing of person with name='{}' produced the following person:  {}\",\n                person.getName(),\n                rslt);\n\n        return rslt;\n    }", "language": "java", "code": "private IPersonAttributes postProcessPerson(IPersonAttributes person, String uidInQuery) {\n\n        // Verify the person has a name\n        final String name = person.getName();\n        if (name == null) {\n            logger.warn(\"IPerson '{}' has no name and therefore cannot be post-processed\", person);\n            return person;\n        }\n\n        // First apply specified overrides\n        IPersonAttributes rslt =\n                applyOverridesIfPresent(person); // default -- won't normally need to do anything\n\n        /*\n         * And secondly there are two attributes in uPortal that cause havoc if they're missing:\n         *\n         *   - username\n         *   - displayName\n         *\n         * We need to do our best to provide these if the external data sources don't cover it.\n         */\n        rslt = selectUsernameIfAbsent(rslt);\n        rslt = selectDisplayNameIfAbsent(rslt);\n\n        logger.debug(\n                \"Post-processing of person with name='{}' produced the following person:  {}\",\n                person.getName(),\n                rslt);\n\n        return rslt;\n    }", "code_tokens": ["private", "IPersonAttributes", "postProcessPerson", "(", "IPersonAttributes", "person", ",", "String", "uidInQuery", ")", "{", "// Verify the person has a name", "final", "String", "name", "=", "person", ".", "getName", "(", ")", ";", "if", "(", "name", "==", "null", ")", "{", "logger", ".", "warn", "(", "\"IPerson '{}' has no name and therefore cannot be post-processed\"", ",", "person", ")", ";", "return", "person", ";", "}", "// First apply specified overrides", "IPersonAttributes", "rslt", "=", "applyOverridesIfPresent", "(", "person", ")", ";", "// default -- won't normally need to do anything", "/*\n         * And secondly there are two attributes in uPortal that cause havoc if they're missing:\n         *\n         *   - username\n         *   - displayName\n         *\n         * We need to do our best to provide these if the external data sources don't cover it.\n         */", "rslt", "=", "selectUsernameIfAbsent", "(", "rslt", ")", ";", "rslt", "=", "selectDisplayNameIfAbsent", "(", "rslt", ")", ";", "logger", ".", "debug", "(", "\"Post-processing of person with name='{}' produced the following person:  {}\"", ",", "person", ".", "getName", "(", ")", ",", "rslt", ")", ";", "return", "rslt", ";", "}"], "docstring": "Implements support for overriding attributes by administrator choice and for intelligently\nselecting (if possible) values for 'username' and 'displayName' if none have been provided by\nother data sources.\n\n@param person The user\n@param uidInQuery The username specified in the PersonDirectory query, if certain\n@return The user, possibly with modifications", "docstring_tokens": ["Implements", "support", "for", "overriding", "attributes", "by", "administrator", "choice", "and", "for", "intelligently", "selecting", "(", "if", "possible", ")", "values", "for", "username", "and", "displayName", "if", "none", "have", "been", "provided", "by", "other", "data", "sources", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-persondir/src/main/java/org/apereo/portal/persondir/PortalRootPersonAttributeDao.java#L168-L198", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-web/src/main/java/org/apereo/portal/portlet/container/services/LocalPortletContextManager.java", "func_name": "LocalPortletContextManager.register", "original_string": "@Override\n    public synchronized String register(ServletConfig config) throws PortletContainerException {\n        ServletContext servletContext = config.getServletContext();\n        String contextPath = servletContext.getContextPath();\n        if (!portletContexts.containsKey(contextPath)) {\n\n            PortletApplicationDefinition portletApp =\n                    this.getPortletAppDD(servletContext, contextPath, contextPath);\n\n            DriverPortletContext portletContext =\n                    new DriverPortletContextImpl(\n                            servletContext, portletApp, requestDispatcherService);\n\n            portletContext.setAttribute(\n                    PlatformApiBroker.PORTLET_CONTEXT_ATTRIBUTE_NAME, platformApiBroker);\n            portletContexts.put(contextPath, portletContext);\n\n            fireRegistered(portletContext);\n\n            if (logger.isInfoEnabled()) {\n                logger.info(\"Registered portlet application for context '\" + contextPath + \"'\");\n\n                logger.info(\n                        \"Registering \"\n                                + portletApp.getPortlets().size()\n                                + \" portlets for context \"\n                                + portletContext.getApplicationName());\n            }\n\n            // TODO have the portlet servlet provide the portlet's classloader as parameter to this\n            // method\n            // This approach is needed as all pluto callbacks in uPortal have an aspect that\n            // switches the thread classloader back\n            // to uPortal's classloader.\n            ClassLoader classLoader = ThreadContextClassLoaderAspect.getPreviousClassLoader();\n            if (classLoader == null) {\n                classLoader = Thread.currentThread().getContextClassLoader();\n            }\n            classLoaders.put(portletApp.getName(), classLoader);\n            for (PortletDefinition portlet : portletApp.getPortlets()) {\n                String appName = portletContext.getApplicationName();\n                if (appName == null) {\n                    throw new PortletContainerException(\n                            \"Portlet application name should not be null.\");\n                }\n                portletConfigs.put(\n                        portletContext.getApplicationName() + \"/\" + portlet.getPortletName(),\n                        new DriverPortletConfigImpl(portletContext, portlet));\n            }\n        } else {\n            if (logger.isInfoEnabled()) {\n                logger.info(\n                        \"Portlet application for context '\"\n                                + contextPath\n                                + \"' already registered.\");\n            }\n        }\n        return contextPath;\n    }", "language": "java", "code": "@Override\n    public synchronized String register(ServletConfig config) throws PortletContainerException {\n        ServletContext servletContext = config.getServletContext();\n        String contextPath = servletContext.getContextPath();\n        if (!portletContexts.containsKey(contextPath)) {\n\n            PortletApplicationDefinition portletApp =\n                    this.getPortletAppDD(servletContext, contextPath, contextPath);\n\n            DriverPortletContext portletContext =\n                    new DriverPortletContextImpl(\n                            servletContext, portletApp, requestDispatcherService);\n\n            portletContext.setAttribute(\n                    PlatformApiBroker.PORTLET_CONTEXT_ATTRIBUTE_NAME, platformApiBroker);\n            portletContexts.put(contextPath, portletContext);\n\n            fireRegistered(portletContext);\n\n            if (logger.isInfoEnabled()) {\n                logger.info(\"Registered portlet application for context '\" + contextPath + \"'\");\n\n                logger.info(\n                        \"Registering \"\n                                + portletApp.getPortlets().size()\n                                + \" portlets for context \"\n                                + portletContext.getApplicationName());\n            }\n\n            // TODO have the portlet servlet provide the portlet's classloader as parameter to this\n            // method\n            // This approach is needed as all pluto callbacks in uPortal have an aspect that\n            // switches the thread classloader back\n            // to uPortal's classloader.\n            ClassLoader classLoader = ThreadContextClassLoaderAspect.getPreviousClassLoader();\n            if (classLoader == null) {\n                classLoader = Thread.currentThread().getContextClassLoader();\n            }\n            classLoaders.put(portletApp.getName(), classLoader);\n            for (PortletDefinition portlet : portletApp.getPortlets()) {\n                String appName = portletContext.getApplicationName();\n                if (appName == null) {\n                    throw new PortletContainerException(\n                            \"Portlet application name should not be null.\");\n                }\n                portletConfigs.put(\n                        portletContext.getApplicationName() + \"/\" + portlet.getPortletName(),\n                        new DriverPortletConfigImpl(portletContext, portlet));\n            }\n        } else {\n            if (logger.isInfoEnabled()) {\n                logger.info(\n                        \"Portlet application for context '\"\n                                + contextPath\n                                + \"' already registered.\");\n            }\n        }\n        return contextPath;\n    }", "code_tokens": ["@", "Override", "public", "synchronized", "String", "register", "(", "ServletConfig", "config", ")", "throws", "PortletContainerException", "{", "ServletContext", "servletContext", "=", "config", ".", "getServletContext", "(", ")", ";", "String", "contextPath", "=", "servletContext", ".", "getContextPath", "(", ")", ";", "if", "(", "!", "portletContexts", ".", "containsKey", "(", "contextPath", ")", ")", "{", "PortletApplicationDefinition", "portletApp", "=", "this", ".", "getPortletAppDD", "(", "servletContext", ",", "contextPath", ",", "contextPath", ")", ";", "DriverPortletContext", "portletContext", "=", "new", "DriverPortletContextImpl", "(", "servletContext", ",", "portletApp", ",", "requestDispatcherService", ")", ";", "portletContext", ".", "setAttribute", "(", "PlatformApiBroker", ".", "PORTLET_CONTEXT_ATTRIBUTE_NAME", ",", "platformApiBroker", ")", ";", "portletContexts", ".", "put", "(", "contextPath", ",", "portletContext", ")", ";", "fireRegistered", "(", "portletContext", ")", ";", "if", "(", "logger", ".", "isInfoEnabled", "(", ")", ")", "{", "logger", ".", "info", "(", "\"Registered portlet application for context '\"", "+", "contextPath", "+", "\"'\"", ")", ";", "logger", ".", "info", "(", "\"Registering \"", "+", "portletApp", ".", "getPortlets", "(", ")", ".", "size", "(", ")", "+", "\" portlets for context \"", "+", "portletContext", ".", "getApplicationName", "(", ")", ")", ";", "}", "// TODO have the portlet servlet provide the portlet's classloader as parameter to this", "// method", "// This approach is needed as all pluto callbacks in uPortal have an aspect that", "// switches the thread classloader back", "// to uPortal's classloader.", "ClassLoader", "classLoader", "=", "ThreadContextClassLoaderAspect", ".", "getPreviousClassLoader", "(", ")", ";", "if", "(", "classLoader", "==", "null", ")", "{", "classLoader", "=", "Thread", ".", "currentThread", "(", ")", ".", "getContextClassLoader", "(", ")", ";", "}", "classLoaders", ".", "put", "(", "portletApp", ".", "getName", "(", ")", ",", "classLoader", ")", ";", "for", "(", "PortletDefinition", "portlet", ":", "portletApp", ".", "getPortlets", "(", ")", ")", "{", "String", "appName", "=", "portletContext", ".", "getApplicationName", "(", ")", ";", "if", "(", "appName", "==", "null", ")", "{", "throw", "new", "PortletContainerException", "(", "\"Portlet application name should not be null.\"", ")", ";", "}", "portletConfigs", ".", "put", "(", "portletContext", ".", "getApplicationName", "(", ")", "+", "\"/\"", "+", "portlet", ".", "getPortletName", "(", ")", ",", "new", "DriverPortletConfigImpl", "(", "portletContext", ",", "portlet", ")", ")", ";", "}", "}", "else", "{", "if", "(", "logger", ".", "isInfoEnabled", "(", ")", ")", "{", "logger", ".", "info", "(", "\"Portlet application for context '\"", "+", "contextPath", "+", "\"' already registered.\"", ")", ";", "}", "}", "return", "contextPath", ";", "}"], "docstring": "Retrieves the PortletContext associated with the given ServletContext. If one does not exist,\nit is created.\n\n@param config the servlet config.\n@return the InternalPortletContext associated with the ServletContext.\n@throws PortletContainerException", "docstring_tokens": ["Retrieves", "the", "PortletContext", "associated", "with", "the", "given", "ServletContext", ".", "If", "one", "does", "not", "exist", "it", "is", "created", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-web/src/main/java/org/apereo/portal/portlet/container/services/LocalPortletContextManager.java#L126-L184", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-web/src/main/java/org/apereo/portal/portlet/container/services/LocalPortletContextManager.java", "func_name": "LocalPortletContextManager.getPortletAppDD", "original_string": "public synchronized PortletApplicationDefinition getPortletAppDD(\n            ServletContext servletContext, String name, String contextPath)\n            throws PortletContainerException {\n        PortletApplicationDefinition portletApp =\n                this.portletAppDefinitionCache.get(servletContext);\n        if (portletApp == null) {\n            portletApp = createDefinition(servletContext, name, contextPath);\n            this.portletAppDefinitionCache.put(servletContext, portletApp);\n        }\n        return portletApp;\n    }", "language": "java", "code": "public synchronized PortletApplicationDefinition getPortletAppDD(\n            ServletContext servletContext, String name, String contextPath)\n            throws PortletContainerException {\n        PortletApplicationDefinition portletApp =\n                this.portletAppDefinitionCache.get(servletContext);\n        if (portletApp == null) {\n            portletApp = createDefinition(servletContext, name, contextPath);\n            this.portletAppDefinitionCache.put(servletContext, portletApp);\n        }\n        return portletApp;\n    }", "code_tokens": ["public", "synchronized", "PortletApplicationDefinition", "getPortletAppDD", "(", "ServletContext", "servletContext", ",", "String", "name", ",", "String", "contextPath", ")", "throws", "PortletContainerException", "{", "PortletApplicationDefinition", "portletApp", "=", "this", ".", "portletAppDefinitionCache", ".", "get", "(", "servletContext", ")", ";", "if", "(", "portletApp", "==", "null", ")", "{", "portletApp", "=", "createDefinition", "(", "servletContext", ",", "name", ",", "contextPath", ")", ";", "this", ".", "portletAppDefinitionCache", ".", "put", "(", "servletContext", ",", "portletApp", ")", ";", "}", "return", "portletApp", ";", "}"], "docstring": "Retrieve the Portlet Application Deployment Descriptor for the given servlet context. Create\nit if it does not allready exist.\n\n@param servletContext the servlet context.\n@return The portlet application deployment descriptor.\n@throws PortletContainerException if the descriptor can not be found or parsed", "docstring_tokens": ["Retrieve", "the", "Portlet", "Application", "Deployment", "Descriptor", "for", "the", "given", "servlet", "context", ".", "Create", "it", "if", "it", "does", "not", "allready", "exist", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-web/src/main/java/org/apereo/portal/portlet/container/services/LocalPortletContextManager.java#L306-L316", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-web/src/main/java/org/apereo/portal/portlet/container/services/LocalPortletContextManager.java", "func_name": "LocalPortletContextManager.createDefinition", "original_string": "private PortletApplicationDefinition createDefinition(\n            ServletContext servletContext, String name, String contextPath)\n            throws PortletContainerException {\n        PortletApplicationDefinition portletApp = null;\n        try {\n            InputStream paIn = servletContext.getResourceAsStream(PORTLET_XML);\n            InputStream webIn = servletContext.getResourceAsStream(WEB_XML);\n            if (paIn == null) {\n                throw new PortletContainerException(\n                        \"Cannot find '\"\n                                + PORTLET_XML\n                                + \"'. Are you sure it is in the deployed package?\");\n            }\n            if (webIn == null) {\n                throw new PortletContainerException(\n                        \"Cannot find '\"\n                                + WEB_XML\n                                + \"'. Are you sure it is in the deployed package?\");\n            }\n            portletApp = this.portletAppDescriptorService.read(name, contextPath, paIn);\n            this.portletAppDescriptorService.mergeWebDescriptor(portletApp, webIn);\n        } catch (Exception ex) {\n            throw new PortletContainerException(\n                    \"Exception loading portlet descriptor for: \"\n                            + servletContext.getServletContextName(),\n                    ex);\n        }\n        return portletApp;\n    }", "language": "java", "code": "private PortletApplicationDefinition createDefinition(\n            ServletContext servletContext, String name, String contextPath)\n            throws PortletContainerException {\n        PortletApplicationDefinition portletApp = null;\n        try {\n            InputStream paIn = servletContext.getResourceAsStream(PORTLET_XML);\n            InputStream webIn = servletContext.getResourceAsStream(WEB_XML);\n            if (paIn == null) {\n                throw new PortletContainerException(\n                        \"Cannot find '\"\n                                + PORTLET_XML\n                                + \"'. Are you sure it is in the deployed package?\");\n            }\n            if (webIn == null) {\n                throw new PortletContainerException(\n                        \"Cannot find '\"\n                                + WEB_XML\n                                + \"'. Are you sure it is in the deployed package?\");\n            }\n            portletApp = this.portletAppDescriptorService.read(name, contextPath, paIn);\n            this.portletAppDescriptorService.mergeWebDescriptor(portletApp, webIn);\n        } catch (Exception ex) {\n            throw new PortletContainerException(\n                    \"Exception loading portlet descriptor for: \"\n                            + servletContext.getServletContextName(),\n                    ex);\n        }\n        return portletApp;\n    }", "code_tokens": ["private", "PortletApplicationDefinition", "createDefinition", "(", "ServletContext", "servletContext", ",", "String", "name", ",", "String", "contextPath", ")", "throws", "PortletContainerException", "{", "PortletApplicationDefinition", "portletApp", "=", "null", ";", "try", "{", "InputStream", "paIn", "=", "servletContext", ".", "getResourceAsStream", "(", "PORTLET_XML", ")", ";", "InputStream", "webIn", "=", "servletContext", ".", "getResourceAsStream", "(", "WEB_XML", ")", ";", "if", "(", "paIn", "==", "null", ")", "{", "throw", "new", "PortletContainerException", "(", "\"Cannot find '\"", "+", "PORTLET_XML", "+", "\"'. Are you sure it is in the deployed package?\"", ")", ";", "}", "if", "(", "webIn", "==", "null", ")", "{", "throw", "new", "PortletContainerException", "(", "\"Cannot find '\"", "+", "WEB_XML", "+", "\"'. Are you sure it is in the deployed package?\"", ")", ";", "}", "portletApp", "=", "this", ".", "portletAppDescriptorService", ".", "read", "(", "name", ",", "contextPath", ",", "paIn", ")", ";", "this", ".", "portletAppDescriptorService", ".", "mergeWebDescriptor", "(", "portletApp", ",", "webIn", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "new", "PortletContainerException", "(", "\"Exception loading portlet descriptor for: \"", "+", "servletContext", ".", "getServletContextName", "(", ")", ",", "ex", ")", ";", "}", "return", "portletApp", ";", "}"], "docstring": "Creates the portlet.xml deployment descriptor representation.\n\n@param servletContext the servlet context for which the DD is requested.\n@return the Portlet Application Deployment Descriptor.\n@throws PortletContainerException", "docstring_tokens": ["Creates", "the", "portlet", ".", "xml", "deployment", "descriptor", "representation", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-web/src/main/java/org/apereo/portal/portlet/container/services/LocalPortletContextManager.java#L327-L355", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/PortletMimeResponseContextImpl.java", "func_name": "PortletMimeResponseContextImpl.getPortletURLProvider", "original_string": "@Override\n    public PortletURLProvider getPortletURLProvider(TYPE type) {\n        final IPortletWindowId portletWindowId = this.portletWindow.getPortletWindowId();\n        final UrlType urlType = UrlType.fromPortletUrlType(type);\n        final IPortalUrlBuilder portalUrlBuilder =\n                this.portalUrlProvider.getPortalUrlBuilderByPortletWindow(\n                        containerRequest, portletWindowId, urlType);\n        final IPortletUrlBuilder portletUrlBuilder =\n                portalUrlBuilder.getPortletUrlBuilder(portletWindowId);\n        return new PortletURLProviderImpl(portletUrlBuilder);\n    }", "language": "java", "code": "@Override\n    public PortletURLProvider getPortletURLProvider(TYPE type) {\n        final IPortletWindowId portletWindowId = this.portletWindow.getPortletWindowId();\n        final UrlType urlType = UrlType.fromPortletUrlType(type);\n        final IPortalUrlBuilder portalUrlBuilder =\n                this.portalUrlProvider.getPortalUrlBuilderByPortletWindow(\n                        containerRequest, portletWindowId, urlType);\n        final IPortletUrlBuilder portletUrlBuilder =\n                portalUrlBuilder.getPortletUrlBuilder(portletWindowId);\n        return new PortletURLProviderImpl(portletUrlBuilder);\n    }", "code_tokens": ["@", "Override", "public", "PortletURLProvider", "getPortletURLProvider", "(", "TYPE", "type", ")", "{", "final", "IPortletWindowId", "portletWindowId", "=", "this", ".", "portletWindow", ".", "getPortletWindowId", "(", ")", ";", "final", "UrlType", "urlType", "=", "UrlType", ".", "fromPortletUrlType", "(", "type", ")", ";", "final", "IPortalUrlBuilder", "portalUrlBuilder", "=", "this", ".", "portalUrlProvider", ".", "getPortalUrlBuilderByPortletWindow", "(", "containerRequest", ",", "portletWindowId", ",", "urlType", ")", ";", "final", "IPortletUrlBuilder", "portletUrlBuilder", "=", "portalUrlBuilder", ".", "getPortletUrlBuilder", "(", "portletWindowId", ")", ";", "return", "new", "PortletURLProviderImpl", "(", "portletUrlBuilder", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apache.pluto.container.PortletMimeResponseContext#getPortletURLProvider(org.apache.pluto.container.PortletURLProvider.TYPE)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/PortletMimeResponseContextImpl.java#L160-L170", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java", "func_name": "JpaClusterLockDao.getClusterMutexInternal", "original_string": "protected ClusterMutex getClusterMutexInternal(final String mutexName) {\n        final TransactionOperations transactionOperations = this.getTransactionOperations();\n        return transactionOperations.execute(\n                new TransactionCallback<ClusterMutex>() {\n                    @Override\n                    public ClusterMutex doInTransaction(TransactionStatus status) {\n                        final CacheKey key = CacheKey.build(CLUSTER_MUTEX_SOURCE, mutexName);\n                        ClusterMutex clusterMutex =\n                                entityManagerCache.get(BasePortalJpaDao.PERSISTENCE_UNIT_NAME, key);\n                        if (clusterMutex != null) {\n                            return clusterMutex;\n                        }\n\n                        final NaturalIdQuery<ClusterMutex> query =\n                                createNaturalIdQuery(ClusterMutex.class);\n                        query.using(ClusterMutex_.name, mutexName);\n                        clusterMutex = query.load();\n\n                        entityManagerCache.put(\n                                BasePortalJpaDao.PERSISTENCE_UNIT_NAME, key, clusterMutex);\n\n                        return clusterMutex;\n                    }\n                });\n    }", "language": "java", "code": "protected ClusterMutex getClusterMutexInternal(final String mutexName) {\n        final TransactionOperations transactionOperations = this.getTransactionOperations();\n        return transactionOperations.execute(\n                new TransactionCallback<ClusterMutex>() {\n                    @Override\n                    public ClusterMutex doInTransaction(TransactionStatus status) {\n                        final CacheKey key = CacheKey.build(CLUSTER_MUTEX_SOURCE, mutexName);\n                        ClusterMutex clusterMutex =\n                                entityManagerCache.get(BasePortalJpaDao.PERSISTENCE_UNIT_NAME, key);\n                        if (clusterMutex != null) {\n                            return clusterMutex;\n                        }\n\n                        final NaturalIdQuery<ClusterMutex> query =\n                                createNaturalIdQuery(ClusterMutex.class);\n                        query.using(ClusterMutex_.name, mutexName);\n                        clusterMutex = query.load();\n\n                        entityManagerCache.put(\n                                BasePortalJpaDao.PERSISTENCE_UNIT_NAME, key, clusterMutex);\n\n                        return clusterMutex;\n                    }\n                });\n    }", "code_tokens": ["protected", "ClusterMutex", "getClusterMutexInternal", "(", "final", "String", "mutexName", ")", "{", "final", "TransactionOperations", "transactionOperations", "=", "this", ".", "getTransactionOperations", "(", ")", ";", "return", "transactionOperations", ".", "execute", "(", "new", "TransactionCallback", "<", "ClusterMutex", ">", "(", ")", "{", "@", "Override", "public", "ClusterMutex", "doInTransaction", "(", "TransactionStatus", "status", ")", "{", "final", "CacheKey", "key", "=", "CacheKey", ".", "build", "(", "CLUSTER_MUTEX_SOURCE", ",", "mutexName", ")", ";", "ClusterMutex", "clusterMutex", "=", "entityManagerCache", ".", "get", "(", "BasePortalJpaDao", ".", "PERSISTENCE_UNIT_NAME", ",", "key", ")", ";", "if", "(", "clusterMutex", "!=", "null", ")", "{", "return", "clusterMutex", ";", "}", "final", "NaturalIdQuery", "<", "ClusterMutex", ">", "query", "=", "createNaturalIdQuery", "(", "ClusterMutex", ".", "class", ")", ";", "query", ".", "using", "(", "ClusterMutex_", ".", "name", ",", "mutexName", ")", ";", "clusterMutex", "=", "query", ".", "load", "(", ")", ";", "entityManagerCache", ".", "put", "(", "BasePortalJpaDao", ".", "PERSISTENCE_UNIT_NAME", ",", "key", ",", "clusterMutex", ")", ";", "return", "clusterMutex", ";", "}", "}", ")", ";", "}"], "docstring": "Retrieves a ClusterMutex in a new TX", "docstring_tokens": ["Retrieves", "a", "ClusterMutex", "in", "a", "new", "TX"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java#L217-L241", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java", "func_name": "JpaClusterLockDao.createClusterMutex", "original_string": "protected void createClusterMutex(final String mutexName) {\n        this.executeIgnoreRollback(\n                new TransactionCallbackWithoutResult() {\n                    @Override\n                    protected void doInTransactionWithoutResult(TransactionStatus status) {\n                        final EntityManager entityManager = getEntityManager();\n                        final ClusterMutex clusterMutex = new ClusterMutex(mutexName);\n                        entityManager.persist(clusterMutex);\n                        try {\n                            entityManager.flush();\n                            logger.trace(\"Created {}\", clusterMutex);\n                        } catch (PersistenceException e) {\n                            if (e.getCause() instanceof ConstraintViolationException) {\n                                // ignore, another thread beat us to creation\n                                logger.debug(\n                                        \"Failed to create mutex, it was likely created concurrently by another thread: \"\n                                                + clusterMutex,\n                                        e);\n                                return;\n                            }\n\n                            // re-throw exception with unhandled cause\n                            throw e;\n                        }\n                    }\n                });\n    }", "language": "java", "code": "protected void createClusterMutex(final String mutexName) {\n        this.executeIgnoreRollback(\n                new TransactionCallbackWithoutResult() {\n                    @Override\n                    protected void doInTransactionWithoutResult(TransactionStatus status) {\n                        final EntityManager entityManager = getEntityManager();\n                        final ClusterMutex clusterMutex = new ClusterMutex(mutexName);\n                        entityManager.persist(clusterMutex);\n                        try {\n                            entityManager.flush();\n                            logger.trace(\"Created {}\", clusterMutex);\n                        } catch (PersistenceException e) {\n                            if (e.getCause() instanceof ConstraintViolationException) {\n                                // ignore, another thread beat us to creation\n                                logger.debug(\n                                        \"Failed to create mutex, it was likely created concurrently by another thread: \"\n                                                + clusterMutex,\n                                        e);\n                                return;\n                            }\n\n                            // re-throw exception with unhandled cause\n                            throw e;\n                        }\n                    }\n                });\n    }", "code_tokens": ["protected", "void", "createClusterMutex", "(", "final", "String", "mutexName", ")", "{", "this", ".", "executeIgnoreRollback", "(", "new", "TransactionCallbackWithoutResult", "(", ")", "{", "@", "Override", "protected", "void", "doInTransactionWithoutResult", "(", "TransactionStatus", "status", ")", "{", "final", "EntityManager", "entityManager", "=", "getEntityManager", "(", ")", ";", "final", "ClusterMutex", "clusterMutex", "=", "new", "ClusterMutex", "(", "mutexName", ")", ";", "entityManager", ".", "persist", "(", "clusterMutex", ")", ";", "try", "{", "entityManager", ".", "flush", "(", ")", ";", "logger", ".", "trace", "(", "\"Created {}\"", ",", "clusterMutex", ")", ";", "}", "catch", "(", "PersistenceException", "e", ")", "{", "if", "(", "e", ".", "getCause", "(", ")", "instanceof", "ConstraintViolationException", ")", "{", "// ignore, another thread beat us to creation", "logger", ".", "debug", "(", "\"Failed to create mutex, it was likely created concurrently by another thread: \"", "+", "clusterMutex", ",", "e", ")", ";", "return", ";", "}", "// re-throw exception with unhandled cause", "throw", "e", ";", "}", "}", "}", ")", ";", "}"], "docstring": "Creates a new ClusterMutex with the specified name. Returns the created mutex or null if the\nmutex already exists.", "docstring_tokens": ["Creates", "a", "new", "ClusterMutex", "with", "the", "specified", "name", ".", "Returns", "the", "created", "mutex", "or", "null", "if", "the", "mutex", "already", "exists", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java#L247-L273", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java", "func_name": "JpaClusterLockDao.validateLockedMutex", "original_string": "protected void validateLockedMutex(ClusterMutex clusterMutex) {\n        if (!clusterMutex.isLocked()) {\n            throw new IllegalMonitorStateException(\n                    \"Mutex is not currently locked, it cannot be updated: \" + clusterMutex);\n        }\n        final String serverName = this.portalInfoProvider.getUniqueServerName();\n        if (!serverName.equals(clusterMutex.getServerId())) {\n            throw new IllegalMonitorStateException(\n                    \"Mutex is currently locked by another server: \"\n                            + clusterMutex\n                            + \" local serverName: \"\n                            + serverName);\n        }\n    }", "language": "java", "code": "protected void validateLockedMutex(ClusterMutex clusterMutex) {\n        if (!clusterMutex.isLocked()) {\n            throw new IllegalMonitorStateException(\n                    \"Mutex is not currently locked, it cannot be updated: \" + clusterMutex);\n        }\n        final String serverName = this.portalInfoProvider.getUniqueServerName();\n        if (!serverName.equals(clusterMutex.getServerId())) {\n            throw new IllegalMonitorStateException(\n                    \"Mutex is currently locked by another server: \"\n                            + clusterMutex\n                            + \" local serverName: \"\n                            + serverName);\n        }\n    }", "code_tokens": ["protected", "void", "validateLockedMutex", "(", "ClusterMutex", "clusterMutex", ")", "{", "if", "(", "!", "clusterMutex", ".", "isLocked", "(", ")", ")", "{", "throw", "new", "IllegalMonitorStateException", "(", "\"Mutex is not currently locked, it cannot be updated: \"", "+", "clusterMutex", ")", ";", "}", "final", "String", "serverName", "=", "this", ".", "portalInfoProvider", ".", "getUniqueServerName", "(", ")", ";", "if", "(", "!", "serverName", ".", "equals", "(", "clusterMutex", ".", "getServerId", "(", ")", ")", ")", "{", "throw", "new", "IllegalMonitorStateException", "(", "\"Mutex is currently locked by another server: \"", "+", "clusterMutex", "+", "\" local serverName: \"", "+", "serverName", ")", ";", "}", "}"], "docstring": "Validates that the specified mutex is locked by this server, throws\nIllegalMonitorStateException if either test fails", "docstring_tokens": ["Validates", "that", "the", "specified", "mutex", "is", "locked", "by", "this", "server", "throws", "IllegalMonitorStateException", "if", "either", "test", "fails"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java#L279-L292", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java", "func_name": "JpaClusterLockDao.unlockAbandonedLock", "original_string": "protected void unlockAbandonedLock(final String mutexName) {\n        this.executeIgnoreRollback(\n                new TransactionCallbackWithoutResult() {\n                    @Override\n                    protected void doInTransactionWithoutResult(TransactionStatus status) {\n                        final EntityManager entityManager = getEntityManager();\n                        final ClusterMutex clusterMutex = getClusterMutex(mutexName);\n\n                        if (!isLockAbandoned(clusterMutex)) {\n                            // No longer abandoned\n                            return;\n                        }\n\n                        logger.warn(\"Unlocking abandoned \" + clusterMutex);\n                        clusterMutex.unlock();\n                        entityManager.persist(clusterMutex);\n                        try {\n                            entityManager.flush();\n                        } catch (OptimisticLockException e) {\n                            logger.trace(\n                                    \"Abandoned mutex {} was cleared by another thread or server\",\n                                    mutexName);\n                        }\n                    }\n                });\n    }", "language": "java", "code": "protected void unlockAbandonedLock(final String mutexName) {\n        this.executeIgnoreRollback(\n                new TransactionCallbackWithoutResult() {\n                    @Override\n                    protected void doInTransactionWithoutResult(TransactionStatus status) {\n                        final EntityManager entityManager = getEntityManager();\n                        final ClusterMutex clusterMutex = getClusterMutex(mutexName);\n\n                        if (!isLockAbandoned(clusterMutex)) {\n                            // No longer abandoned\n                            return;\n                        }\n\n                        logger.warn(\"Unlocking abandoned \" + clusterMutex);\n                        clusterMutex.unlock();\n                        entityManager.persist(clusterMutex);\n                        try {\n                            entityManager.flush();\n                        } catch (OptimisticLockException e) {\n                            logger.trace(\n                                    \"Abandoned mutex {} was cleared by another thread or server\",\n                                    mutexName);\n                        }\n                    }\n                });\n    }", "code_tokens": ["protected", "void", "unlockAbandonedLock", "(", "final", "String", "mutexName", ")", "{", "this", ".", "executeIgnoreRollback", "(", "new", "TransactionCallbackWithoutResult", "(", ")", "{", "@", "Override", "protected", "void", "doInTransactionWithoutResult", "(", "TransactionStatus", "status", ")", "{", "final", "EntityManager", "entityManager", "=", "getEntityManager", "(", ")", ";", "final", "ClusterMutex", "clusterMutex", "=", "getClusterMutex", "(", "mutexName", ")", ";", "if", "(", "!", "isLockAbandoned", "(", "clusterMutex", ")", ")", "{", "// No longer abandoned", "return", ";", "}", "logger", ".", "warn", "(", "\"Unlocking abandoned \"", "+", "clusterMutex", ")", ";", "clusterMutex", ".", "unlock", "(", ")", ";", "entityManager", ".", "persist", "(", "clusterMutex", ")", ";", "try", "{", "entityManager", ".", "flush", "(", ")", ";", "}", "catch", "(", "OptimisticLockException", "e", ")", "{", "logger", ".", "trace", "(", "\"Abandoned mutex {} was cleared by another thread or server\"", ",", "mutexName", ")", ";", "}", "}", "}", ")", ";", "}"], "docstring": "Unlocks an abandoned mutex", "docstring_tokens": ["Unlocks", "an", "abandoned", "mutex"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java#L295-L320", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java", "func_name": "JpaClusterLockDao.executeIgnoreRollback", "original_string": "protected <T> T executeIgnoreRollback(TransactionCallback<T> action, T rollbackValue) {\n        try {\n            // Try to create the mutex in a new TX\n            return this.newTransactionTemplate.execute(action);\n        } catch (TransactionSystemException e) {\n            if (e.getCause() instanceof RollbackException) {\n                // Ignore rollbacks\n                return rollbackValue;\n            }\n\n            // re-throw exception with unhandled cause\n            throw e;\n        }\n    }", "language": "java", "code": "protected <T> T executeIgnoreRollback(TransactionCallback<T> action, T rollbackValue) {\n        try {\n            // Try to create the mutex in a new TX\n            return this.newTransactionTemplate.execute(action);\n        } catch (TransactionSystemException e) {\n            if (e.getCause() instanceof RollbackException) {\n                // Ignore rollbacks\n                return rollbackValue;\n            }\n\n            // re-throw exception with unhandled cause\n            throw e;\n        }\n    }", "code_tokens": ["protected", "<", "T", ">", "T", "executeIgnoreRollback", "(", "TransactionCallback", "<", "T", ">", "action", ",", "T", "rollbackValue", ")", "{", "try", "{", "// Try to create the mutex in a new TX", "return", "this", ".", "newTransactionTemplate", ".", "execute", "(", "action", ")", ";", "}", "catch", "(", "TransactionSystemException", "e", ")", "{", "if", "(", "e", ".", "getCause", "(", ")", "instanceof", "RollbackException", ")", "{", "// Ignore rollbacks", "return", "rollbackValue", ";", "}", "// re-throw exception with unhandled cause", "throw", "e", ";", "}", "}"], "docstring": "Utility for using TransactionTemplate when we know that a rollback might happen and just want\nto ignore it", "docstring_tokens": ["Utility", "for", "using", "TransactionTemplate", "when", "we", "know", "that", "a", "rollback", "might", "happen", "and", "just", "want", "to", "ignore", "it"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java#L335-L348", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/favorites/FavoritesUtils.java", "func_name": "FavoritesUtils.getFavoriteCollections", "original_string": "public List<IUserLayoutNodeDescription> getFavoriteCollections(IUserLayout userLayout) {\n\n        if (null == userLayout) {\n            throw new IllegalArgumentException(\n                    \"Cannot get favorites collections from a null userLayout\");\n        }\n\n        logger.trace(\"Extracting favorites collections from layout [{}].\", userLayout);\n\n        Enumeration<String> nodeIds = userLayout.getChildIds(userLayout.getRootId());\n\n        List<IUserLayoutNodeDescription> results = new LinkedList<IUserLayoutNodeDescription>();\n\n        while (nodeIds.hasMoreElements()) {\n            String nodeId = nodeIds.nextElement();\n\n            try {\n                IUserLayoutNodeDescription nodeDescription = userLayout.getNodeDescription(nodeId);\n\n                String parentId = userLayout.getParentId(nodeId);\n                String nodeName = nodeDescription.getName();\n                IUserLayoutNodeDescription.LayoutNodeType nodeType = nodeDescription.getType();\n\n                if (FOLDER.equals(nodeType)\n                        && nodeDescription instanceof IUserLayoutFolderDescription) {\n\n                    IUserLayoutFolderDescription folderDescription =\n                            (IUserLayoutFolderDescription) nodeDescription;\n\n                    String folderType = folderDescription.getFolderType();\n\n                    if (FAVORITE_COLLECTION_TYPE.equals(folderType)) {\n\n                        results.add(nodeDescription);\n\n                        logger.trace(\n                                \"Selected node with id [{}] named [{}] with \"\n                                        + \"folderType [{}] and type [{}] as a collection of favorites.\",\n                                nodeId,\n                                nodeName,\n                                folderType,\n                                nodeType);\n\n                    } else {\n\n                        logger.trace(\n                                \"Rejected node with id [{}] named [{}] with \"\n                                        + \"folderType [{}] and type [{}] as not a collection of favorites.\",\n                                nodeId,\n                                nodeName,\n                                folderType,\n                                nodeType);\n                    }\n\n                } else {\n                    logger.trace(\n                            \"Rejected non-folder node with id [{}] named [{}] \"\n                                    + \"with parentId [{}] and type [{}] as not a collection of favorites.\",\n                            nodeId,\n                            nodeName,\n                            parentId,\n                            nodeType);\n                }\n\n                // if something goes wrong in processing a node, exclude it\n            } catch (Exception e) {\n                logger.error(\n                        \"Error determining whether to include layout node [{}]\"\n                                + \" as a collection of favorites.  Excluding.\",\n                        nodeId,\n                        e);\n            }\n        }\n\n        logger.debug(\"Extracted favorites collections [{}] from [{}]\", results, userLayout);\n\n        return results;\n    }", "language": "java", "code": "public List<IUserLayoutNodeDescription> getFavoriteCollections(IUserLayout userLayout) {\n\n        if (null == userLayout) {\n            throw new IllegalArgumentException(\n                    \"Cannot get favorites collections from a null userLayout\");\n        }\n\n        logger.trace(\"Extracting favorites collections from layout [{}].\", userLayout);\n\n        Enumeration<String> nodeIds = userLayout.getChildIds(userLayout.getRootId());\n\n        List<IUserLayoutNodeDescription> results = new LinkedList<IUserLayoutNodeDescription>();\n\n        while (nodeIds.hasMoreElements()) {\n            String nodeId = nodeIds.nextElement();\n\n            try {\n                IUserLayoutNodeDescription nodeDescription = userLayout.getNodeDescription(nodeId);\n\n                String parentId = userLayout.getParentId(nodeId);\n                String nodeName = nodeDescription.getName();\n                IUserLayoutNodeDescription.LayoutNodeType nodeType = nodeDescription.getType();\n\n                if (FOLDER.equals(nodeType)\n                        && nodeDescription instanceof IUserLayoutFolderDescription) {\n\n                    IUserLayoutFolderDescription folderDescription =\n                            (IUserLayoutFolderDescription) nodeDescription;\n\n                    String folderType = folderDescription.getFolderType();\n\n                    if (FAVORITE_COLLECTION_TYPE.equals(folderType)) {\n\n                        results.add(nodeDescription);\n\n                        logger.trace(\n                                \"Selected node with id [{}] named [{}] with \"\n                                        + \"folderType [{}] and type [{}] as a collection of favorites.\",\n                                nodeId,\n                                nodeName,\n                                folderType,\n                                nodeType);\n\n                    } else {\n\n                        logger.trace(\n                                \"Rejected node with id [{}] named [{}] with \"\n                                        + \"folderType [{}] and type [{}] as not a collection of favorites.\",\n                                nodeId,\n                                nodeName,\n                                folderType,\n                                nodeType);\n                    }\n\n                } else {\n                    logger.trace(\n                            \"Rejected non-folder node with id [{}] named [{}] \"\n                                    + \"with parentId [{}] and type [{}] as not a collection of favorites.\",\n                            nodeId,\n                            nodeName,\n                            parentId,\n                            nodeType);\n                }\n\n                // if something goes wrong in processing a node, exclude it\n            } catch (Exception e) {\n                logger.error(\n                        \"Error determining whether to include layout node [{}]\"\n                                + \" as a collection of favorites.  Excluding.\",\n                        nodeId,\n                        e);\n            }\n        }\n\n        logger.debug(\"Extracted favorites collections [{}] from [{}]\", results, userLayout);\n\n        return results;\n    }", "code_tokens": ["public", "List", "<", "IUserLayoutNodeDescription", ">", "getFavoriteCollections", "(", "IUserLayout", "userLayout", ")", "{", "if", "(", "null", "==", "userLayout", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"Cannot get favorites collections from a null userLayout\"", ")", ";", "}", "logger", ".", "trace", "(", "\"Extracting favorites collections from layout [{}].\"", ",", "userLayout", ")", ";", "Enumeration", "<", "String", ">", "nodeIds", "=", "userLayout", ".", "getChildIds", "(", "userLayout", ".", "getRootId", "(", ")", ")", ";", "List", "<", "IUserLayoutNodeDescription", ">", "results", "=", "new", "LinkedList", "<", "IUserLayoutNodeDescription", ">", "(", ")", ";", "while", "(", "nodeIds", ".", "hasMoreElements", "(", ")", ")", "{", "String", "nodeId", "=", "nodeIds", ".", "nextElement", "(", ")", ";", "try", "{", "IUserLayoutNodeDescription", "nodeDescription", "=", "userLayout", ".", "getNodeDescription", "(", "nodeId", ")", ";", "String", "parentId", "=", "userLayout", ".", "getParentId", "(", "nodeId", ")", ";", "String", "nodeName", "=", "nodeDescription", ".", "getName", "(", ")", ";", "IUserLayoutNodeDescription", ".", "LayoutNodeType", "nodeType", "=", "nodeDescription", ".", "getType", "(", ")", ";", "if", "(", "FOLDER", ".", "equals", "(", "nodeType", ")", "&&", "nodeDescription", "instanceof", "IUserLayoutFolderDescription", ")", "{", "IUserLayoutFolderDescription", "folderDescription", "=", "(", "IUserLayoutFolderDescription", ")", "nodeDescription", ";", "String", "folderType", "=", "folderDescription", ".", "getFolderType", "(", ")", ";", "if", "(", "FAVORITE_COLLECTION_TYPE", ".", "equals", "(", "folderType", ")", ")", "{", "results", ".", "add", "(", "nodeDescription", ")", ";", "logger", ".", "trace", "(", "\"Selected node with id [{}] named [{}] with \"", "+", "\"folderType [{}] and type [{}] as a collection of favorites.\"", ",", "nodeId", ",", "nodeName", ",", "folderType", ",", "nodeType", ")", ";", "}", "else", "{", "logger", ".", "trace", "(", "\"Rejected node with id [{}] named [{}] with \"", "+", "\"folderType [{}] and type [{}] as not a collection of favorites.\"", ",", "nodeId", ",", "nodeName", ",", "folderType", ",", "nodeType", ")", ";", "}", "}", "else", "{", "logger", ".", "trace", "(", "\"Rejected non-folder node with id [{}] named [{}] \"", "+", "\"with parentId [{}] and type [{}] as not a collection of favorites.\"", ",", "nodeId", ",", "nodeName", ",", "parentId", ",", "nodeType", ")", ";", "}", "// if something goes wrong in processing a node, exclude it", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "error", "(", "\"Error determining whether to include layout node [{}]\"", "+", "\" as a collection of favorites.  Excluding.\"", ",", "nodeId", ",", "e", ")", ";", "}", "}", "logger", ".", "debug", "(", "\"Extracted favorites collections [{}] from [{}]\"", ",", "results", ",", "userLayout", ")", ";", "return", "results", ";", "}"], "docstring": "Get the favorite collections of portlets (i.e. suitable folders (\"tabs\") in the user layout.)\nSuitable layout nodes are of type folder with @type attribute favorite_collection.\n\n@param userLayout\n@return non-null List of IUserLayoutDescriptions describing the tabs", "docstring_tokens": ["Get", "the", "favorite", "collections", "of", "portlets", "(", "i", ".", "e", ".", "suitable", "folders", "(", "tabs", ")", "in", "the", "user", "layout", ".", ")", "Suitable", "layout", "nodes", "are", "of", "type", "folder", "with", "@type", "attribute", "favorite_collection", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/favorites/FavoritesUtils.java#L58-L135", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/favorites/FavoritesUtils.java", "func_name": "FavoritesUtils.getFavoritePortletLayoutNodes", "original_string": "@SuppressWarnings(\"unchecked\")\n    public List<IUserLayoutNodeDescription> getFavoritePortletLayoutNodes(IUserLayout userLayout) {\n\n        logger.trace(\"Extracting favorite portlets from layout [{}]\", userLayout);\n\n        List<IUserLayoutNodeDescription> favorites = new LinkedList<>();\n\n        Enumeration<String> childrenOfRoot = userLayout.getChildIds(userLayout.getRootId());\n\n        // loop over folders that might be the favorites folder\n        while (childrenOfRoot.hasMoreElements()) {\n            String nodeId = childrenOfRoot.nextElement();\n\n            try {\n\n                IUserLayoutNodeDescription nodeDescription = userLayout.getNodeDescription(nodeId);\n\n                if (FOLDER.equals(nodeDescription.getType())\n                        && nodeDescription instanceof IUserLayoutFolderDescription) {\n\n                    IUserLayoutFolderDescription folderDescription =\n                            (IUserLayoutFolderDescription) nodeDescription;\n\n                    if (FAVORITES_TYPE.equalsIgnoreCase(folderDescription.getFolderType())) {\n                        // TODO: assumes columns structure, but should traverse tree to collect all\n                        // portlets regardless\n                        Enumeration<String> columns = userLayout.getChildIds(nodeId);\n\n                        // loop through columns to gather beloved portlets\n                        while (columns.hasMoreElements()) {\n                            String column = columns.nextElement();\n                            Enumeration<String> portlets = userLayout.getChildIds(column);\n                            while (portlets.hasMoreElements()) {\n                                String portlet = portlets.nextElement();\n                                IUserLayoutNodeDescription portletDescription =\n                                        userLayout.getNodeDescription(portlet);\n                                favorites.add(portletDescription);\n                            }\n                        }\n                    } else {\n                        logger.trace(\"Ignoring non-favorites folder node [{}]\", nodeDescription);\n                    }\n\n                } else {\n                    logger.trace(\"Ignoring non-folder node [{}]\", nodeDescription);\n                }\n\n            } catch (Exception e) {\n                logger.error(\n                        \"Ignoring on error a node while examining for favorites: node ID is [{}]\",\n                        nodeId,\n                        e);\n            }\n        }\n\n        logger.debug(\"Extracted favorite portlets [{}] from [{}]\", favorites, userLayout);\n\n        return favorites;\n    }", "language": "java", "code": "@SuppressWarnings(\"unchecked\")\n    public List<IUserLayoutNodeDescription> getFavoritePortletLayoutNodes(IUserLayout userLayout) {\n\n        logger.trace(\"Extracting favorite portlets from layout [{}]\", userLayout);\n\n        List<IUserLayoutNodeDescription> favorites = new LinkedList<>();\n\n        Enumeration<String> childrenOfRoot = userLayout.getChildIds(userLayout.getRootId());\n\n        // loop over folders that might be the favorites folder\n        while (childrenOfRoot.hasMoreElements()) {\n            String nodeId = childrenOfRoot.nextElement();\n\n            try {\n\n                IUserLayoutNodeDescription nodeDescription = userLayout.getNodeDescription(nodeId);\n\n                if (FOLDER.equals(nodeDescription.getType())\n                        && nodeDescription instanceof IUserLayoutFolderDescription) {\n\n                    IUserLayoutFolderDescription folderDescription =\n                            (IUserLayoutFolderDescription) nodeDescription;\n\n                    if (FAVORITES_TYPE.equalsIgnoreCase(folderDescription.getFolderType())) {\n                        // TODO: assumes columns structure, but should traverse tree to collect all\n                        // portlets regardless\n                        Enumeration<String> columns = userLayout.getChildIds(nodeId);\n\n                        // loop through columns to gather beloved portlets\n                        while (columns.hasMoreElements()) {\n                            String column = columns.nextElement();\n                            Enumeration<String> portlets = userLayout.getChildIds(column);\n                            while (portlets.hasMoreElements()) {\n                                String portlet = portlets.nextElement();\n                                IUserLayoutNodeDescription portletDescription =\n                                        userLayout.getNodeDescription(portlet);\n                                favorites.add(portletDescription);\n                            }\n                        }\n                    } else {\n                        logger.trace(\"Ignoring non-favorites folder node [{}]\", nodeDescription);\n                    }\n\n                } else {\n                    logger.trace(\"Ignoring non-folder node [{}]\", nodeDescription);\n                }\n\n            } catch (Exception e) {\n                logger.error(\n                        \"Ignoring on error a node while examining for favorites: node ID is [{}]\",\n                        nodeId,\n                        e);\n            }\n        }\n\n        logger.debug(\"Extracted favorite portlets [{}] from [{}]\", favorites, userLayout);\n\n        return favorites;\n    }", "code_tokens": ["@", "SuppressWarnings", "(", "\"unchecked\"", ")", "public", "List", "<", "IUserLayoutNodeDescription", ">", "getFavoritePortletLayoutNodes", "(", "IUserLayout", "userLayout", ")", "{", "logger", ".", "trace", "(", "\"Extracting favorite portlets from layout [{}]\"", ",", "userLayout", ")", ";", "List", "<", "IUserLayoutNodeDescription", ">", "favorites", "=", "new", "LinkedList", "<>", "(", ")", ";", "Enumeration", "<", "String", ">", "childrenOfRoot", "=", "userLayout", ".", "getChildIds", "(", "userLayout", ".", "getRootId", "(", ")", ")", ";", "// loop over folders that might be the favorites folder", "while", "(", "childrenOfRoot", ".", "hasMoreElements", "(", ")", ")", "{", "String", "nodeId", "=", "childrenOfRoot", ".", "nextElement", "(", ")", ";", "try", "{", "IUserLayoutNodeDescription", "nodeDescription", "=", "userLayout", ".", "getNodeDescription", "(", "nodeId", ")", ";", "if", "(", "FOLDER", ".", "equals", "(", "nodeDescription", ".", "getType", "(", ")", ")", "&&", "nodeDescription", "instanceof", "IUserLayoutFolderDescription", ")", "{", "IUserLayoutFolderDescription", "folderDescription", "=", "(", "IUserLayoutFolderDescription", ")", "nodeDescription", ";", "if", "(", "FAVORITES_TYPE", ".", "equalsIgnoreCase", "(", "folderDescription", ".", "getFolderType", "(", ")", ")", ")", "{", "// TODO: assumes columns structure, but should traverse tree to collect all", "// portlets regardless", "Enumeration", "<", "String", ">", "columns", "=", "userLayout", ".", "getChildIds", "(", "nodeId", ")", ";", "// loop through columns to gather beloved portlets", "while", "(", "columns", ".", "hasMoreElements", "(", ")", ")", "{", "String", "column", "=", "columns", ".", "nextElement", "(", ")", ";", "Enumeration", "<", "String", ">", "portlets", "=", "userLayout", ".", "getChildIds", "(", "column", ")", ";", "while", "(", "portlets", ".", "hasMoreElements", "(", ")", ")", "{", "String", "portlet", "=", "portlets", ".", "nextElement", "(", ")", ";", "IUserLayoutNodeDescription", "portletDescription", "=", "userLayout", ".", "getNodeDescription", "(", "portlet", ")", ";", "favorites", ".", "add", "(", "portletDescription", ")", ";", "}", "}", "}", "else", "{", "logger", ".", "trace", "(", "\"Ignoring non-favorites folder node [{}]\"", ",", "nodeDescription", ")", ";", "}", "}", "else", "{", "logger", ".", "trace", "(", "\"Ignoring non-folder node [{}]\"", ",", "nodeDescription", ")", ";", "}", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "error", "(", "\"Ignoring on error a node while examining for favorites: node ID is [{}]\"", ",", "nodeId", ",", "e", ")", ";", "}", "}", "logger", ".", "debug", "(", "\"Extracted favorite portlets [{}] from [{}]\"", ",", "favorites", ",", "userLayout", ")", ";", "return", "favorites", ";", "}"], "docstring": "Get the portlets that are in the folder(s) of type \"favorites\".\n\n@param userLayout\n@return", "docstring_tokens": ["Get", "the", "portlets", "that", "are", "in", "the", "folder", "(", "s", ")", "of", "type", "favorites", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/favorites/FavoritesUtils.java#L178-L236", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/favorites/FavoritesUtils.java", "func_name": "FavoritesUtils.hasAnyFavorites", "original_string": "public boolean hasAnyFavorites(IUserLayout layout) {\n        Validate.notNull(layout, \"Cannot determine whether a null layout contains favorites.\");\n\n        // (premature) performance optimization: short circuit returns true if nonzero favorite\n        // portlets\n        return (!getFavoritePortletLayoutNodes(layout).isEmpty()\n                || !getFavoriteCollections(layout).isEmpty());\n    }", "language": "java", "code": "public boolean hasAnyFavorites(IUserLayout layout) {\n        Validate.notNull(layout, \"Cannot determine whether a null layout contains favorites.\");\n\n        // (premature) performance optimization: short circuit returns true if nonzero favorite\n        // portlets\n        return (!getFavoritePortletLayoutNodes(layout).isEmpty()\n                || !getFavoriteCollections(layout).isEmpty());\n    }", "code_tokens": ["public", "boolean", "hasAnyFavorites", "(", "IUserLayout", "layout", ")", "{", "Validate", ".", "notNull", "(", "layout", ",", "\"Cannot determine whether a null layout contains favorites.\"", ")", ";", "// (premature) performance optimization: short circuit returns true if nonzero favorite", "// portlets", "return", "(", "!", "getFavoritePortletLayoutNodes", "(", "layout", ")", ".", "isEmpty", "(", ")", "||", "!", "getFavoriteCollections", "(", "layout", ")", ".", "isEmpty", "(", ")", ")", ";", "}"], "docstring": "True if the layout contains any favorited collections or favorited individual portlets, false\notherwise.\n\n@param layout non-null user layout that might contain favorite portlets and/or collections\n@return true if the layout contains at least one favorited portlet or collection, false\notherwise\n@throws IllegalArgumentException if layout is null", "docstring_tokens": ["True", "if", "the", "layout", "contains", "any", "favorited", "collections", "or", "favorited", "individual", "portlets", "false", "otherwise", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/favorites/FavoritesUtils.java#L280-L287", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/LocaleTransformerConfigurationSource.java", "func_name": "LocaleTransformerConfigurationSource.getParameters", "original_string": "@Override\n    public Map<String, Object> getParameters(\n            HttpServletRequest request, HttpServletResponse response) {\n        final LocaleManager localeManager = this.getLocaleManager(request);\n\n        final List<Locale> locales = localeManager.getLocales();\n        if (locales != null && locales.size() > 0 && locales.get(0) != null) {\n            final String locale = locales.get(0).toString();\n            final String xslLocale = locale.replace('_', '-');\n            this.logger.debug(\"Setting USER_LANG to {}\", xslLocale);\n            return Collections.singletonMap(\"USER_LANG\", (Object) xslLocale);\n        }\n\n        return null;\n    }", "language": "java", "code": "@Override\n    public Map<String, Object> getParameters(\n            HttpServletRequest request, HttpServletResponse response) {\n        final LocaleManager localeManager = this.getLocaleManager(request);\n\n        final List<Locale> locales = localeManager.getLocales();\n        if (locales != null && locales.size() > 0 && locales.get(0) != null) {\n            final String locale = locales.get(0).toString();\n            final String xslLocale = locale.replace('_', '-');\n            this.logger.debug(\"Setting USER_LANG to {}\", xslLocale);\n            return Collections.singletonMap(\"USER_LANG\", (Object) xslLocale);\n        }\n\n        return null;\n    }", "code_tokens": ["@", "Override", "public", "Map", "<", "String", ",", "Object", ">", "getParameters", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "final", "LocaleManager", "localeManager", "=", "this", ".", "getLocaleManager", "(", "request", ")", ";", "final", "List", "<", "Locale", ">", "locales", "=", "localeManager", ".", "getLocales", "(", ")", ";", "if", "(", "locales", "!=", "null", "&&", "locales", ".", "size", "(", ")", ">", "0", "&&", "locales", ".", "get", "(", "0", ")", "!=", "null", ")", "{", "final", "String", "locale", "=", "locales", ".", "get", "(", "0", ")", ".", "toString", "(", ")", ";", "final", "String", "xslLocale", "=", "locale", ".", "replace", "(", "'", "'", ",", "'", "'", ")", ";", "this", ".", "logger", ".", "debug", "(", "\"Setting USER_LANG to {}\"", ",", "xslLocale", ")", ";", "return", "Collections", ".", "singletonMap", "(", "\"USER_LANG\"", ",", "(", "Object", ")", "xslLocale", ")", ";", "}", "return", "null", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.xslt.TransformerConfigurationSource#getParameters(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/LocaleTransformerConfigurationSource.java#L50-L64", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/LocaleTransformerConfigurationSource.java", "func_name": "LocaleTransformerConfigurationSource.getCacheKey", "original_string": "@Override\n    public CacheKey getCacheKey(HttpServletRequest request, HttpServletResponse response) {\n        final LocaleManager localeManager = this.getLocaleManager(request);\n\n        final List<Locale> locales = localeManager.getLocales();\n        if (locales != null && locales.size() > 0 && locales.get(0) != null) {\n            final String locale = locales.get(0).toString();\n            final String xslLocale = locale.replace('_', '-');\n            return CacheKey.build(this.getClass().getName(), xslLocale);\n        }\n\n        return null;\n    }", "language": "java", "code": "@Override\n    public CacheKey getCacheKey(HttpServletRequest request, HttpServletResponse response) {\n        final LocaleManager localeManager = this.getLocaleManager(request);\n\n        final List<Locale> locales = localeManager.getLocales();\n        if (locales != null && locales.size() > 0 && locales.get(0) != null) {\n            final String locale = locales.get(0).toString();\n            final String xslLocale = locale.replace('_', '-');\n            return CacheKey.build(this.getClass().getName(), xslLocale);\n        }\n\n        return null;\n    }", "code_tokens": ["@", "Override", "public", "CacheKey", "getCacheKey", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "final", "LocaleManager", "localeManager", "=", "this", ".", "getLocaleManager", "(", "request", ")", ";", "final", "List", "<", "Locale", ">", "locales", "=", "localeManager", ".", "getLocales", "(", ")", ";", "if", "(", "locales", "!=", "null", "&&", "locales", ".", "size", "(", ")", ">", "0", "&&", "locales", ".", "get", "(", "0", ")", "!=", "null", ")", "{", "final", "String", "locale", "=", "locales", ".", "get", "(", "0", ")", ".", "toString", "(", ")", ";", "final", "String", "xslLocale", "=", "locale", ".", "replace", "(", "'", "'", ",", "'", "'", ")", ";", "return", "CacheKey", ".", "build", "(", "this", ".", "getClass", "(", ")", ".", "getName", "(", ")", ",", "xslLocale", ")", ";", "}", "return", "null", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.xslt.TransformerConfigurationSource#getCacheKey(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/LocaleTransformerConfigurationSource.java#L69-L81", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/LPAChangeAttribute.java", "func_name": "LPAChangeAttribute.perform", "original_string": "@Override\n    public void perform() throws PortalException {\n        // push the change into the PLF\n        if (nodeId.startsWith(Constants.FRAGMENT_ID_USER_PREFIX)) {\n            // we are dealing with an incorporated node, so get a plf ghost\n            // node, set its attribute, then add a directive indicating the\n            // attribute that should be pushed into the ilf during merge\n            Element plfNode =\n                    HandlerUtils.getPLFNode(\n                            ilfNode, person, true, // create node if not found\n                            false); // don't create children\n            plfNode.setAttribute(name, value);\n            /*\n             * add directive to hold override value. This is not necessary for\n             * folder names since they are overridden at render time with their\n             * locale specific version and persisted via a different mechanism.\n             */\n            EditManager.addEditDirective(plfNode, name, person);\n        } else {\n            // node owned by user so change attribute in child directly\n            Document plf = RDBMDistributedLayoutStore.getPLF(person);\n            Element plfNode = plf.getElementById(nodeId);\n            if (plfNode != null) // should always be non-null\n            {\n                plfNode.setAttribute(name, value);\n            }\n        }\n        /*\n         * push the change into the ILF if not the name attribute. For names\n         * the rendering will inject the localized name via a special processor.\n         * So it doesn't matter what is in the ILF's folder name attribute.\n         */\n        if (!name.equals(Constants.ATT_NAME))\n        // should always be non-null\n        {\n            ilfNode.setAttribute(name, value);\n        }\n    }", "language": "java", "code": "@Override\n    public void perform() throws PortalException {\n        // push the change into the PLF\n        if (nodeId.startsWith(Constants.FRAGMENT_ID_USER_PREFIX)) {\n            // we are dealing with an incorporated node, so get a plf ghost\n            // node, set its attribute, then add a directive indicating the\n            // attribute that should be pushed into the ilf during merge\n            Element plfNode =\n                    HandlerUtils.getPLFNode(\n                            ilfNode, person, true, // create node if not found\n                            false); // don't create children\n            plfNode.setAttribute(name, value);\n            /*\n             * add directive to hold override value. This is not necessary for\n             * folder names since they are overridden at render time with their\n             * locale specific version and persisted via a different mechanism.\n             */\n            EditManager.addEditDirective(plfNode, name, person);\n        } else {\n            // node owned by user so change attribute in child directly\n            Document plf = RDBMDistributedLayoutStore.getPLF(person);\n            Element plfNode = plf.getElementById(nodeId);\n            if (plfNode != null) // should always be non-null\n            {\n                plfNode.setAttribute(name, value);\n            }\n        }\n        /*\n         * push the change into the ILF if not the name attribute. For names\n         * the rendering will inject the localized name via a special processor.\n         * So it doesn't matter what is in the ILF's folder name attribute.\n         */\n        if (!name.equals(Constants.ATT_NAME))\n        // should always be non-null\n        {\n            ilfNode.setAttribute(name, value);\n        }\n    }", "code_tokens": ["@", "Override", "public", "void", "perform", "(", ")", "throws", "PortalException", "{", "// push the change into the PLF", "if", "(", "nodeId", ".", "startsWith", "(", "Constants", ".", "FRAGMENT_ID_USER_PREFIX", ")", ")", "{", "// we are dealing with an incorporated node, so get a plf ghost", "// node, set its attribute, then add a directive indicating the", "// attribute that should be pushed into the ilf during merge", "Element", "plfNode", "=", "HandlerUtils", ".", "getPLFNode", "(", "ilfNode", ",", "person", ",", "true", ",", "// create node if not found", "false", ")", ";", "// don't create children", "plfNode", ".", "setAttribute", "(", "name", ",", "value", ")", ";", "/*\n             * add directive to hold override value. This is not necessary for\n             * folder names since they are overridden at render time with their\n             * locale specific version and persisted via a different mechanism.\n             */", "EditManager", ".", "addEditDirective", "(", "plfNode", ",", "name", ",", "person", ")", ";", "}", "else", "{", "// node owned by user so change attribute in child directly", "Document", "plf", "=", "RDBMDistributedLayoutStore", ".", "getPLF", "(", "person", ")", ";", "Element", "plfNode", "=", "plf", ".", "getElementById", "(", "nodeId", ")", ";", "if", "(", "plfNode", "!=", "null", ")", "// should always be non-null", "{", "plfNode", ".", "setAttribute", "(", "name", ",", "value", ")", ";", "}", "}", "/*\n         * push the change into the ILF if not the name attribute. For names\n         * the rendering will inject the localized name via a special processor.\n         * So it doesn't matter what is in the ILF's folder name attribute.\n         */", "if", "(", "!", "name", ".", "equals", "(", "Constants", ".", "ATT_NAME", ")", ")", "// should always be non-null", "{", "ilfNode", ".", "setAttribute", "(", "name", ",", "value", ")", ";", "}", "}"], "docstring": "Apply the attribute change.", "docstring_tokens": ["Apply", "the", "attribute", "change", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/LPAChangeAttribute.java#L39-L76", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/session/PortletSessionExpirationManager.java", "func_name": "PortletSessionExpirationManager.onEnd", "original_string": "@SuppressWarnings(\"unchecked\")\n    @Override\n    public void onEnd(PortletInvocationEvent event) {\n        final PortletRequest portletRequest = event.getPortletRequest();\n        final PortletSession portletSession = portletRequest.getPortletSession(false);\n        if (portletSession == null) {\n            return;\n        }\n\n        final HttpServletRequest portalRequest =\n                this.portalRequestUtils.getPortletHttpRequest(portletRequest);\n        final HttpSession portalSession = portalRequest.getSession();\n\n        if (portalSession != null) {\n            NonSerializableMapHolder<String, PortletSession> portletSessions;\n            synchronized (WebUtils.getSessionMutex(portalSession)) {\n                portletSessions =\n                        (NonSerializableMapHolder<String, PortletSession>)\n                                portalSession.getAttribute(PORTLET_SESSIONS_MAP);\n                if (portletSessions == null || !portletSessions.isValid()) {\n                    portletSessions =\n                            new NonSerializableMapHolder(\n                                    new ConcurrentHashMap<String, PortletSession>());\n                    portalSession.setAttribute(PORTLET_SESSIONS_MAP, portletSessions);\n                }\n            }\n\n            final String contextPath = portletRequest.getContextPath();\n            portletSessions.put(contextPath, portletSession);\n        }\n    }", "language": "java", "code": "@SuppressWarnings(\"unchecked\")\n    @Override\n    public void onEnd(PortletInvocationEvent event) {\n        final PortletRequest portletRequest = event.getPortletRequest();\n        final PortletSession portletSession = portletRequest.getPortletSession(false);\n        if (portletSession == null) {\n            return;\n        }\n\n        final HttpServletRequest portalRequest =\n                this.portalRequestUtils.getPortletHttpRequest(portletRequest);\n        final HttpSession portalSession = portalRequest.getSession();\n\n        if (portalSession != null) {\n            NonSerializableMapHolder<String, PortletSession> portletSessions;\n            synchronized (WebUtils.getSessionMutex(portalSession)) {\n                portletSessions =\n                        (NonSerializableMapHolder<String, PortletSession>)\n                                portalSession.getAttribute(PORTLET_SESSIONS_MAP);\n                if (portletSessions == null || !portletSessions.isValid()) {\n                    portletSessions =\n                            new NonSerializableMapHolder(\n                                    new ConcurrentHashMap<String, PortletSession>());\n                    portalSession.setAttribute(PORTLET_SESSIONS_MAP, portletSessions);\n                }\n            }\n\n            final String contextPath = portletRequest.getContextPath();\n            portletSessions.put(contextPath, portletSession);\n        }\n    }", "code_tokens": ["@", "SuppressWarnings", "(", "\"unchecked\"", ")", "@", "Override", "public", "void", "onEnd", "(", "PortletInvocationEvent", "event", ")", "{", "final", "PortletRequest", "portletRequest", "=", "event", ".", "getPortletRequest", "(", ")", ";", "final", "PortletSession", "portletSession", "=", "portletRequest", ".", "getPortletSession", "(", "false", ")", ";", "if", "(", "portletSession", "==", "null", ")", "{", "return", ";", "}", "final", "HttpServletRequest", "portalRequest", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "portletRequest", ")", ";", "final", "HttpSession", "portalSession", "=", "portalRequest", ".", "getSession", "(", ")", ";", "if", "(", "portalSession", "!=", "null", ")", "{", "NonSerializableMapHolder", "<", "String", ",", "PortletSession", ">", "portletSessions", ";", "synchronized", "(", "WebUtils", ".", "getSessionMutex", "(", "portalSession", ")", ")", "{", "portletSessions", "=", "(", "NonSerializableMapHolder", "<", "String", ",", "PortletSession", ">", ")", "portalSession", ".", "getAttribute", "(", "PORTLET_SESSIONS_MAP", ")", ";", "if", "(", "portletSessions", "==", "null", "||", "!", "portletSessions", ".", "isValid", "(", ")", ")", "{", "portletSessions", "=", "new", "NonSerializableMapHolder", "(", "new", "ConcurrentHashMap", "<", "String", ",", "PortletSession", ">", "(", ")", ")", ";", "portalSession", ".", "setAttribute", "(", "PORTLET_SESSIONS_MAP", ",", "portletSessions", ")", ";", "}", "}", "final", "String", "contextPath", "=", "portletRequest", ".", "getContextPath", "(", ")", ";", "portletSessions", ".", "put", "(", "contextPath", ",", "portletSession", ")", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.apache.pluto.spi.optional.PortletInvocationListener#onEnd(org.apache.pluto.spi.optional.PortletInvocationEvent)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/session/PortletSessionExpirationManager.java#L71-L101", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/session/PortletSessionExpirationManager.java", "func_name": "PortletSessionExpirationManager.onApplicationEvent", "original_string": "@Override\n    public void onApplicationEvent(HttpSessionDestroyedEvent event) {\n        final HttpSession session = ((HttpSessionDestroyedEvent) event).getSession();\n        @SuppressWarnings(\"unchecked\")\n        final Map<String, PortletSession> portletSessions =\n                (Map<String, PortletSession>) session.getAttribute(PORTLET_SESSIONS_MAP);\n        if (portletSessions == null) {\n            return;\n        }\n\n        /*\n         * Since (at least) Tomcat 7.0.47, this method has the potential to\n         * generate a StackOverflowError because PortletSession.invalidate()\n         * will trigger another HttpSessionDestroyedEvent, which means this\n         * method will be called again.  I don't know if this behavior is a bug\n         * in Tomcat or Spring, if this behavior is entirely proper, or if the\n         * reality somewhere in between.\n         *\n         * For the present, let's put a token in the HttpSession (which is\n         * available from the event object) as soon as we start invalidating it.\n         * We'll then ignore sessions that already have this token.\n         */\n        if (session.getAttribute(ALREADY_INVALIDATING_SESSION_ATTRIBUTE) != null) {\n            // We're already invalidating;  don't do it again\n            return;\n        }\n        session.setAttribute(ALREADY_INVALIDATING_SESSION_ATTRIBUTE, Boolean.TRUE);\n\n        for (final Map.Entry<String, PortletSession> portletSessionEntry :\n                portletSessions.entrySet()) {\n            final String contextPath = portletSessionEntry.getKey();\n            final PortletSession portletSession = portletSessionEntry.getValue();\n            try {\n                portletSession.invalidate();\n            } catch (IllegalStateException e) {\n                this.logger.info(\n                        \"PortletSession with id '\"\n                                + portletSession.getId()\n                                + \"' for context '\"\n                                + contextPath\n                                + \"' has already been invalidated.\");\n            } catch (Exception e) {\n                this.logger.warn(\n                        \"Failed to invalidate PortletSession with id '\"\n                                + portletSession.getId()\n                                + \"' for context '\"\n                                + contextPath\n                                + \"'\",\n                        e);\n            }\n        }\n    }", "language": "java", "code": "@Override\n    public void onApplicationEvent(HttpSessionDestroyedEvent event) {\n        final HttpSession session = ((HttpSessionDestroyedEvent) event).getSession();\n        @SuppressWarnings(\"unchecked\")\n        final Map<String, PortletSession> portletSessions =\n                (Map<String, PortletSession>) session.getAttribute(PORTLET_SESSIONS_MAP);\n        if (portletSessions == null) {\n            return;\n        }\n\n        /*\n         * Since (at least) Tomcat 7.0.47, this method has the potential to\n         * generate a StackOverflowError because PortletSession.invalidate()\n         * will trigger another HttpSessionDestroyedEvent, which means this\n         * method will be called again.  I don't know if this behavior is a bug\n         * in Tomcat or Spring, if this behavior is entirely proper, or if the\n         * reality somewhere in between.\n         *\n         * For the present, let's put a token in the HttpSession (which is\n         * available from the event object) as soon as we start invalidating it.\n         * We'll then ignore sessions that already have this token.\n         */\n        if (session.getAttribute(ALREADY_INVALIDATING_SESSION_ATTRIBUTE) != null) {\n            // We're already invalidating;  don't do it again\n            return;\n        }\n        session.setAttribute(ALREADY_INVALIDATING_SESSION_ATTRIBUTE, Boolean.TRUE);\n\n        for (final Map.Entry<String, PortletSession> portletSessionEntry :\n                portletSessions.entrySet()) {\n            final String contextPath = portletSessionEntry.getKey();\n            final PortletSession portletSession = portletSessionEntry.getValue();\n            try {\n                portletSession.invalidate();\n            } catch (IllegalStateException e) {\n                this.logger.info(\n                        \"PortletSession with id '\"\n                                + portletSession.getId()\n                                + \"' for context '\"\n                                + contextPath\n                                + \"' has already been invalidated.\");\n            } catch (Exception e) {\n                this.logger.warn(\n                        \"Failed to invalidate PortletSession with id '\"\n                                + portletSession.getId()\n                                + \"' for context '\"\n                                + contextPath\n                                + \"'\",\n                        e);\n            }\n        }\n    }", "code_tokens": ["@", "Override", "public", "void", "onApplicationEvent", "(", "HttpSessionDestroyedEvent", "event", ")", "{", "final", "HttpSession", "session", "=", "(", "(", "HttpSessionDestroyedEvent", ")", "event", ")", ".", "getSession", "(", ")", ";", "@", "SuppressWarnings", "(", "\"unchecked\"", ")", "final", "Map", "<", "String", ",", "PortletSession", ">", "portletSessions", "=", "(", "Map", "<", "String", ",", "PortletSession", ">", ")", "session", ".", "getAttribute", "(", "PORTLET_SESSIONS_MAP", ")", ";", "if", "(", "portletSessions", "==", "null", ")", "{", "return", ";", "}", "/*\n         * Since (at least) Tomcat 7.0.47, this method has the potential to\n         * generate a StackOverflowError because PortletSession.invalidate()\n         * will trigger another HttpSessionDestroyedEvent, which means this\n         * method will be called again.  I don't know if this behavior is a bug\n         * in Tomcat or Spring, if this behavior is entirely proper, or if the\n         * reality somewhere in between.\n         *\n         * For the present, let's put a token in the HttpSession (which is\n         * available from the event object) as soon as we start invalidating it.\n         * We'll then ignore sessions that already have this token.\n         */", "if", "(", "session", ".", "getAttribute", "(", "ALREADY_INVALIDATING_SESSION_ATTRIBUTE", ")", "!=", "null", ")", "{", "// We're already invalidating;  don't do it again", "return", ";", "}", "session", ".", "setAttribute", "(", "ALREADY_INVALIDATING_SESSION_ATTRIBUTE", ",", "Boolean", ".", "TRUE", ")", ";", "for", "(", "final", "Map", ".", "Entry", "<", "String", ",", "PortletSession", ">", "portletSessionEntry", ":", "portletSessions", ".", "entrySet", "(", ")", ")", "{", "final", "String", "contextPath", "=", "portletSessionEntry", ".", "getKey", "(", ")", ";", "final", "PortletSession", "portletSession", "=", "portletSessionEntry", ".", "getValue", "(", ")", ";", "try", "{", "portletSession", ".", "invalidate", "(", ")", ";", "}", "catch", "(", "IllegalStateException", "e", ")", "{", "this", ".", "logger", ".", "info", "(", "\"PortletSession with id '\"", "+", "portletSession", ".", "getId", "(", ")", "+", "\"' for context '\"", "+", "contextPath", "+", "\"' has already been invalidated.\"", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"Failed to invalidate PortletSession with id '\"", "+", "portletSession", ".", "getId", "(", ")", "+", "\"' for context '\"", "+", "contextPath", "+", "\"'\"", ",", "e", ")", ";", "}", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.springframework.context.ApplicationListener#onApplicationEvent(org.springframework.context.ApplicationEvent)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/session/PortletSessionExpirationManager.java#L106-L157", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java", "func_name": "PortletDefinitionRegistryImpl.getPortletDefinition", "original_string": "@Override\n    public IPortletDefinition getPortletDefinition(IPortletDefinitionId portletDefinitionId) {\n        Validate.notNull(portletDefinitionId, \"portletDefinitionId can not be null\");\n\n        return this.portletDefinitionDao.getPortletDefinition(portletDefinitionId);\n    }", "language": "java", "code": "@Override\n    public IPortletDefinition getPortletDefinition(IPortletDefinitionId portletDefinitionId) {\n        Validate.notNull(portletDefinitionId, \"portletDefinitionId can not be null\");\n\n        return this.portletDefinitionDao.getPortletDefinition(portletDefinitionId);\n    }", "code_tokens": ["@", "Override", "public", "IPortletDefinition", "getPortletDefinition", "(", "IPortletDefinitionId", "portletDefinitionId", ")", "{", "Validate", ".", "notNull", "(", "portletDefinitionId", ",", "\"portletDefinitionId can not be null\"", ")", ";", "return", "this", ".", "portletDefinitionDao", ".", "getPortletDefinition", "(", "portletDefinitionId", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.portlet.registry.IPortletDefinitionRegistry#getPortletDefinition(org.apereo.portal.portlet.om.IPortletDefinitionId)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java#L80-L85", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java", "func_name": "PortletDefinitionRegistryImpl.savePortletDefinition", "original_string": "@Override\n    public IPortletDefinition savePortletDefinition(IPortletDefinition portletDefinition) {\n        Validate.notNull(portletDefinition, \"portletDefinition can not be null\");\n        return this.portletDefinitionDao.savePortletDefinition(portletDefinition);\n    }", "language": "java", "code": "@Override\n    public IPortletDefinition savePortletDefinition(IPortletDefinition portletDefinition) {\n        Validate.notNull(portletDefinition, \"portletDefinition can not be null\");\n        return this.portletDefinitionDao.savePortletDefinition(portletDefinition);\n    }", "code_tokens": ["@", "Override", "public", "IPortletDefinition", "savePortletDefinition", "(", "IPortletDefinition", "portletDefinition", ")", "{", "Validate", ".", "notNull", "(", "portletDefinition", ",", "\"portletDefinition can not be null\"", ")", ";", "return", "this", ".", "portletDefinitionDao", ".", "savePortletDefinition", "(", "portletDefinition", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.portlet.registry.IPortletDefinitionRegistry#savePortletDefinition(org.apereo.portal.portlet.om.IPortletDefinition)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java#L122-L126", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java", "func_name": "PortletDefinitionRegistryImpl.getParentPortletApplicationDescriptor", "original_string": "@Override\n    public PortletApplicationDefinition getParentPortletApplicationDescriptor(\n            IPortletDefinitionId portletDefinitionId) {\n        final IPortletDefinition portletDefinition = this.getPortletDefinition(portletDefinitionId);\n        if (portletDefinition == null) {\n            return null;\n        }\n\n        final Tuple<String, String> portletDescriptorKeys =\n                this.getPortletDescriptorKeys(portletDefinition);\n\n        final PortletRegistryService portletRegistryService =\n                this.portalDriverContainerServices.getPortletRegistryService();\n        try {\n            return portletRegistryService.getPortletApplication(portletDescriptorKeys.first);\n        } catch (PortletContainerException e) {\n            this.logger.warn(\n                    \"No portlet application descriptor could be found likely not deployed. For portlet definition: \"\n                            + portletDefinition,\n                    e);\n            return null;\n        }\n    }", "language": "java", "code": "@Override\n    public PortletApplicationDefinition getParentPortletApplicationDescriptor(\n            IPortletDefinitionId portletDefinitionId) {\n        final IPortletDefinition portletDefinition = this.getPortletDefinition(portletDefinitionId);\n        if (portletDefinition == null) {\n            return null;\n        }\n\n        final Tuple<String, String> portletDescriptorKeys =\n                this.getPortletDescriptorKeys(portletDefinition);\n\n        final PortletRegistryService portletRegistryService =\n                this.portalDriverContainerServices.getPortletRegistryService();\n        try {\n            return portletRegistryService.getPortletApplication(portletDescriptorKeys.first);\n        } catch (PortletContainerException e) {\n            this.logger.warn(\n                    \"No portlet application descriptor could be found likely not deployed. For portlet definition: \"\n                            + portletDefinition,\n                    e);\n            return null;\n        }\n    }", "code_tokens": ["@", "Override", "public", "PortletApplicationDefinition", "getParentPortletApplicationDescriptor", "(", "IPortletDefinitionId", "portletDefinitionId", ")", "{", "final", "IPortletDefinition", "portletDefinition", "=", "this", ".", "getPortletDefinition", "(", "portletDefinitionId", ")", ";", "if", "(", "portletDefinition", "==", "null", ")", "{", "return", "null", ";", "}", "final", "Tuple", "<", "String", ",", "String", ">", "portletDescriptorKeys", "=", "this", ".", "getPortletDescriptorKeys", "(", "portletDefinition", ")", ";", "final", "PortletRegistryService", "portletRegistryService", "=", "this", ".", "portalDriverContainerServices", ".", "getPortletRegistryService", "(", ")", ";", "try", "{", "return", "portletRegistryService", ".", "getPortletApplication", "(", "portletDescriptorKeys", ".", "first", ")", ";", "}", "catch", "(", "PortletContainerException", "e", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"No portlet application descriptor could be found likely not deployed. For portlet definition: \"", "+", "portletDefinition", ",", "e", ")", ";", "return", "null", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.portlet.registry.IPortletDefinitionRegistry#getParentPortletApplicationDescriptor(org.apereo.portal.portlet.om.IPortletDefinitionId)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java#L131-L153", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java", "func_name": "PortletDefinitionRegistryImpl.getParentPortletDescriptor", "original_string": "@Override\n    public PortletDefinition getParentPortletDescriptor(IPortletDefinitionId portletDefinitionId) {\n        final IPortletDefinition portletDefinition = this.getPortletDefinition(portletDefinitionId);\n        if (portletDefinition == null) {\n            return null;\n        }\n\n        final Tuple<String, String> portletDescriptorKeys =\n                this.getPortletDescriptorKeys(portletDefinition);\n\n        final PortletRegistryService portletRegistryService =\n                this.portalDriverContainerServices.getPortletRegistryService();\n        try {\n            return portletRegistryService.getPortlet(\n                    portletDescriptorKeys.first, portletDescriptorKeys.second);\n        } catch (PortletContainerException e) {\n            if (this.logger.isDebugEnabled()) {\n                this.logger.warn(\n                        \"No portlet descriptor could be found for the portlet definition, null will be returned: \"\n                                + portletDefinition,\n                        e);\n            } else {\n                this.logger.warn(\n                        \"No portlet descriptor could be found for the portlet definition, null will be returned: \"\n                                + portletDefinition\n                                + \" Enable DEBUG for stack trace.\");\n            }\n            return null;\n        }\n    }", "language": "java", "code": "@Override\n    public PortletDefinition getParentPortletDescriptor(IPortletDefinitionId portletDefinitionId) {\n        final IPortletDefinition portletDefinition = this.getPortletDefinition(portletDefinitionId);\n        if (portletDefinition == null) {\n            return null;\n        }\n\n        final Tuple<String, String> portletDescriptorKeys =\n                this.getPortletDescriptorKeys(portletDefinition);\n\n        final PortletRegistryService portletRegistryService =\n                this.portalDriverContainerServices.getPortletRegistryService();\n        try {\n            return portletRegistryService.getPortlet(\n                    portletDescriptorKeys.first, portletDescriptorKeys.second);\n        } catch (PortletContainerException e) {\n            if (this.logger.isDebugEnabled()) {\n                this.logger.warn(\n                        \"No portlet descriptor could be found for the portlet definition, null will be returned: \"\n                                + portletDefinition,\n                        e);\n            } else {\n                this.logger.warn(\n                        \"No portlet descriptor could be found for the portlet definition, null will be returned: \"\n                                + portletDefinition\n                                + \" Enable DEBUG for stack trace.\");\n            }\n            return null;\n        }\n    }", "code_tokens": ["@", "Override", "public", "PortletDefinition", "getParentPortletDescriptor", "(", "IPortletDefinitionId", "portletDefinitionId", ")", "{", "final", "IPortletDefinition", "portletDefinition", "=", "this", ".", "getPortletDefinition", "(", "portletDefinitionId", ")", ";", "if", "(", "portletDefinition", "==", "null", ")", "{", "return", "null", ";", "}", "final", "Tuple", "<", "String", ",", "String", ">", "portletDescriptorKeys", "=", "this", ".", "getPortletDescriptorKeys", "(", "portletDefinition", ")", ";", "final", "PortletRegistryService", "portletRegistryService", "=", "this", ".", "portalDriverContainerServices", ".", "getPortletRegistryService", "(", ")", ";", "try", "{", "return", "portletRegistryService", ".", "getPortlet", "(", "portletDescriptorKeys", ".", "first", ",", "portletDescriptorKeys", ".", "second", ")", ";", "}", "catch", "(", "PortletContainerException", "e", ")", "{", "if", "(", "this", ".", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"No portlet descriptor could be found for the portlet definition, null will be returned: \"", "+", "portletDefinition", ",", "e", ")", ";", "}", "else", "{", "this", ".", "logger", ".", "warn", "(", "\"No portlet descriptor could be found for the portlet definition, null will be returned: \"", "+", "portletDefinition", "+", "\" Enable DEBUG for stack trace.\"", ")", ";", "}", "return", "null", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.portlet.registry.IPortletDefinitionRegistry#getParentPortletDescriptor(org.apereo.portal.portlet.om.IPortletDefinitionId)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java#L158-L187", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java", "func_name": "PortletDefinitionRegistryImpl.getPortletDescriptorKeys", "original_string": "@Override\n    public Tuple<String, String> getPortletDescriptorKeys(IPortletDefinition portletDefinition) {\n\n        final String portletApplicationId;\n        if (portletDefinition.getPortletDescriptorKey().isFrameworkPortlet()) {\n            portletApplicationId = this.servletContext.getContextPath();\n        } else {\n            portletApplicationId = portletDefinition.getPortletDescriptorKey().getWebAppName();\n        }\n\n        final String portletName = portletDefinition.getPortletDescriptorKey().getPortletName();\n\n        return new Tuple<String, String>(portletApplicationId, portletName);\n    }", "language": "java", "code": "@Override\n    public Tuple<String, String> getPortletDescriptorKeys(IPortletDefinition portletDefinition) {\n\n        final String portletApplicationId;\n        if (portletDefinition.getPortletDescriptorKey().isFrameworkPortlet()) {\n            portletApplicationId = this.servletContext.getContextPath();\n        } else {\n            portletApplicationId = portletDefinition.getPortletDescriptorKey().getWebAppName();\n        }\n\n        final String portletName = portletDefinition.getPortletDescriptorKey().getPortletName();\n\n        return new Tuple<String, String>(portletApplicationId, portletName);\n    }", "code_tokens": ["@", "Override", "public", "Tuple", "<", "String", ",", "String", ">", "getPortletDescriptorKeys", "(", "IPortletDefinition", "portletDefinition", ")", "{", "final", "String", "portletApplicationId", ";", "if", "(", "portletDefinition", ".", "getPortletDescriptorKey", "(", ")", ".", "isFrameworkPortlet", "(", ")", ")", "{", "portletApplicationId", "=", "this", ".", "servletContext", ".", "getContextPath", "(", ")", ";", "}", "else", "{", "portletApplicationId", "=", "portletDefinition", ".", "getPortletDescriptorKey", "(", ")", ".", "getWebAppName", "(", ")", ";", "}", "final", "String", "portletName", "=", "portletDefinition", ".", "getPortletDescriptorKey", "(", ")", ".", "getPortletName", "(", ")", ";", "return", "new", "Tuple", "<", "String", ",", "String", ">", "(", "portletApplicationId", ",", "portletName", ")", ";", "}"], "docstring": "Get the portletApplicationId and portletName for the specified channel definition id. The\nportletApplicationId will be {@link Tuple#first} and the portletName will be {@link\nTuple#second}", "docstring_tokens": ["Get", "the", "portletApplicationId", "and", "portletName", "for", "the", "specified", "channel", "definition", "id", ".", "The", "portletApplicationId", "will", "be", "{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java#L194-L207", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/services/PersonDirectoryUserInfoService.java", "func_name": "PersonDirectoryUserInfoService.getUserInfo", "original_string": "@Override\n    public Map<String, String> getUserInfo(PortletRequest request, PortletWindow plutoPortletWindow)\n            throws PortletContainerException {\n        // Get the remote user\n        final String remoteUser = request.getRemoteUser();\n        if (remoteUser == null) {\n            return null;\n        }\n\n        final HttpServletRequest httpServletRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPortletWindow portletWindow =\n                this.portletWindowRegistry.convertPortletWindow(\n                        httpServletRequest, plutoPortletWindow);\n\n        return this.getUserInfo(remoteUser, httpServletRequest, portletWindow);\n    }", "language": "java", "code": "@Override\n    public Map<String, String> getUserInfo(PortletRequest request, PortletWindow plutoPortletWindow)\n            throws PortletContainerException {\n        // Get the remote user\n        final String remoteUser = request.getRemoteUser();\n        if (remoteUser == null) {\n            return null;\n        }\n\n        final HttpServletRequest httpServletRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPortletWindow portletWindow =\n                this.portletWindowRegistry.convertPortletWindow(\n                        httpServletRequest, plutoPortletWindow);\n\n        return this.getUserInfo(remoteUser, httpServletRequest, portletWindow);\n    }", "code_tokens": ["@", "Override", "public", "Map", "<", "String", ",", "String", ">", "getUserInfo", "(", "PortletRequest", "request", ",", "PortletWindow", "plutoPortletWindow", ")", "throws", "PortletContainerException", "{", "// Get the remote user", "final", "String", "remoteUser", "=", "request", ".", "getRemoteUser", "(", ")", ";", "if", "(", "remoteUser", "==", "null", ")", "{", "return", "null", ";", "}", "final", "HttpServletRequest", "httpServletRequest", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "request", ")", ";", "final", "IPortletWindow", "portletWindow", "=", "this", ".", "portletWindowRegistry", ".", "convertPortletWindow", "(", "httpServletRequest", ",", "plutoPortletWindow", ")", ";", "return", "this", ".", "getUserInfo", "(", "remoteUser", ",", "httpServletRequest", ",", "portletWindow", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apache.pluto.spi.optional.UserInfoService#getUserInfo(javax.portlet.PortletRequest, org.apache.pluto.PortletWindow)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/services/PersonDirectoryUserInfoService.java#L95-L111", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/services/PersonDirectoryUserInfoService.java", "func_name": "PersonDirectoryUserInfoService.getUserInfo", "original_string": "protected Map<String, String> getUserInfo(\n            String remoteUser, HttpServletRequest httpServletRequest, IPortletWindow portletWindow)\n            throws PortletContainerException {\n        // Get the list of user attributes the portal knows about the user\n        final IPersonAttributes personAttributes = this.personAttributeDao.getPerson(remoteUser);\n        if (personAttributes == null) {\n            return Collections.emptyMap();\n        }\n        final List<? extends UserAttribute> expectedUserAttributes =\n                this.getExpectedUserAttributes(httpServletRequest, portletWindow);\n\n        final Map<String, String> portletUserAttributes =\n                this.generateUserInfo(personAttributes, expectedUserAttributes, httpServletRequest);\n        return portletUserAttributes;\n    }", "language": "java", "code": "protected Map<String, String> getUserInfo(\n            String remoteUser, HttpServletRequest httpServletRequest, IPortletWindow portletWindow)\n            throws PortletContainerException {\n        // Get the list of user attributes the portal knows about the user\n        final IPersonAttributes personAttributes = this.personAttributeDao.getPerson(remoteUser);\n        if (personAttributes == null) {\n            return Collections.emptyMap();\n        }\n        final List<? extends UserAttribute> expectedUserAttributes =\n                this.getExpectedUserAttributes(httpServletRequest, portletWindow);\n\n        final Map<String, String> portletUserAttributes =\n                this.generateUserInfo(personAttributes, expectedUserAttributes, httpServletRequest);\n        return portletUserAttributes;\n    }", "code_tokens": ["protected", "Map", "<", "String", ",", "String", ">", "getUserInfo", "(", "String", "remoteUser", ",", "HttpServletRequest", "httpServletRequest", ",", "IPortletWindow", "portletWindow", ")", "throws", "PortletContainerException", "{", "// Get the list of user attributes the portal knows about the user", "final", "IPersonAttributes", "personAttributes", "=", "this", ".", "personAttributeDao", ".", "getPerson", "(", "remoteUser", ")", ";", "if", "(", "personAttributes", "==", "null", ")", "{", "return", "Collections", ".", "emptyMap", "(", ")", ";", "}", "final", "List", "<", "?", "extends", "UserAttribute", ">", "expectedUserAttributes", "=", "this", ".", "getExpectedUserAttributes", "(", "httpServletRequest", ",", "portletWindow", ")", ";", "final", "Map", "<", "String", ",", "String", ">", "portletUserAttributes", "=", "this", ".", "generateUserInfo", "(", "personAttributes", ",", "expectedUserAttributes", ",", "httpServletRequest", ")", ";", "return", "portletUserAttributes", ";", "}"], "docstring": "Commons logic to get a subset of the user's attributes for the specified portlet window.\n\n@param remoteUser The user to get attributes for.\n@param httpServletRequest The current, underlying httpServletRequest\n@param portletWindow The window to filter attributes for\n@return A Map of user attributes for the user and windows\n@throws PortletContainerException", "docstring_tokens": ["Commons", "logic", "to", "get", "a", "subset", "of", "the", "user", "s", "attributes", "for", "the", "specified", "portlet", "window", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/services/PersonDirectoryUserInfoService.java#L122-L136", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/services/PersonDirectoryUserInfoService.java", "func_name": "PersonDirectoryUserInfoService.generateUserInfo", "original_string": "protected Map<String, String> generateUserInfo(\n            final IPersonAttributes personAttributes,\n            final List<? extends UserAttribute> expectedUserAttributes,\n            HttpServletRequest httpServletRequest) {\n        final Map<String, String> portletUserAttributes =\n                new HashMap<String, String>(expectedUserAttributes.size());\n\n        // Copy expected attributes to the USER_INFO Map\n        final Map<String, List<Object>> attributes = personAttributes.getAttributes();\n        for (final UserAttribute userAttributeDD : expectedUserAttributes) {\n            final String attributeName = userAttributeDD.getName();\n\n            // TODO a personAttributes.hasAttribute(String) API is needed here, if hasAttribute and\n            // null then put the key with no value in the returned map\n            if (attributes.containsKey(attributeName)) {\n                final Object valueObj = personAttributes.getAttributeValue(attributeName);\n                final String value = valueObj == null ? null : String.valueOf(valueObj);\n                portletUserAttributes.put(attributeName, value);\n            }\n        }\n\n        return portletUserAttributes;\n    }", "language": "java", "code": "protected Map<String, String> generateUserInfo(\n            final IPersonAttributes personAttributes,\n            final List<? extends UserAttribute> expectedUserAttributes,\n            HttpServletRequest httpServletRequest) {\n        final Map<String, String> portletUserAttributes =\n                new HashMap<String, String>(expectedUserAttributes.size());\n\n        // Copy expected attributes to the USER_INFO Map\n        final Map<String, List<Object>> attributes = personAttributes.getAttributes();\n        for (final UserAttribute userAttributeDD : expectedUserAttributes) {\n            final String attributeName = userAttributeDD.getName();\n\n            // TODO a personAttributes.hasAttribute(String) API is needed here, if hasAttribute and\n            // null then put the key with no value in the returned map\n            if (attributes.containsKey(attributeName)) {\n                final Object valueObj = personAttributes.getAttributeValue(attributeName);\n                final String value = valueObj == null ? null : String.valueOf(valueObj);\n                portletUserAttributes.put(attributeName, value);\n            }\n        }\n\n        return portletUserAttributes;\n    }", "code_tokens": ["protected", "Map", "<", "String", ",", "String", ">", "generateUserInfo", "(", "final", "IPersonAttributes", "personAttributes", ",", "final", "List", "<", "?", "extends", "UserAttribute", ">", "expectedUserAttributes", ",", "HttpServletRequest", "httpServletRequest", ")", "{", "final", "Map", "<", "String", ",", "String", ">", "portletUserAttributes", "=", "new", "HashMap", "<", "String", ",", "String", ">", "(", "expectedUserAttributes", ".", "size", "(", ")", ")", ";", "// Copy expected attributes to the USER_INFO Map", "final", "Map", "<", "String", ",", "List", "<", "Object", ">", ">", "attributes", "=", "personAttributes", ".", "getAttributes", "(", ")", ";", "for", "(", "final", "UserAttribute", "userAttributeDD", ":", "expectedUserAttributes", ")", "{", "final", "String", "attributeName", "=", "userAttributeDD", ".", "getName", "(", ")", ";", "// TODO a personAttributes.hasAttribute(String) API is needed here, if hasAttribute and", "// null then put the key with no value in the returned map", "if", "(", "attributes", ".", "containsKey", "(", "attributeName", ")", ")", "{", "final", "Object", "valueObj", "=", "personAttributes", ".", "getAttributeValue", "(", "attributeName", ")", ";", "final", "String", "value", "=", "valueObj", "==", "null", "?", "null", ":", "String", ".", "valueOf", "(", "valueObj", ")", ";", "portletUserAttributes", ".", "put", "(", "attributeName", ",", "value", ")", ";", "}", "}", "return", "portletUserAttributes", ";", "}"], "docstring": "Using the Map of portal user attributes and a List of expected attributes generate the\nUSER_INFO map for the portlet\n\n@param portalUserAttributes All the attributes the portal knows about the user\n@param expectedUserAttributes The attributes the portlet expects to get\n@return The Map to use for the USER_INFO attribute", "docstring_tokens": ["Using", "the", "Map", "of", "portal", "user", "attributes", "and", "a", "List", "of", "expected", "attributes", "generate", "the", "USER_INFO", "map", "for", "the", "portlet"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/services/PersonDirectoryUserInfoService.java#L146-L168", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/TransformerConfigurationSourceAdapter.java", "func_name": "TransformerConfigurationSourceAdapter.getParameters", "original_string": "@Override\n    public Map<String, Object> getParameters(\n            HttpServletRequest request, HttpServletResponse response) {\n        return null;\n    }", "language": "java", "code": "@Override\n    public Map<String, Object> getParameters(\n            HttpServletRequest request, HttpServletResponse response) {\n        return null;\n    }", "code_tokens": ["@", "Override", "public", "Map", "<", "String", ",", "Object", ">", "getParameters", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "return", "null", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.xslt.TransformerConfigurationSource#getParameters(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/TransformerConfigurationSourceAdapter.java#L32-L36", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/AbstractBeanLocator.java", "func_name": "AbstractBeanLocator.afterPropertiesSet", "original_string": "@Override\n    public final void afterPropertiesSet() throws Exception {\n        if (this.getLocator() != null) {\n            this.logger.warn(\n                    \"Static \"\n                            + this.getClass().getName()\n                            + \" reference has already been set and setInstance is being called\");\n        }\n        this.setLocator(this);\n    }", "language": "java", "code": "@Override\n    public final void afterPropertiesSet() throws Exception {\n        if (this.getLocator() != null) {\n            this.logger.warn(\n                    \"Static \"\n                            + this.getClass().getName()\n                            + \" reference has already been set and setInstance is being called\");\n        }\n        this.setLocator(this);\n    }", "code_tokens": ["@", "Override", "public", "final", "void", "afterPropertiesSet", "(", ")", "throws", "Exception", "{", "if", "(", "this", ".", "getLocator", "(", ")", "!=", "null", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"Static \"", "+", "this", ".", "getClass", "(", ")", ".", "getName", "(", ")", "+", "\" reference has already been set and setInstance is being called\"", ")", ";", "}", "this", ".", "setLocator", "(", "this", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.springframework.beans.factory.InitializingBean#afterPropertiesSet()", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/AbstractBeanLocator.java#L52-L61", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-mvc/src/main/java/org/apereo/portal/security/mvc/LoginController.java", "func_name": "LoginController.service", "original_string": "@RequestMapping\n    public void service(HttpServletRequest request, HttpServletResponse response)\n            throws ServletException, IOException {\n        response.setHeader(\"Pragma\", \"no-cache\");\n        response.setHeader(\"Cache-Control\", \"no-cache\");\n        response.setDateHeader(\"Expires\", 0);\n\n        // create the redirect URL, adding fname and args parameters if necessary\n        String redirectTarget = null;\n\n        final String refUrl = request.getParameter(REFERER_URL_PARAM);\n        final URL redirectLocation = parseLocalRefUrl(request, refUrl);\n        if (redirectLocation != null) {\n            redirectTarget = redirectLocation.toString();\n        }\n\n        if (redirectTarget == null) {\n            /* Grab the target functional name, if any, off the login request.\n             * Also any arguments for the target. We will pass them  along after authentication.\n             */\n            String targetFname = request.getParameter(\"uP_fname\");\n\n            if (targetFname == null) {\n                final IPortalUrlBuilder defaultUrl = this.portalUrlProvider.getDefaultUrl(request);\n                redirectTarget = defaultUrl.getUrlString();\n            } else {\n                try {\n                    final IPortalUrlBuilder urlBuilder =\n                            this.portalUrlProvider.getPortalUrlBuilderByPortletFName(\n                                    request, targetFname, UrlType.RENDER);\n\n                    Enumeration<String> e = request.getParameterNames();\n                    while (e.hasMoreElements()) {\n                        String paramName = e.nextElement();\n                        if (!paramName.equals(\"uP_fname\")) {\n                            urlBuilder.addParameter(\n                                    paramName, request.getParameterValues(paramName));\n                        }\n                    }\n\n                    redirectTarget = urlBuilder.getUrlString();\n                } catch (IllegalArgumentException e) {\n                    final IPortalUrlBuilder defaultUrl =\n                            this.portalUrlProvider.getDefaultUrl(request);\n                    redirectTarget = defaultUrl.getUrlString();\n                }\n            }\n        }\n\n        IPerson person = null;\n\n        final Object authError =\n                request.getSession(false).getAttribute(LoginController.AUTH_ERROR_KEY);\n        if (authError == null || !((Boolean) authError)) {\n            person = this.personManager.getPerson(request);\n        }\n\n        if (person == null || !person.getSecurityContext().isAuthenticated()) {\n            if (request.getMethod().equals(\"POST\"))\n                request.getSession(false).setAttribute(AUTH_ATTEMPTED_KEY, \"true\");\n            // Preserve the attempted username so it can be redisplayed to the user\n            String attemptedUserName = request.getParameter(\"userName\");\n            if (attemptedUserName != null)\n                request.getSession(false)\n                        .setAttribute(ATTEMPTED_USERNAME_KEY, request.getParameter(\"userName\"));\n        }\n\n        final String encodedRedirectURL = response.encodeRedirectURL(redirectTarget);\n\n        if (log.isDebugEnabled()) {\n            log.debug(\"Redirecting to \" + redirectTarget);\n        }\n\n        response.sendRedirect(encodedRedirectURL);\n    }", "language": "java", "code": "@RequestMapping\n    public void service(HttpServletRequest request, HttpServletResponse response)\n            throws ServletException, IOException {\n        response.setHeader(\"Pragma\", \"no-cache\");\n        response.setHeader(\"Cache-Control\", \"no-cache\");\n        response.setDateHeader(\"Expires\", 0);\n\n        // create the redirect URL, adding fname and args parameters if necessary\n        String redirectTarget = null;\n\n        final String refUrl = request.getParameter(REFERER_URL_PARAM);\n        final URL redirectLocation = parseLocalRefUrl(request, refUrl);\n        if (redirectLocation != null) {\n            redirectTarget = redirectLocation.toString();\n        }\n\n        if (redirectTarget == null) {\n            /* Grab the target functional name, if any, off the login request.\n             * Also any arguments for the target. We will pass them  along after authentication.\n             */\n            String targetFname = request.getParameter(\"uP_fname\");\n\n            if (targetFname == null) {\n                final IPortalUrlBuilder defaultUrl = this.portalUrlProvider.getDefaultUrl(request);\n                redirectTarget = defaultUrl.getUrlString();\n            } else {\n                try {\n                    final IPortalUrlBuilder urlBuilder =\n                            this.portalUrlProvider.getPortalUrlBuilderByPortletFName(\n                                    request, targetFname, UrlType.RENDER);\n\n                    Enumeration<String> e = request.getParameterNames();\n                    while (e.hasMoreElements()) {\n                        String paramName = e.nextElement();\n                        if (!paramName.equals(\"uP_fname\")) {\n                            urlBuilder.addParameter(\n                                    paramName, request.getParameterValues(paramName));\n                        }\n                    }\n\n                    redirectTarget = urlBuilder.getUrlString();\n                } catch (IllegalArgumentException e) {\n                    final IPortalUrlBuilder defaultUrl =\n                            this.portalUrlProvider.getDefaultUrl(request);\n                    redirectTarget = defaultUrl.getUrlString();\n                }\n            }\n        }\n\n        IPerson person = null;\n\n        final Object authError =\n                request.getSession(false).getAttribute(LoginController.AUTH_ERROR_KEY);\n        if (authError == null || !((Boolean) authError)) {\n            person = this.personManager.getPerson(request);\n        }\n\n        if (person == null || !person.getSecurityContext().isAuthenticated()) {\n            if (request.getMethod().equals(\"POST\"))\n                request.getSession(false).setAttribute(AUTH_ATTEMPTED_KEY, \"true\");\n            // Preserve the attempted username so it can be redisplayed to the user\n            String attemptedUserName = request.getParameter(\"userName\");\n            if (attemptedUserName != null)\n                request.getSession(false)\n                        .setAttribute(ATTEMPTED_USERNAME_KEY, request.getParameter(\"userName\"));\n        }\n\n        final String encodedRedirectURL = response.encodeRedirectURL(redirectTarget);\n\n        if (log.isDebugEnabled()) {\n            log.debug(\"Redirecting to \" + redirectTarget);\n        }\n\n        response.sendRedirect(encodedRedirectURL);\n    }", "code_tokens": ["@", "RequestMapping", "public", "void", "service", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "throws", "ServletException", ",", "IOException", "{", "response", ".", "setHeader", "(", "\"Pragma\"", ",", "\"no-cache\"", ")", ";", "response", ".", "setHeader", "(", "\"Cache-Control\"", ",", "\"no-cache\"", ")", ";", "response", ".", "setDateHeader", "(", "\"Expires\"", ",", "0", ")", ";", "// create the redirect URL, adding fname and args parameters if necessary", "String", "redirectTarget", "=", "null", ";", "final", "String", "refUrl", "=", "request", ".", "getParameter", "(", "REFERER_URL_PARAM", ")", ";", "final", "URL", "redirectLocation", "=", "parseLocalRefUrl", "(", "request", ",", "refUrl", ")", ";", "if", "(", "redirectLocation", "!=", "null", ")", "{", "redirectTarget", "=", "redirectLocation", ".", "toString", "(", ")", ";", "}", "if", "(", "redirectTarget", "==", "null", ")", "{", "/* Grab the target functional name, if any, off the login request.\n             * Also any arguments for the target. We will pass them  along after authentication.\n             */", "String", "targetFname", "=", "request", ".", "getParameter", "(", "\"uP_fname\"", ")", ";", "if", "(", "targetFname", "==", "null", ")", "{", "final", "IPortalUrlBuilder", "defaultUrl", "=", "this", ".", "portalUrlProvider", ".", "getDefaultUrl", "(", "request", ")", ";", "redirectTarget", "=", "defaultUrl", ".", "getUrlString", "(", ")", ";", "}", "else", "{", "try", "{", "final", "IPortalUrlBuilder", "urlBuilder", "=", "this", ".", "portalUrlProvider", ".", "getPortalUrlBuilderByPortletFName", "(", "request", ",", "targetFname", ",", "UrlType", ".", "RENDER", ")", ";", "Enumeration", "<", "String", ">", "e", "=", "request", ".", "getParameterNames", "(", ")", ";", "while", "(", "e", ".", "hasMoreElements", "(", ")", ")", "{", "String", "paramName", "=", "e", ".", "nextElement", "(", ")", ";", "if", "(", "!", "paramName", ".", "equals", "(", "\"uP_fname\"", ")", ")", "{", "urlBuilder", ".", "addParameter", "(", "paramName", ",", "request", ".", "getParameterValues", "(", "paramName", ")", ")", ";", "}", "}", "redirectTarget", "=", "urlBuilder", ".", "getUrlString", "(", ")", ";", "}", "catch", "(", "IllegalArgumentException", "e", ")", "{", "final", "IPortalUrlBuilder", "defaultUrl", "=", "this", ".", "portalUrlProvider", ".", "getDefaultUrl", "(", "request", ")", ";", "redirectTarget", "=", "defaultUrl", ".", "getUrlString", "(", ")", ";", "}", "}", "}", "IPerson", "person", "=", "null", ";", "final", "Object", "authError", "=", "request", ".", "getSession", "(", "false", ")", ".", "getAttribute", "(", "LoginController", ".", "AUTH_ERROR_KEY", ")", ";", "if", "(", "authError", "==", "null", "||", "!", "(", "(", "Boolean", ")", "authError", ")", ")", "{", "person", "=", "this", ".", "personManager", ".", "getPerson", "(", "request", ")", ";", "}", "if", "(", "person", "==", "null", "||", "!", "person", ".", "getSecurityContext", "(", ")", ".", "isAuthenticated", "(", ")", ")", "{", "if", "(", "request", ".", "getMethod", "(", ")", ".", "equals", "(", "\"POST\"", ")", ")", "request", ".", "getSession", "(", "false", ")", ".", "setAttribute", "(", "AUTH_ATTEMPTED_KEY", ",", "\"true\"", ")", ";", "// Preserve the attempted username so it can be redisplayed to the user", "String", "attemptedUserName", "=", "request", ".", "getParameter", "(", "\"userName\"", ")", ";", "if", "(", "attemptedUserName", "!=", "null", ")", "request", ".", "getSession", "(", "false", ")", ".", "setAttribute", "(", "ATTEMPTED_USERNAME_KEY", ",", "request", ".", "getParameter", "(", "\"userName\"", ")", ")", ";", "}", "final", "String", "encodedRedirectURL", "=", "response", ".", "encodeRedirectURL", "(", "redirectTarget", ")", ";", "if", "(", "log", ".", "isDebugEnabled", "(", ")", ")", "{", "log", ".", "debug", "(", "\"Redirecting to \"", "+", "redirectTarget", ")", ";", "}", "response", ".", "sendRedirect", "(", "encodedRedirectURL", ")", ";", "}"], "docstring": "Process the incoming HttpServletRequest. Note that this processing occurs after\nPortalPreAuthenticatedProcessingFilter has run and performed pre-processing.\n\n@param request\n@param response\n@exception ServletException\n@exception IOException", "docstring_tokens": ["Process", "the", "incoming", "HttpServletRequest", ".", "Note", "that", "this", "processing", "occurs", "after", "PortalPreAuthenticatedProcessingFilter", "has", "run", "and", "performed", "pre", "-", "processing", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-mvc/src/main/java/org/apereo/portal/security/mvc/LoginController.java#L75-L149", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-mvc/src/main/java/org/apereo/portal/security/mvc/LoginController.java", "func_name": "LoginController.parseLocalRefUrl", "original_string": "URL parseLocalRefUrl(\n            final HttpServletRequest request, final String refUrl) {\n        URL rslt = null; // default\n        if (StringUtils.isNotBlank(refUrl)) {\n            try {\n                final URL context = new URL(request.getRequestURL().toString());\n                final URL location = new URL(context, refUrl);\n\n                if (location.getProtocol().equals(context.getProtocol())\n                        && location.getHost().equals(context.getHost())\n                        && location.getPort() == context.getPort()) {\n                    rslt = location;\n                } else {\n                    log.warn(\"The specified refUrl is not local:  \" + refUrl);\n                }\n            } catch (Exception e) {\n                log.warn(\"Unable to analyze specified refUrl:  \" + refUrl);\n                log.debug(e);\n            }\n        }\n        return rslt;\n    }", "language": "java", "code": "URL parseLocalRefUrl(\n            final HttpServletRequest request, final String refUrl) {\n        URL rslt = null; // default\n        if (StringUtils.isNotBlank(refUrl)) {\n            try {\n                final URL context = new URL(request.getRequestURL().toString());\n                final URL location = new URL(context, refUrl);\n\n                if (location.getProtocol().equals(context.getProtocol())\n                        && location.getHost().equals(context.getHost())\n                        && location.getPort() == context.getPort()) {\n                    rslt = location;\n                } else {\n                    log.warn(\"The specified refUrl is not local:  \" + refUrl);\n                }\n            } catch (Exception e) {\n                log.warn(\"Unable to analyze specified refUrl:  \" + refUrl);\n                log.debug(e);\n            }\n        }\n        return rslt;\n    }", "code_tokens": ["URL", "parseLocalRefUrl", "(", "final", "HttpServletRequest", "request", ",", "final", "String", "refUrl", ")", "{", "URL", "rslt", "=", "null", ";", "// default", "if", "(", "StringUtils", ".", "isNotBlank", "(", "refUrl", ")", ")", "{", "try", "{", "final", "URL", "context", "=", "new", "URL", "(", "request", ".", "getRequestURL", "(", ")", ".", "toString", "(", ")", ")", ";", "final", "URL", "location", "=", "new", "URL", "(", "context", ",", "refUrl", ")", ";", "if", "(", "location", ".", "getProtocol", "(", ")", ".", "equals", "(", "context", ".", "getProtocol", "(", ")", ")", "&&", "location", ".", "getHost", "(", ")", ".", "equals", "(", "context", ".", "getHost", "(", ")", ")", "&&", "location", ".", "getPort", "(", ")", "==", "context", ".", "getPort", "(", ")", ")", "{", "rslt", "=", "location", ";", "}", "else", "{", "log", ".", "warn", "(", "\"The specified refUrl is not local:  \"", "+", "refUrl", ")", ";", "}", "}", "catch", "(", "Exception", "e", ")", "{", "log", ".", "warn", "(", "\"Unable to analyze specified refUrl:  \"", "+", "refUrl", ")", ";", "log", ".", "debug", "(", "e", ")", ";", "}", "}", "return", "rslt", ";", "}"], "docstring": "/* package-private", "docstring_tokens": ["/", "*", "package", "-", "private"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-mvc/src/main/java/org/apereo/portal/security/mvc/LoginController.java#L159-L180", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/LoggingCharacterComponent.java", "func_name": "LoggingCharacterComponent.getEventReader", "original_string": "@Override\n    public PipelineEventReader<CharacterEventReader, CharacterEvent> getEventReader(\n            HttpServletRequest request, HttpServletResponse response) {\n        final PipelineEventReader<CharacterEventReader, CharacterEvent> pipelineEventReader =\n                this.wrappedComponent.getEventReader(request, response);\n\n        final CharacterEventReader eventReader = pipelineEventReader.getEventReader();\n\n        final LoggingCharacterEventReader loggingEventReader =\n                new LoggingCharacterEventReader(eventReader);\n\n        final Map<String, String> outputProperties = pipelineEventReader.getOutputProperties();\n        return new PipelineEventReaderImpl<CharacterEventReader, CharacterEvent>(\n                loggingEventReader, outputProperties);\n    }", "language": "java", "code": "@Override\n    public PipelineEventReader<CharacterEventReader, CharacterEvent> getEventReader(\n            HttpServletRequest request, HttpServletResponse response) {\n        final PipelineEventReader<CharacterEventReader, CharacterEvent> pipelineEventReader =\n                this.wrappedComponent.getEventReader(request, response);\n\n        final CharacterEventReader eventReader = pipelineEventReader.getEventReader();\n\n        final LoggingCharacterEventReader loggingEventReader =\n                new LoggingCharacterEventReader(eventReader);\n\n        final Map<String, String> outputProperties = pipelineEventReader.getOutputProperties();\n        return new PipelineEventReaderImpl<CharacterEventReader, CharacterEvent>(\n                loggingEventReader, outputProperties);\n    }", "code_tokens": ["@", "Override", "public", "PipelineEventReader", "<", "CharacterEventReader", ",", "CharacterEvent", ">", "getEventReader", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "final", "PipelineEventReader", "<", "CharacterEventReader", ",", "CharacterEvent", ">", "pipelineEventReader", "=", "this", ".", "wrappedComponent", ".", "getEventReader", "(", "request", ",", "response", ")", ";", "final", "CharacterEventReader", "eventReader", "=", "pipelineEventReader", ".", "getEventReader", "(", ")", ";", "final", "LoggingCharacterEventReader", "loggingEventReader", "=", "new", "LoggingCharacterEventReader", "(", "eventReader", ")", ";", "final", "Map", "<", "String", ",", "String", ">", "outputProperties", "=", "pipelineEventReader", ".", "getOutputProperties", "(", ")", ";", "return", "new", "PipelineEventReaderImpl", "<", "CharacterEventReader", ",", "CharacterEvent", ">", "(", "loggingEventReader", ",", "outputProperties", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.PipelineComponent#getEventReader(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/LoggingCharacterComponent.java#L43-L57", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/statistics/BasePortletLayoutStatisticsController.java", "func_name": "BasePortletLayoutStatisticsController.selectFormDefaultPortlet", "original_string": "protected void selectFormDefaultPortlet(final F report) {\n        final Set<AggregatedPortletMapping> portlets = this.getPortlets();\n        if (!portlets.isEmpty()) {\n            report.getPortlets().add(portlets.iterator().next().getFname());\n        }\n    }", "language": "java", "code": "protected void selectFormDefaultPortlet(final F report) {\n        final Set<AggregatedPortletMapping> portlets = this.getPortlets();\n        if (!portlets.isEmpty()) {\n            report.getPortlets().add(portlets.iterator().next().getFname());\n        }\n    }", "code_tokens": ["protected", "void", "selectFormDefaultPortlet", "(", "final", "F", "report", ")", "{", "final", "Set", "<", "AggregatedPortletMapping", ">", "portlets", "=", "this", ".", "getPortlets", "(", ")", ";", "if", "(", "!", "portlets", ".", "isEmpty", "(", ")", ")", "{", "report", ".", "getPortlets", "(", ")", ".", "add", "(", "portlets", ".", "iterator", "(", ")", ".", "next", "(", ")", ".", "getFname", "(", ")", ")", ";", "}", "}"], "docstring": "Select the first portlet name by default for the form", "docstring_tokens": ["Select", "the", "first", "portlet", "name", "by", "default", "for", "the", "form"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/statistics/BasePortletLayoutStatisticsController.java#L83-L88", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/statistics/BasePortletLayoutStatisticsController.java", "func_name": "BasePortletLayoutStatisticsController.getReportTitleAugmentation", "original_string": "@Override\n    protected String getReportTitleAugmentation(F form) {\n        int groupSize = form.getGroups().size();\n        int portletSize = form.getPortlets().size();\n\n        // If multiple of all selected, the report title does not change.\n        if (portletSize > 1 && groupSize > 1) {\n            return null;\n        }\n\n        // Look up names in case we need them.  They should be in cache so no real performance hit.\n        String firstPortletName =\n                this.aggregatedPortletLookupDao\n                        .getMappedPortletForFname(form.getPortlets().iterator().next())\n                        .getFname();\n        Long firstGroupId = form.getGroups().iterator().next().longValue();\n        String firstGroupName =\n                this.aggregatedGroupLookupDao.getGroupMapping(firstGroupId).getGroupName();\n\n        // Default to show portlet name else group name in title\n        String augmentedTitle =\n                groupSize == 1 && portletSize > 1 ? firstGroupName : firstPortletName;\n\n        return augmentedTitle;\n    }", "language": "java", "code": "@Override\n    protected String getReportTitleAugmentation(F form) {\n        int groupSize = form.getGroups().size();\n        int portletSize = form.getPortlets().size();\n\n        // If multiple of all selected, the report title does not change.\n        if (portletSize > 1 && groupSize > 1) {\n            return null;\n        }\n\n        // Look up names in case we need them.  They should be in cache so no real performance hit.\n        String firstPortletName =\n                this.aggregatedPortletLookupDao\n                        .getMappedPortletForFname(form.getPortlets().iterator().next())\n                        .getFname();\n        Long firstGroupId = form.getGroups().iterator().next().longValue();\n        String firstGroupName =\n                this.aggregatedGroupLookupDao.getGroupMapping(firstGroupId).getGroupName();\n\n        // Default to show portlet name else group name in title\n        String augmentedTitle =\n                groupSize == 1 && portletSize > 1 ? firstGroupName : firstPortletName;\n\n        return augmentedTitle;\n    }", "code_tokens": ["@", "Override", "protected", "String", "getReportTitleAugmentation", "(", "F", "form", ")", "{", "int", "groupSize", "=", "form", ".", "getGroups", "(", ")", ".", "size", "(", ")", ";", "int", "portletSize", "=", "form", ".", "getPortlets", "(", ")", ".", "size", "(", ")", ";", "// If multiple of all selected, the report title does not change.", "if", "(", "portletSize", ">", "1", "&&", "groupSize", ">", "1", ")", "{", "return", "null", ";", "}", "// Look up names in case we need them.  They should be in cache so no real performance hit.", "String", "firstPortletName", "=", "this", ".", "aggregatedPortletLookupDao", ".", "getMappedPortletForFname", "(", "form", ".", "getPortlets", "(", ")", ".", "iterator", "(", ")", ".", "next", "(", ")", ")", ".", "getFname", "(", ")", ";", "Long", "firstGroupId", "=", "form", ".", "getGroups", "(", ")", ".", "iterator", "(", ")", ".", "next", "(", ")", ".", "longValue", "(", ")", ";", "String", "firstGroupName", "=", "this", ".", "aggregatedGroupLookupDao", ".", "getGroupMapping", "(", "firstGroupId", ")", ".", "getGroupName", "(", ")", ";", "// Default to show portlet name else group name in title", "String", "augmentedTitle", "=", "groupSize", "==", "1", "&&", "portletSize", ">", "1", "?", "firstGroupName", ":", "firstPortletName", ";", "return", "augmentedTitle", ";", "}"], "docstring": "Create report title. Criteria that have a single value selected are put into the title.\nFormat and possible options are:\n\n<ul>\n<li>null (no change needed)\n<li>portlet\n<li>portlet (execution)\n<li>group\n<li>group (execution)\n<li>execution\n<li>portlet - group (also displayed if one of each criteria selected)\n</ul>\n\n@param form the form\n@return report title", "docstring_tokens": ["Create", "report", "title", ".", "Criteria", "that", "have", "a", "single", "value", "selected", "are", "put", "into", "the", "title", ".", "Format", "and", "possible", "options", "are", ":"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/statistics/BasePortletLayoutStatisticsController.java#L188-L212", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/statistics/BasePortletLayoutStatisticsController.java", "func_name": "BasePortletLayoutStatisticsController.getColumnDescriptions", "original_string": "@Override\n    protected List<ColumnDescription> getColumnDescriptions(\n            PortletLayoutAggregationDiscriminator reportColumnDiscriminator, F form) {\n        int groupSize = form.getGroups().size();\n        int portletSize = form.getPortlets().size();\n\n        String portletName = reportColumnDiscriminator.getPortletMapping().getFname();\n        String groupName = reportColumnDiscriminator.getAggregatedGroup().getGroupName();\n\n        String description = null;\n        if (showFullColumnHeaderDescriptions(form) || (groupSize > 1 && portletSize > 1)) {\n            description = String.format(\"%s - %s\", portletName, groupName);\n        } else {\n            // Default to group name, else portlet name\n            description = groupSize == 1 && portletSize > 1 ? portletName : groupName;\n        }\n\n        final List<ColumnDescription> columnDescriptions = new ArrayList<ColumnDescription>();\n        columnDescriptions.add(new ColumnDescription(description, ValueType.NUMBER, description));\n        return columnDescriptions;\n    }", "language": "java", "code": "@Override\n    protected List<ColumnDescription> getColumnDescriptions(\n            PortletLayoutAggregationDiscriminator reportColumnDiscriminator, F form) {\n        int groupSize = form.getGroups().size();\n        int portletSize = form.getPortlets().size();\n\n        String portletName = reportColumnDiscriminator.getPortletMapping().getFname();\n        String groupName = reportColumnDiscriminator.getAggregatedGroup().getGroupName();\n\n        String description = null;\n        if (showFullColumnHeaderDescriptions(form) || (groupSize > 1 && portletSize > 1)) {\n            description = String.format(\"%s - %s\", portletName, groupName);\n        } else {\n            // Default to group name, else portlet name\n            description = groupSize == 1 && portletSize > 1 ? portletName : groupName;\n        }\n\n        final List<ColumnDescription> columnDescriptions = new ArrayList<ColumnDescription>();\n        columnDescriptions.add(new ColumnDescription(description, ValueType.NUMBER, description));\n        return columnDescriptions;\n    }", "code_tokens": ["@", "Override", "protected", "List", "<", "ColumnDescription", ">", "getColumnDescriptions", "(", "PortletLayoutAggregationDiscriminator", "reportColumnDiscriminator", ",", "F", "form", ")", "{", "int", "groupSize", "=", "form", ".", "getGroups", "(", ")", ".", "size", "(", ")", ";", "int", "portletSize", "=", "form", ".", "getPortlets", "(", ")", ".", "size", "(", ")", ";", "String", "portletName", "=", "reportColumnDiscriminator", ".", "getPortletMapping", "(", ")", ".", "getFname", "(", ")", ";", "String", "groupName", "=", "reportColumnDiscriminator", ".", "getAggregatedGroup", "(", ")", ".", "getGroupName", "(", ")", ";", "String", "description", "=", "null", ";", "if", "(", "showFullColumnHeaderDescriptions", "(", "form", ")", "||", "(", "groupSize", ">", "1", "&&", "portletSize", ">", "1", ")", ")", "{", "description", "=", "String", ".", "format", "(", "\"%s - %s\"", ",", "portletName", ",", "groupName", ")", ";", "}", "else", "{", "// Default to group name, else portlet name", "description", "=", "groupSize", "==", "1", "&&", "portletSize", ">", "1", "?", "portletName", ":", "groupName", ";", "}", "final", "List", "<", "ColumnDescription", ">", "columnDescriptions", "=", "new", "ArrayList", "<", "ColumnDescription", ">", "(", ")", ";", "columnDescriptions", ".", "add", "(", "new", "ColumnDescription", "(", "description", ",", "ValueType", ".", "NUMBER", ",", "description", ")", ")", ";", "return", "columnDescriptions", ";", "}"], "docstring": "Create column descriptions for the portlet report. The default column description is the\ngroup name, but those items that are singular will move to the report title and only those\nthat have 2 or more values selected on the form will be in the column title. Format: P - G P\nG P - G where P is portlet name, G is group name\n\n@param reportColumnDiscriminator\n@param form The original query form\n@return", "docstring_tokens": ["Create", "column", "descriptions", "for", "the", "portlet", "report", ".", "The", "default", "column", "description", "is", "the", "group", "name", "but", "those", "items", "that", "are", "singular", "will", "move", "to", "the", "report", "title", "and", "only", "those", "that", "have", "2", "or", "more", "values", "selected", "on", "the", "form", "will", "be", "in", "the", "column", "title", ".", "Format", ":", "P", "-", "G", "P", "G", "P", "-", "G", "where", "P", "is", "portlet", "name", "G", "is", "group", "name"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/statistics/BasePortletLayoutStatisticsController.java#L224-L244", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/jdbc/DatabaseMetaDataImpl.java", "func_name": "DatabaseMetaDataImpl.afterPropertiesSet", "original_string": "@Override\n    public void afterPropertiesSet() throws Exception {\n        this.transactionTemplate = new TransactionTemplate(this.transactionManager);\n        this.transactionTemplate.setPropagationBehavior(\n                TransactionTemplate.PROPAGATION_REQUIRES_NEW);\n        this.transactionTemplate.setReadOnly(true);\n        this.transactionTemplate.afterPropertiesSet();\n\n        this.runDatabaseTests();\n        if (LOG.isDebugEnabled()) LOG.debug(this.toString());\n    }", "language": "java", "code": "@Override\n    public void afterPropertiesSet() throws Exception {\n        this.transactionTemplate = new TransactionTemplate(this.transactionManager);\n        this.transactionTemplate.setPropagationBehavior(\n                TransactionTemplate.PROPAGATION_REQUIRES_NEW);\n        this.transactionTemplate.setReadOnly(true);\n        this.transactionTemplate.afterPropertiesSet();\n\n        this.runDatabaseTests();\n        if (LOG.isDebugEnabled()) LOG.debug(this.toString());\n    }", "code_tokens": ["@", "Override", "public", "void", "afterPropertiesSet", "(", ")", "throws", "Exception", "{", "this", ".", "transactionTemplate", "=", "new", "TransactionTemplate", "(", "this", ".", "transactionManager", ")", ";", "this", ".", "transactionTemplate", ".", "setPropagationBehavior", "(", "TransactionTemplate", ".", "PROPAGATION_REQUIRES_NEW", ")", ";", "this", ".", "transactionTemplate", ".", "setReadOnly", "(", "true", ")", ";", "this", ".", "transactionTemplate", ".", "afterPropertiesSet", "(", ")", ";", "this", ".", "runDatabaseTests", "(", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "this", ".", "toString", "(", ")", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.springframework.beans.factory.InitializingBean#afterPropertiesSet()", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/jdbc/DatabaseMetaDataImpl.java#L113-L123", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/jdbc/DatabaseMetaDataImpl.java", "func_name": "DatabaseMetaDataImpl.getMetaData", "original_string": "private void getMetaData(final Connection conn) {\n        try {\n            final DatabaseMetaData dmd = conn.getMetaData();\n\n            this.databaseProductName = dmd.getDatabaseProductName();\n            this.databaseProductVersion = dmd.getDatabaseProductVersion();\n            this.driverName = dmd.getDriverName();\n            this.driverVersion = dmd.getDriverVersion();\n            this.userName = dmd.getUserName();\n            this.dbUrl = dmd.getURL();\n            this.dbmdSupportsOuterJoins = dmd.supportsOuterJoins();\n        } catch (SQLException sqle) {\n            LOG.error(\"Error getting database meta data.\", sqle);\n        }\n    }", "language": "java", "code": "private void getMetaData(final Connection conn) {\n        try {\n            final DatabaseMetaData dmd = conn.getMetaData();\n\n            this.databaseProductName = dmd.getDatabaseProductName();\n            this.databaseProductVersion = dmd.getDatabaseProductVersion();\n            this.driverName = dmd.getDriverName();\n            this.driverVersion = dmd.getDriverVersion();\n            this.userName = dmd.getUserName();\n            this.dbUrl = dmd.getURL();\n            this.dbmdSupportsOuterJoins = dmd.supportsOuterJoins();\n        } catch (SQLException sqle) {\n            LOG.error(\"Error getting database meta data.\", sqle);\n        }\n    }", "code_tokens": ["private", "void", "getMetaData", "(", "final", "Connection", "conn", ")", "{", "try", "{", "final", "DatabaseMetaData", "dmd", "=", "conn", ".", "getMetaData", "(", ")", ";", "this", ".", "databaseProductName", "=", "dmd", ".", "getDatabaseProductName", "(", ")", ";", "this", ".", "databaseProductVersion", "=", "dmd", ".", "getDatabaseProductVersion", "(", ")", ";", "this", ".", "driverName", "=", "dmd", ".", "getDriverName", "(", ")", ";", "this", ".", "driverVersion", "=", "dmd", ".", "getDriverVersion", "(", ")", ";", "this", ".", "userName", "=", "dmd", ".", "getUserName", "(", ")", ";", "this", ".", "dbUrl", "=", "dmd", ".", "getURL", "(", ")", ";", "this", ".", "dbmdSupportsOuterJoins", "=", "dmd", ".", "supportsOuterJoins", "(", ")", ";", "}", "catch", "(", "SQLException", "sqle", ")", "{", "LOG", ".", "error", "(", "\"Error getting database meta data.\"", ",", "sqle", ")", ";", "}", "}"], "docstring": "Gets meta data about the connection.", "docstring_tokens": ["Gets", "meta", "data", "about", "the", "connection", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/jdbc/DatabaseMetaDataImpl.java#L314-L328", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/PortalController.java", "func_name": "PortalController.actionRequest", "original_string": "@RequestMapping(\n            headers = {\"org.apereo.portal.url.UrlType=ACTION\"},\n            method = RequestMethod.POST)\n    public void actionRequest(HttpServletRequest request, HttpServletResponse response)\n            throws IOException {\n\n        final IPortalRequestInfo portalRequestInfo =\n                this.urlSyntaxProvider.getPortalRequestInfo(request);\n        final IPortletRequestInfo portletRequestInfo =\n                portalRequestInfo.getTargetedPortletRequestInfo();\n\n        final IPortalUrlBuilder actionRedirectUrl;\n        if (portletRequestInfo != null) {\n            final IPortletWindowId targetWindowId = portletRequestInfo.getPortletWindowId();\n            actionRedirectUrl =\n                    this.portalUrlProvider.getPortalUrlBuilderByPortletWindow(\n                            request, targetWindowId, UrlType.RENDER);\n        } else {\n            final String targetedLayoutNodeId = portalRequestInfo.getTargetedLayoutNodeId();\n\n            if (targetedLayoutNodeId != null) {\n                actionRedirectUrl =\n                        this.portalUrlProvider.getPortalUrlBuilderByLayoutNode(\n                                request, targetedLayoutNodeId, UrlType.RENDER);\n            } else {\n                actionRedirectUrl = this.portalUrlProvider.getDefaultUrl(request);\n            }\n        }\n\n        // Stuff the action-redirect URL builder into the request so other code can use it during\n        // request processing\n        this.portalUrlProvider.convertToPortalActionUrlBuilder(request, actionRedirectUrl);\n\n        if (portletRequestInfo != null) {\n            final IPortletWindowId targetWindowId = portletRequestInfo.getPortletWindowId();\n\n            try {\n                this.portletExecutionManager.doPortletAction(targetWindowId, request, response);\n            } catch (RuntimeException e) {\n                this.logger.error(\n                        \"Exception thrown while executing portlet action for: \"\n                                + portletRequestInfo,\n                        e);\n\n                // TODO this should be a constant right?\n                actionRedirectUrl.setParameter(\"portletActionError\", targetWindowId.toString());\n            }\n        }\n\n        sendRedirect(actionRedirectUrl, response);\n    }", "language": "java", "code": "@RequestMapping(\n            headers = {\"org.apereo.portal.url.UrlType=ACTION\"},\n            method = RequestMethod.POST)\n    public void actionRequest(HttpServletRequest request, HttpServletResponse response)\n            throws IOException {\n\n        final IPortalRequestInfo portalRequestInfo =\n                this.urlSyntaxProvider.getPortalRequestInfo(request);\n        final IPortletRequestInfo portletRequestInfo =\n                portalRequestInfo.getTargetedPortletRequestInfo();\n\n        final IPortalUrlBuilder actionRedirectUrl;\n        if (portletRequestInfo != null) {\n            final IPortletWindowId targetWindowId = portletRequestInfo.getPortletWindowId();\n            actionRedirectUrl =\n                    this.portalUrlProvider.getPortalUrlBuilderByPortletWindow(\n                            request, targetWindowId, UrlType.RENDER);\n        } else {\n            final String targetedLayoutNodeId = portalRequestInfo.getTargetedLayoutNodeId();\n\n            if (targetedLayoutNodeId != null) {\n                actionRedirectUrl =\n                        this.portalUrlProvider.getPortalUrlBuilderByLayoutNode(\n                                request, targetedLayoutNodeId, UrlType.RENDER);\n            } else {\n                actionRedirectUrl = this.portalUrlProvider.getDefaultUrl(request);\n            }\n        }\n\n        // Stuff the action-redirect URL builder into the request so other code can use it during\n        // request processing\n        this.portalUrlProvider.convertToPortalActionUrlBuilder(request, actionRedirectUrl);\n\n        if (portletRequestInfo != null) {\n            final IPortletWindowId targetWindowId = portletRequestInfo.getPortletWindowId();\n\n            try {\n                this.portletExecutionManager.doPortletAction(targetWindowId, request, response);\n            } catch (RuntimeException e) {\n                this.logger.error(\n                        \"Exception thrown while executing portlet action for: \"\n                                + portletRequestInfo,\n                        e);\n\n                // TODO this should be a constant right?\n                actionRedirectUrl.setParameter(\"portletActionError\", targetWindowId.toString());\n            }\n        }\n\n        sendRedirect(actionRedirectUrl, response);\n    }", "code_tokens": ["@", "RequestMapping", "(", "headers", "=", "{", "\"org.apereo.portal.url.UrlType=ACTION\"", "}", ",", "method", "=", "RequestMethod", ".", "POST", ")", "public", "void", "actionRequest", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "throws", "IOException", "{", "final", "IPortalRequestInfo", "portalRequestInfo", "=", "this", ".", "urlSyntaxProvider", ".", "getPortalRequestInfo", "(", "request", ")", ";", "final", "IPortletRequestInfo", "portletRequestInfo", "=", "portalRequestInfo", ".", "getTargetedPortletRequestInfo", "(", ")", ";", "final", "IPortalUrlBuilder", "actionRedirectUrl", ";", "if", "(", "portletRequestInfo", "!=", "null", ")", "{", "final", "IPortletWindowId", "targetWindowId", "=", "portletRequestInfo", ".", "getPortletWindowId", "(", ")", ";", "actionRedirectUrl", "=", "this", ".", "portalUrlProvider", ".", "getPortalUrlBuilderByPortletWindow", "(", "request", ",", "targetWindowId", ",", "UrlType", ".", "RENDER", ")", ";", "}", "else", "{", "final", "String", "targetedLayoutNodeId", "=", "portalRequestInfo", ".", "getTargetedLayoutNodeId", "(", ")", ";", "if", "(", "targetedLayoutNodeId", "!=", "null", ")", "{", "actionRedirectUrl", "=", "this", ".", "portalUrlProvider", ".", "getPortalUrlBuilderByLayoutNode", "(", "request", ",", "targetedLayoutNodeId", ",", "UrlType", ".", "RENDER", ")", ";", "}", "else", "{", "actionRedirectUrl", "=", "this", ".", "portalUrlProvider", ".", "getDefaultUrl", "(", "request", ")", ";", "}", "}", "// Stuff the action-redirect URL builder into the request so other code can use it during", "// request processing", "this", ".", "portalUrlProvider", ".", "convertToPortalActionUrlBuilder", "(", "request", ",", "actionRedirectUrl", ")", ";", "if", "(", "portletRequestInfo", "!=", "null", ")", "{", "final", "IPortletWindowId", "targetWindowId", "=", "portletRequestInfo", ".", "getPortletWindowId", "(", ")", ";", "try", "{", "this", ".", "portletExecutionManager", ".", "doPortletAction", "(", "targetWindowId", ",", "request", ",", "response", ")", ";", "}", "catch", "(", "RuntimeException", "e", ")", "{", "this", ".", "logger", ".", "error", "(", "\"Exception thrown while executing portlet action for: \"", "+", "portletRequestInfo", ",", "e", ")", ";", "// TODO this should be a constant right?", "actionRedirectUrl", ".", "setParameter", "(", "\"portletActionError\"", ",", "targetWindowId", ".", "toString", "(", ")", ")", ";", "}", "}", "sendRedirect", "(", "actionRedirectUrl", ",", "response", ")", ";", "}"], "docstring": "HTTP POST required for security.", "docstring_tokens": ["HTTP", "POST", "required", "for", "security", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/PortalController.java#L112-L162", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/localization/UserLocaleHelper.java", "func_name": "UserLocaleHelper.getLocales", "original_string": "public List<LocaleBean> getLocales(Locale currentLocale) {\n        List<LocaleBean> locales = new ArrayList<>();\n\n        // get the array of locales available from the portal\n        List<Locale> portalLocales = localeManagerFactory.getPortalLocales();\n        for (Locale locale : portalLocales) {\n            if (currentLocale != null) {\n                // if a current locale is available, display language names\n                // using the current locale\n                locales.add(new LocaleBean(locale, currentLocale));\n            } else {\n                locales.add(new LocaleBean(locale));\n            }\n        }\n        return locales;\n    }", "language": "java", "code": "public List<LocaleBean> getLocales(Locale currentLocale) {\n        List<LocaleBean> locales = new ArrayList<>();\n\n        // get the array of locales available from the portal\n        List<Locale> portalLocales = localeManagerFactory.getPortalLocales();\n        for (Locale locale : portalLocales) {\n            if (currentLocale != null) {\n                // if a current locale is available, display language names\n                // using the current locale\n                locales.add(new LocaleBean(locale, currentLocale));\n            } else {\n                locales.add(new LocaleBean(locale));\n            }\n        }\n        return locales;\n    }", "code_tokens": ["public", "List", "<", "LocaleBean", ">", "getLocales", "(", "Locale", "currentLocale", ")", "{", "List", "<", "LocaleBean", ">", "locales", "=", "new", "ArrayList", "<>", "(", ")", ";", "// get the array of locales available from the portal", "List", "<", "Locale", ">", "portalLocales", "=", "localeManagerFactory", ".", "getPortalLocales", "(", ")", ";", "for", "(", "Locale", "locale", ":", "portalLocales", ")", "{", "if", "(", "currentLocale", "!=", "null", ")", "{", "// if a current locale is available, display language names", "// using the current locale", "locales", ".", "add", "(", "new", "LocaleBean", "(", "locale", ",", "currentLocale", ")", ")", ";", "}", "else", "{", "locales", ".", "add", "(", "new", "LocaleBean", "(", "locale", ")", ")", ";", "}", "}", "return", "locales", ";", "}"], "docstring": "Return a list of LocaleBeans matching the currently available locales for the portal.\n\n@param currentLocale\n@return", "docstring_tokens": ["Return", "a", "list", "of", "LocaleBeans", "matching", "the", "currently", "available", "locales", "for", "the", "portal", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/localization/UserLocaleHelper.java#L77-L92", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/localization/UserLocaleHelper.java", "func_name": "UserLocaleHelper.getCurrentUserLocale", "original_string": "public Locale getCurrentUserLocale(PortletRequest request) {\n        final HttpServletRequest originalPortalRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        IUserInstance ui = userInstanceManager.getUserInstance(originalPortalRequest);\n        IUserPreferencesManager upm = ui.getPreferencesManager();\n        final IUserProfile userProfile = upm.getUserProfile();\n        LocaleManager localeManager = userProfile.getLocaleManager();\n\n        // first check the session locales\n        List<Locale> sessionLocales = localeManager.getSessionLocales();\n        if (sessionLocales != null && sessionLocales.size() > 0) {\n            return sessionLocales.get(0);\n        }\n\n        // if no session locales were found, check the user locales\n        List<Locale> userLocales = localeManager.getUserLocales();\n        if (userLocales != null && userLocales.size() > 0) {\n            return userLocales.get(0);\n        }\n\n        // if no selected locale was found either in the session or user layout,\n        // just return null\n        return null;\n    }", "language": "java", "code": "public Locale getCurrentUserLocale(PortletRequest request) {\n        final HttpServletRequest originalPortalRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        IUserInstance ui = userInstanceManager.getUserInstance(originalPortalRequest);\n        IUserPreferencesManager upm = ui.getPreferencesManager();\n        final IUserProfile userProfile = upm.getUserProfile();\n        LocaleManager localeManager = userProfile.getLocaleManager();\n\n        // first check the session locales\n        List<Locale> sessionLocales = localeManager.getSessionLocales();\n        if (sessionLocales != null && sessionLocales.size() > 0) {\n            return sessionLocales.get(0);\n        }\n\n        // if no session locales were found, check the user locales\n        List<Locale> userLocales = localeManager.getUserLocales();\n        if (userLocales != null && userLocales.size() > 0) {\n            return userLocales.get(0);\n        }\n\n        // if no selected locale was found either in the session or user layout,\n        // just return null\n        return null;\n    }", "code_tokens": ["public", "Locale", "getCurrentUserLocale", "(", "PortletRequest", "request", ")", "{", "final", "HttpServletRequest", "originalPortalRequest", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "request", ")", ";", "IUserInstance", "ui", "=", "userInstanceManager", ".", "getUserInstance", "(", "originalPortalRequest", ")", ";", "IUserPreferencesManager", "upm", "=", "ui", ".", "getPreferencesManager", "(", ")", ";", "final", "IUserProfile", "userProfile", "=", "upm", ".", "getUserProfile", "(", ")", ";", "LocaleManager", "localeManager", "=", "userProfile", ".", "getLocaleManager", "(", ")", ";", "// first check the session locales", "List", "<", "Locale", ">", "sessionLocales", "=", "localeManager", ".", "getSessionLocales", "(", ")", ";", "if", "(", "sessionLocales", "!=", "null", "&&", "sessionLocales", ".", "size", "(", ")", ">", "0", ")", "{", "return", "sessionLocales", ".", "get", "(", "0", ")", ";", "}", "// if no session locales were found, check the user locales", "List", "<", "Locale", ">", "userLocales", "=", "localeManager", ".", "getUserLocales", "(", ")", ";", "if", "(", "userLocales", "!=", "null", "&&", "userLocales", ".", "size", "(", ")", ">", "0", ")", "{", "return", "userLocales", ".", "get", "(", "0", ")", ";", "}", "// if no selected locale was found either in the session or user layout,", "// just return null", "return", "null", ";", "}"], "docstring": "Return the current user's locale.\n\n@param request The current {@link PortletRequest}\n@return", "docstring_tokens": ["Return", "the", "current", "user", "s", "locale", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/localization/UserLocaleHelper.java#L100-L123", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/localization/UserLocaleHelper.java", "func_name": "UserLocaleHelper.updateUserLocale", "original_string": "public void updateUserLocale(HttpServletRequest request, String localeString) {\n\n        IUserInstance ui = userInstanceManager.getUserInstance(request);\n        IUserPreferencesManager upm = ui.getPreferencesManager();\n        final IUserProfile userProfile = upm.getUserProfile();\n        LocaleManager localeManager = userProfile.getLocaleManager();\n\n        if (localeString != null) {\n\n            // build a new List<Locale> from the specified locale\n            Locale userLocale = localeManagerFactory.parseLocale(localeString);\n            List<Locale> locales = Collections.singletonList(userLocale);\n\n            // set this locale in the session\n            localeManager.setSessionLocales(locales);\n\n            // if the current user is logged in, also update the persisted\n            // user locale\n            final IPerson person = ui.getPerson();\n            if (!person.isGuest()) {\n                try {\n                    localeManager.setUserLocales(Collections.singletonList(userLocale));\n                    localeStore.updateUserLocales(person, new Locale[] {userLocale});\n\n                    // remove person layout framgent from session since it contains some of the data\n                    // in previous\n                    // translation and won't be cleared until next logout-login (applies when using\n                    // RDBMDistributedLayoutStore as user layout store).\n                    person.setAttribute(Constants.PLF, null);\n                    upm.getUserLayoutManager().loadUserLayout(true);\n                } catch (Exception e) {\n                    throw new PortalException(e);\n                }\n            }\n        }\n    }", "language": "java", "code": "public void updateUserLocale(HttpServletRequest request, String localeString) {\n\n        IUserInstance ui = userInstanceManager.getUserInstance(request);\n        IUserPreferencesManager upm = ui.getPreferencesManager();\n        final IUserProfile userProfile = upm.getUserProfile();\n        LocaleManager localeManager = userProfile.getLocaleManager();\n\n        if (localeString != null) {\n\n            // build a new List<Locale> from the specified locale\n            Locale userLocale = localeManagerFactory.parseLocale(localeString);\n            List<Locale> locales = Collections.singletonList(userLocale);\n\n            // set this locale in the session\n            localeManager.setSessionLocales(locales);\n\n            // if the current user is logged in, also update the persisted\n            // user locale\n            final IPerson person = ui.getPerson();\n            if (!person.isGuest()) {\n                try {\n                    localeManager.setUserLocales(Collections.singletonList(userLocale));\n                    localeStore.updateUserLocales(person, new Locale[] {userLocale});\n\n                    // remove person layout framgent from session since it contains some of the data\n                    // in previous\n                    // translation and won't be cleared until next logout-login (applies when using\n                    // RDBMDistributedLayoutStore as user layout store).\n                    person.setAttribute(Constants.PLF, null);\n                    upm.getUserLayoutManager().loadUserLayout(true);\n                } catch (Exception e) {\n                    throw new PortalException(e);\n                }\n            }\n        }\n    }", "code_tokens": ["public", "void", "updateUserLocale", "(", "HttpServletRequest", "request", ",", "String", "localeString", ")", "{", "IUserInstance", "ui", "=", "userInstanceManager", ".", "getUserInstance", "(", "request", ")", ";", "IUserPreferencesManager", "upm", "=", "ui", ".", "getPreferencesManager", "(", ")", ";", "final", "IUserProfile", "userProfile", "=", "upm", ".", "getUserProfile", "(", ")", ";", "LocaleManager", "localeManager", "=", "userProfile", ".", "getLocaleManager", "(", ")", ";", "if", "(", "localeString", "!=", "null", ")", "{", "// build a new List<Locale> from the specified locale", "Locale", "userLocale", "=", "localeManagerFactory", ".", "parseLocale", "(", "localeString", ")", ";", "List", "<", "Locale", ">", "locales", "=", "Collections", ".", "singletonList", "(", "userLocale", ")", ";", "// set this locale in the session", "localeManager", ".", "setSessionLocales", "(", "locales", ")", ";", "// if the current user is logged in, also update the persisted", "// user locale", "final", "IPerson", "person", "=", "ui", ".", "getPerson", "(", ")", ";", "if", "(", "!", "person", ".", "isGuest", "(", ")", ")", "{", "try", "{", "localeManager", ".", "setUserLocales", "(", "Collections", ".", "singletonList", "(", "userLocale", ")", ")", ";", "localeStore", ".", "updateUserLocales", "(", "person", ",", "new", "Locale", "[", "]", "{", "userLocale", "}", ")", ";", "// remove person layout framgent from session since it contains some of the data", "// in previous", "// translation and won't be cleared until next logout-login (applies when using", "// RDBMDistributedLayoutStore as user layout store).", "person", ".", "setAttribute", "(", "Constants", ".", "PLF", ",", "null", ")", ";", "upm", ".", "getUserLayoutManager", "(", ")", ".", "loadUserLayout", "(", "true", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "PortalException", "(", "e", ")", ";", "}", "}", "}", "}"], "docstring": "Update the current user's locale to match the selected locale. This implementation will\nupdate the session locale, and if the user is not a guest, will also update the locale in the\nuser's persisted preferences.\n\n@param request\n@param localeString", "docstring_tokens": ["Update", "the", "current", "user", "s", "locale", "to", "match", "the", "selected", "locale", ".", "This", "implementation", "will", "update", "the", "session", "locale", "and", "if", "the", "user", "is", "not", "a", "guest", "will", "also", "update", "the", "locale", "in", "the", "user", "s", "persisted", "preferences", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/localization/UserLocaleHelper.java#L133-L168", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/caching/CacheStatistics.java", "func_name": "CacheStatistics.getLoadExceptionRate", "original_string": "@Override\n    public double getLoadExceptionRate() {\n        long totalLoadCount = loadSuccessCount.get() + loadExceptionCount.get();\n        return (totalLoadCount == 0) ? 0.0 : (double) loadExceptionCount.get() / totalLoadCount;\n    }", "language": "java", "code": "@Override\n    public double getLoadExceptionRate() {\n        long totalLoadCount = loadSuccessCount.get() + loadExceptionCount.get();\n        return (totalLoadCount == 0) ? 0.0 : (double) loadExceptionCount.get() / totalLoadCount;\n    }", "code_tokens": ["@", "Override", "public", "double", "getLoadExceptionRate", "(", ")", "{", "long", "totalLoadCount", "=", "loadSuccessCount", ".", "get", "(", ")", "+", "loadExceptionCount", ".", "get", "(", ")", ";", "return", "(", "totalLoadCount", "==", "0", ")", "?", "0.0", ":", "(", "double", ")", "loadExceptionCount", ".", "get", "(", ")", "/", "totalLoadCount", ";", "}"], "docstring": "Returns the ratio of cache loading attempts which threw exceptions. This is defined as {@code\nloadExceptionCount / (loadSuccessCount + loadExceptionCount)}, or {@code 0.0} when {@code\nloadSuccessCount + loadExceptionCount == 0}.", "docstring_tokens": ["Returns", "the", "ratio", "of", "cache", "loading", "attempts", "which", "threw", "exceptions", ".", "This", "is", "defined", "as", "{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/caching/CacheStatistics.java#L137-L141", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java", "func_name": "TemplateDataTenantOperationsListener.setDataTypeImportOrder", "original_string": "@Autowired\n    public void setDataTypeImportOrder(List<IPortalDataType> dataTypeImportOrder) {\n        final ArrayList<PortalDataKey> dataKeyImportOrder =\n                new ArrayList<>(dataTypeImportOrder.size() * 2);\n\n        for (final IPortalDataType portalDataType : dataTypeImportOrder) {\n            final List<PortalDataKey> supportedDataKeys = portalDataType.getDataKeyImportOrder();\n            for (final PortalDataKey portalDataKey : supportedDataKeys) {\n                /*\n                 * Special Handling:  Need to prevent some keys from entering our\n                 * sorted collection because they attempt to import both a group\n                 * part and the membership parts of a group (either local or PAGS)\n                 * in one go.  We import several entities at once, so it's important\n                 * to do these in 2 phases.\n                 */\n                if (!KEYS_TO_IGNORE.contains(portalDataKey)) {\n                    dataKeyImportOrder.add(portalDataKey);\n                }\n            }\n        }\n        dataKeyImportOrder.trimToSize();\n        this.dataKeyImportOrder = Collections.unmodifiableList(dataKeyImportOrder);\n    }", "language": "java", "code": "@Autowired\n    public void setDataTypeImportOrder(List<IPortalDataType> dataTypeImportOrder) {\n        final ArrayList<PortalDataKey> dataKeyImportOrder =\n                new ArrayList<>(dataTypeImportOrder.size() * 2);\n\n        for (final IPortalDataType portalDataType : dataTypeImportOrder) {\n            final List<PortalDataKey> supportedDataKeys = portalDataType.getDataKeyImportOrder();\n            for (final PortalDataKey portalDataKey : supportedDataKeys) {\n                /*\n                 * Special Handling:  Need to prevent some keys from entering our\n                 * sorted collection because they attempt to import both a group\n                 * part and the membership parts of a group (either local or PAGS)\n                 * in one go.  We import several entities at once, so it's important\n                 * to do these in 2 phases.\n                 */\n                if (!KEYS_TO_IGNORE.contains(portalDataKey)) {\n                    dataKeyImportOrder.add(portalDataKey);\n                }\n            }\n        }\n        dataKeyImportOrder.trimToSize();\n        this.dataKeyImportOrder = Collections.unmodifiableList(dataKeyImportOrder);\n    }", "code_tokens": ["@", "Autowired", "public", "void", "setDataTypeImportOrder", "(", "List", "<", "IPortalDataType", ">", "dataTypeImportOrder", ")", "{", "final", "ArrayList", "<", "PortalDataKey", ">", "dataKeyImportOrder", "=", "new", "ArrayList", "<>", "(", "dataTypeImportOrder", ".", "size", "(", ")", "*", "2", ")", ";", "for", "(", "final", "IPortalDataType", "portalDataType", ":", "dataTypeImportOrder", ")", "{", "final", "List", "<", "PortalDataKey", ">", "supportedDataKeys", "=", "portalDataType", ".", "getDataKeyImportOrder", "(", ")", ";", "for", "(", "final", "PortalDataKey", "portalDataKey", ":", "supportedDataKeys", ")", "{", "/*\n                 * Special Handling:  Need to prevent some keys from entering our\n                 * sorted collection because they attempt to import both a group\n                 * part and the membership parts of a group (either local or PAGS)\n                 * in one go.  We import several entities at once, so it's important\n                 * to do these in 2 phases.\n                 */", "if", "(", "!", "KEYS_TO_IGNORE", ".", "contains", "(", "portalDataKey", ")", ")", "{", "dataKeyImportOrder", ".", "add", "(", "portalDataKey", ")", ";", "}", "}", "}", "dataKeyImportOrder", ".", "trimToSize", "(", ")", ";", "this", ".", "dataKeyImportOrder", "=", "Collections", ".", "unmodifiableList", "(", "dataKeyImportOrder", ")", ";", "}"], "docstring": "The <code>@Autowired</code> list will reflect the order in which data types should be\nimported.", "docstring_tokens": ["The", "<code", ">"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java#L110-L132", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java", "func_name": "TemplateDataTenantOperationsListener.determineImportOnUpdatePaths", "original_string": "static Set<String> determineImportOnUpdatePaths(\n            String templateLoc, Set<String> relResourcePathSet) {\n        String templateLocPath = templateLoc.split(\"\\\\*\")[0]; // up to wildcard pattern\n        if (!templateLocPath.endsWith(\"/\")) {\n            templateLocPath = templateLocPath + \"/\";\n        }\n        final Set<String> fullResourcePathSet = new HashSet<>();\n        for (String resourcePath : relResourcePathSet) {\n            final String fullPath;\n            try {\n                fullPath =\n                        resourcePath.matches(\"^[a-zA-Z]+:.*\")\n                                ? resourcePath\n                                : (new URI(templateLocPath).resolve(resourcePath)).toString();\n            } catch (URISyntaxException e) {\n                throw new RuntimeException(\n                        \"Unable to construct a URI by resolving '\"\n                                + resourcePath\n                                + \"'from '\"\n                                + templateLocPath\n                                + \"'\");\n            }\n            log.debug(\"Calculated full path: {} -> {}\", resourcePath, fullPath);\n            fullResourcePathSet.add(fullPath);\n        }\n        return fullResourcePathSet;\n    }", "language": "java", "code": "static Set<String> determineImportOnUpdatePaths(\n            String templateLoc, Set<String> relResourcePathSet) {\n        String templateLocPath = templateLoc.split(\"\\\\*\")[0]; // up to wildcard pattern\n        if (!templateLocPath.endsWith(\"/\")) {\n            templateLocPath = templateLocPath + \"/\";\n        }\n        final Set<String> fullResourcePathSet = new HashSet<>();\n        for (String resourcePath : relResourcePathSet) {\n            final String fullPath;\n            try {\n                fullPath =\n                        resourcePath.matches(\"^[a-zA-Z]+:.*\")\n                                ? resourcePath\n                                : (new URI(templateLocPath).resolve(resourcePath)).toString();\n            } catch (URISyntaxException e) {\n                throw new RuntimeException(\n                        \"Unable to construct a URI by resolving '\"\n                                + resourcePath\n                                + \"'from '\"\n                                + templateLocPath\n                                + \"'\");\n            }\n            log.debug(\"Calculated full path: {} -> {}\", resourcePath, fullPath);\n            fullResourcePathSet.add(fullPath);\n        }\n        return fullResourcePathSet;\n    }", "code_tokens": ["static", "Set", "<", "String", ">", "determineImportOnUpdatePaths", "(", "String", "templateLoc", ",", "Set", "<", "String", ">", "relResourcePathSet", ")", "{", "String", "templateLocPath", "=", "templateLoc", ".", "split", "(", "\"\\\\*\"", ")", "[", "0", "]", ";", "// up to wildcard pattern", "if", "(", "!", "templateLocPath", ".", "endsWith", "(", "\"/\"", ")", ")", "{", "templateLocPath", "=", "templateLocPath", "+", "\"/\"", ";", "}", "final", "Set", "<", "String", ">", "fullResourcePathSet", "=", "new", "HashSet", "<>", "(", ")", ";", "for", "(", "String", "resourcePath", ":", "relResourcePathSet", ")", "{", "final", "String", "fullPath", ";", "try", "{", "fullPath", "=", "resourcePath", ".", "matches", "(", "\"^[a-zA-Z]+:.*\"", ")", "?", "resourcePath", ":", "(", "new", "URI", "(", "templateLocPath", ")", ".", "resolve", "(", "resourcePath", ")", ")", ".", "toString", "(", ")", ";", "}", "catch", "(", "URISyntaxException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Unable to construct a URI by resolving '\"", "+", "resourcePath", "+", "\"'from '\"", "+", "templateLocPath", "+", "\"'\"", ")", ";", "}", "log", ".", "debug", "(", "\"Calculated full path: {} -> {}\"", ",", "resourcePath", ",", "fullPath", ")", ";", "fullResourcePathSet", ".", "add", "(", "fullPath", ")", ";", "}", "return", "fullResourcePathSet", ";", "}"], "docstring": "/*package", "docstring_tokens": ["/", "*", "package"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java#L150-L176", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java", "func_name": "TemplateDataTenantOperationsListener.buildResourcesFromPaths", "original_string": "static Set<Resource> buildResourcesFromPaths(\n            ResourceLoader resourceLoader, Set<String> resourcePaths) {\n        final Set<Resource> resourceSet = new HashSet<>();\n        for (String resourcePath : resourcePaths) {\n            Resource resource = resourceLoader.getResource(resourcePath);\n            log.debug(\"Resource {} exists?: {}\", resource, resource.exists());\n            resourceSet.add(resource);\n        }\n        return resourceSet;\n    }", "language": "java", "code": "static Set<Resource> buildResourcesFromPaths(\n            ResourceLoader resourceLoader, Set<String> resourcePaths) {\n        final Set<Resource> resourceSet = new HashSet<>();\n        for (String resourcePath : resourcePaths) {\n            Resource resource = resourceLoader.getResource(resourcePath);\n            log.debug(\"Resource {} exists?: {}\", resource, resource.exists());\n            resourceSet.add(resource);\n        }\n        return resourceSet;\n    }", "code_tokens": ["static", "Set", "<", "Resource", ">", "buildResourcesFromPaths", "(", "ResourceLoader", "resourceLoader", ",", "Set", "<", "String", ">", "resourcePaths", ")", "{", "final", "Set", "<", "Resource", ">", "resourceSet", "=", "new", "HashSet", "<>", "(", ")", ";", "for", "(", "String", "resourcePath", ":", "resourcePaths", ")", "{", "Resource", "resource", "=", "resourceLoader", ".", "getResource", "(", "resourcePath", ")", ";", "log", ".", "debug", "(", "\"Resource {} exists?: {}\"", ",", "resource", ",", "resource", ".", "exists", "(", ")", ")", ";", "resourceSet", ".", "add", "(", "resource", ")", ";", "}", "return", "resourceSet", ";", "}"], "docstring": "/*package", "docstring_tokens": ["/", "*", "package"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java#L186-L195", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java", "func_name": "TemplateDataTenantOperationsListener.importWithResources", "original_string": "public TenantOperationResponse importWithResources(\n            final ITenant tenant, final Set<Resource> resources) {\n        /*\n         * First load dom4j Documents and sort the entity files into the proper order\n         */\n        final Map<PortalDataKey, Set<BucketTuple>> importQueue;\n        try {\n            importQueue = prepareImportQueue(tenant, resources);\n        } catch (Exception e) {\n            final TenantOperationResponse error =\n                    new TenantOperationResponse(this, TenantOperationResponse.Result.ABORT);\n            error.addMessage(\n                    createLocalizedMessage(\n                            FAILED_TO_LOAD_TENANT_TEMPLATE, new String[] {tenant.getName()}));\n            return error;\n        }\n\n        log.trace(\n                \"Ready to import data entity templates for new tenant '{}';  importQueue={}\",\n                tenant.getName(),\n                importQueue);\n\n        // We're going to report on every item imported;  TODO it would be better\n        // if we could display human-friendly entity type name + sysid (fname, etc.)\n        final StringBuilder importReport = new StringBuilder();\n\n        /*\n         * Now import the identified entities each bucket in turn\n         */\n        try {\n            importQueue(tenant, importQueue, importReport);\n        } catch (Exception e) {\n            final TenantOperationResponse error =\n                    new TenantOperationResponse(this, TenantOperationResponse.Result.ABORT);\n            error.addMessage(finalizeImportReport(importReport));\n            error.addMessage(\n                    createLocalizedMessage(\n                            FAILED_TO_IMPORT_TENANT_TEMPLATE_DATA,\n                            new String[] {tenant.getName()}));\n            return error;\n        }\n\n        TenantOperationResponse rslt =\n                new TenantOperationResponse(this, TenantOperationResponse.Result.SUCCESS);\n        rslt.addMessage(finalizeImportReport(importReport));\n        rslt.addMessage(\n                createLocalizedMessage(TENANT_ENTITIES_IMPORTED, new String[] {tenant.getName()}));\n        return rslt;\n    }", "language": "java", "code": "public TenantOperationResponse importWithResources(\n            final ITenant tenant, final Set<Resource> resources) {\n        /*\n         * First load dom4j Documents and sort the entity files into the proper order\n         */\n        final Map<PortalDataKey, Set<BucketTuple>> importQueue;\n        try {\n            importQueue = prepareImportQueue(tenant, resources);\n        } catch (Exception e) {\n            final TenantOperationResponse error =\n                    new TenantOperationResponse(this, TenantOperationResponse.Result.ABORT);\n            error.addMessage(\n                    createLocalizedMessage(\n                            FAILED_TO_LOAD_TENANT_TEMPLATE, new String[] {tenant.getName()}));\n            return error;\n        }\n\n        log.trace(\n                \"Ready to import data entity templates for new tenant '{}';  importQueue={}\",\n                tenant.getName(),\n                importQueue);\n\n        // We're going to report on every item imported;  TODO it would be better\n        // if we could display human-friendly entity type name + sysid (fname, etc.)\n        final StringBuilder importReport = new StringBuilder();\n\n        /*\n         * Now import the identified entities each bucket in turn\n         */\n        try {\n            importQueue(tenant, importQueue, importReport);\n        } catch (Exception e) {\n            final TenantOperationResponse error =\n                    new TenantOperationResponse(this, TenantOperationResponse.Result.ABORT);\n            error.addMessage(finalizeImportReport(importReport));\n            error.addMessage(\n                    createLocalizedMessage(\n                            FAILED_TO_IMPORT_TENANT_TEMPLATE_DATA,\n                            new String[] {tenant.getName()}));\n            return error;\n        }\n\n        TenantOperationResponse rslt =\n                new TenantOperationResponse(this, TenantOperationResponse.Result.SUCCESS);\n        rslt.addMessage(finalizeImportReport(importReport));\n        rslt.addMessage(\n                createLocalizedMessage(TENANT_ENTITIES_IMPORTED, new String[] {tenant.getName()}));\n        return rslt;\n    }", "code_tokens": ["public", "TenantOperationResponse", "importWithResources", "(", "final", "ITenant", "tenant", ",", "final", "Set", "<", "Resource", ">", "resources", ")", "{", "/*\n         * First load dom4j Documents and sort the entity files into the proper order\n         */", "final", "Map", "<", "PortalDataKey", ",", "Set", "<", "BucketTuple", ">", ">", "importQueue", ";", "try", "{", "importQueue", "=", "prepareImportQueue", "(", "tenant", ",", "resources", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "final", "TenantOperationResponse", "error", "=", "new", "TenantOperationResponse", "(", "this", ",", "TenantOperationResponse", ".", "Result", ".", "ABORT", ")", ";", "error", ".", "addMessage", "(", "createLocalizedMessage", "(", "FAILED_TO_LOAD_TENANT_TEMPLATE", ",", "new", "String", "[", "]", "{", "tenant", ".", "getName", "(", ")", "}", ")", ")", ";", "return", "error", ";", "}", "log", ".", "trace", "(", "\"Ready to import data entity templates for new tenant '{}';  importQueue={}\"", ",", "tenant", ".", "getName", "(", ")", ",", "importQueue", ")", ";", "// We're going to report on every item imported;  TODO it would be better", "// if we could display human-friendly entity type name + sysid (fname, etc.)", "final", "StringBuilder", "importReport", "=", "new", "StringBuilder", "(", ")", ";", "/*\n         * Now import the identified entities each bucket in turn\n         */", "try", "{", "importQueue", "(", "tenant", ",", "importQueue", ",", "importReport", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "final", "TenantOperationResponse", "error", "=", "new", "TenantOperationResponse", "(", "this", ",", "TenantOperationResponse", ".", "Result", ".", "ABORT", ")", ";", "error", ".", "addMessage", "(", "finalizeImportReport", "(", "importReport", ")", ")", ";", "error", ".", "addMessage", "(", "createLocalizedMessage", "(", "FAILED_TO_IMPORT_TENANT_TEMPLATE_DATA", ",", "new", "String", "[", "]", "{", "tenant", ".", "getName", "(", ")", "}", ")", ")", ";", "return", "error", ";", "}", "TenantOperationResponse", "rslt", "=", "new", "TenantOperationResponse", "(", "this", ",", "TenantOperationResponse", ".", "Result", ".", "SUCCESS", ")", ";", "rslt", ".", "addMessage", "(", "finalizeImportReport", "(", "importReport", ")", ")", ";", "rslt", ".", "addMessage", "(", "createLocalizedMessage", "(", "TENANT_ENTITIES_IMPORTED", ",", "new", "String", "[", "]", "{", "tenant", ".", "getName", "(", ")", "}", ")", ")", ";", "return", "rslt", ";", "}"], "docstring": "High-level implementation method that brokers the queuing, importing, and reporting that is\ncommon to Create and Update.", "docstring_tokens": ["High", "-", "level", "implementation", "method", "that", "brokers", "the", "queuing", "importing", "and", "reporting", "that", "is", "common", "to", "Create", "and", "Update", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java#L319-L367", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java", "func_name": "TemplateDataTenantOperationsListener.prepareImportQueue", "original_string": "private Map<PortalDataKey, Set<BucketTuple>> prepareImportQueue(\n            final ITenant tenant, final Set<Resource> templates) throws Exception {\n        final Map<PortalDataKey, Set<BucketTuple>> rslt = new HashMap<>();\n        Resource rsc = null;\n        try {\n            for (Resource r : templates) {\n                rsc = r;\n                if (log.isDebugEnabled()) {\n                    log.debug(\n                            \"Loading template resource file for tenant \"\n                                    + \"'\"\n                                    + tenant.getFname()\n                                    + \"':  \"\n                                    + rsc.getFilename());\n                }\n                final Document doc = reader.read(rsc.getInputStream());\n                PortalDataKey atLeastOneMatchingDataKey = null;\n                for (PortalDataKey pdk : dataKeyImportOrder) {\n                    boolean matches = evaluatePortalDataKeyMatch(doc, pdk);\n                    if (matches) {\n                        // Found the right bucket...\n                        log.debug(\"Found PortalDataKey '{}' for data document {}\", pdk, r.getURI());\n                        atLeastOneMatchingDataKey = pdk;\n                        Set<BucketTuple> bucket = rslt.get(atLeastOneMatchingDataKey);\n                        if (bucket == null) {\n                            // First of these we've seen;  create the bucket;\n                            bucket = new HashSet<>();\n                            rslt.put(atLeastOneMatchingDataKey, bucket);\n                        }\n                        BucketTuple tuple = new BucketTuple(rsc, doc);\n                        bucket.add(tuple);\n                        /*\n                         * At this point, we would normally add a break;\n                         * statement, but group_membership.xml files need to\n                         * match more than one PortalDataKey.\n                         */\n                    }\n                }\n                if (atLeastOneMatchingDataKey == null) {\n                    // We can't proceed\n                    throw new RuntimeException(\n                            \"No PortalDataKey found for QName:  \"\n                                    + doc.getRootElement().getQName());\n                }\n            }\n        } catch (Exception e) {\n            log.error(\n                    \"Failed to process the specified template:  {}\",\n                    (rsc != null ? rsc.getFilename() : \"null\"),\n                    e);\n            throw e;\n        }\n        return rslt;\n    }", "language": "java", "code": "private Map<PortalDataKey, Set<BucketTuple>> prepareImportQueue(\n            final ITenant tenant, final Set<Resource> templates) throws Exception {\n        final Map<PortalDataKey, Set<BucketTuple>> rslt = new HashMap<>();\n        Resource rsc = null;\n        try {\n            for (Resource r : templates) {\n                rsc = r;\n                if (log.isDebugEnabled()) {\n                    log.debug(\n                            \"Loading template resource file for tenant \"\n                                    + \"'\"\n                                    + tenant.getFname()\n                                    + \"':  \"\n                                    + rsc.getFilename());\n                }\n                final Document doc = reader.read(rsc.getInputStream());\n                PortalDataKey atLeastOneMatchingDataKey = null;\n                for (PortalDataKey pdk : dataKeyImportOrder) {\n                    boolean matches = evaluatePortalDataKeyMatch(doc, pdk);\n                    if (matches) {\n                        // Found the right bucket...\n                        log.debug(\"Found PortalDataKey '{}' for data document {}\", pdk, r.getURI());\n                        atLeastOneMatchingDataKey = pdk;\n                        Set<BucketTuple> bucket = rslt.get(atLeastOneMatchingDataKey);\n                        if (bucket == null) {\n                            // First of these we've seen;  create the bucket;\n                            bucket = new HashSet<>();\n                            rslt.put(atLeastOneMatchingDataKey, bucket);\n                        }\n                        BucketTuple tuple = new BucketTuple(rsc, doc);\n                        bucket.add(tuple);\n                        /*\n                         * At this point, we would normally add a break;\n                         * statement, but group_membership.xml files need to\n                         * match more than one PortalDataKey.\n                         */\n                    }\n                }\n                if (atLeastOneMatchingDataKey == null) {\n                    // We can't proceed\n                    throw new RuntimeException(\n                            \"No PortalDataKey found for QName:  \"\n                                    + doc.getRootElement().getQName());\n                }\n            }\n        } catch (Exception e) {\n            log.error(\n                    \"Failed to process the specified template:  {}\",\n                    (rsc != null ? rsc.getFilename() : \"null\"),\n                    e);\n            throw e;\n        }\n        return rslt;\n    }", "code_tokens": ["private", "Map", "<", "PortalDataKey", ",", "Set", "<", "BucketTuple", ">", ">", "prepareImportQueue", "(", "final", "ITenant", "tenant", ",", "final", "Set", "<", "Resource", ">", "templates", ")", "throws", "Exception", "{", "final", "Map", "<", "PortalDataKey", ",", "Set", "<", "BucketTuple", ">", ">", "rslt", "=", "new", "HashMap", "<>", "(", ")", ";", "Resource", "rsc", "=", "null", ";", "try", "{", "for", "(", "Resource", "r", ":", "templates", ")", "{", "rsc", "=", "r", ";", "if", "(", "log", ".", "isDebugEnabled", "(", ")", ")", "{", "log", ".", "debug", "(", "\"Loading template resource file for tenant \"", "+", "\"'\"", "+", "tenant", ".", "getFname", "(", ")", "+", "\"':  \"", "+", "rsc", ".", "getFilename", "(", ")", ")", ";", "}", "final", "Document", "doc", "=", "reader", ".", "read", "(", "rsc", ".", "getInputStream", "(", ")", ")", ";", "PortalDataKey", "atLeastOneMatchingDataKey", "=", "null", ";", "for", "(", "PortalDataKey", "pdk", ":", "dataKeyImportOrder", ")", "{", "boolean", "matches", "=", "evaluatePortalDataKeyMatch", "(", "doc", ",", "pdk", ")", ";", "if", "(", "matches", ")", "{", "// Found the right bucket...", "log", ".", "debug", "(", "\"Found PortalDataKey '{}' for data document {}\"", ",", "pdk", ",", "r", ".", "getURI", "(", ")", ")", ";", "atLeastOneMatchingDataKey", "=", "pdk", ";", "Set", "<", "BucketTuple", ">", "bucket", "=", "rslt", ".", "get", "(", "atLeastOneMatchingDataKey", ")", ";", "if", "(", "bucket", "==", "null", ")", "{", "// First of these we've seen;  create the bucket;", "bucket", "=", "new", "HashSet", "<>", "(", ")", ";", "rslt", ".", "put", "(", "atLeastOneMatchingDataKey", ",", "bucket", ")", ";", "}", "BucketTuple", "tuple", "=", "new", "BucketTuple", "(", "rsc", ",", "doc", ")", ";", "bucket", ".", "add", "(", "tuple", ")", ";", "/*\n                         * At this point, we would normally add a break;\n                         * statement, but group_membership.xml files need to\n                         * match more than one PortalDataKey.\n                         */", "}", "}", "if", "(", "atLeastOneMatchingDataKey", "==", "null", ")", "{", "// We can't proceed", "throw", "new", "RuntimeException", "(", "\"No PortalDataKey found for QName:  \"", "+", "doc", ".", "getRootElement", "(", ")", ".", "getQName", "(", ")", ")", ";", "}", "}", "}", "catch", "(", "Exception", "e", ")", "{", "log", ".", "error", "(", "\"Failed to process the specified template:  {}\"", ",", "(", "rsc", "!=", "null", "?", "rsc", ".", "getFilename", "(", ")", ":", "\"null\"", ")", ",", "e", ")", ";", "throw", "e", ";", "}", "return", "rslt", ";", "}"], "docstring": "Loads dom4j Documents and sorts the entity files into the proper order for Import.", "docstring_tokens": ["Loads", "dom4j", "Documents", "and", "sorts", "the", "entity", "files", "into", "the", "proper", "order", "for", "Import", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java#L370-L423", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java", "func_name": "TemplateDataTenantOperationsListener.importQueue", "original_string": "private void importQueue(\n            final ITenant tenant,\n            final Map<PortalDataKey, Set<BucketTuple>> queue,\n            final StringBuilder importReport)\n            throws Exception {\n\n        final StandardEvaluationContext ctx = new StandardEvaluationContext();\n        ctx.setRootObject(new RootObjectImpl(tenant));\n        IDataTemplatingStrategy templating = new SpELDataTemplatingStrategy(portalSpELService, ctx);\n        Document doc = null;\n        try {\n            for (PortalDataKey pdk : dataKeyImportOrder) {\n                Set<BucketTuple> bucket = queue.get(pdk);\n                if (bucket != null) {\n                    log.debug(\n                            \"Importing the specified PortalDataKey tenant '{}':  {}\",\n                            tenant.getName(),\n                            pdk.getName());\n                    for (BucketTuple tuple : bucket) {\n                        doc = tuple.getDocument();\n                        Source data =\n                                templating.processTemplates(\n                                        doc, tuple.getResource().getURL().toString());\n                        dataHandlerService.importData(data, pdk);\n                        importReport.append(createImportReportLineItem(pdk, tuple));\n                    }\n                }\n            }\n\n        } catch (Exception e) {\n            log.error(\n                    \"Failed to process the specified template document:\\n{}\",\n                    (doc != null ? doc.asXML() : \"null\"),\n                    e);\n            throw e;\n        }\n    }", "language": "java", "code": "private void importQueue(\n            final ITenant tenant,\n            final Map<PortalDataKey, Set<BucketTuple>> queue,\n            final StringBuilder importReport)\n            throws Exception {\n\n        final StandardEvaluationContext ctx = new StandardEvaluationContext();\n        ctx.setRootObject(new RootObjectImpl(tenant));\n        IDataTemplatingStrategy templating = new SpELDataTemplatingStrategy(portalSpELService, ctx);\n        Document doc = null;\n        try {\n            for (PortalDataKey pdk : dataKeyImportOrder) {\n                Set<BucketTuple> bucket = queue.get(pdk);\n                if (bucket != null) {\n                    log.debug(\n                            \"Importing the specified PortalDataKey tenant '{}':  {}\",\n                            tenant.getName(),\n                            pdk.getName());\n                    for (BucketTuple tuple : bucket) {\n                        doc = tuple.getDocument();\n                        Source data =\n                                templating.processTemplates(\n                                        doc, tuple.getResource().getURL().toString());\n                        dataHandlerService.importData(data, pdk);\n                        importReport.append(createImportReportLineItem(pdk, tuple));\n                    }\n                }\n            }\n\n        } catch (Exception e) {\n            log.error(\n                    \"Failed to process the specified template document:\\n{}\",\n                    (doc != null ? doc.asXML() : \"null\"),\n                    e);\n            throw e;\n        }\n    }", "code_tokens": ["private", "void", "importQueue", "(", "final", "ITenant", "tenant", ",", "final", "Map", "<", "PortalDataKey", ",", "Set", "<", "BucketTuple", ">", ">", "queue", ",", "final", "StringBuilder", "importReport", ")", "throws", "Exception", "{", "final", "StandardEvaluationContext", "ctx", "=", "new", "StandardEvaluationContext", "(", ")", ";", "ctx", ".", "setRootObject", "(", "new", "RootObjectImpl", "(", "tenant", ")", ")", ";", "IDataTemplatingStrategy", "templating", "=", "new", "SpELDataTemplatingStrategy", "(", "portalSpELService", ",", "ctx", ")", ";", "Document", "doc", "=", "null", ";", "try", "{", "for", "(", "PortalDataKey", "pdk", ":", "dataKeyImportOrder", ")", "{", "Set", "<", "BucketTuple", ">", "bucket", "=", "queue", ".", "get", "(", "pdk", ")", ";", "if", "(", "bucket", "!=", "null", ")", "{", "log", ".", "debug", "(", "\"Importing the specified PortalDataKey tenant '{}':  {}\"", ",", "tenant", ".", "getName", "(", ")", ",", "pdk", ".", "getName", "(", ")", ")", ";", "for", "(", "BucketTuple", "tuple", ":", "bucket", ")", "{", "doc", "=", "tuple", ".", "getDocument", "(", ")", ";", "Source", "data", "=", "templating", ".", "processTemplates", "(", "doc", ",", "tuple", ".", "getResource", "(", ")", ".", "getURL", "(", ")", ".", "toString", "(", ")", ")", ";", "dataHandlerService", ".", "importData", "(", "data", ",", "pdk", ")", ";", "importReport", ".", "append", "(", "createImportReportLineItem", "(", "pdk", ",", "tuple", ")", ")", ";", "}", "}", "}", "}", "catch", "(", "Exception", "e", ")", "{", "log", ".", "error", "(", "\"Failed to process the specified template document:\\n{}\"", ",", "(", "doc", "!=", "null", "?", "doc", ".", "asXML", "(", ")", ":", "\"null\"", ")", ",", "e", ")", ";", "throw", "e", ";", "}", "}"], "docstring": "Imports the specified entities in the proper order.", "docstring_tokens": ["Imports", "the", "specified", "entities", "in", "the", "proper", "order", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java#L426-L462", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/PortletRenderingInitiationStAXComponent.java", "func_name": "PortletRenderingInitiationStAXComponent.getCacheKey", "original_string": "@Override\n    public CacheKey getCacheKey(HttpServletRequest request, HttpServletResponse response) {\n        // Initiating rendering of portlets will change the stream at all\n        return this.wrappedComponent.getCacheKey(request, response);\n    }", "language": "java", "code": "@Override\n    public CacheKey getCacheKey(HttpServletRequest request, HttpServletResponse response) {\n        // Initiating rendering of portlets will change the stream at all\n        return this.wrappedComponent.getCacheKey(request, response);\n    }", "code_tokens": ["@", "Override", "public", "CacheKey", "getCacheKey", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "// Initiating rendering of portlets will change the stream at all", "return", "this", ".", "wrappedComponent", ".", "getCacheKey", "(", "request", ",", "response", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.PipelineComponent#getCacheKey(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/PortletRenderingInitiationStAXComponent.java#L59-L63", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/PortletRenderingInitiationStAXComponent.java", "func_name": "PortletRenderingInitiationStAXComponent.getEventReader", "original_string": "@Override\n    public PipelineEventReader<XMLEventReader, XMLEvent> getEventReader(\n            HttpServletRequest request, HttpServletResponse response) {\n        final PipelineEventReader<XMLEventReader, XMLEvent> pipelineEventReader =\n                this.wrappedComponent.getEventReader(request, response);\n\n        final XMLEventReader eventReader = pipelineEventReader.getEventReader();\n        final PortletRenderingXMLEventReader filteredEventReader =\n                new PortletRenderingXMLEventReader(request, response, eventReader);\n\n        final Map<String, String> outputProperties = pipelineEventReader.getOutputProperties();\n        return new PipelineEventReaderImpl<XMLEventReader, XMLEvent>(\n                filteredEventReader, outputProperties);\n    }", "language": "java", "code": "@Override\n    public PipelineEventReader<XMLEventReader, XMLEvent> getEventReader(\n            HttpServletRequest request, HttpServletResponse response) {\n        final PipelineEventReader<XMLEventReader, XMLEvent> pipelineEventReader =\n                this.wrappedComponent.getEventReader(request, response);\n\n        final XMLEventReader eventReader = pipelineEventReader.getEventReader();\n        final PortletRenderingXMLEventReader filteredEventReader =\n                new PortletRenderingXMLEventReader(request, response, eventReader);\n\n        final Map<String, String> outputProperties = pipelineEventReader.getOutputProperties();\n        return new PipelineEventReaderImpl<XMLEventReader, XMLEvent>(\n                filteredEventReader, outputProperties);\n    }", "code_tokens": ["@", "Override", "public", "PipelineEventReader", "<", "XMLEventReader", ",", "XMLEvent", ">", "getEventReader", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "final", "PipelineEventReader", "<", "XMLEventReader", ",", "XMLEvent", ">", "pipelineEventReader", "=", "this", ".", "wrappedComponent", ".", "getEventReader", "(", "request", ",", "response", ")", ";", "final", "XMLEventReader", "eventReader", "=", "pipelineEventReader", ".", "getEventReader", "(", ")", ";", "final", "PortletRenderingXMLEventReader", "filteredEventReader", "=", "new", "PortletRenderingXMLEventReader", "(", "request", ",", "response", ",", "eventReader", ")", ";", "final", "Map", "<", "String", ",", "String", ">", "outputProperties", "=", "pipelineEventReader", ".", "getOutputProperties", "(", ")", ";", "return", "new", "PipelineEventReaderImpl", "<", "XMLEventReader", ",", "XMLEvent", ">", "(", "filteredEventReader", ",", "outputProperties", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.PipelineComponent#getEventReader(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/PortletRenderingInitiationStAXComponent.java#L68-L81", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-xslt/src/main/java/org/apereo/portal/security/xslt/XalanLayoutElementTitleHelper.java", "func_name": "XalanLayoutElementTitleHelper.getTitle", "original_string": "public static String getTitle(String id, String language, String name) {\n        if (id != null && id.startsWith(Constants.FRAGMENT_ID_USER_PREFIX)) {\n            final Locale locale = localeManagerFactory.parseLocale(language);\n            return messageSource.getMessage(name, new Object[] {}, name, locale);\n        }\n        return name;\n    }", "language": "java", "code": "public static String getTitle(String id, String language, String name) {\n        if (id != null && id.startsWith(Constants.FRAGMENT_ID_USER_PREFIX)) {\n            final Locale locale = localeManagerFactory.parseLocale(language);\n            return messageSource.getMessage(name, new Object[] {}, name, locale);\n        }\n        return name;\n    }", "code_tokens": ["public", "static", "String", "getTitle", "(", "String", "id", ",", "String", "language", ",", "String", "name", ")", "{", "if", "(", "id", "!=", "null", "&&", "id", ".", "startsWith", "(", "Constants", ".", "FRAGMENT_ID_USER_PREFIX", ")", ")", "{", "final", "Locale", "locale", "=", "localeManagerFactory", ".", "parseLocale", "(", "language", ")", ";", "return", "messageSource", ".", "getMessage", "(", "name", ",", "new", "Object", "[", "]", "{", "}", ",", "name", ",", "locale", ")", ";", "}", "return", "name", ";", "}"], "docstring": "This method checks whether id indicates that it is a layout owner's structure element (or at\nleast derived from it). If it is the case, then it asks {@link MessageSource} to resolve the\nmessage using layout element's name. Otherwise it returns the name. Note that layout owner's\nelement identifier format is 'uXlYnZ' where X stands for layout owners id, Y stands for\nlayout id, and Z stands for element (node) identifier, hence identifiers that start with 'u'\nare considered as derived from layout owner.\n\n@param id - layout structure element's identifier.\n@param language - locale identifier.\n@param name - default layout strucute element's name.\n@return localized title in case of layout owner's element or default name otherwise.", "docstring_tokens": ["This", "method", "checks", "whether", "id", "indicates", "that", "it", "is", "a", "layout", "owner", "s", "structure", "element", "(", "or", "at", "least", "derived", "from", "it", ")", ".", "If", "it", "is", "the", "case", "then", "it", "asks", "{", "@link", "MessageSource", "}", "to", "resolve", "the", "message", "using", "layout", "element", "s", "name", ".", "Otherwise", "it", "returns", "the", "name", ".", "Note", "that", "layout", "owner", "s", "element", "identifier", "format", "is", "uXlYnZ", "where", "X", "stands", "for", "layout", "owners", "id", "Y", "stands", "for", "layout", "id", "and", "Z", "stands", "for", "element", "(", "node", ")", "identifier", "hence", "identifiers", "that", "start", "with", "u", "are", "considered", "as", "derived", "from", "layout", "owner", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-xslt/src/main/java/org/apereo/portal/security/xslt/XalanLayoutElementTitleHelper.java#L57-L63", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-core/src/main/java/org/apereo/portal/security/ThreadNamingRequestFilter.java", "func_name": "ThreadNamingRequestFilter.updateCurrentUsername", "original_string": "public void updateCurrentUsername(String newUsername) {\n        final String originalThreadName = originalThreadNameLocal.get();\n        if (originalThreadName != null && newUsername != null) {\n            final Thread currentThread = Thread.currentThread();\n            final String threadName = getThreadName(originalThreadName, newUsername);\n            currentThread.setName(threadName);\n        }\n    }", "language": "java", "code": "public void updateCurrentUsername(String newUsername) {\n        final String originalThreadName = originalThreadNameLocal.get();\n        if (originalThreadName != null && newUsername != null) {\n            final Thread currentThread = Thread.currentThread();\n            final String threadName = getThreadName(originalThreadName, newUsername);\n            currentThread.setName(threadName);\n        }\n    }", "code_tokens": ["public", "void", "updateCurrentUsername", "(", "String", "newUsername", ")", "{", "final", "String", "originalThreadName", "=", "originalThreadNameLocal", ".", "get", "(", ")", ";", "if", "(", "originalThreadName", "!=", "null", "&&", "newUsername", "!=", "null", ")", "{", "final", "Thread", "currentThread", "=", "Thread", ".", "currentThread", "(", ")", ";", "final", "String", "threadName", "=", "getThreadName", "(", "originalThreadName", ",", "newUsername", ")", ";", "currentThread", ".", "setName", "(", "threadName", ")", ";", "}", "}"], "docstring": "Update the thread name to use the specified username. Useful for authentication requests\nwhere the username changes mid-request", "docstring_tokens": ["Update", "the", "thread", "name", "to", "use", "the", "specified", "username", ".", "Useful", "for", "authentication", "requests", "where", "the", "username", "changes", "mid", "-", "request"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-core/src/main/java/org/apereo/portal/security/ThreadNamingRequestFilter.java#L41-L48", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-platform-impl/src/main/java/org/apereo/portal/api/groups/EntityService.java", "func_name": "EntityService.search", "original_string": "public Set<Entity> search(String entityType, String searchTerm) {\n        if (StringUtils.isBlank(entityType) && StringUtils.isBlank(searchTerm)) {\n            return null;\n        }\n        Set<Entity> results = new HashSet<Entity>();\n        EntityEnum entityEnum = EntityEnum.getEntityEnum(entityType);\n        EntityIdentifier[] identifiers;\n        Class<?> identifierType;\n\n        // if the entity type is a group, use the group service's findGroup method\n        // to locate it\n        if (entityEnum.isGroup()) {\n            identifiers =\n                    GroupService.searchForGroups(\n                            searchTerm,\n                            GroupService.SearchMethod.CONTAINS_CI,\n                            entityEnum.getClazz());\n            identifierType = IEntityGroup.class;\n        }\n        // otherwise use the getGroupMember method\n        else {\n            identifiers =\n                    GroupService.searchForEntities(\n                            searchTerm,\n                            GroupService.SearchMethod.CONTAINS_CI,\n                            entityEnum.getClazz());\n            identifierType = entityEnum.getClazz();\n        }\n\n        for (EntityIdentifier entityIdentifier : identifiers) {\n            if (entityIdentifier.getType().equals(identifierType)) {\n                IGroupMember groupMember = GroupService.getGroupMember(entityIdentifier);\n                Entity entity = getEntity(groupMember);\n                results.add(entity);\n            }\n        }\n\n        return results;\n    }", "language": "java", "code": "public Set<Entity> search(String entityType, String searchTerm) {\n        if (StringUtils.isBlank(entityType) && StringUtils.isBlank(searchTerm)) {\n            return null;\n        }\n        Set<Entity> results = new HashSet<Entity>();\n        EntityEnum entityEnum = EntityEnum.getEntityEnum(entityType);\n        EntityIdentifier[] identifiers;\n        Class<?> identifierType;\n\n        // if the entity type is a group, use the group service's findGroup method\n        // to locate it\n        if (entityEnum.isGroup()) {\n            identifiers =\n                    GroupService.searchForGroups(\n                            searchTerm,\n                            GroupService.SearchMethod.CONTAINS_CI,\n                            entityEnum.getClazz());\n            identifierType = IEntityGroup.class;\n        }\n        // otherwise use the getGroupMember method\n        else {\n            identifiers =\n                    GroupService.searchForEntities(\n                            searchTerm,\n                            GroupService.SearchMethod.CONTAINS_CI,\n                            entityEnum.getClazz());\n            identifierType = entityEnum.getClazz();\n        }\n\n        for (EntityIdentifier entityIdentifier : identifiers) {\n            if (entityIdentifier.getType().equals(identifierType)) {\n                IGroupMember groupMember = GroupService.getGroupMember(entityIdentifier);\n                Entity entity = getEntity(groupMember);\n                results.add(entity);\n            }\n        }\n\n        return results;\n    }", "code_tokens": ["public", "Set", "<", "Entity", ">", "search", "(", "String", "entityType", ",", "String", "searchTerm", ")", "{", "if", "(", "StringUtils", ".", "isBlank", "(", "entityType", ")", "&&", "StringUtils", ".", "isBlank", "(", "searchTerm", ")", ")", "{", "return", "null", ";", "}", "Set", "<", "Entity", ">", "results", "=", "new", "HashSet", "<", "Entity", ">", "(", ")", ";", "EntityEnum", "entityEnum", "=", "EntityEnum", ".", "getEntityEnum", "(", "entityType", ")", ";", "EntityIdentifier", "[", "]", "identifiers", ";", "Class", "<", "?", ">", "identifierType", ";", "// if the entity type is a group, use the group service's findGroup method", "// to locate it", "if", "(", "entityEnum", ".", "isGroup", "(", ")", ")", "{", "identifiers", "=", "GroupService", ".", "searchForGroups", "(", "searchTerm", ",", "GroupService", ".", "SearchMethod", ".", "CONTAINS_CI", ",", "entityEnum", ".", "getClazz", "(", ")", ")", ";", "identifierType", "=", "IEntityGroup", ".", "class", ";", "}", "// otherwise use the getGroupMember method", "else", "{", "identifiers", "=", "GroupService", ".", "searchForEntities", "(", "searchTerm", ",", "GroupService", ".", "SearchMethod", ".", "CONTAINS_CI", ",", "entityEnum", ".", "getClazz", "(", ")", ")", ";", "identifierType", "=", "entityEnum", ".", "getClazz", "(", ")", ";", "}", "for", "(", "EntityIdentifier", "entityIdentifier", ":", "identifiers", ")", "{", "if", "(", "entityIdentifier", ".", "getType", "(", ")", ".", "equals", "(", "identifierType", ")", ")", "{", "IGroupMember", "groupMember", "=", "GroupService", ".", "getGroupMember", "(", "entityIdentifier", ")", ";", "Entity", "entity", "=", "getEntity", "(", "groupMember", ")", ";", "results", ".", "add", "(", "entity", ")", ";", "}", "}", "return", "results", ";", "}"], "docstring": "External search, thus case insensitive.", "docstring_tokens": ["External", "search", "thus", "case", "insensitive", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-platform-impl/src/main/java/org/apereo/portal/api/groups/EntityService.java#L52-L90", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-platform-impl/src/main/java/org/apereo/portal/api/groups/EntityService.java", "func_name": "EntityService.lookupEntityName", "original_string": "public String lookupEntityName(Entity entity) {\n        if (entity == null) {\n            return null;\n        }\n        EntityEnum entityEnum = EntityEnum.getEntityEnum(entity.getEntityType());\n        return lookupEntityName(entityEnum, entity.getId());\n    }", "language": "java", "code": "public String lookupEntityName(Entity entity) {\n        if (entity == null) {\n            return null;\n        }\n        EntityEnum entityEnum = EntityEnum.getEntityEnum(entity.getEntityType());\n        return lookupEntityName(entityEnum, entity.getId());\n    }", "code_tokens": ["public", "String", "lookupEntityName", "(", "Entity", "entity", ")", "{", "if", "(", "entity", "==", "null", ")", "{", "return", "null", ";", "}", "EntityEnum", "entityEnum", "=", "EntityEnum", ".", "getEntityEnum", "(", "entity", ".", "getEntityType", "(", ")", ")", ";", "return", "lookupEntityName", "(", "entityEnum", ",", "entity", ".", "getId", "(", ")", ")", ";", "}"], "docstring": "Convenience method that looks up the name of the given group member. Used for person types.\n\n@param entity Entity to look up\n@return groupMember's name or null if there's an error", "docstring_tokens": ["Convenience", "method", "that", "looks", "up", "the", "name", "of", "the", "given", "group", "member", ".", "Used", "for", "person", "types", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-platform-impl/src/main/java/org/apereo/portal/api/groups/EntityService.java#L205-L211", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-spring/src/main/java/org/apereo/portal/spring/security/evaluator/PortalPermissionEvaluator.java", "func_name": "PortalPermissionEvaluator.getAuthorizationPrincipal", "original_string": "private IAuthorizationPrincipal getAuthorizationPrincipal(Authentication authentication) {\n\n        final Object authPrincipal = authentication.getPrincipal();\n        logger.trace(\"getAuthorizationPrincipal -- authPrincipal=[{}]\", authPrincipal);\n\n        String username;\n        if (authPrincipal instanceof UserDetails) {\n            // User is authenticated\n            UserDetails userDetails = (UserDetails) authPrincipal;\n            logger.trace(\n                    \"getAuthorizationPrincipal -- AUTHENTICATED, userDetails=[{}]\", userDetails);\n            username = userDetails.getUsername();\n        } else {\n            // Which guest user are we?\n            final HttpServletRequest req = portalRequestUtils.getCurrentPortalRequest();\n            final IPerson person = personManager.getPerson(req);\n            logger.trace(\"getAuthorizationPrincipal -- UNAUTHENTICATED, person=[{}]\", person);\n            username = person.getUserName();\n        }\n\n        return authorizationServiceFacade.newPrincipal(username, IPerson.class);\n    }", "language": "java", "code": "private IAuthorizationPrincipal getAuthorizationPrincipal(Authentication authentication) {\n\n        final Object authPrincipal = authentication.getPrincipal();\n        logger.trace(\"getAuthorizationPrincipal -- authPrincipal=[{}]\", authPrincipal);\n\n        String username;\n        if (authPrincipal instanceof UserDetails) {\n            // User is authenticated\n            UserDetails userDetails = (UserDetails) authPrincipal;\n            logger.trace(\n                    \"getAuthorizationPrincipal -- AUTHENTICATED, userDetails=[{}]\", userDetails);\n            username = userDetails.getUsername();\n        } else {\n            // Which guest user are we?\n            final HttpServletRequest req = portalRequestUtils.getCurrentPortalRequest();\n            final IPerson person = personManager.getPerson(req);\n            logger.trace(\"getAuthorizationPrincipal -- UNAUTHENTICATED, person=[{}]\", person);\n            username = person.getUserName();\n        }\n\n        return authorizationServiceFacade.newPrincipal(username, IPerson.class);\n    }", "code_tokens": ["private", "IAuthorizationPrincipal", "getAuthorizationPrincipal", "(", "Authentication", "authentication", ")", "{", "final", "Object", "authPrincipal", "=", "authentication", ".", "getPrincipal", "(", ")", ";", "logger", ".", "trace", "(", "\"getAuthorizationPrincipal -- authPrincipal=[{}]\"", ",", "authPrincipal", ")", ";", "String", "username", ";", "if", "(", "authPrincipal", "instanceof", "UserDetails", ")", "{", "// User is authenticated", "UserDetails", "userDetails", "=", "(", "UserDetails", ")", "authPrincipal", ";", "logger", ".", "trace", "(", "\"getAuthorizationPrincipal -- AUTHENTICATED, userDetails=[{}]\"", ",", "userDetails", ")", ";", "username", "=", "userDetails", ".", "getUsername", "(", ")", ";", "}", "else", "{", "// Which guest user are we?", "final", "HttpServletRequest", "req", "=", "portalRequestUtils", ".", "getCurrentPortalRequest", "(", ")", ";", "final", "IPerson", "person", "=", "personManager", ".", "getPerson", "(", "req", ")", ";", "logger", ".", "trace", "(", "\"getAuthorizationPrincipal -- UNAUTHENTICATED, person=[{}]\"", ",", "person", ")", ";", "username", "=", "person", ".", "getUserName", "(", ")", ";", "}", "return", "authorizationServiceFacade", ".", "newPrincipal", "(", "username", ",", "IPerson", ".", "class", ")", ";", "}"], "docstring": "Prepare a uPortal IAuthorizationPrincipal based in the Spring principal", "docstring_tokens": ["Prepare", "a", "uPortal", "IAuthorizationPrincipal", "based", "in", "the", "Spring", "principal"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-spring/src/main/java/org/apereo/portal/spring/security/evaluator/PortalPermissionEvaluator.java#L153-L174", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/StylesheetUserPreferencesImpl.java", "func_name": "StylesheetUserPreferencesImpl.removeLayoutAttribute", "original_string": "@Override\n    public String removeLayoutAttribute(String nodeId, String name) {\n        Validate.notEmpty(nodeId, \"nodeId cannot be null\");\n        Validate.notEmpty(name, \"name cannot be null\");\n\n        final Map<String, String> nodeAttributes = this.layoutAttributes.get(nodeId);\n        if (nodeAttributes == null) {\n            return null;\n        }\n\n        return nodeAttributes.remove(name);\n    }", "language": "java", "code": "@Override\n    public String removeLayoutAttribute(String nodeId, String name) {\n        Validate.notEmpty(nodeId, \"nodeId cannot be null\");\n        Validate.notEmpty(name, \"name cannot be null\");\n\n        final Map<String, String> nodeAttributes = this.layoutAttributes.get(nodeId);\n        if (nodeAttributes == null) {\n            return null;\n        }\n\n        return nodeAttributes.remove(name);\n    }", "code_tokens": ["@", "Override", "public", "String", "removeLayoutAttribute", "(", "String", "nodeId", ",", "String", "name", ")", "{", "Validate", ".", "notEmpty", "(", "nodeId", ",", "\"nodeId cannot be null\"", ")", ";", "Validate", ".", "notEmpty", "(", "name", ",", "\"name cannot be null\"", ")", ";", "final", "Map", "<", "String", ",", "String", ">", "nodeAttributes", "=", "this", ".", "layoutAttributes", ".", "get", "(", "nodeId", ")", ";", "if", "(", "nodeAttributes", "==", "null", ")", "{", "return", "null", ";", "}", "return", "nodeAttributes", ".", "remove", "(", "name", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.layout.om.IStylesheetUserPreferences#removeLayoutAttribute(java.lang.String, java.lang.String)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/StylesheetUserPreferencesImpl.java#L122-L133", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-events/src/main/java/org/apereo/portal/events/aggr/BaseAggregationImpl.java", "func_name": "BaseAggregationImpl.setDuration", "original_string": "public final void setDuration(int duration) {\n        if (isComplete()) {\n            this.getLogger()\n                    .warn(\n                            \"{} is already closed, the new duration of {} will be ignored on: {}\",\n                            this.getClass().getSimpleName(),\n                            duration,\n                            this);\n            return;\n        }\n        this.duration = duration;\n    }", "language": "java", "code": "public final void setDuration(int duration) {\n        if (isComplete()) {\n            this.getLogger()\n                    .warn(\n                            \"{} is already closed, the new duration of {} will be ignored on: {}\",\n                            this.getClass().getSimpleName(),\n                            duration,\n                            this);\n            return;\n        }\n        this.duration = duration;\n    }", "code_tokens": ["public", "final", "void", "setDuration", "(", "int", "duration", ")", "{", "if", "(", "isComplete", "(", ")", ")", "{", "this", ".", "getLogger", "(", ")", ".", "warn", "(", "\"{} is already closed, the new duration of {} will be ignored on: {}\"", ",", "this", ".", "getClass", "(", ")", ".", "getSimpleName", "(", ")", ",", "duration", ",", "this", ")", ";", "return", ";", "}", "this", ".", "duration", "=", "duration", ";", "}"], "docstring": "Set the duration of the interval", "docstring_tokens": ["Set", "the", "duration", "of", "the", "interval"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-events/src/main/java/org/apereo/portal/events/aggr/BaseAggregationImpl.java#L133-L144", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/XsltDataUpgrader.java", "func_name": "XsltDataUpgrader.upgradeData", "original_string": "@Override\n    public boolean upgradeData(Source source, Result result) {\n        final Transformer transformer;\n        try {\n            transformer = this.upgradeTemplates.newTransformer();\n        } catch (TransformerConfigurationException e) {\n            throw new RuntimeException(\n                    \"Failed to create new Transformer from the configured templates: \"\n                            + this.xslResource,\n                    e);\n        }\n\n        try {\n            transformer.transform(source, result);\n        } catch (TransformerException e) {\n            throw new RuntimeException(\n                    \"Failed to upgrade data using XSLT transformation: \" + this.xslResource, e);\n        }\n\n        return true;\n    }", "language": "java", "code": "@Override\n    public boolean upgradeData(Source source, Result result) {\n        final Transformer transformer;\n        try {\n            transformer = this.upgradeTemplates.newTransformer();\n        } catch (TransformerConfigurationException e) {\n            throw new RuntimeException(\n                    \"Failed to create new Transformer from the configured templates: \"\n                            + this.xslResource,\n                    e);\n        }\n\n        try {\n            transformer.transform(source, result);\n        } catch (TransformerException e) {\n            throw new RuntimeException(\n                    \"Failed to upgrade data using XSLT transformation: \" + this.xslResource, e);\n        }\n\n        return true;\n    }", "code_tokens": ["@", "Override", "public", "boolean", "upgradeData", "(", "Source", "source", ",", "Result", "result", ")", "{", "final", "Transformer", "transformer", ";", "try", "{", "transformer", "=", "this", ".", "upgradeTemplates", ".", "newTransformer", "(", ")", ";", "}", "catch", "(", "TransformerConfigurationException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Failed to create new Transformer from the configured templates: \"", "+", "this", ".", "xslResource", ",", "e", ")", ";", "}", "try", "{", "transformer", ".", "transform", "(", "source", ",", "result", ")", ";", "}", "catch", "(", "TransformerException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Failed to upgrade data using XSLT transformation: \"", "+", "this", ".", "xslResource", ",", "e", ")", ";", "}", "return", "true", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.io.xml.IDataUpgrader#upgradeData(javax.xml.transform.Source, javax.xml.transform.Result)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/XsltDataUpgrader.java#L72-L92", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-web/src/main/java/org/apereo/portal/portlet/delegation/jsp/ParamTag.java", "func_name": "ParamTag.doStartTag", "original_string": "@Override\n    public int doStartTag() throws JspException {\n        final ParameterizableTag parameterizableTag =\n                (ParameterizableTag)\n                        TagSupport.findAncestorWithClass(this, ParameterizableTag.class);\n\n        if (parameterizableTag == null) {\n            throw new JspException(\n                    \"the 'param' Tag must have a parent tag that implements ParameterizableTag\");\n        }\n\n        if (this.name != null) {\n            parameterizableTag.addParameter(this.name, this.value);\n        }\n\n        return SKIP_BODY;\n    }", "language": "java", "code": "@Override\n    public int doStartTag() throws JspException {\n        final ParameterizableTag parameterizableTag =\n                (ParameterizableTag)\n                        TagSupport.findAncestorWithClass(this, ParameterizableTag.class);\n\n        if (parameterizableTag == null) {\n            throw new JspException(\n                    \"the 'param' Tag must have a parent tag that implements ParameterizableTag\");\n        }\n\n        if (this.name != null) {\n            parameterizableTag.addParameter(this.name, this.value);\n        }\n\n        return SKIP_BODY;\n    }", "code_tokens": ["@", "Override", "public", "int", "doStartTag", "(", ")", "throws", "JspException", "{", "final", "ParameterizableTag", "parameterizableTag", "=", "(", "ParameterizableTag", ")", "TagSupport", ".", "findAncestorWithClass", "(", "this", ",", "ParameterizableTag", ".", "class", ")", ";", "if", "(", "parameterizableTag", "==", "null", ")", "{", "throw", "new", "JspException", "(", "\"the 'param' Tag must have a parent tag that implements ParameterizableTag\"", ")", ";", "}", "if", "(", "this", ".", "name", "!=", "null", ")", "{", "parameterizableTag", ".", "addParameter", "(", "this", ".", "name", ",", "this", ".", "value", ")", ";", "}", "return", "SKIP_BODY", ";", "}"], "docstring": "Processes the <CODE>param</CODE> tag.\n\n@return <CODE>SKIP_BODY</CODE>", "docstring_tokens": ["Processes", "the", "<CODE", ">", "param<", "/", "CODE", ">", "tag", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-web/src/main/java/org/apereo/portal/portlet/delegation/jsp/ParamTag.java#L32-L48", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java", "func_name": "GrouperEntityGroupStore.contains", "original_string": "@Override\n    public boolean contains(IEntityGroup group, IGroupMember member) throws GroupsException {\n\n        String groupContainerName = group.getLocalKey();\n        String groupMemberName = member.getKey();\n\n        if (!validKey(groupContainerName) || !validKey(groupMemberName)) {\n            return false;\n        }\n\n        GcHasMember gcHasMember = new GcHasMember();\n        gcHasMember.assignGroupName(groupContainerName);\n        gcHasMember.addSubjectLookup(new WsSubjectLookup(null, \"g:gsa\", groupMemberName));\n        WsHasMemberResults wsHasMemberResults = gcHasMember.execute();\n        if (GrouperClientUtils.length(wsHasMemberResults.getResults()) == 1) {\n            WsHasMemberResult wsHasMemberResult = wsHasMemberResults.getResults()[0];\n            return StringUtils.equals(\n                    \"IS_MEMBER\", wsHasMemberResult.getResultMetadata().getResultCode());\n        }\n        return false;\n    }", "language": "java", "code": "@Override\n    public boolean contains(IEntityGroup group, IGroupMember member) throws GroupsException {\n\n        String groupContainerName = group.getLocalKey();\n        String groupMemberName = member.getKey();\n\n        if (!validKey(groupContainerName) || !validKey(groupMemberName)) {\n            return false;\n        }\n\n        GcHasMember gcHasMember = new GcHasMember();\n        gcHasMember.assignGroupName(groupContainerName);\n        gcHasMember.addSubjectLookup(new WsSubjectLookup(null, \"g:gsa\", groupMemberName));\n        WsHasMemberResults wsHasMemberResults = gcHasMember.execute();\n        if (GrouperClientUtils.length(wsHasMemberResults.getResults()) == 1) {\n            WsHasMemberResult wsHasMemberResult = wsHasMemberResults.getResults()[0];\n            return StringUtils.equals(\n                    \"IS_MEMBER\", wsHasMemberResult.getResultMetadata().getResultCode());\n        }\n        return false;\n    }", "code_tokens": ["@", "Override", "public", "boolean", "contains", "(", "IEntityGroup", "group", ",", "IGroupMember", "member", ")", "throws", "GroupsException", "{", "String", "groupContainerName", "=", "group", ".", "getLocalKey", "(", ")", ";", "String", "groupMemberName", "=", "member", ".", "getKey", "(", ")", ";", "if", "(", "!", "validKey", "(", "groupContainerName", ")", "||", "!", "validKey", "(", "groupMemberName", ")", ")", "{", "return", "false", ";", "}", "GcHasMember", "gcHasMember", "=", "new", "GcHasMember", "(", ")", ";", "gcHasMember", ".", "assignGroupName", "(", "groupContainerName", ")", ";", "gcHasMember", ".", "addSubjectLookup", "(", "new", "WsSubjectLookup", "(", "null", ",", "\"g:gsa\"", ",", "groupMemberName", ")", ")", ";", "WsHasMemberResults", "wsHasMemberResults", "=", "gcHasMember", ".", "execute", "(", ")", ";", "if", "(", "GrouperClientUtils", ".", "length", "(", "wsHasMemberResults", ".", "getResults", "(", ")", ")", "==", "1", ")", "{", "WsHasMemberResult", "wsHasMemberResult", "=", "wsHasMemberResults", ".", "getResults", "(", ")", "[", "0", "]", ";", "return", "StringUtils", ".", "equals", "(", "\"IS_MEMBER\"", ",", "wsHasMemberResult", ".", "getResultMetadata", "(", ")", ".", "getResultCode", "(", ")", ")", ";", "}", "return", "false", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.groups.IEntityGroupStore#contains(org.apereo.portal.groups.IEntityGroup, org.apereo.portal.groups.IGroupMember)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java#L88-L108", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java", "func_name": "GrouperEntityGroupStore.find", "original_string": "@Override\n    public IEntityGroup find(String key) throws GroupsException {\n\n        try {\n\n            // Search the Grouper server for groups with the specified local\n            // key\n            if (LOGGER.isDebugEnabled()) {\n                LOGGER.debug(\"Searching Grouper for a direct match for key: \" + key);\n            }\n            WsGroup wsGroup = findGroupFromKey(key);\n            if (wsGroup == null) {\n                return null;\n            }\n            IEntityGroup group = createUportalGroupFromGrouperGroup(wsGroup);\n\n            if (LOGGER.isDebugEnabled()) {\n                LOGGER.debug(\n                        \"Retrieved group from the Grouper server matching key \"\n                                + key\n                                + \": \"\n                                + group.toString());\n            }\n\n            // return the group\n            return group;\n\n        } catch (Exception e) {\n            LOGGER.warn(\n                    \"Exception while attempting to retrieve \"\n                            + \"group with key \"\n                            + key\n                            + \" from Grouper web services: \"\n                            + e.getMessage());\n            return null;\n        }\n    }", "language": "java", "code": "@Override\n    public IEntityGroup find(String key) throws GroupsException {\n\n        try {\n\n            // Search the Grouper server for groups with the specified local\n            // key\n            if (LOGGER.isDebugEnabled()) {\n                LOGGER.debug(\"Searching Grouper for a direct match for key: \" + key);\n            }\n            WsGroup wsGroup = findGroupFromKey(key);\n            if (wsGroup == null) {\n                return null;\n            }\n            IEntityGroup group = createUportalGroupFromGrouperGroup(wsGroup);\n\n            if (LOGGER.isDebugEnabled()) {\n                LOGGER.debug(\n                        \"Retrieved group from the Grouper server matching key \"\n                                + key\n                                + \": \"\n                                + group.toString());\n            }\n\n            // return the group\n            return group;\n\n        } catch (Exception e) {\n            LOGGER.warn(\n                    \"Exception while attempting to retrieve \"\n                            + \"group with key \"\n                            + key\n                            + \" from Grouper web services: \"\n                            + e.getMessage());\n            return null;\n        }\n    }", "code_tokens": ["@", "Override", "public", "IEntityGroup", "find", "(", "String", "key", ")", "throws", "GroupsException", "{", "try", "{", "// Search the Grouper server for groups with the specified local", "// key", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"Searching Grouper for a direct match for key: \"", "+", "key", ")", ";", "}", "WsGroup", "wsGroup", "=", "findGroupFromKey", "(", "key", ")", ";", "if", "(", "wsGroup", "==", "null", ")", "{", "return", "null", ";", "}", "IEntityGroup", "group", "=", "createUportalGroupFromGrouperGroup", "(", "wsGroup", ")", ";", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"Retrieved group from the Grouper server matching key \"", "+", "key", "+", "\": \"", "+", "group", ".", "toString", "(", ")", ")", ";", "}", "// return the group", "return", "group", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOGGER", ".", "warn", "(", "\"Exception while attempting to retrieve \"", "+", "\"group with key \"", "+", "key", "+", "\" from Grouper web services: \"", "+", "e", ".", "getMessage", "(", ")", ")", ";", "return", "null", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.groups.IEntityGroupStore#find(java.lang.String)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java#L113-L149", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java", "func_name": "GrouperEntityGroupStore.findParentGroups", "original_string": "@Override\n    @SuppressWarnings(\"unchecked\")\n    public Iterator findParentGroups(IGroupMember gm) throws GroupsException {\n\n        final List<IEntityGroup> parents = new LinkedList<IEntityGroup>();\n\n        GcGetGroups getGroups = new GcGetGroups();\n\n        String uportalStem = getStemPrefix();\n\n        // if only searching in a specific stem\n        if (!StringUtils.isBlank(uportalStem)) {\n            getGroups.assignStemScope(StemScope.ALL_IN_SUBTREE);\n            getGroups.assignWsStemLookup(new WsStemLookup(uportalStem, null));\n        }\n\n        String key = null;\n        String subjectSourceId = null;\n        if (gm.isGroup()) {\n\n            key = ((IEntityGroup) gm).getLocalKey();\n\n            if (!validKey(key)) {\n                return parents.iterator();\n            }\n            subjectSourceId = \"g:gsa\";\n        } else {\n\n            // Determine the key to use for this entity. If the entity is a\n            // group, we should use the group's local key (excluding the\n            // \"grouper.\" portion of the full key. If the entity is not a\n            // group type, just use the key.\n            key = gm.getKey();\n        }\n        getGroups.addSubjectLookup(new WsSubjectLookup(null, subjectSourceId, key));\n\n        if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"Searching Grouper for parent groups of the entity with key: \" + key);\n        }\n\n        try {\n\n            WsGetGroupsResults results = getGroups.execute();\n\n            if (results == null\n                    || results.getResults() == null\n                    || results.getResults().length != 1) {\n                LOGGER.debug(\"Grouper service returned no matches for key \" + key);\n                return parents.iterator();\n            }\n            WsGetGroupsResult wsg = results.getResults()[0];\n            if (wsg.getWsGroups() != null) {\n                for (WsGroup g : wsg.getWsGroups()) {\n                    if (LOGGER.isDebugEnabled()) {\n                        LOGGER.trace(\"Retrieved group: \" + g.getName());\n                    }\n                    IEntityGroup parent = createUportalGroupFromGrouperGroup(g);\n                    parents.add(parent);\n                }\n            }\n\n            if (LOGGER.isDebugEnabled()) {\n                LOGGER.debug(\n                        \"Retrieved \" + parents.size() + \" parent groups of entity with key \" + key);\n            }\n\n        } catch (Exception e) {\n            LOGGER.warn(\n                    \"Exception while attempting to retrieve \"\n                            + \"parents for entity with key \"\n                            + key\n                            + \" from Grouper web services: \"\n                            + e.getMessage());\n            return Collections.<IEntityGroup>emptyList().iterator();\n        }\n\n        return parents.iterator();\n    }", "language": "java", "code": "@Override\n    @SuppressWarnings(\"unchecked\")\n    public Iterator findParentGroups(IGroupMember gm) throws GroupsException {\n\n        final List<IEntityGroup> parents = new LinkedList<IEntityGroup>();\n\n        GcGetGroups getGroups = new GcGetGroups();\n\n        String uportalStem = getStemPrefix();\n\n        // if only searching in a specific stem\n        if (!StringUtils.isBlank(uportalStem)) {\n            getGroups.assignStemScope(StemScope.ALL_IN_SUBTREE);\n            getGroups.assignWsStemLookup(new WsStemLookup(uportalStem, null));\n        }\n\n        String key = null;\n        String subjectSourceId = null;\n        if (gm.isGroup()) {\n\n            key = ((IEntityGroup) gm).getLocalKey();\n\n            if (!validKey(key)) {\n                return parents.iterator();\n            }\n            subjectSourceId = \"g:gsa\";\n        } else {\n\n            // Determine the key to use for this entity. If the entity is a\n            // group, we should use the group's local key (excluding the\n            // \"grouper.\" portion of the full key. If the entity is not a\n            // group type, just use the key.\n            key = gm.getKey();\n        }\n        getGroups.addSubjectLookup(new WsSubjectLookup(null, subjectSourceId, key));\n\n        if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"Searching Grouper for parent groups of the entity with key: \" + key);\n        }\n\n        try {\n\n            WsGetGroupsResults results = getGroups.execute();\n\n            if (results == null\n                    || results.getResults() == null\n                    || results.getResults().length != 1) {\n                LOGGER.debug(\"Grouper service returned no matches for key \" + key);\n                return parents.iterator();\n            }\n            WsGetGroupsResult wsg = results.getResults()[0];\n            if (wsg.getWsGroups() != null) {\n                for (WsGroup g : wsg.getWsGroups()) {\n                    if (LOGGER.isDebugEnabled()) {\n                        LOGGER.trace(\"Retrieved group: \" + g.getName());\n                    }\n                    IEntityGroup parent = createUportalGroupFromGrouperGroup(g);\n                    parents.add(parent);\n                }\n            }\n\n            if (LOGGER.isDebugEnabled()) {\n                LOGGER.debug(\n                        \"Retrieved \" + parents.size() + \" parent groups of entity with key \" + key);\n            }\n\n        } catch (Exception e) {\n            LOGGER.warn(\n                    \"Exception while attempting to retrieve \"\n                            + \"parents for entity with key \"\n                            + key\n                            + \" from Grouper web services: \"\n                            + e.getMessage());\n            return Collections.<IEntityGroup>emptyList().iterator();\n        }\n\n        return parents.iterator();\n    }", "code_tokens": ["@", "Override", "@", "SuppressWarnings", "(", "\"unchecked\"", ")", "public", "Iterator", "findParentGroups", "(", "IGroupMember", "gm", ")", "throws", "GroupsException", "{", "final", "List", "<", "IEntityGroup", ">", "parents", "=", "new", "LinkedList", "<", "IEntityGroup", ">", "(", ")", ";", "GcGetGroups", "getGroups", "=", "new", "GcGetGroups", "(", ")", ";", "String", "uportalStem", "=", "getStemPrefix", "(", ")", ";", "// if only searching in a specific stem", "if", "(", "!", "StringUtils", ".", "isBlank", "(", "uportalStem", ")", ")", "{", "getGroups", ".", "assignStemScope", "(", "StemScope", ".", "ALL_IN_SUBTREE", ")", ";", "getGroups", ".", "assignWsStemLookup", "(", "new", "WsStemLookup", "(", "uportalStem", ",", "null", ")", ")", ";", "}", "String", "key", "=", "null", ";", "String", "subjectSourceId", "=", "null", ";", "if", "(", "gm", ".", "isGroup", "(", ")", ")", "{", "key", "=", "(", "(", "IEntityGroup", ")", "gm", ")", ".", "getLocalKey", "(", ")", ";", "if", "(", "!", "validKey", "(", "key", ")", ")", "{", "return", "parents", ".", "iterator", "(", ")", ";", "}", "subjectSourceId", "=", "\"g:gsa\"", ";", "}", "else", "{", "// Determine the key to use for this entity. If the entity is a", "// group, we should use the group's local key (excluding the", "// \"grouper.\" portion of the full key. If the entity is not a", "// group type, just use the key.", "key", "=", "gm", ".", "getKey", "(", ")", ";", "}", "getGroups", ".", "addSubjectLookup", "(", "new", "WsSubjectLookup", "(", "null", ",", "subjectSourceId", ",", "key", ")", ")", ";", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"Searching Grouper for parent groups of the entity with key: \"", "+", "key", ")", ";", "}", "try", "{", "WsGetGroupsResults", "results", "=", "getGroups", ".", "execute", "(", ")", ";", "if", "(", "results", "==", "null", "||", "results", ".", "getResults", "(", ")", "==", "null", "||", "results", ".", "getResults", "(", ")", ".", "length", "!=", "1", ")", "{", "LOGGER", ".", "debug", "(", "\"Grouper service returned no matches for key \"", "+", "key", ")", ";", "return", "parents", ".", "iterator", "(", ")", ";", "}", "WsGetGroupsResult", "wsg", "=", "results", ".", "getResults", "(", ")", "[", "0", "]", ";", "if", "(", "wsg", ".", "getWsGroups", "(", ")", "!=", "null", ")", "{", "for", "(", "WsGroup", "g", ":", "wsg", ".", "getWsGroups", "(", ")", ")", "{", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "trace", "(", "\"Retrieved group: \"", "+", "g", ".", "getName", "(", ")", ")", ";", "}", "IEntityGroup", "parent", "=", "createUportalGroupFromGrouperGroup", "(", "g", ")", ";", "parents", ".", "add", "(", "parent", ")", ";", "}", "}", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"Retrieved \"", "+", "parents", ".", "size", "(", ")", "+", "\" parent groups of entity with key \"", "+", "key", ")", ";", "}", "}", "catch", "(", "Exception", "e", ")", "{", "LOGGER", ".", "warn", "(", "\"Exception while attempting to retrieve \"", "+", "\"parents for entity with key \"", "+", "key", "+", "\" from Grouper web services: \"", "+", "e", ".", "getMessage", "(", ")", ")", ";", "return", "Collections", ".", "<", "IEntityGroup", ">", "emptyList", "(", ")", ".", "iterator", "(", ")", ";", "}", "return", "parents", ".", "iterator", "(", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.groups.IEntityGroupStore#findParentGroups(org.apereo.portal.groups.IGroupMember)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java#L154-L231", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java", "func_name": "GrouperEntityGroupStore.findEntitiesForGroup", "original_string": "@Override\n    @SuppressWarnings(\"unchecked\")\n    public Iterator findEntitiesForGroup(IEntityGroup group) throws GroupsException {\n\n        if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"Searching Grouper for members of the group with key: \" + group.getKey());\n        }\n\n        try {\n\n            // execute a search for members of the specified group\n            GcGetMembers getGroupsMembers = new GcGetMembers();\n            getGroupsMembers.addGroupName(group.getLocalKey());\n            getGroupsMembers.assignIncludeSubjectDetail(true);\n            WsGetMembersResults results = getGroupsMembers.execute();\n\n            if (results == null\n                    || results.getResults() == null\n                    || results.getResults().length == 0\n                    || results.getResults()[0].getWsSubjects() == null) {\n                LOGGER.debug(\"No members found for Grouper group with key \" + group.getLocalKey());\n                return Collections.<IGroupMember>emptyList().iterator();\n            }\n\n            WsSubject[] gInfos = results.getResults()[0].getWsSubjects();\n            final List<IGroupMember> members = new ArrayList<IGroupMember>(gInfos.length);\n\n            // add each result to the member list\n            for (WsSubject gInfo : gInfos) {\n\n                // if the member is not a group (aka person)\n                if (!StringUtils.equals(gInfo.getSourceId(), \"g:gsa\")) {\n\n                    if (LOGGER.isDebugEnabled()) {\n                        LOGGER.debug(\n                                \"creating leaf member:\"\n                                        + gInfo.getId()\n                                        + \" and name: \"\n                                        + gInfo.getName()\n                                        + \" from group: \"\n                                        + group.getLocalKey());\n                    }\n                    // use the name instead of id as it shows better in the display\n                    IGroupMember member = new EntityImpl(gInfo.getName(), IPerson.class);\n                    members.add(member);\n                }\n            }\n\n            // return an iterator for the assembled group\n            return members.iterator();\n\n        } catch (Exception e) {\n            LOGGER.warn(\n                    \"Exception while attempting to retrieve \"\n                            + \"member entities of group with key \"\n                            + group.getKey()\n                            + \" from Grouper web services: \"\n                            + e.getMessage());\n            return Collections.<IGroupMember>emptyList().iterator();\n        }\n    }", "language": "java", "code": "@Override\n    @SuppressWarnings(\"unchecked\")\n    public Iterator findEntitiesForGroup(IEntityGroup group) throws GroupsException {\n\n        if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"Searching Grouper for members of the group with key: \" + group.getKey());\n        }\n\n        try {\n\n            // execute a search for members of the specified group\n            GcGetMembers getGroupsMembers = new GcGetMembers();\n            getGroupsMembers.addGroupName(group.getLocalKey());\n            getGroupsMembers.assignIncludeSubjectDetail(true);\n            WsGetMembersResults results = getGroupsMembers.execute();\n\n            if (results == null\n                    || results.getResults() == null\n                    || results.getResults().length == 0\n                    || results.getResults()[0].getWsSubjects() == null) {\n                LOGGER.debug(\"No members found for Grouper group with key \" + group.getLocalKey());\n                return Collections.<IGroupMember>emptyList().iterator();\n            }\n\n            WsSubject[] gInfos = results.getResults()[0].getWsSubjects();\n            final List<IGroupMember> members = new ArrayList<IGroupMember>(gInfos.length);\n\n            // add each result to the member list\n            for (WsSubject gInfo : gInfos) {\n\n                // if the member is not a group (aka person)\n                if (!StringUtils.equals(gInfo.getSourceId(), \"g:gsa\")) {\n\n                    if (LOGGER.isDebugEnabled()) {\n                        LOGGER.debug(\n                                \"creating leaf member:\"\n                                        + gInfo.getId()\n                                        + \" and name: \"\n                                        + gInfo.getName()\n                                        + \" from group: \"\n                                        + group.getLocalKey());\n                    }\n                    // use the name instead of id as it shows better in the display\n                    IGroupMember member = new EntityImpl(gInfo.getName(), IPerson.class);\n                    members.add(member);\n                }\n            }\n\n            // return an iterator for the assembled group\n            return members.iterator();\n\n        } catch (Exception e) {\n            LOGGER.warn(\n                    \"Exception while attempting to retrieve \"\n                            + \"member entities of group with key \"\n                            + group.getKey()\n                            + \" from Grouper web services: \"\n                            + e.getMessage());\n            return Collections.<IGroupMember>emptyList().iterator();\n        }\n    }", "code_tokens": ["@", "Override", "@", "SuppressWarnings", "(", "\"unchecked\"", ")", "public", "Iterator", "findEntitiesForGroup", "(", "IEntityGroup", "group", ")", "throws", "GroupsException", "{", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"Searching Grouper for members of the group with key: \"", "+", "group", ".", "getKey", "(", ")", ")", ";", "}", "try", "{", "// execute a search for members of the specified group", "GcGetMembers", "getGroupsMembers", "=", "new", "GcGetMembers", "(", ")", ";", "getGroupsMembers", ".", "addGroupName", "(", "group", ".", "getLocalKey", "(", ")", ")", ";", "getGroupsMembers", ".", "assignIncludeSubjectDetail", "(", "true", ")", ";", "WsGetMembersResults", "results", "=", "getGroupsMembers", ".", "execute", "(", ")", ";", "if", "(", "results", "==", "null", "||", "results", ".", "getResults", "(", ")", "==", "null", "||", "results", ".", "getResults", "(", ")", ".", "length", "==", "0", "||", "results", ".", "getResults", "(", ")", "[", "0", "]", ".", "getWsSubjects", "(", ")", "==", "null", ")", "{", "LOGGER", ".", "debug", "(", "\"No members found for Grouper group with key \"", "+", "group", ".", "getLocalKey", "(", ")", ")", ";", "return", "Collections", ".", "<", "IGroupMember", ">", "emptyList", "(", ")", ".", "iterator", "(", ")", ";", "}", "WsSubject", "[", "]", "gInfos", "=", "results", ".", "getResults", "(", ")", "[", "0", "]", ".", "getWsSubjects", "(", ")", ";", "final", "List", "<", "IGroupMember", ">", "members", "=", "new", "ArrayList", "<", "IGroupMember", ">", "(", "gInfos", ".", "length", ")", ";", "// add each result to the member list", "for", "(", "WsSubject", "gInfo", ":", "gInfos", ")", "{", "// if the member is not a group (aka person)", "if", "(", "!", "StringUtils", ".", "equals", "(", "gInfo", ".", "getSourceId", "(", ")", ",", "\"g:gsa\"", ")", ")", "{", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"creating leaf member:\"", "+", "gInfo", ".", "getId", "(", ")", "+", "\" and name: \"", "+", "gInfo", ".", "getName", "(", ")", "+", "\" from group: \"", "+", "group", ".", "getLocalKey", "(", ")", ")", ";", "}", "// use the name instead of id as it shows better in the display", "IGroupMember", "member", "=", "new", "EntityImpl", "(", "gInfo", ".", "getName", "(", ")", ",", "IPerson", ".", "class", ")", ";", "members", ".", "add", "(", "member", ")", ";", "}", "}", "// return an iterator for the assembled group", "return", "members", ".", "iterator", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOGGER", ".", "warn", "(", "\"Exception while attempting to retrieve \"", "+", "\"member entities of group with key \"", "+", "group", ".", "getKey", "(", ")", "+", "\" from Grouper web services: \"", "+", "e", ".", "getMessage", "(", ")", ")", ";", "return", "Collections", ".", "<", "IGroupMember", ">", "emptyList", "(", ")", ".", "iterator", "(", ")", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.groups.IEntityGroupStore#findEntitiesForGroup(org.apereo.portal.groups.IEntityGroup)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java#L236-L296", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java", "func_name": "GrouperEntityGroupStore.searchForGroups", "original_string": "@Override\n    public EntityIdentifier[] searchForGroups(\n            final String query,\n            final SearchMethod method,\n            @SuppressWarnings(\"unchecked\") final Class leaftype) {\n\n        // only search for groups\n        if (leaftype != IPerson.class) {\n            return new EntityIdentifier[] {};\n        }\n\n        if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"Searching Grouper for groups matching query: \" + query);\n        }\n\n        // result groups.\n        List<EntityIdentifier> groups = new ArrayList<EntityIdentifier>();\n\n        try {\n\n            // TODO: searches need to be performed against the group display\n            // name rather than the group key\n\n            GcFindGroups groupSearch = new GcFindGroups();\n            WsQueryFilter filter = new WsQueryFilter();\n            // is this an exact search or fuzzy\n            if ((method == SearchMethod.DISCRETE_CI) || (method == SearchMethod.DISCRETE)) {\n                filter.setQueryFilterType(\"FIND_BY_GROUP_NAME_EXACT\");\n            } else {\n                filter.setQueryFilterType(\"FIND_BY_GROUP_NAME_APPROXIMATE\");\n            }\n            filter.setGroupName(query);\n            groupSearch.assignQueryFilter(filter);\n            WsFindGroupsResults results = groupSearch.execute();\n\n            if (results != null && results.getGroupResults() != null) {\n                for (WsGroup g : results.getGroupResults()) {\n                    if (validKey(g.getName())) {\n                        if (LOGGER.isTraceEnabled()) {\n                            LOGGER.trace(\"Retrieved group: \" + g.getName());\n                        }\n                        groups.add(new EntityIdentifier(g.getName(), IEntityGroup.class));\n                    }\n                }\n            }\n\n            if (LOGGER.isDebugEnabled()) {\n                LOGGER.debug(\"Returning \" + groups.size() + \" results for query \" + query);\n            }\n\n            return groups.toArray(new EntityIdentifier[groups.size()]);\n\n        } catch (Exception e) {\n            LOGGER.warn(\n                    \"Exception while attempting to retrieve \"\n                            + \"search results for query \"\n                            + query\n                            + \" and entity type \"\n                            + leaftype.getCanonicalName()\n                            + \" : \"\n                            + e.getMessage());\n            return new EntityIdentifier[] {};\n        }\n    }", "language": "java", "code": "@Override\n    public EntityIdentifier[] searchForGroups(\n            final String query,\n            final SearchMethod method,\n            @SuppressWarnings(\"unchecked\") final Class leaftype) {\n\n        // only search for groups\n        if (leaftype != IPerson.class) {\n            return new EntityIdentifier[] {};\n        }\n\n        if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"Searching Grouper for groups matching query: \" + query);\n        }\n\n        // result groups.\n        List<EntityIdentifier> groups = new ArrayList<EntityIdentifier>();\n\n        try {\n\n            // TODO: searches need to be performed against the group display\n            // name rather than the group key\n\n            GcFindGroups groupSearch = new GcFindGroups();\n            WsQueryFilter filter = new WsQueryFilter();\n            // is this an exact search or fuzzy\n            if ((method == SearchMethod.DISCRETE_CI) || (method == SearchMethod.DISCRETE)) {\n                filter.setQueryFilterType(\"FIND_BY_GROUP_NAME_EXACT\");\n            } else {\n                filter.setQueryFilterType(\"FIND_BY_GROUP_NAME_APPROXIMATE\");\n            }\n            filter.setGroupName(query);\n            groupSearch.assignQueryFilter(filter);\n            WsFindGroupsResults results = groupSearch.execute();\n\n            if (results != null && results.getGroupResults() != null) {\n                for (WsGroup g : results.getGroupResults()) {\n                    if (validKey(g.getName())) {\n                        if (LOGGER.isTraceEnabled()) {\n                            LOGGER.trace(\"Retrieved group: \" + g.getName());\n                        }\n                        groups.add(new EntityIdentifier(g.getName(), IEntityGroup.class));\n                    }\n                }\n            }\n\n            if (LOGGER.isDebugEnabled()) {\n                LOGGER.debug(\"Returning \" + groups.size() + \" results for query \" + query);\n            }\n\n            return groups.toArray(new EntityIdentifier[groups.size()]);\n\n        } catch (Exception e) {\n            LOGGER.warn(\n                    \"Exception while attempting to retrieve \"\n                            + \"search results for query \"\n                            + query\n                            + \" and entity type \"\n                            + leaftype.getCanonicalName()\n                            + \" : \"\n                            + e.getMessage());\n            return new EntityIdentifier[] {};\n        }\n    }", "code_tokens": ["@", "Override", "public", "EntityIdentifier", "[", "]", "searchForGroups", "(", "final", "String", "query", ",", "final", "SearchMethod", "method", ",", "@", "SuppressWarnings", "(", "\"unchecked\"", ")", "final", "Class", "leaftype", ")", "{", "// only search for groups", "if", "(", "leaftype", "!=", "IPerson", ".", "class", ")", "{", "return", "new", "EntityIdentifier", "[", "]", "{", "}", ";", "}", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"Searching Grouper for groups matching query: \"", "+", "query", ")", ";", "}", "// result groups.", "List", "<", "EntityIdentifier", ">", "groups", "=", "new", "ArrayList", "<", "EntityIdentifier", ">", "(", ")", ";", "try", "{", "// TODO: searches need to be performed against the group display", "// name rather than the group key", "GcFindGroups", "groupSearch", "=", "new", "GcFindGroups", "(", ")", ";", "WsQueryFilter", "filter", "=", "new", "WsQueryFilter", "(", ")", ";", "// is this an exact search or fuzzy", "if", "(", "(", "method", "==", "SearchMethod", ".", "DISCRETE_CI", ")", "||", "(", "method", "==", "SearchMethod", ".", "DISCRETE", ")", ")", "{", "filter", ".", "setQueryFilterType", "(", "\"FIND_BY_GROUP_NAME_EXACT\"", ")", ";", "}", "else", "{", "filter", ".", "setQueryFilterType", "(", "\"FIND_BY_GROUP_NAME_APPROXIMATE\"", ")", ";", "}", "filter", ".", "setGroupName", "(", "query", ")", ";", "groupSearch", ".", "assignQueryFilter", "(", "filter", ")", ";", "WsFindGroupsResults", "results", "=", "groupSearch", ".", "execute", "(", ")", ";", "if", "(", "results", "!=", "null", "&&", "results", ".", "getGroupResults", "(", ")", "!=", "null", ")", "{", "for", "(", "WsGroup", "g", ":", "results", ".", "getGroupResults", "(", ")", ")", "{", "if", "(", "validKey", "(", "g", ".", "getName", "(", ")", ")", ")", "{", "if", "(", "LOGGER", ".", "isTraceEnabled", "(", ")", ")", "{", "LOGGER", ".", "trace", "(", "\"Retrieved group: \"", "+", "g", ".", "getName", "(", ")", ")", ";", "}", "groups", ".", "add", "(", "new", "EntityIdentifier", "(", "g", ".", "getName", "(", ")", ",", "IEntityGroup", ".", "class", ")", ")", ";", "}", "}", "}", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"Returning \"", "+", "groups", ".", "size", "(", ")", "+", "\" results for query \"", "+", "query", ")", ";", "}", "return", "groups", ".", "toArray", "(", "new", "EntityIdentifier", "[", "groups", ".", "size", "(", ")", "]", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOGGER", ".", "warn", "(", "\"Exception while attempting to retrieve \"", "+", "\"search results for query \"", "+", "query", "+", "\" and entity type \"", "+", "leaftype", ".", "getCanonicalName", "(", ")", "+", "\" : \"", "+", "e", ".", "getMessage", "(", ")", ")", ";", "return", "new", "EntityIdentifier", "[", "]", "{", "}", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.groups.IEntityGroupStore#searchForGroups(java.lang.String, int, java.lang.Class)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java#L382-L445", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java", "func_name": "GrouperEntityGroupStore.createUportalGroupFromGrouperGroup", "original_string": "protected IEntityGroup createUportalGroupFromGrouperGroup(WsGroup wsGroup) {\n        IEntityGroup iEntityGroup = new EntityGroupImpl(wsGroup.getName(), IPerson.class);\n\n        // need to set the group name and description to the actual\n        // display name and description\n        iEntityGroup.setName(wsGroup.getDisplayName());\n        iEntityGroup.setDescription(wsGroup.getDescription());\n        return iEntityGroup;\n    }", "language": "java", "code": "protected IEntityGroup createUportalGroupFromGrouperGroup(WsGroup wsGroup) {\n        IEntityGroup iEntityGroup = new EntityGroupImpl(wsGroup.getName(), IPerson.class);\n\n        // need to set the group name and description to the actual\n        // display name and description\n        iEntityGroup.setName(wsGroup.getDisplayName());\n        iEntityGroup.setDescription(wsGroup.getDescription());\n        return iEntityGroup;\n    }", "code_tokens": ["protected", "IEntityGroup", "createUportalGroupFromGrouperGroup", "(", "WsGroup", "wsGroup", ")", "{", "IEntityGroup", "iEntityGroup", "=", "new", "EntityGroupImpl", "(", "wsGroup", ".", "getName", "(", ")", ",", "IPerson", ".", "class", ")", ";", "// need to set the group name and description to the actual", "// display name and description", "iEntityGroup", ".", "setName", "(", "wsGroup", ".", "getDisplayName", "(", ")", ")", ";", "iEntityGroup", ".", "setDescription", "(", "wsGroup", ".", "getDescription", "(", ")", ")", ";", "return", "iEntityGroup", ";", "}"], "docstring": "Construct an IEntityGroup from a Grouper WsGroup.\n\n@param wsGroup\n@return the group", "docstring_tokens": ["Construct", "an", "IEntityGroup", "from", "a", "Grouper", "WsGroup", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java#L508-L516", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java", "func_name": "GrouperEntityGroupStore.findGroupFromKey", "original_string": "protected WsGroup findGroupFromKey(String key) {\n        WsGroup wsGroup = null;\n\n        if (key != null) {\n\n            GcFindGroups gcFindGroups = new GcFindGroups();\n            gcFindGroups.addGroupName(key);\n            WsFindGroupsResults results = gcFindGroups.execute();\n\n            // if no results were returned, return null\n            if (results != null\n                    && results.getGroupResults() != null\n                    && results.getGroupResults().length > 0) {\n\n                if (LOGGER.isDebugEnabled()) {\n                    LOGGER.debug(\n                            \"found group from key \" + key + \": \" + results.getGroupResults()[0]);\n                }\n\n                wsGroup = results.getGroupResults()[0];\n            }\n        }\n\n        return wsGroup;\n    }", "language": "java", "code": "protected WsGroup findGroupFromKey(String key) {\n        WsGroup wsGroup = null;\n\n        if (key != null) {\n\n            GcFindGroups gcFindGroups = new GcFindGroups();\n            gcFindGroups.addGroupName(key);\n            WsFindGroupsResults results = gcFindGroups.execute();\n\n            // if no results were returned, return null\n            if (results != null\n                    && results.getGroupResults() != null\n                    && results.getGroupResults().length > 0) {\n\n                if (LOGGER.isDebugEnabled()) {\n                    LOGGER.debug(\n                            \"found group from key \" + key + \": \" + results.getGroupResults()[0]);\n                }\n\n                wsGroup = results.getGroupResults()[0];\n            }\n        }\n\n        return wsGroup;\n    }", "code_tokens": ["protected", "WsGroup", "findGroupFromKey", "(", "String", "key", ")", "{", "WsGroup", "wsGroup", "=", "null", ";", "if", "(", "key", "!=", "null", ")", "{", "GcFindGroups", "gcFindGroups", "=", "new", "GcFindGroups", "(", ")", ";", "gcFindGroups", ".", "addGroupName", "(", "key", ")", ";", "WsFindGroupsResults", "results", "=", "gcFindGroups", ".", "execute", "(", ")", ";", "// if no results were returned, return null", "if", "(", "results", "!=", "null", "&&", "results", ".", "getGroupResults", "(", ")", "!=", "null", "&&", "results", ".", "getGroupResults", "(", ")", ".", "length", ">", "0", ")", "{", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"found group from key \"", "+", "key", "+", "\": \"", "+", "results", ".", "getGroupResults", "(", ")", "[", "0", "]", ")", ";", "}", "wsGroup", "=", "results", ".", "getGroupResults", "(", ")", "[", "0", "]", ";", "}", "}", "return", "wsGroup", ";", "}"], "docstring": "Find the Grouper group matching the specified key.\n\n@param key\n@return the group or null", "docstring_tokens": ["Find", "the", "Grouper", "group", "matching", "the", "specified", "key", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java#L524-L548", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java", "func_name": "GrouperEntityGroupStore.getStemPrefix", "original_string": "protected static String getStemPrefix() {\n\n        String uportalStem = GrouperClientUtils.propertiesValue(STEM_PREFIX, false);\n\n        // make sure it ends in colon\n        if (!StringUtils.isBlank(uportalStem)) {\n            if (uportalStem.endsWith(\":\")) {\n                uportalStem = uportalStem.substring(0, uportalStem.length() - 1);\n            }\n        }\n\n        return uportalStem;\n    }", "language": "java", "code": "protected static String getStemPrefix() {\n\n        String uportalStem = GrouperClientUtils.propertiesValue(STEM_PREFIX, false);\n\n        // make sure it ends in colon\n        if (!StringUtils.isBlank(uportalStem)) {\n            if (uportalStem.endsWith(\":\")) {\n                uportalStem = uportalStem.substring(0, uportalStem.length() - 1);\n            }\n        }\n\n        return uportalStem;\n    }", "code_tokens": ["protected", "static", "String", "getStemPrefix", "(", ")", "{", "String", "uportalStem", "=", "GrouperClientUtils", ".", "propertiesValue", "(", "STEM_PREFIX", ",", "false", ")", ";", "// make sure it ends in colon", "if", "(", "!", "StringUtils", ".", "isBlank", "(", "uportalStem", ")", ")", "{", "if", "(", "uportalStem", ".", "endsWith", "(", "\":\"", ")", ")", "{", "uportalStem", "=", "uportalStem", ".", "substring", "(", "0", ",", "uportalStem", ".", "length", "(", ")", "-", "1", ")", ";", "}", "}", "return", "uportalStem", ";", "}"], "docstring": "Get the prefix for the stem containing uPortal groups. If this value is non-empty, all groups\nwill be required to be prefixed with the specified stem name.\n\n@return the uportal stem in the registry, without trailing colon", "docstring_tokens": ["Get", "the", "prefix", "for", "the", "stem", "containing", "uPortal", "groups", ".", "If", "this", "value", "is", "non", "-", "empty", "all", "groups", "will", "be", "required", "to", "be", "prefixed", "with", "the", "specified", "stem", "name", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java#L556-L568", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/LPARemoveParameter.java", "func_name": "LPARemoveParameter.perform", "original_string": "@Override\n    public void perform() throws PortalException {\n        // push the change into the PLF\n        if (nodeId.startsWith(Constants.FRAGMENT_ID_USER_PREFIX)) {\n            // we are dealing with an incorporated node\n            ParameterEditManager.removeParmEditDirective(nodeId, name, person);\n        } else {\n            // node owned by user so add parameter child directly\n            Document plf = RDBMDistributedLayoutStore.getPLF(person);\n            Element plfNode = plf.getElementById(nodeId);\n            removeParameterChild(plfNode, name);\n        }\n        // push the change into the ILF\n        removeParameterChild(ilfNode, name);\n    }", "language": "java", "code": "@Override\n    public void perform() throws PortalException {\n        // push the change into the PLF\n        if (nodeId.startsWith(Constants.FRAGMENT_ID_USER_PREFIX)) {\n            // we are dealing with an incorporated node\n            ParameterEditManager.removeParmEditDirective(nodeId, name, person);\n        } else {\n            // node owned by user so add parameter child directly\n            Document plf = RDBMDistributedLayoutStore.getPLF(person);\n            Element plfNode = plf.getElementById(nodeId);\n            removeParameterChild(plfNode, name);\n        }\n        // push the change into the ILF\n        removeParameterChild(ilfNode, name);\n    }", "code_tokens": ["@", "Override", "public", "void", "perform", "(", ")", "throws", "PortalException", "{", "// push the change into the PLF", "if", "(", "nodeId", ".", "startsWith", "(", "Constants", ".", "FRAGMENT_ID_USER_PREFIX", ")", ")", "{", "// we are dealing with an incorporated node", "ParameterEditManager", ".", "removeParmEditDirective", "(", "nodeId", ",", "name", ",", "person", ")", ";", "}", "else", "{", "// node owned by user so add parameter child directly", "Document", "plf", "=", "RDBMDistributedLayoutStore", ".", "getPLF", "(", "person", ")", ";", "Element", "plfNode", "=", "plf", ".", "getElementById", "(", "nodeId", ")", ";", "removeParameterChild", "(", "plfNode", ",", "name", ")", ";", "}", "// push the change into the ILF", "removeParameterChild", "(", "ilfNode", ",", "name", ")", ";", "}"], "docstring": "Remove the parameter from a channel in both the ILF and PLF using the appropriate mechanisms\nfor incorporated nodes versus owned nodes.", "docstring_tokens": ["Remove", "the", "parameter", "from", "a", "channel", "in", "both", "the", "ILF", "and", "PLF", "using", "the", "appropriate", "mechanisms", "for", "incorporated", "nodes", "versus", "owned", "nodes", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/LPARemoveParameter.java#L40-L54", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/layout/dlm/remoting/registry/v43/PortletCategoryBean.java", "func_name": "PortletCategoryBean.create", "original_string": "public static PortletCategoryBean create(\n            String id,\n            String name,\n            String description,\n            Set<PortletCategoryBean> subcategories,\n            Set<PortletDefinitionBean> portlets) {\n        return new PortletCategoryBean(id, name, description, subcategories, portlets);\n    }", "language": "java", "code": "public static PortletCategoryBean create(\n            String id,\n            String name,\n            String description,\n            Set<PortletCategoryBean> subcategories,\n            Set<PortletDefinitionBean> portlets) {\n        return new PortletCategoryBean(id, name, description, subcategories, portlets);\n    }", "code_tokens": ["public", "static", "PortletCategoryBean", "create", "(", "String", "id", ",", "String", "name", ",", "String", "description", ",", "Set", "<", "PortletCategoryBean", ">", "subcategories", ",", "Set", "<", "PortletDefinitionBean", ">", "portlets", ")", "{", "return", "new", "PortletCategoryBean", "(", "id", ",", "name", ",", "description", ",", "subcategories", ",", "portlets", ")", ";", "}"], "docstring": "Creates a new bean based on the provided inputs.", "docstring_tokens": ["Creates", "a", "new", "bean", "based", "on", "the", "provided", "inputs", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/layout/dlm/remoting/registry/v43/PortletCategoryBean.java#L57-L64", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/logging/AppendableLogger.java", "func_name": "AppendableLogger.append", "original_string": "@Override\n    public Appendable append(CharSequence csq, int start, int end) throws IOException {\n        this.loggingWriter.append(csq, start, end);\n        return this;\n    }", "language": "java", "code": "@Override\n    public Appendable append(CharSequence csq, int start, int end) throws IOException {\n        this.loggingWriter.append(csq, start, end);\n        return this;\n    }", "code_tokens": ["@", "Override", "public", "Appendable", "append", "(", "CharSequence", "csq", ",", "int", "start", ",", "int", "end", ")", "throws", "IOException", "{", "this", ".", "loggingWriter", ".", "append", "(", "csq", ",", "start", ",", "end", ")", ";", "return", "this", ";", "}"], "docstring": "/* (non-Javadoc)\n@see java.lang.Appendable#append(java.lang.CharSequence, int, int)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/logging/AppendableLogger.java#L51-L55", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/permissions/PermissionsRESTController.java", "func_name": "PermissionsRESTController.getOwners", "original_string": "@PreAuthorize(\n            \"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\")\n    @RequestMapping(value = \"/permissions/owners.json\", method = RequestMethod.GET)\n    public ModelAndView getOwners() {\n\n        // get a list of all currently defined permission owners\n        List<IPermissionOwner> owners = permissionOwnerDao.getAllPermissionOwners();\n\n        ModelAndView mv = new ModelAndView();\n        mv.addObject(\"owners\", owners);\n        mv.setViewName(\"json\");\n\n        return mv;\n    }", "language": "java", "code": "@PreAuthorize(\n            \"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\")\n    @RequestMapping(value = \"/permissions/owners.json\", method = RequestMethod.GET)\n    public ModelAndView getOwners() {\n\n        // get a list of all currently defined permission owners\n        List<IPermissionOwner> owners = permissionOwnerDao.getAllPermissionOwners();\n\n        ModelAndView mv = new ModelAndView();\n        mv.addObject(\"owners\", owners);\n        mv.setViewName(\"json\");\n\n        return mv;\n    }", "code_tokens": ["@", "PreAuthorize", "(", "\"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\"", ")", "@", "RequestMapping", "(", "value", "=", "\"/permissions/owners.json\"", ",", "method", "=", "RequestMethod", ".", "GET", ")", "public", "ModelAndView", "getOwners", "(", ")", "{", "// get a list of all currently defined permission owners", "List", "<", "IPermissionOwner", ">", "owners", "=", "permissionOwnerDao", ".", "getAllPermissionOwners", "(", ")", ";", "ModelAndView", "mv", "=", "new", "ModelAndView", "(", ")", ";", "mv", ".", "addObject", "(", "\"owners\"", ",", "owners", ")", ";", "mv", ".", "setViewName", "(", "\"json\"", ")", ";", "return", "mv", ";", "}"], "docstring": "Provide a JSON view of all known permission owners registered with uPortal.", "docstring_tokens": ["Provide", "a", "JSON", "view", "of", "all", "known", "permission", "owners", "registered", "with", "uPortal", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/permissions/PermissionsRESTController.java#L96-L109", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/permissions/PermissionsRESTController.java", "func_name": "PermissionsRESTController.getOwners", "original_string": "@PreAuthorize(\n            \"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\")\n    @RequestMapping(value = \"/permissions/owners/{owner}.json\", method = RequestMethod.GET)\n    public ModelAndView getOwners(\n            @PathVariable(\"owner\") String ownerParam, HttpServletResponse response) {\n\n        IPermissionOwner owner;\n\n        if (StringUtils.isNumeric(ownerParam)) {\n            long id = Long.valueOf(ownerParam);\n            owner = permissionOwnerDao.getPermissionOwner(id);\n        } else {\n            owner = permissionOwnerDao.getPermissionOwner(ownerParam);\n        }\n\n        // if the IPermissionOwner was found, add it to the JSON model\n        if (owner != null) {\n            ModelAndView mv = new ModelAndView();\n            mv.addObject(\"owner\", owner);\n            mv.setViewName(\"json\");\n            return mv;\n        }\n\n        // otherwise return a 404 not found error code\n        else {\n            response.setStatus(HttpServletResponse.SC_NOT_FOUND);\n            return null;\n        }\n    }", "language": "java", "code": "@PreAuthorize(\n            \"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\")\n    @RequestMapping(value = \"/permissions/owners/{owner}.json\", method = RequestMethod.GET)\n    public ModelAndView getOwners(\n            @PathVariable(\"owner\") String ownerParam, HttpServletResponse response) {\n\n        IPermissionOwner owner;\n\n        if (StringUtils.isNumeric(ownerParam)) {\n            long id = Long.valueOf(ownerParam);\n            owner = permissionOwnerDao.getPermissionOwner(id);\n        } else {\n            owner = permissionOwnerDao.getPermissionOwner(ownerParam);\n        }\n\n        // if the IPermissionOwner was found, add it to the JSON model\n        if (owner != null) {\n            ModelAndView mv = new ModelAndView();\n            mv.addObject(\"owner\", owner);\n            mv.setViewName(\"json\");\n            return mv;\n        }\n\n        // otherwise return a 404 not found error code\n        else {\n            response.setStatus(HttpServletResponse.SC_NOT_FOUND);\n            return null;\n        }\n    }", "code_tokens": ["@", "PreAuthorize", "(", "\"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\"", ")", "@", "RequestMapping", "(", "value", "=", "\"/permissions/owners/{owner}.json\"", ",", "method", "=", "RequestMethod", ".", "GET", ")", "public", "ModelAndView", "getOwners", "(", "@", "PathVariable", "(", "\"owner\"", ")", "String", "ownerParam", ",", "HttpServletResponse", "response", ")", "{", "IPermissionOwner", "owner", ";", "if", "(", "StringUtils", ".", "isNumeric", "(", "ownerParam", ")", ")", "{", "long", "id", "=", "Long", ".", "valueOf", "(", "ownerParam", ")", ";", "owner", "=", "permissionOwnerDao", ".", "getPermissionOwner", "(", "id", ")", ";", "}", "else", "{", "owner", "=", "permissionOwnerDao", ".", "getPermissionOwner", "(", "ownerParam", ")", ";", "}", "// if the IPermissionOwner was found, add it to the JSON model", "if", "(", "owner", "!=", "null", ")", "{", "ModelAndView", "mv", "=", "new", "ModelAndView", "(", ")", ";", "mv", ".", "addObject", "(", "\"owner\"", ",", "owner", ")", ";", "mv", ".", "setViewName", "(", "\"json\"", ")", ";", "return", "mv", ";", "}", "// otherwise return a 404 not found error code", "else", "{", "response", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_NOT_FOUND", ")", ";", "return", "null", ";", "}", "}"], "docstring": "Provide a detailed view of the specified IPermissionOwner. This view should contain a list of\nthe owner's defined activities.", "docstring_tokens": ["Provide", "a", "detailed", "view", "of", "the", "specified", "IPermissionOwner", ".", "This", "view", "should", "contain", "a", "list", "of", "the", "owner", "s", "defined", "activities", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/permissions/PermissionsRESTController.java#L115-L143", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/permissions/PermissionsRESTController.java", "func_name": "PermissionsRESTController.getActivities", "original_string": "@PreAuthorize(\n            \"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\")\n    @RequestMapping(value = \"/permissions/activities.json\", method = RequestMethod.GET)\n    public ModelAndView getActivities(@RequestParam(value = \"q\", required = false) String query) {\n\n        if (StringUtils.isNotBlank(query)) {\n            query = query.toLowerCase();\n        }\n\n        List<IPermissionActivity> activities = new ArrayList<>();\n        Collection<IPermissionOwner> owners = permissionOwnerDao.getAllPermissionOwners();\n\n        for (IPermissionOwner owner : owners) {\n            for (IPermissionActivity activity : owner.getActivities()) {\n                if (StringUtils.isBlank(query)\n                        || activity.getName().toLowerCase().contains(query)) {\n                    activities.add(activity);\n                }\n            }\n        }\n        Collections.sort(activities);\n\n        ModelAndView mv = new ModelAndView();\n        mv.addObject(\"activities\", activities);\n        mv.setViewName(\"json\");\n\n        return mv;\n    }", "language": "java", "code": "@PreAuthorize(\n            \"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\")\n    @RequestMapping(value = \"/permissions/activities.json\", method = RequestMethod.GET)\n    public ModelAndView getActivities(@RequestParam(value = \"q\", required = false) String query) {\n\n        if (StringUtils.isNotBlank(query)) {\n            query = query.toLowerCase();\n        }\n\n        List<IPermissionActivity> activities = new ArrayList<>();\n        Collection<IPermissionOwner> owners = permissionOwnerDao.getAllPermissionOwners();\n\n        for (IPermissionOwner owner : owners) {\n            for (IPermissionActivity activity : owner.getActivities()) {\n                if (StringUtils.isBlank(query)\n                        || activity.getName().toLowerCase().contains(query)) {\n                    activities.add(activity);\n                }\n            }\n        }\n        Collections.sort(activities);\n\n        ModelAndView mv = new ModelAndView();\n        mv.addObject(\"activities\", activities);\n        mv.setViewName(\"json\");\n\n        return mv;\n    }", "code_tokens": ["@", "PreAuthorize", "(", "\"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\"", ")", "@", "RequestMapping", "(", "value", "=", "\"/permissions/activities.json\"", ",", "method", "=", "RequestMethod", ".", "GET", ")", "public", "ModelAndView", "getActivities", "(", "@", "RequestParam", "(", "value", "=", "\"q\"", ",", "required", "=", "false", ")", "String", "query", ")", "{", "if", "(", "StringUtils", ".", "isNotBlank", "(", "query", ")", ")", "{", "query", "=", "query", ".", "toLowerCase", "(", ")", ";", "}", "List", "<", "IPermissionActivity", ">", "activities", "=", "new", "ArrayList", "<>", "(", ")", ";", "Collection", "<", "IPermissionOwner", ">", "owners", "=", "permissionOwnerDao", ".", "getAllPermissionOwners", "(", ")", ";", "for", "(", "IPermissionOwner", "owner", ":", "owners", ")", "{", "for", "(", "IPermissionActivity", "activity", ":", "owner", ".", "getActivities", "(", ")", ")", "{", "if", "(", "StringUtils", ".", "isBlank", "(", "query", ")", "||", "activity", ".", "getName", "(", ")", ".", "toLowerCase", "(", ")", ".", "contains", "(", "query", ")", ")", "{", "activities", ".", "add", "(", "activity", ")", ";", "}", "}", "}", "Collections", ".", "sort", "(", "activities", ")", ";", "ModelAndView", "mv", "=", "new", "ModelAndView", "(", ")", ";", "mv", ".", "addObject", "(", "\"activities\"", ",", "activities", ")", ";", "mv", ".", "setViewName", "(", "\"json\"", ")", ";", "return", "mv", ";", "}"], "docstring": "Provide a list of all registered IPermissionActivities. If an optional search string is\nprovided, the returned list will be restricted to activities matching the query.", "docstring_tokens": ["Provide", "a", "list", "of", "all", "registered", "IPermissionActivities", ".", "If", "an", "optional", "search", "string", "is", "provided", "the", "returned", "list", "will", "be", "restricted", "to", "activities", "matching", "the", "query", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/permissions/PermissionsRESTController.java#L149-L176", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/permissions/PermissionsRESTController.java", "func_name": "PermissionsRESTController.getTargets", "original_string": "@PreAuthorize(\n            \"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\")\n    @RequestMapping(value = \"/permissions/{activity}/targets.json\", method = RequestMethod.GET)\n    public ModelAndView getTargets(\n            @PathVariable(\"activity\") Long activityId, @RequestParam(\"q\") String query) {\n\n        IPermissionActivity activity = permissionOwnerDao.getPermissionActivity(activityId);\n        Collection<IPermissionTarget> targets = Collections.emptyList();\n        if (activity != null) {\n            IPermissionTargetProvider provider =\n                    targetProviderRegistry.getTargetProvider(activity.getTargetProviderKey());\n\n            SortedSet<IPermissionTarget> matchingTargets = new TreeSet<>();\n            // add matching results for this identifier provider to the set\n            targets = provider.searchTargets(query);\n            for (IPermissionTarget target : targets) {\n                if ((StringUtils.isNotBlank(target.getName())\n                                && target.getName().toLowerCase().contains(query))\n                        || target.getKey().toLowerCase().contains(query)) {\n                    matchingTargets.addAll(targets);\n                }\n            }\n        }\n        ModelAndView mv = new ModelAndView();\n        mv.addObject(\"targets\", targets);\n        mv.setViewName(\"json\");\n\n        return mv;\n    }", "language": "java", "code": "@PreAuthorize(\n            \"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\")\n    @RequestMapping(value = \"/permissions/{activity}/targets.json\", method = RequestMethod.GET)\n    public ModelAndView getTargets(\n            @PathVariable(\"activity\") Long activityId, @RequestParam(\"q\") String query) {\n\n        IPermissionActivity activity = permissionOwnerDao.getPermissionActivity(activityId);\n        Collection<IPermissionTarget> targets = Collections.emptyList();\n        if (activity != null) {\n            IPermissionTargetProvider provider =\n                    targetProviderRegistry.getTargetProvider(activity.getTargetProviderKey());\n\n            SortedSet<IPermissionTarget> matchingTargets = new TreeSet<>();\n            // add matching results for this identifier provider to the set\n            targets = provider.searchTargets(query);\n            for (IPermissionTarget target : targets) {\n                if ((StringUtils.isNotBlank(target.getName())\n                                && target.getName().toLowerCase().contains(query))\n                        || target.getKey().toLowerCase().contains(query)) {\n                    matchingTargets.addAll(targets);\n                }\n            }\n        }\n        ModelAndView mv = new ModelAndView();\n        mv.addObject(\"targets\", targets);\n        mv.setViewName(\"json\");\n\n        return mv;\n    }", "code_tokens": ["@", "PreAuthorize", "(", "\"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\"", ")", "@", "RequestMapping", "(", "value", "=", "\"/permissions/{activity}/targets.json\"", ",", "method", "=", "RequestMethod", ".", "GET", ")", "public", "ModelAndView", "getTargets", "(", "@", "PathVariable", "(", "\"activity\"", ")", "Long", "activityId", ",", "@", "RequestParam", "(", "\"q\"", ")", "String", "query", ")", "{", "IPermissionActivity", "activity", "=", "permissionOwnerDao", ".", "getPermissionActivity", "(", "activityId", ")", ";", "Collection", "<", "IPermissionTarget", ">", "targets", "=", "Collections", ".", "emptyList", "(", ")", ";", "if", "(", "activity", "!=", "null", ")", "{", "IPermissionTargetProvider", "provider", "=", "targetProviderRegistry", ".", "getTargetProvider", "(", "activity", ".", "getTargetProviderKey", "(", ")", ")", ";", "SortedSet", "<", "IPermissionTarget", ">", "matchingTargets", "=", "new", "TreeSet", "<>", "(", ")", ";", "// add matching results for this identifier provider to the set", "targets", "=", "provider", ".", "searchTargets", "(", "query", ")", ";", "for", "(", "IPermissionTarget", "target", ":", "targets", ")", "{", "if", "(", "(", "StringUtils", ".", "isNotBlank", "(", "target", ".", "getName", "(", ")", ")", "&&", "target", ".", "getName", "(", ")", ".", "toLowerCase", "(", ")", ".", "contains", "(", "query", ")", ")", "||", "target", ".", "getKey", "(", ")", ".", "toLowerCase", "(", ")", ".", "contains", "(", "query", ")", ")", "{", "matchingTargets", ".", "addAll", "(", "targets", ")", ";", "}", "}", "}", "ModelAndView", "mv", "=", "new", "ModelAndView", "(", ")", ";", "mv", ".", "addObject", "(", "\"targets\"", ",", "targets", ")", ";", "mv", ".", "setViewName", "(", "\"json\"", ")", ";", "return", "mv", ";", "}"], "docstring": "Return a list of targets defined for a particular IPermissionActivity matching the specified\nsearch query.", "docstring_tokens": ["Return", "a", "list", "of", "targets", "defined", "for", "a", "particular", "IPermissionActivity", "matching", "the", "specified", "search", "query", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/permissions/PermissionsRESTController.java#L182-L210", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/permissions/PermissionsRESTController.java", "func_name": "PermissionsRESTController.getAssignmentsForUser", "original_string": "@PreAuthorize(\n            \"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\")\n    @RequestMapping(\"/v5-5/permissions/assignments/users/{username}\")\n    public ModelAndView getAssignmentsForUser(\n            @PathVariable(\"username\") String username,\n            @RequestParam(value = \"includeInherited\", required = false, defaultValue = \"false\")\n                    boolean includeInherited) {\n\n        final JsonEntityBean entity =\n                groupListHelper.getEntity(EntityEnum.PERSON.toString(), username, false);\n        final List<JsonPermission> permissions = getPermissionsForEntity(entity, includeInherited);\n\n        final ModelAndView mv = new ModelAndView();\n        mv.addObject(\"assignments\", permissions);\n        mv.setViewName(\"json\");\n\n        return mv;\n    }", "language": "java", "code": "@PreAuthorize(\n            \"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\")\n    @RequestMapping(\"/v5-5/permissions/assignments/users/{username}\")\n    public ModelAndView getAssignmentsForUser(\n            @PathVariable(\"username\") String username,\n            @RequestParam(value = \"includeInherited\", required = false, defaultValue = \"false\")\n                    boolean includeInherited) {\n\n        final JsonEntityBean entity =\n                groupListHelper.getEntity(EntityEnum.PERSON.toString(), username, false);\n        final List<JsonPermission> permissions = getPermissionsForEntity(entity, includeInherited);\n\n        final ModelAndView mv = new ModelAndView();\n        mv.addObject(\"assignments\", permissions);\n        mv.setViewName(\"json\");\n\n        return mv;\n    }", "code_tokens": ["@", "PreAuthorize", "(", "\"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\"", ")", "@", "RequestMapping", "(", "\"/v5-5/permissions/assignments/users/{username}\"", ")", "public", "ModelAndView", "getAssignmentsForUser", "(", "@", "PathVariable", "(", "\"username\"", ")", "String", "username", ",", "@", "RequestParam", "(", "value", "=", "\"includeInherited\"", ",", "required", "=", "false", ",", "defaultValue", "=", "\"false\"", ")", "boolean", "includeInherited", ")", "{", "final", "JsonEntityBean", "entity", "=", "groupListHelper", ".", "getEntity", "(", "EntityEnum", ".", "PERSON", ".", "toString", "(", ")", ",", "username", ",", "false", ")", ";", "final", "List", "<", "JsonPermission", ">", "permissions", "=", "getPermissionsForEntity", "(", "entity", ",", "includeInherited", ")", ";", "final", "ModelAndView", "mv", "=", "new", "ModelAndView", "(", ")", ";", "mv", ".", "addObject", "(", "\"assignments\"", ",", "permissions", ")", ";", "mv", ".", "setViewName", "(", "\"json\"", ")", ";", "return", "mv", ";", "}"], "docstring": "Provides the collection of permission assignments that apply to the specified user,\noptionally including inherited assignments.\n\n@since 5.5", "docstring_tokens": ["Provides", "the", "collection", "of", "permission", "assignments", "that", "apply", "to", "the", "specified", "user", "optionally", "including", "inherited", "assignments", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/permissions/PermissionsRESTController.java#L235-L252", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/xml/dlm/FragmentDefinitionImporter.java", "func_name": "FragmentDefinitionImporter.importData", "original_string": "@Override\n    @Transactional\n    public void importData(Tuple<String, Document> data) {\n        final Document resultDoc = data.second;\n\n        final Element fragmentDefElement =\n                this.xPathOperations.evaluate(\n                        \"//*[local-name() = 'fragment']\", resultDoc, XPathConstants.NODE);\n        if (fragmentDefElement == null) {\n            throw new IllegalArgumentException(\n                    \"Could not find required dlm:fragment element in fragment-definition file\");\n        }\n        final String fragmentName = fragmentDefElement.getAttribute(\"name\");\n\n        FragmentDefinition fragmentDefinition =\n                this.fragmentDefinitionDao.getFragmentDefinition(fragmentName);\n        if (fragmentDefinition == null) {\n            fragmentDefinition = new FragmentDefinition(fragmentDefElement);\n        }\n\n        fragmentDefinition.loadFromEelement(fragmentDefElement);\n\n        this.fragmentDefinitionDao.updateFragmentDefinition(fragmentDefinition);\n    }", "language": "java", "code": "@Override\n    @Transactional\n    public void importData(Tuple<String, Document> data) {\n        final Document resultDoc = data.second;\n\n        final Element fragmentDefElement =\n                this.xPathOperations.evaluate(\n                        \"//*[local-name() = 'fragment']\", resultDoc, XPathConstants.NODE);\n        if (fragmentDefElement == null) {\n            throw new IllegalArgumentException(\n                    \"Could not find required dlm:fragment element in fragment-definition file\");\n        }\n        final String fragmentName = fragmentDefElement.getAttribute(\"name\");\n\n        FragmentDefinition fragmentDefinition =\n                this.fragmentDefinitionDao.getFragmentDefinition(fragmentName);\n        if (fragmentDefinition == null) {\n            fragmentDefinition = new FragmentDefinition(fragmentDefElement);\n        }\n\n        fragmentDefinition.loadFromEelement(fragmentDefElement);\n\n        this.fragmentDefinitionDao.updateFragmentDefinition(fragmentDefinition);\n    }", "code_tokens": ["@", "Override", "@", "Transactional", "public", "void", "importData", "(", "Tuple", "<", "String", ",", "Document", ">", "data", ")", "{", "final", "Document", "resultDoc", "=", "data", ".", "second", ";", "final", "Element", "fragmentDefElement", "=", "this", ".", "xPathOperations", ".", "evaluate", "(", "\"//*[local-name() = 'fragment']\"", ",", "resultDoc", ",", "XPathConstants", ".", "NODE", ")", ";", "if", "(", "fragmentDefElement", "==", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"Could not find required dlm:fragment element in fragment-definition file\"", ")", ";", "}", "final", "String", "fragmentName", "=", "fragmentDefElement", ".", "getAttribute", "(", "\"name\"", ")", ";", "FragmentDefinition", "fragmentDefinition", "=", "this", ".", "fragmentDefinitionDao", ".", "getFragmentDefinition", "(", "fragmentName", ")", ";", "if", "(", "fragmentDefinition", "==", "null", ")", "{", "fragmentDefinition", "=", "new", "FragmentDefinition", "(", "fragmentDefElement", ")", ";", "}", "fragmentDefinition", ".", "loadFromEelement", "(", "fragmentDefElement", ")", ";", "this", ".", "fragmentDefinitionDao", ".", "updateFragmentDefinition", "(", "fragmentDefinition", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.io.xml.IDataImporter#importData(java.lang.Object)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/xml/dlm/FragmentDefinitionImporter.java#L80-L103", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/xml/dlm/FragmentDefinitionImporter.java", "func_name": "FragmentDefinitionImporter.unmarshal", "original_string": "@Override\n    public Object unmarshal(Source source) throws IOException, XmlMappingException {\n        if (source instanceof StAXSource) {\n            source = fixStAXSource((StAXSource) source);\n        }\n\n        final Transformer identityTransformer;\n        try {\n            identityTransformer = this.xmlUtilities.getIdentityTransformer();\n        } catch (TransformerConfigurationException e) {\n            throw new RuntimeException(\"Failed to create identity Transformer\", e);\n        }\n\n        final DOMResult domResult = new DOMResult();\n        try {\n            identityTransformer.transform(source, domResult);\n        } catch (TransformerException e) {\n            throw new RuntimeException(\"Failed to transform \" + source + \" into Document\", e);\n        }\n\n        final Document resultDoc = (Document) domResult.getNode();\n        return new Tuple<String, Document>(source.getSystemId(), resultDoc);\n    }", "language": "java", "code": "@Override\n    public Object unmarshal(Source source) throws IOException, XmlMappingException {\n        if (source instanceof StAXSource) {\n            source = fixStAXSource((StAXSource) source);\n        }\n\n        final Transformer identityTransformer;\n        try {\n            identityTransformer = this.xmlUtilities.getIdentityTransformer();\n        } catch (TransformerConfigurationException e) {\n            throw new RuntimeException(\"Failed to create identity Transformer\", e);\n        }\n\n        final DOMResult domResult = new DOMResult();\n        try {\n            identityTransformer.transform(source, domResult);\n        } catch (TransformerException e) {\n            throw new RuntimeException(\"Failed to transform \" + source + \" into Document\", e);\n        }\n\n        final Document resultDoc = (Document) domResult.getNode();\n        return new Tuple<String, Document>(source.getSystemId(), resultDoc);\n    }", "code_tokens": ["@", "Override", "public", "Object", "unmarshal", "(", "Source", "source", ")", "throws", "IOException", ",", "XmlMappingException", "{", "if", "(", "source", "instanceof", "StAXSource", ")", "{", "source", "=", "fixStAXSource", "(", "(", "StAXSource", ")", "source", ")", ";", "}", "final", "Transformer", "identityTransformer", ";", "try", "{", "identityTransformer", "=", "this", ".", "xmlUtilities", ".", "getIdentityTransformer", "(", ")", ";", "}", "catch", "(", "TransformerConfigurationException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Failed to create identity Transformer\"", ",", "e", ")", ";", "}", "final", "DOMResult", "domResult", "=", "new", "DOMResult", "(", ")", ";", "try", "{", "identityTransformer", ".", "transform", "(", "source", ",", "domResult", ")", ";", "}", "catch", "(", "TransformerException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Failed to transform \"", "+", "source", "+", "\" into Document\"", ",", "e", ")", ";", "}", "final", "Document", "resultDoc", "=", "(", "Document", ")", "domResult", ".", "getNode", "(", ")", ";", "return", "new", "Tuple", "<", "String", ",", "Document", ">", "(", "source", ".", "getSystemId", "(", ")", ",", "resultDoc", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.springframework.oxm.Unmarshaller#unmarshal(javax.xml.transform.Source)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/xml/dlm/FragmentDefinitionImporter.java#L123-L145", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/PortalContextImpl.java", "func_name": "PortalContextImpl.getProperty", "original_string": "@Override\n    public String getProperty(String name) {\n        Validate.notNull(name, \"Property name can not be null\");\n        return this.portalProperties.getProperty(name);\n    }", "language": "java", "code": "@Override\n    public String getProperty(String name) {\n        Validate.notNull(name, \"Property name can not be null\");\n        return this.portalProperties.getProperty(name);\n    }", "code_tokens": ["@", "Override", "public", "String", "getProperty", "(", "String", "name", ")", "{", "Validate", ".", "notNull", "(", "name", ",", "\"Property name can not be null\"", ")", ";", "return", "this", ".", "portalProperties", ".", "getProperty", "(", "name", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see javax.portlet.PortalContext#getProperty(java.lang.String)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/PortalContextImpl.java#L84-L88", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/statistics/TabRenderStatisticsController.java", "func_name": "TabRenderStatisticsController.setReportFormTabs", "original_string": "private void setReportFormTabs(final TabRenderReportForm report) {\n        if (!report.getTabs().isEmpty()) {\n            // Tabs are already set, do nothing\n            return;\n        }\n\n        final Set<AggregatedTabMapping> tabs = this.getTabs();\n        if (!tabs.isEmpty()) {\n            report.getTabs().add(tabs.iterator().next().getId());\n        }\n    }", "language": "java", "code": "private void setReportFormTabs(final TabRenderReportForm report) {\n        if (!report.getTabs().isEmpty()) {\n            // Tabs are already set, do nothing\n            return;\n        }\n\n        final Set<AggregatedTabMapping> tabs = this.getTabs();\n        if (!tabs.isEmpty()) {\n            report.getTabs().add(tabs.iterator().next().getId());\n        }\n    }", "code_tokens": ["private", "void", "setReportFormTabs", "(", "final", "TabRenderReportForm", "report", ")", "{", "if", "(", "!", "report", ".", "getTabs", "(", ")", ".", "isEmpty", "(", ")", ")", "{", "// Tabs are already set, do nothing", "return", ";", "}", "final", "Set", "<", "AggregatedTabMapping", ">", "tabs", "=", "this", ".", "getTabs", "(", ")", ";", "if", "(", "!", "tabs", ".", "isEmpty", "(", ")", ")", "{", "report", ".", "getTabs", "(", ")", ".", "add", "(", "tabs", ".", "iterator", "(", ")", ".", "next", "(", ")", ".", "getId", "(", ")", ")", ";", "}", "}"], "docstring": "Set the tab names to have first selected by default", "docstring_tokens": ["Set", "the", "tab", "names", "to", "have", "first", "selected", "by", "default"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/statistics/TabRenderStatisticsController.java#L99-L109", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java", "func_name": "JaxbPortalDataHandlerService.setDataTypeImportOrder", "original_string": "@Autowired\n    public void setDataTypeImportOrder(List<IPortalDataType> dataTypeImportOrder) {\n        final ArrayList<PortalDataKey> dataKeyImportOrder =\n                new ArrayList<>(dataTypeImportOrder.size() * 2);\n        final Map<PortalDataKey, IPortalDataType> dataKeyTypes =\n                new LinkedHashMap<>(dataTypeImportOrder.size() * 2);\n\n        for (final IPortalDataType portalDataType : dataTypeImportOrder) {\n            final List<PortalDataKey> supportedDataKeys = portalDataType.getDataKeyImportOrder();\n            for (final PortalDataKey portalDataKey : supportedDataKeys) {\n                dataKeyImportOrder.add(portalDataKey);\n                dataKeyTypes.put(portalDataKey, portalDataType);\n            }\n        }\n\n        dataKeyImportOrder.trimToSize();\n        this.dataKeyImportOrder = Collections.unmodifiableList(dataKeyImportOrder);\n        this.dataKeyTypes = Collections.unmodifiableMap(dataKeyTypes);\n    }", "language": "java", "code": "@Autowired\n    public void setDataTypeImportOrder(List<IPortalDataType> dataTypeImportOrder) {\n        final ArrayList<PortalDataKey> dataKeyImportOrder =\n                new ArrayList<>(dataTypeImportOrder.size() * 2);\n        final Map<PortalDataKey, IPortalDataType> dataKeyTypes =\n                new LinkedHashMap<>(dataTypeImportOrder.size() * 2);\n\n        for (final IPortalDataType portalDataType : dataTypeImportOrder) {\n            final List<PortalDataKey> supportedDataKeys = portalDataType.getDataKeyImportOrder();\n            for (final PortalDataKey portalDataKey : supportedDataKeys) {\n                dataKeyImportOrder.add(portalDataKey);\n                dataKeyTypes.put(portalDataKey, portalDataType);\n            }\n        }\n\n        dataKeyImportOrder.trimToSize();\n        this.dataKeyImportOrder = Collections.unmodifiableList(dataKeyImportOrder);\n        this.dataKeyTypes = Collections.unmodifiableMap(dataKeyTypes);\n    }", "code_tokens": ["@", "Autowired", "public", "void", "setDataTypeImportOrder", "(", "List", "<", "IPortalDataType", ">", "dataTypeImportOrder", ")", "{", "final", "ArrayList", "<", "PortalDataKey", ">", "dataKeyImportOrder", "=", "new", "ArrayList", "<>", "(", "dataTypeImportOrder", ".", "size", "(", ")", "*", "2", ")", ";", "final", "Map", "<", "PortalDataKey", ",", "IPortalDataType", ">", "dataKeyTypes", "=", "new", "LinkedHashMap", "<>", "(", "dataTypeImportOrder", ".", "size", "(", ")", "*", "2", ")", ";", "for", "(", "final", "IPortalDataType", "portalDataType", ":", "dataTypeImportOrder", ")", "{", "final", "List", "<", "PortalDataKey", ">", "supportedDataKeys", "=", "portalDataType", ".", "getDataKeyImportOrder", "(", ")", ";", "for", "(", "final", "PortalDataKey", "portalDataKey", ":", "supportedDataKeys", ")", "{", "dataKeyImportOrder", ".", "add", "(", "portalDataKey", ")", ";", "dataKeyTypes", ".", "put", "(", "portalDataKey", ",", "portalDataType", ")", ";", "}", "}", "dataKeyImportOrder", ".", "trimToSize", "(", ")", ";", "this", ".", "dataKeyImportOrder", "=", "Collections", ".", "unmodifiableList", "(", "dataKeyImportOrder", ")", ";", "this", ".", "dataKeyTypes", "=", "Collections", ".", "unmodifiableMap", "(", "dataKeyTypes", ")", ";", "}"], "docstring": "The <code>@Autowired</code> list will reflect the order in which data types should be\nimported.", "docstring_tokens": ["The", "<code", ">"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java#L200-L218", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java", "func_name": "JaxbPortalDataHandlerService.setDataFileIncludes", "original_string": "@javax.annotation.Resource(name = \"dataFileIncludes\")\n    public void setDataFileIncludes(Set<String> dataFileIncludes) {\n        this.dataFileIncludes = dataFileIncludes;\n    }", "language": "java", "code": "@javax.annotation.Resource(name = \"dataFileIncludes\")\n    public void setDataFileIncludes(Set<String> dataFileIncludes) {\n        this.dataFileIncludes = dataFileIncludes;\n    }", "code_tokens": ["@", "javax", ".", "annotation", ".", "Resource", "(", "name", "=", "\"dataFileIncludes\"", ")", "public", "void", "setDataFileIncludes", "(", "Set", "<", "String", ">", "dataFileIncludes", ")", "{", "this", ".", "dataFileIncludes", "=", "dataFileIncludes", ";", "}"], "docstring": "Ant path matching patterns that files must match to be included", "docstring_tokens": ["Ant", "path", "matching", "patterns", "that", "files", "must", "match", "to", "be", "included"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java#L221-L224", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java", "func_name": "JaxbPortalDataHandlerService.setDataImporters", "original_string": "@Autowired(required = false)\n    public void setDataImporters(Collection<IDataImporter<? extends Object>> dataImporters) {\n        this.dataImporters = dataImporters;\n    }", "language": "java", "code": "@Autowired(required = false)\n    public void setDataImporters(Collection<IDataImporter<? extends Object>> dataImporters) {\n        this.dataImporters = dataImporters;\n    }", "code_tokens": ["@", "Autowired", "(", "required", "=", "false", ")", "public", "void", "setDataImporters", "(", "Collection", "<", "IDataImporter", "<", "?", "extends", "Object", ">", ">", "dataImporters", ")", "{", "this", ".", "dataImporters", "=", "dataImporters", ";", "}"], "docstring": "{@link IDataImporter} implementations to delegate import operations to.", "docstring_tokens": ["{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java#L235-L238", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java", "func_name": "JaxbPortalDataHandlerService.setDataExporters", "original_string": "@Autowired(required = false)\n    public void setDataExporters(Collection<IDataExporter<? extends Object>> dataExporters) {\n        this.dataExporters = dataExporters;\n    }", "language": "java", "code": "@Autowired(required = false)\n    public void setDataExporters(Collection<IDataExporter<? extends Object>> dataExporters) {\n        this.dataExporters = dataExporters;\n    }", "code_tokens": ["@", "Autowired", "(", "required", "=", "false", ")", "public", "void", "setDataExporters", "(", "Collection", "<", "IDataExporter", "<", "?", "extends", "Object", ">", ">", "dataExporters", ")", "{", "this", ".", "dataExporters", "=", "dataExporters", ";", "}"], "docstring": "{@link IDataExporter} implementations to delegate export operations to.", "docstring_tokens": ["{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java#L241-L244", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java", "func_name": "JaxbPortalDataHandlerService.setDataDeleters", "original_string": "@Autowired(required = false)\n    public void setDataDeleters(Collection<IDataDeleter<? extends Object>> dataDeleters) {\n        this.dataDeleters = dataDeleters;\n    }", "language": "java", "code": "@Autowired(required = false)\n    public void setDataDeleters(Collection<IDataDeleter<? extends Object>> dataDeleters) {\n        this.dataDeleters = dataDeleters;\n    }", "code_tokens": ["@", "Autowired", "(", "required", "=", "false", ")", "public", "void", "setDataDeleters", "(", "Collection", "<", "IDataDeleter", "<", "?", "extends", "Object", ">", ">", "dataDeleters", ")", "{", "this", ".", "dataDeleters", "=", "dataDeleters", ";", "}"], "docstring": "{@link IDataDeleter} implementations to delegate delete operations to.", "docstring_tokens": ["{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java#L247-L250", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java", "func_name": "JaxbPortalDataHandlerService.initDataUpgraders", "original_string": "private void initDataUpgraders() {\n        final Map<PortalDataKey, IDataUpgrader> dataUpgraderMap = new LinkedHashMap<>();\n\n        for (final IDataUpgrader dataUpgrader : dataUpgraders) {\n\n            try {\n\n                final Set<PortalDataKey> upgradeDataKeys = dataUpgrader.getSourceDataTypes();\n                for (final PortalDataKey upgradeDataKey : upgradeDataKeys) {\n                    this.logger.debug(\n                            \"Registering IDataUpgrader for '{}' - {}\",\n                            upgradeDataKey,\n                            dataUpgrader);\n                    final IDataUpgrader existing =\n                            dataUpgraderMap.put(upgradeDataKey, dataUpgrader);\n                    if (existing != null) {\n                        this.logger.warn(\n                                \"Duplicate IDataUpgrader PortalDataKey for {} Replacing {} with {}\",\n                                upgradeDataKey,\n                                existing,\n                                dataUpgrader);\n                    }\n                }\n\n            } catch (Exception exception) {\n                logger.error(\"Failed to register data upgrader {}.\", dataUpgrader, exception);\n            }\n        }\n\n        this.portalDataUpgraders = Collections.unmodifiableMap(dataUpgraderMap);\n    }", "language": "java", "code": "private void initDataUpgraders() {\n        final Map<PortalDataKey, IDataUpgrader> dataUpgraderMap = new LinkedHashMap<>();\n\n        for (final IDataUpgrader dataUpgrader : dataUpgraders) {\n\n            try {\n\n                final Set<PortalDataKey> upgradeDataKeys = dataUpgrader.getSourceDataTypes();\n                for (final PortalDataKey upgradeDataKey : upgradeDataKeys) {\n                    this.logger.debug(\n                            \"Registering IDataUpgrader for '{}' - {}\",\n                            upgradeDataKey,\n                            dataUpgrader);\n                    final IDataUpgrader existing =\n                            dataUpgraderMap.put(upgradeDataKey, dataUpgrader);\n                    if (existing != null) {\n                        this.logger.warn(\n                                \"Duplicate IDataUpgrader PortalDataKey for {} Replacing {} with {}\",\n                                upgradeDataKey,\n                                existing,\n                                dataUpgrader);\n                    }\n                }\n\n            } catch (Exception exception) {\n                logger.error(\"Failed to register data upgrader {}.\", dataUpgrader, exception);\n            }\n        }\n\n        this.portalDataUpgraders = Collections.unmodifiableMap(dataUpgraderMap);\n    }", "code_tokens": ["private", "void", "initDataUpgraders", "(", ")", "{", "final", "Map", "<", "PortalDataKey", ",", "IDataUpgrader", ">", "dataUpgraderMap", "=", "new", "LinkedHashMap", "<>", "(", ")", ";", "for", "(", "final", "IDataUpgrader", "dataUpgrader", ":", "dataUpgraders", ")", "{", "try", "{", "final", "Set", "<", "PortalDataKey", ">", "upgradeDataKeys", "=", "dataUpgrader", ".", "getSourceDataTypes", "(", ")", ";", "for", "(", "final", "PortalDataKey", "upgradeDataKey", ":", "upgradeDataKeys", ")", "{", "this", ".", "logger", ".", "debug", "(", "\"Registering IDataUpgrader for '{}' - {}\"", ",", "upgradeDataKey", ",", "dataUpgrader", ")", ";", "final", "IDataUpgrader", "existing", "=", "dataUpgraderMap", ".", "put", "(", "upgradeDataKey", ",", "dataUpgrader", ")", ";", "if", "(", "existing", "!=", "null", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"Duplicate IDataUpgrader PortalDataKey for {} Replacing {} with {}\"", ",", "upgradeDataKey", ",", "existing", ",", "dataUpgrader", ")", ";", "}", "}", "}", "catch", "(", "Exception", "exception", ")", "{", "logger", ".", "error", "(", "\"Failed to register data upgrader {}.\"", ",", "dataUpgrader", ",", "exception", ")", ";", "}", "}", "this", ".", "portalDataUpgraders", "=", "Collections", ".", "unmodifiableMap", "(", "dataUpgraderMap", ")", ";", "}"], "docstring": "{@link IDataUpgrader} implementations to delegate upgrade operations to.", "docstring_tokens": ["{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java#L385-L415", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java", "func_name": "JaxbPortalDataHandlerService.importDataArchive", "original_string": "private void importDataArchive(\n            final Resource resource,\n            final ArchiveInputStream resourceStream,\n            BatchImportOptions options) {\n\n        final File tempDir = Files.createTempDir();\n        try {\n            ArchiveEntry archiveEntry;\n            while ((archiveEntry = resourceStream.getNextEntry()) != null) {\n                final File entryFile = new File(tempDir, archiveEntry.getName());\n                if (!archiveEntry.isDirectory()) {\n                    entryFile.getParentFile().mkdirs();\n                    IOUtils.copy(\n                            new CloseShieldInputStream(resourceStream),\n                            new FileOutputStream(entryFile));\n                }\n            }\n\n            importDataDirectory(tempDir, null, options);\n        } catch (IOException e) {\n            throw new RuntimeException(\n                    \"Failed to extract data from '\"\n                            + resource\n                            + \"' to '\"\n                            + tempDir\n                            + \"' for batch import.\",\n                    e);\n        } finally {\n            FileUtils.deleteQuietly(tempDir);\n        }\n    }", "language": "java", "code": "private void importDataArchive(\n            final Resource resource,\n            final ArchiveInputStream resourceStream,\n            BatchImportOptions options) {\n\n        final File tempDir = Files.createTempDir();\n        try {\n            ArchiveEntry archiveEntry;\n            while ((archiveEntry = resourceStream.getNextEntry()) != null) {\n                final File entryFile = new File(tempDir, archiveEntry.getName());\n                if (!archiveEntry.isDirectory()) {\n                    entryFile.getParentFile().mkdirs();\n                    IOUtils.copy(\n                            new CloseShieldInputStream(resourceStream),\n                            new FileOutputStream(entryFile));\n                }\n            }\n\n            importDataDirectory(tempDir, null, options);\n        } catch (IOException e) {\n            throw new RuntimeException(\n                    \"Failed to extract data from '\"\n                            + resource\n                            + \"' to '\"\n                            + tempDir\n                            + \"' for batch import.\",\n                    e);\n        } finally {\n            FileUtils.deleteQuietly(tempDir);\n        }\n    }", "code_tokens": ["private", "void", "importDataArchive", "(", "final", "Resource", "resource", ",", "final", "ArchiveInputStream", "resourceStream", ",", "BatchImportOptions", "options", ")", "{", "final", "File", "tempDir", "=", "Files", ".", "createTempDir", "(", ")", ";", "try", "{", "ArchiveEntry", "archiveEntry", ";", "while", "(", "(", "archiveEntry", "=", "resourceStream", ".", "getNextEntry", "(", ")", ")", "!=", "null", ")", "{", "final", "File", "entryFile", "=", "new", "File", "(", "tempDir", ",", "archiveEntry", ".", "getName", "(", ")", ")", ";", "if", "(", "!", "archiveEntry", ".", "isDirectory", "(", ")", ")", "{", "entryFile", ".", "getParentFile", "(", ")", ".", "mkdirs", "(", ")", ";", "IOUtils", ".", "copy", "(", "new", "CloseShieldInputStream", "(", "resourceStream", ")", ",", "new", "FileOutputStream", "(", "entryFile", ")", ")", ";", "}", "}", "importDataDirectory", "(", "tempDir", ",", "null", ",", "options", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Failed to extract data from '\"", "+", "resource", "+", "\"' to '\"", "+", "tempDir", "+", "\"' for batch import.\"", ",", "e", ")", ";", "}", "finally", "{", "FileUtils", ".", "deleteQuietly", "(", "tempDir", ")", ";", "}", "}"], "docstring": "Extracts the archive resource and then runs the batch-import process on it.", "docstring_tokens": ["Extracts", "the", "archive", "resource", "and", "then", "runs", "the", "batch", "-", "import", "process", "on", "it", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java#L490-L520", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java", "func_name": "JaxbPortalDataHandlerService.determineLogDirectory", "original_string": "private File determineLogDirectory(final BatchOptions options, String operation) {\n        File logDirectoryParent = options != null ? options.getLogDirectoryParent() : null;\n        if (logDirectoryParent == null) {\n            logDirectoryParent = Files.createTempDir();\n        }\n        File logDirectory = new File(logDirectoryParent, \"data-\" + operation + \"-reports\");\n        try {\n            logDirectory = logDirectory.getCanonicalFile();\n            FileUtils.deleteDirectory(logDirectory);\n        } catch (IOException e) {\n            throw new RuntimeException(\n                    \"Failed to clean data-\" + operation + \" log directory: \" + logDirectory, e);\n        }\n        logDirectory.mkdirs();\n        return logDirectory;\n    }", "language": "java", "code": "private File determineLogDirectory(final BatchOptions options, String operation) {\n        File logDirectoryParent = options != null ? options.getLogDirectoryParent() : null;\n        if (logDirectoryParent == null) {\n            logDirectoryParent = Files.createTempDir();\n        }\n        File logDirectory = new File(logDirectoryParent, \"data-\" + operation + \"-reports\");\n        try {\n            logDirectory = logDirectory.getCanonicalFile();\n            FileUtils.deleteDirectory(logDirectory);\n        } catch (IOException e) {\n            throw new RuntimeException(\n                    \"Failed to clean data-\" + operation + \" log directory: \" + logDirectory, e);\n        }\n        logDirectory.mkdirs();\n        return logDirectory;\n    }", "code_tokens": ["private", "File", "determineLogDirectory", "(", "final", "BatchOptions", "options", ",", "String", "operation", ")", "{", "File", "logDirectoryParent", "=", "options", "!=", "null", "?", "options", ".", "getLogDirectoryParent", "(", ")", ":", "null", ";", "if", "(", "logDirectoryParent", "==", "null", ")", "{", "logDirectoryParent", "=", "Files", ".", "createTempDir", "(", ")", ";", "}", "File", "logDirectory", "=", "new", "File", "(", "logDirectoryParent", ",", "\"data-\"", "+", "operation", "+", "\"-reports\"", ")", ";", "try", "{", "logDirectory", "=", "logDirectory", ".", "getCanonicalFile", "(", ")", ";", "FileUtils", ".", "deleteDirectory", "(", "logDirectory", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Failed to clean data-\"", "+", "operation", "+", "\" log directory: \"", "+", "logDirectory", ",", "e", ")", ";", "}", "logDirectory", ".", "mkdirs", "(", ")", ";", "return", "logDirectory", ";", "}"], "docstring": "Determine directory to log import/export reports to", "docstring_tokens": ["Determine", "directory", "to", "log", "import", "/", "export", "reports", "to"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java#L681-L696", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java", "func_name": "JaxbPortalDataHandlerService.importOrUpgradeData", "original_string": "private void importOrUpgradeData(\n            String systemId, PortalDataKey portalDataKey, XMLEventReader xmlEventReader) {\n        // See if there is a registered importer for the data, if so import\n        final IDataImporter<Object> dataImporterExporter =\n                this.portalDataImporters.get(portalDataKey);\n        if (dataImporterExporter != null) {\n            this.logger.debug(\"Importing: {}\", getPartialSystemId(systemId));\n            final Object data = unmarshallData(xmlEventReader, dataImporterExporter);\n            dataImporterExporter.importData(data);\n            this.logger.info(\"Imported : {}\", getPartialSystemId(systemId));\n            return;\n        }\n\n        // No importer, see if there is an upgrader, if so upgrade\n        final IDataUpgrader dataUpgrader = this.portalDataUpgraders.get(portalDataKey);\n        if (dataUpgrader != null) {\n            this.logger.debug(\"Upgrading: {}\", getPartialSystemId(systemId));\n\n            // Convert the StAX stream to a DOM node, due to poor JDK support for StAX with XSLT\n            final Node sourceNode;\n            try {\n                sourceNode = xmlUtilities.convertToDom(xmlEventReader);\n            } catch (XMLStreamException e) {\n                throw new RuntimeException(\n                        \"Failed to create StAXSource from original XML reader\", e);\n            }\n            final DOMSource source = new DOMSource(sourceNode);\n\n            final DOMResult result = new DOMResult();\n            final boolean doImport = dataUpgrader.upgradeData(source, result);\n            if (doImport) {\n                // If the upgrader didn't handle the import as well wrap the result DOM in a new\n                // Source and start the import process over again\n                final org.w3c.dom.Node node = result.getNode();\n                final PortalDataKey upgradedPortalDataKey = new PortalDataKey(node);\n                if (this.logger.isTraceEnabled()) {\n                    this.logger.trace(\n                            \"Upgraded: \"\n                                    + getPartialSystemId(systemId)\n                                    + \" to \"\n                                    + upgradedPortalDataKey\n                                    + \"\\n\\nSource XML: \\n\"\n                                    + XmlUtilitiesImpl.toString(source.getNode())\n                                    + \"\\n\\nResult XML: \\n\"\n                                    + XmlUtilitiesImpl.toString(node));\n                } else {\n                    this.logger.info(\n                            \"Upgraded: {} to {}\",\n                            getPartialSystemId(systemId),\n                            upgradedPortalDataKey);\n                }\n                final DOMSource upgradedSource = new DOMSource(node, systemId);\n                this.importData(upgradedSource, upgradedPortalDataKey);\n            } else {\n                this.logger.info(\"Upgraded and Imported: {}\", getPartialSystemId(systemId));\n            }\n            return;\n        }\n\n        // No importer or upgrader found, fail\n        throw new IllegalArgumentException(\n                \"Provided data \"\n                        + portalDataKey\n                        + \" has no registered importer or upgrader support: \"\n                        + systemId);\n    }", "language": "java", "code": "private void importOrUpgradeData(\n            String systemId, PortalDataKey portalDataKey, XMLEventReader xmlEventReader) {\n        // See if there is a registered importer for the data, if so import\n        final IDataImporter<Object> dataImporterExporter =\n                this.portalDataImporters.get(portalDataKey);\n        if (dataImporterExporter != null) {\n            this.logger.debug(\"Importing: {}\", getPartialSystemId(systemId));\n            final Object data = unmarshallData(xmlEventReader, dataImporterExporter);\n            dataImporterExporter.importData(data);\n            this.logger.info(\"Imported : {}\", getPartialSystemId(systemId));\n            return;\n        }\n\n        // No importer, see if there is an upgrader, if so upgrade\n        final IDataUpgrader dataUpgrader = this.portalDataUpgraders.get(portalDataKey);\n        if (dataUpgrader != null) {\n            this.logger.debug(\"Upgrading: {}\", getPartialSystemId(systemId));\n\n            // Convert the StAX stream to a DOM node, due to poor JDK support for StAX with XSLT\n            final Node sourceNode;\n            try {\n                sourceNode = xmlUtilities.convertToDom(xmlEventReader);\n            } catch (XMLStreamException e) {\n                throw new RuntimeException(\n                        \"Failed to create StAXSource from original XML reader\", e);\n            }\n            final DOMSource source = new DOMSource(sourceNode);\n\n            final DOMResult result = new DOMResult();\n            final boolean doImport = dataUpgrader.upgradeData(source, result);\n            if (doImport) {\n                // If the upgrader didn't handle the import as well wrap the result DOM in a new\n                // Source and start the import process over again\n                final org.w3c.dom.Node node = result.getNode();\n                final PortalDataKey upgradedPortalDataKey = new PortalDataKey(node);\n                if (this.logger.isTraceEnabled()) {\n                    this.logger.trace(\n                            \"Upgraded: \"\n                                    + getPartialSystemId(systemId)\n                                    + \" to \"\n                                    + upgradedPortalDataKey\n                                    + \"\\n\\nSource XML: \\n\"\n                                    + XmlUtilitiesImpl.toString(source.getNode())\n                                    + \"\\n\\nResult XML: \\n\"\n                                    + XmlUtilitiesImpl.toString(node));\n                } else {\n                    this.logger.info(\n                            \"Upgraded: {} to {}\",\n                            getPartialSystemId(systemId),\n                            upgradedPortalDataKey);\n                }\n                final DOMSource upgradedSource = new DOMSource(node, systemId);\n                this.importData(upgradedSource, upgradedPortalDataKey);\n            } else {\n                this.logger.info(\"Upgraded and Imported: {}\", getPartialSystemId(systemId));\n            }\n            return;\n        }\n\n        // No importer or upgrader found, fail\n        throw new IllegalArgumentException(\n                \"Provided data \"\n                        + portalDataKey\n                        + \" has no registered importer or upgrader support: \"\n                        + systemId);\n    }", "code_tokens": ["private", "void", "importOrUpgradeData", "(", "String", "systemId", ",", "PortalDataKey", "portalDataKey", ",", "XMLEventReader", "xmlEventReader", ")", "{", "// See if there is a registered importer for the data, if so import", "final", "IDataImporter", "<", "Object", ">", "dataImporterExporter", "=", "this", ".", "portalDataImporters", ".", "get", "(", "portalDataKey", ")", ";", "if", "(", "dataImporterExporter", "!=", "null", ")", "{", "this", ".", "logger", ".", "debug", "(", "\"Importing: {}\"", ",", "getPartialSystemId", "(", "systemId", ")", ")", ";", "final", "Object", "data", "=", "unmarshallData", "(", "xmlEventReader", ",", "dataImporterExporter", ")", ";", "dataImporterExporter", ".", "importData", "(", "data", ")", ";", "this", ".", "logger", ".", "info", "(", "\"Imported : {}\"", ",", "getPartialSystemId", "(", "systemId", ")", ")", ";", "return", ";", "}", "// No importer, see if there is an upgrader, if so upgrade", "final", "IDataUpgrader", "dataUpgrader", "=", "this", ".", "portalDataUpgraders", ".", "get", "(", "portalDataKey", ")", ";", "if", "(", "dataUpgrader", "!=", "null", ")", "{", "this", ".", "logger", ".", "debug", "(", "\"Upgrading: {}\"", ",", "getPartialSystemId", "(", "systemId", ")", ")", ";", "// Convert the StAX stream to a DOM node, due to poor JDK support for StAX with XSLT", "final", "Node", "sourceNode", ";", "try", "{", "sourceNode", "=", "xmlUtilities", ".", "convertToDom", "(", "xmlEventReader", ")", ";", "}", "catch", "(", "XMLStreamException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Failed to create StAXSource from original XML reader\"", ",", "e", ")", ";", "}", "final", "DOMSource", "source", "=", "new", "DOMSource", "(", "sourceNode", ")", ";", "final", "DOMResult", "result", "=", "new", "DOMResult", "(", ")", ";", "final", "boolean", "doImport", "=", "dataUpgrader", ".", "upgradeData", "(", "source", ",", "result", ")", ";", "if", "(", "doImport", ")", "{", "// If the upgrader didn't handle the import as well wrap the result DOM in a new", "// Source and start the import process over again", "final", "org", ".", "w3c", ".", "dom", ".", "Node", "node", "=", "result", ".", "getNode", "(", ")", ";", "final", "PortalDataKey", "upgradedPortalDataKey", "=", "new", "PortalDataKey", "(", "node", ")", ";", "if", "(", "this", ".", "logger", ".", "isTraceEnabled", "(", ")", ")", "{", "this", ".", "logger", ".", "trace", "(", "\"Upgraded: \"", "+", "getPartialSystemId", "(", "systemId", ")", "+", "\" to \"", "+", "upgradedPortalDataKey", "+", "\"\\n\\nSource XML: \\n\"", "+", "XmlUtilitiesImpl", ".", "toString", "(", "source", ".", "getNode", "(", ")", ")", "+", "\"\\n\\nResult XML: \\n\"", "+", "XmlUtilitiesImpl", ".", "toString", "(", "node", ")", ")", ";", "}", "else", "{", "this", ".", "logger", ".", "info", "(", "\"Upgraded: {} to {}\"", ",", "getPartialSystemId", "(", "systemId", ")", ",", "upgradedPortalDataKey", ")", ";", "}", "final", "DOMSource", "upgradedSource", "=", "new", "DOMSource", "(", "node", ",", "systemId", ")", ";", "this", ".", "importData", "(", "upgradedSource", ",", "upgradedPortalDataKey", ")", ";", "}", "else", "{", "this", ".", "logger", ".", "info", "(", "\"Upgraded and Imported: {}\"", ",", "getPartialSystemId", "(", "systemId", ")", ")", ";", "}", "return", ";", "}", "// No importer or upgrader found, fail", "throw", "new", "IllegalArgumentException", "(", "\"Provided data \"", "+", "portalDataKey", "+", "\" has no registered importer or upgrader support: \"", "+", "systemId", ")", ";", "}"], "docstring": "Run the import/update process on the data", "docstring_tokens": ["Run", "the", "import", "/", "update", "process", "on", "the", "data"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java#L791-L856", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java", "func_name": "JaxbPortalDataHandlerService.waitForFutures", "original_string": "private List<FutureHolder<?>> waitForFutures(\n            final Queue<? extends FutureHolder<?>> futures,\n            final PrintWriter reportWriter,\n            final File reportDirectory,\n            final boolean wait)\n            throws InterruptedException {\n\n        final List<FutureHolder<?>> failedFutures = new LinkedList<>();\n\n        for (Iterator<? extends FutureHolder<?>> futuresItr = futures.iterator();\n                futuresItr.hasNext(); ) {\n            final FutureHolder<?> futureHolder = futuresItr.next();\n\n            // If waiting, or if not waiting but the future is already done do the get\n            final Future<?> future = futureHolder.getFuture();\n            if (wait || (!wait && future.isDone())) {\n                futuresItr.remove();\n\n                try {\n                    // Don't bother doing a get() on canceled futures\n                    if (!future.isCancelled()) {\n                        if (this.maxWait > 0) {\n                            future.get(this.maxWait, this.maxWaitTimeUnit);\n                        } else {\n                            future.get();\n                        }\n\n                        reportWriter.printf(\n                                REPORT_FORMAT,\n                                \"SUCCESS\",\n                                futureHolder.getDescription(),\n                                futureHolder.getExecutionTimeMillis());\n                    }\n                } catch (CancellationException e) {\n                    // Ignore cancellation exceptions\n                } catch (ExecutionException e) {\n                    logger.error(\"Failed: \" + futureHolder);\n\n                    futureHolder.setError(e);\n                    failedFutures.add(futureHolder);\n                    reportWriter.printf(\n                            REPORT_FORMAT,\n                            \"FAIL\",\n                            futureHolder.getDescription(),\n                            futureHolder.getExecutionTimeMillis());\n\n                    try {\n                        final String dataReportName =\n                                SafeFilenameUtils.makeSafeFilename(\n                                        futureHolder.getDataType()\n                                                + \"_\"\n                                                + futureHolder.getDataName()\n                                                + \".txt\");\n                        final File dataReportFile = new File(reportDirectory, dataReportName);\n                        final PrintWriter dataReportWriter =\n                                new PrintWriter(new BufferedWriter(new FileWriter(dataReportFile)));\n                        try {\n                            dataReportWriter.println(\n                                    \"FAIL: \"\n                                            + futureHolder.getDataType()\n                                            + \" - \"\n                                            + futureHolder.getDataName());\n                            dataReportWriter.println(\n                                    \"--------------------------------------------------------------------------------\");\n                            e.getCause().printStackTrace(dataReportWriter);\n                        } finally {\n                            IOUtils.closeQuietly(dataReportWriter);\n                        }\n                    } catch (Exception re) {\n                        logger.warn(\n                                \"Failed to write error report for failed \"\n                                        + futureHolder\n                                        + \", logging root failure here\",\n                                e.getCause());\n                    }\n                } catch (TimeoutException e) {\n                    logger.warn(\"Failed: \" + futureHolder);\n\n                    futureHolder.setError(e);\n                    failedFutures.add(futureHolder);\n                    future.cancel(true);\n                    reportWriter.printf(\n                            REPORT_FORMAT,\n                            \"TIMEOUT\",\n                            futureHolder.getDescription(),\n                            futureHolder.getExecutionTimeMillis());\n                }\n            }\n        }\n\n        return failedFutures;\n    }", "language": "java", "code": "private List<FutureHolder<?>> waitForFutures(\n            final Queue<? extends FutureHolder<?>> futures,\n            final PrintWriter reportWriter,\n            final File reportDirectory,\n            final boolean wait)\n            throws InterruptedException {\n\n        final List<FutureHolder<?>> failedFutures = new LinkedList<>();\n\n        for (Iterator<? extends FutureHolder<?>> futuresItr = futures.iterator();\n                futuresItr.hasNext(); ) {\n            final FutureHolder<?> futureHolder = futuresItr.next();\n\n            // If waiting, or if not waiting but the future is already done do the get\n            final Future<?> future = futureHolder.getFuture();\n            if (wait || (!wait && future.isDone())) {\n                futuresItr.remove();\n\n                try {\n                    // Don't bother doing a get() on canceled futures\n                    if (!future.isCancelled()) {\n                        if (this.maxWait > 0) {\n                            future.get(this.maxWait, this.maxWaitTimeUnit);\n                        } else {\n                            future.get();\n                        }\n\n                        reportWriter.printf(\n                                REPORT_FORMAT,\n                                \"SUCCESS\",\n                                futureHolder.getDescription(),\n                                futureHolder.getExecutionTimeMillis());\n                    }\n                } catch (CancellationException e) {\n                    // Ignore cancellation exceptions\n                } catch (ExecutionException e) {\n                    logger.error(\"Failed: \" + futureHolder);\n\n                    futureHolder.setError(e);\n                    failedFutures.add(futureHolder);\n                    reportWriter.printf(\n                            REPORT_FORMAT,\n                            \"FAIL\",\n                            futureHolder.getDescription(),\n                            futureHolder.getExecutionTimeMillis());\n\n                    try {\n                        final String dataReportName =\n                                SafeFilenameUtils.makeSafeFilename(\n                                        futureHolder.getDataType()\n                                                + \"_\"\n                                                + futureHolder.getDataName()\n                                                + \".txt\");\n                        final File dataReportFile = new File(reportDirectory, dataReportName);\n                        final PrintWriter dataReportWriter =\n                                new PrintWriter(new BufferedWriter(new FileWriter(dataReportFile)));\n                        try {\n                            dataReportWriter.println(\n                                    \"FAIL: \"\n                                            + futureHolder.getDataType()\n                                            + \" - \"\n                                            + futureHolder.getDataName());\n                            dataReportWriter.println(\n                                    \"--------------------------------------------------------------------------------\");\n                            e.getCause().printStackTrace(dataReportWriter);\n                        } finally {\n                            IOUtils.closeQuietly(dataReportWriter);\n                        }\n                    } catch (Exception re) {\n                        logger.warn(\n                                \"Failed to write error report for failed \"\n                                        + futureHolder\n                                        + \", logging root failure here\",\n                                e.getCause());\n                    }\n                } catch (TimeoutException e) {\n                    logger.warn(\"Failed: \" + futureHolder);\n\n                    futureHolder.setError(e);\n                    failedFutures.add(futureHolder);\n                    future.cancel(true);\n                    reportWriter.printf(\n                            REPORT_FORMAT,\n                            \"TIMEOUT\",\n                            futureHolder.getDescription(),\n                            futureHolder.getExecutionTimeMillis());\n                }\n            }\n        }\n\n        return failedFutures;\n    }", "code_tokens": ["private", "List", "<", "FutureHolder", "<", "?", ">", ">", "waitForFutures", "(", "final", "Queue", "<", "?", "extends", "FutureHolder", "<", "?", ">", ">", "futures", ",", "final", "PrintWriter", "reportWriter", ",", "final", "File", "reportDirectory", ",", "final", "boolean", "wait", ")", "throws", "InterruptedException", "{", "final", "List", "<", "FutureHolder", "<", "?", ">", ">", "failedFutures", "=", "new", "LinkedList", "<>", "(", ")", ";", "for", "(", "Iterator", "<", "?", "extends", "FutureHolder", "<", "?", ">", ">", "futuresItr", "=", "futures", ".", "iterator", "(", ")", ";", "futuresItr", ".", "hasNext", "(", ")", ";", ")", "{", "final", "FutureHolder", "<", "?", ">", "futureHolder", "=", "futuresItr", ".", "next", "(", ")", ";", "// If waiting, or if not waiting but the future is already done do the get", "final", "Future", "<", "?", ">", "future", "=", "futureHolder", ".", "getFuture", "(", ")", ";", "if", "(", "wait", "||", "(", "!", "wait", "&&", "future", ".", "isDone", "(", ")", ")", ")", "{", "futuresItr", ".", "remove", "(", ")", ";", "try", "{", "// Don't bother doing a get() on canceled futures", "if", "(", "!", "future", ".", "isCancelled", "(", ")", ")", "{", "if", "(", "this", ".", "maxWait", ">", "0", ")", "{", "future", ".", "get", "(", "this", ".", "maxWait", ",", "this", ".", "maxWaitTimeUnit", ")", ";", "}", "else", "{", "future", ".", "get", "(", ")", ";", "}", "reportWriter", ".", "printf", "(", "REPORT_FORMAT", ",", "\"SUCCESS\"", ",", "futureHolder", ".", "getDescription", "(", ")", ",", "futureHolder", ".", "getExecutionTimeMillis", "(", ")", ")", ";", "}", "}", "catch", "(", "CancellationException", "e", ")", "{", "// Ignore cancellation exceptions", "}", "catch", "(", "ExecutionException", "e", ")", "{", "logger", ".", "error", "(", "\"Failed: \"", "+", "futureHolder", ")", ";", "futureHolder", ".", "setError", "(", "e", ")", ";", "failedFutures", ".", "add", "(", "futureHolder", ")", ";", "reportWriter", ".", "printf", "(", "REPORT_FORMAT", ",", "\"FAIL\"", ",", "futureHolder", ".", "getDescription", "(", ")", ",", "futureHolder", ".", "getExecutionTimeMillis", "(", ")", ")", ";", "try", "{", "final", "String", "dataReportName", "=", "SafeFilenameUtils", ".", "makeSafeFilename", "(", "futureHolder", ".", "getDataType", "(", ")", "+", "\"_\"", "+", "futureHolder", ".", "getDataName", "(", ")", "+", "\".txt\"", ")", ";", "final", "File", "dataReportFile", "=", "new", "File", "(", "reportDirectory", ",", "dataReportName", ")", ";", "final", "PrintWriter", "dataReportWriter", "=", "new", "PrintWriter", "(", "new", "BufferedWriter", "(", "new", "FileWriter", "(", "dataReportFile", ")", ")", ")", ";", "try", "{", "dataReportWriter", ".", "println", "(", "\"FAIL: \"", "+", "futureHolder", ".", "getDataType", "(", ")", "+", "\" - \"", "+", "futureHolder", ".", "getDataName", "(", ")", ")", ";", "dataReportWriter", ".", "println", "(", "\"--------------------------------------------------------------------------------\"", ")", ";", "e", ".", "getCause", "(", ")", ".", "printStackTrace", "(", "dataReportWriter", ")", ";", "}", "finally", "{", "IOUtils", ".", "closeQuietly", "(", "dataReportWriter", ")", ";", "}", "}", "catch", "(", "Exception", "re", ")", "{", "logger", ".", "warn", "(", "\"Failed to write error report for failed \"", "+", "futureHolder", "+", "\", logging root failure here\"", ",", "e", ".", "getCause", "(", ")", ")", ";", "}", "}", "catch", "(", "TimeoutException", "e", ")", "{", "logger", ".", "warn", "(", "\"Failed: \"", "+", "futureHolder", ")", ";", "futureHolder", ".", "setError", "(", "e", ")", ";", "failedFutures", ".", "add", "(", "futureHolder", ")", ";", "future", ".", "cancel", "(", "true", ")", ";", "reportWriter", ".", "printf", "(", "REPORT_FORMAT", ",", "\"TIMEOUT\"", ",", "futureHolder", ".", "getDescription", "(", ")", ",", "futureHolder", ".", "getExecutionTimeMillis", "(", ")", ")", ";", "}", "}", "}", "return", "failedFutures", ";", "}"], "docstring": "Used by batch import and export to wait for queued tasks to complete. Handles fail-fast\nbehavior if any of the tasks threw and exception by canceling all queued futures and logging\na summary of the failures. All completed futures are removed from the queue.\n\n@param futures Queued futures to check for completeness\n@param wait If true it will wait for all futures to complete, if false only check for\ncompleted futures\n@return a list of futures that either threw exceptions or timed out", "docstring_tokens": ["Used", "by", "batch", "import", "and", "export", "to", "wait", "for", "queued", "tasks", "to", "complete", ".", "Handles", "fail", "-", "fast", "behavior", "if", "any", "of", "the", "tasks", "threw", "and", "exception", "by", "canceling", "all", "queued", "futures", "and", "logging", "a", "summary", "of", "the", "failures", ".", "All", "completed", "futures", "are", "removed", "from", "the", "queue", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/JaxbPortalDataHandlerService.java#L1123-L1214", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/node/UserLayoutChannelDescription.java", "func_name": "UserLayoutChannelDescription.setParameterValue", "original_string": "@Override\n    public String setParameterValue(String parameterName, String parameterValue) {\n        // don't try to store a null value\n        if (parameterValue == null) return null;\n        return (String) parameters.put(parameterName, parameterValue);\n    }", "language": "java", "code": "@Override\n    public String setParameterValue(String parameterName, String parameterValue) {\n        // don't try to store a null value\n        if (parameterValue == null) return null;\n        return (String) parameters.put(parameterName, parameterValue);\n    }", "code_tokens": ["@", "Override", "public", "String", "setParameterValue", "(", "String", "parameterName", ",", "String", "parameterValue", ")", "{", "// don't try to store a null value", "if", "(", "parameterValue", "==", "null", ")", "return", "null", ";", "return", "(", "String", ")", "parameters", ".", "put", "(", "parameterName", ",", "parameterValue", ")", ";", "}"], "docstring": "Set a channel parameter value.\n\n@param parameterValue a <code>String</code> value\n@param parameterName a <code>String</code> value\n@return a <code>String</code> value that was set.", "docstring_tokens": ["Set", "a", "channel", "parameter", "value", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/node/UserLayoutChannelDescription.java#L374-L379", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/GenerateEntityFileNameTask.java", "func_name": "GenerateEntityFileNameTask.init", "original_string": "@Override\n    public void init(EntityConfig config) {\n\n        // Lock & load reagents\n        this.entityElement = (Phrase) config.getValue(ENTITY_ELEMENT);\n        this.layoutStore = (Phrase) config.getValue(LAYOUT_STORE);\n    }", "language": "java", "code": "@Override\n    public void init(EntityConfig config) {\n\n        // Lock & load reagents\n        this.entityElement = (Phrase) config.getValue(ENTITY_ELEMENT);\n        this.layoutStore = (Phrase) config.getValue(LAYOUT_STORE);\n    }", "code_tokens": ["@", "Override", "public", "void", "init", "(", "EntityConfig", "config", ")", "{", "// Lock & load reagents", "this", ".", "entityElement", "=", "(", "Phrase", ")", "config", ".", "getValue", "(", "ENTITY_ELEMENT", ")", ";", "this", ".", "layoutStore", "=", "(", "Phrase", ")", "config", ".", "getValue", "(", "LAYOUT_STORE", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.danann.cernunnos.Bootstrappable#init(org.danann.cernunnos.EntityConfig)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/GenerateEntityFileNameTask.java#L66-L72", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/GenerateEntityFileNameTask.java", "func_name": "GenerateEntityFileNameTask.perform", "original_string": "@Override\n    public void perform(TaskRequest req, TaskResponse res) {\n        final Element rootElement = (Element) entityElement.evaluate(req, res);\n        final IUserLayoutStore rdbmdls = (IUserLayoutStore) layoutStore.evaluate(req, res);\n        SupportedFileTypes y = SupportedFileTypes.getApplicableFileType(rootElement, rdbmdls);\n        String entityFileName = y.getSafeFileNameWithExtension(rootElement);\n        ReturnValue rslt = (ReturnValue) req.getAttribute(Attributes.RETURN_VALUE);\n        rslt.setValue(entityFileName);\n    }", "language": "java", "code": "@Override\n    public void perform(TaskRequest req, TaskResponse res) {\n        final Element rootElement = (Element) entityElement.evaluate(req, res);\n        final IUserLayoutStore rdbmdls = (IUserLayoutStore) layoutStore.evaluate(req, res);\n        SupportedFileTypes y = SupportedFileTypes.getApplicableFileType(rootElement, rdbmdls);\n        String entityFileName = y.getSafeFileNameWithExtension(rootElement);\n        ReturnValue rslt = (ReturnValue) req.getAttribute(Attributes.RETURN_VALUE);\n        rslt.setValue(entityFileName);\n    }", "code_tokens": ["@", "Override", "public", "void", "perform", "(", "TaskRequest", "req", ",", "TaskResponse", "res", ")", "{", "final", "Element", "rootElement", "=", "(", "Element", ")", "entityElement", ".", "evaluate", "(", "req", ",", "res", ")", ";", "final", "IUserLayoutStore", "rdbmdls", "=", "(", "IUserLayoutStore", ")", "layoutStore", ".", "evaluate", "(", "req", ",", "res", ")", ";", "SupportedFileTypes", "y", "=", "SupportedFileTypes", ".", "getApplicableFileType", "(", "rootElement", ",", "rdbmdls", ")", ";", "String", "entityFileName", "=", "y", ".", "getSafeFileNameWithExtension", "(", "rootElement", ")", ";", "ReturnValue", "rslt", "=", "(", "ReturnValue", ")", "req", ".", "getAttribute", "(", "Attributes", ".", "RETURN_VALUE", ")", ";", "rslt", ".", "setValue", "(", "entityFileName", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.danann.cernunnos.Phrase#evaluate(org.danann.cernunnos.TaskRequest, org.danann.cernunnos.TaskResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/GenerateEntityFileNameTask.java#L86-L94", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-events/src/main/java/org/apereo/portal/events/handlers/QueueingEventHandler.java", "func_name": "QueueingEventHandler.flush", "original_string": "public final void flush() {\n        if (eventQueue.isEmpty()) {\n            // No events to flush\n            logger.trace(\"No events to flush, returning.\");\n            return;\n        }\n\n        // Only one thread should be flushing at a time, try to get the flush lock and if it\n        // is already held just return.\n        if (!this.flushLock.tryLock()) {\n            logger.trace(\"FlushLock already held, returning.\");\n            return;\n        }\n        try {\n            while (!this.eventQueue.isEmpty()) {\n                // Clear the buffer for re-use\n                eventBuffer.clear();\n\n                // Pop events off the queue into the buffer\n                while (!this.eventQueue.isEmpty() && eventBuffer.size() < this.batchSize) {\n                    final E event = eventQueue.poll();\n                    eventBuffer.add(event);\n                }\n\n                if (this.logger.isDebugEnabled()) {\n                    this.logger.debug(\"Flushing \" + eventBuffer.size() + \" events\");\n                }\n\n                // Write events out to batching listener\n                try {\n                    this.onApplicationEvents(eventBuffer);\n                } catch (Throwable t) {\n                    this.logger.error(\n                            \"An exception was thrown while trying to flush \"\n                                    + eventBuffer.size()\n                                    + \" events\",\n                            t);\n\n                    final StringBuilder failedEvents = new StringBuilder();\n                    failedEvents.append(\n                            \"The following events that were being flushed, some may have been persisted correctly\");\n\n                    for (final E portalEvent : eventBuffer) {\n                        failedEvents.append(\"\\n\\t\");\n                        try {\n                            failedEvents.append(portalEvent.toString());\n                        } catch (Exception e) {\n                            failedEvents\n                                    .append(\"toString failed on a PortalEvent of type '\")\n                                    .append(portalEvent.getClass())\n                                    .append(\"': \")\n                                    .append(e);\n                        }\n                    }\n\n                    this.logger.error(failedEvents.toString(), t);\n                }\n            }\n\n        } finally {\n            // Clear the buffer to avoid memory leaks\n            eventBuffer.clear();\n\n            this.flushLock.unlock();\n        }\n    }", "language": "java", "code": "public final void flush() {\n        if (eventQueue.isEmpty()) {\n            // No events to flush\n            logger.trace(\"No events to flush, returning.\");\n            return;\n        }\n\n        // Only one thread should be flushing at a time, try to get the flush lock and if it\n        // is already held just return.\n        if (!this.flushLock.tryLock()) {\n            logger.trace(\"FlushLock already held, returning.\");\n            return;\n        }\n        try {\n            while (!this.eventQueue.isEmpty()) {\n                // Clear the buffer for re-use\n                eventBuffer.clear();\n\n                // Pop events off the queue into the buffer\n                while (!this.eventQueue.isEmpty() && eventBuffer.size() < this.batchSize) {\n                    final E event = eventQueue.poll();\n                    eventBuffer.add(event);\n                }\n\n                if (this.logger.isDebugEnabled()) {\n                    this.logger.debug(\"Flushing \" + eventBuffer.size() + \" events\");\n                }\n\n                // Write events out to batching listener\n                try {\n                    this.onApplicationEvents(eventBuffer);\n                } catch (Throwable t) {\n                    this.logger.error(\n                            \"An exception was thrown while trying to flush \"\n                                    + eventBuffer.size()\n                                    + \" events\",\n                            t);\n\n                    final StringBuilder failedEvents = new StringBuilder();\n                    failedEvents.append(\n                            \"The following events that were being flushed, some may have been persisted correctly\");\n\n                    for (final E portalEvent : eventBuffer) {\n                        failedEvents.append(\"\\n\\t\");\n                        try {\n                            failedEvents.append(portalEvent.toString());\n                        } catch (Exception e) {\n                            failedEvents\n                                    .append(\"toString failed on a PortalEvent of type '\")\n                                    .append(portalEvent.getClass())\n                                    .append(\"': \")\n                                    .append(e);\n                        }\n                    }\n\n                    this.logger.error(failedEvents.toString(), t);\n                }\n            }\n\n        } finally {\n            // Clear the buffer to avoid memory leaks\n            eventBuffer.clear();\n\n            this.flushLock.unlock();\n        }\n    }", "code_tokens": ["public", "final", "void", "flush", "(", ")", "{", "if", "(", "eventQueue", ".", "isEmpty", "(", ")", ")", "{", "// No events to flush", "logger", ".", "trace", "(", "\"No events to flush, returning.\"", ")", ";", "return", ";", "}", "// Only one thread should be flushing at a time, try to get the flush lock and if it", "// is already held just return.", "if", "(", "!", "this", ".", "flushLock", ".", "tryLock", "(", ")", ")", "{", "logger", ".", "trace", "(", "\"FlushLock already held, returning.\"", ")", ";", "return", ";", "}", "try", "{", "while", "(", "!", "this", ".", "eventQueue", ".", "isEmpty", "(", ")", ")", "{", "// Clear the buffer for re-use", "eventBuffer", ".", "clear", "(", ")", ";", "// Pop events off the queue into the buffer", "while", "(", "!", "this", ".", "eventQueue", ".", "isEmpty", "(", ")", "&&", "eventBuffer", ".", "size", "(", ")", "<", "this", ".", "batchSize", ")", "{", "final", "E", "event", "=", "eventQueue", ".", "poll", "(", ")", ";", "eventBuffer", ".", "add", "(", "event", ")", ";", "}", "if", "(", "this", ".", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "this", ".", "logger", ".", "debug", "(", "\"Flushing \"", "+", "eventBuffer", ".", "size", "(", ")", "+", "\" events\"", ")", ";", "}", "// Write events out to batching listener", "try", "{", "this", ".", "onApplicationEvents", "(", "eventBuffer", ")", ";", "}", "catch", "(", "Throwable", "t", ")", "{", "this", ".", "logger", ".", "error", "(", "\"An exception was thrown while trying to flush \"", "+", "eventBuffer", ".", "size", "(", ")", "+", "\" events\"", ",", "t", ")", ";", "final", "StringBuilder", "failedEvents", "=", "new", "StringBuilder", "(", ")", ";", "failedEvents", ".", "append", "(", "\"The following events that were being flushed, some may have been persisted correctly\"", ")", ";", "for", "(", "final", "E", "portalEvent", ":", "eventBuffer", ")", "{", "failedEvents", ".", "append", "(", "\"\\n\\t\"", ")", ";", "try", "{", "failedEvents", ".", "append", "(", "portalEvent", ".", "toString", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "failedEvents", ".", "append", "(", "\"toString failed on a PortalEvent of type '\"", ")", ".", "append", "(", "portalEvent", ".", "getClass", "(", ")", ")", ".", "append", "(", "\"': \"", ")", ".", "append", "(", "e", ")", ";", "}", "}", "this", ".", "logger", ".", "error", "(", "failedEvents", ".", "toString", "(", ")", ",", "t", ")", ";", "}", "}", "}", "finally", "{", "// Clear the buffer to avoid memory leaks", "eventBuffer", ".", "clear", "(", ")", ";", "this", ".", "flushLock", ".", "unlock", "(", ")", ";", "}", "}"], "docstring": "Flushes the queued PortalEvents to the configured {@link BatchingEventHandler}. If <code>\nforce</code> is false flushing only happens if there are enough events in the queue and a\nflush isn't already under way. If <code>force</code> is true all queued events will be\nflushed and the calling thread will wait until any previously executing flush call completes\nbefore flushing\n\n@param force Forces flushing events to the {@link BatchingEventHandler} even if there are\nfewer than <code>flushCount</code> PortalEvents in the queue.", "docstring_tokens": ["Flushes", "the", "queued", "PortalEvents", "to", "the", "configured", "{", "@link", "BatchingEventHandler", "}", ".", "If", "<code", ">", "force<", "/", "code", ">", "is", "false", "flushing", "only", "happens", "if", "there", "are", "enough", "events", "in", "the", "queue", "and", "a", "flush", "isn", "t", "already", "under", "way", ".", "If", "<code", ">", "force<", "/", "code", ">", "is", "true", "all", "queued", "events", "will", "be", "flushed", "and", "the", "calling", "thread", "will", "wait", "until", "any", "previously", "executing", "flush", "call", "completes", "before", "flushing"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-events/src/main/java/org/apereo/portal/events/handlers/QueueingEventHandler.java#L82-L147", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-web/src/main/java/org/apereo/portal/web/skin/ResourcesAggregationHelper.java", "func_name": "ResourcesAggregationHelper.setAggregationEnabled", "original_string": "public void setAggregationEnabled(boolean enabled) {\n        if (enabled) {\n            this.resourcesElementsProvider.setDefaultIncludedType(Included.AGGREGATED);\n        } else {\n            this.resourcesElementsProvider.setDefaultIncludedType(Included.PLAIN);\n        }\n    }", "language": "java", "code": "public void setAggregationEnabled(boolean enabled) {\n        if (enabled) {\n            this.resourcesElementsProvider.setDefaultIncludedType(Included.AGGREGATED);\n        } else {\n            this.resourcesElementsProvider.setDefaultIncludedType(Included.PLAIN);\n        }\n    }", "code_tokens": ["public", "void", "setAggregationEnabled", "(", "boolean", "enabled", ")", "{", "if", "(", "enabled", ")", "{", "this", ".", "resourcesElementsProvider", ".", "setDefaultIncludedType", "(", "Included", ".", "AGGREGATED", ")", ";", "}", "else", "{", "this", ".", "resourcesElementsProvider", ".", "setDefaultIncludedType", "(", "Included", ".", "PLAIN", ")", ";", "}", "}"], "docstring": "Toggle resources aggregation (if and only if value parameter differs from current value).", "docstring_tokens": ["Toggle", "resources", "aggregation", "(", "if", "and", "only", "if", "value", "parameter", "differs", "from", "current", "value", ")", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-web/src/main/java/org/apereo/portal/web/skin/ResourcesAggregationHelper.java#L48-L54", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/account/PersonForm.java", "func_name": "PersonForm.getCustomAttributes", "original_string": "public Map<String, StringListAttribute> getCustomAttributes() {\n        Map<String, StringListAttribute> rslt =\n                new HashMap<String, StringListAttribute>(attributes);\n        for (Preference p : accountEditAttributes) {\n            rslt.remove(p.getName());\n        }\n        return Collections.unmodifiableMap(rslt);\n    }", "language": "java", "code": "public Map<String, StringListAttribute> getCustomAttributes() {\n        Map<String, StringListAttribute> rslt =\n                new HashMap<String, StringListAttribute>(attributes);\n        for (Preference p : accountEditAttributes) {\n            rslt.remove(p.getName());\n        }\n        return Collections.unmodifiableMap(rslt);\n    }", "code_tokens": ["public", "Map", "<", "String", ",", "StringListAttribute", ">", "getCustomAttributes", "(", ")", "{", "Map", "<", "String", ",", "StringListAttribute", ">", "rslt", "=", "new", "HashMap", "<", "String", ",", "StringListAttribute", ">", "(", "attributes", ")", ";", "for", "(", "Preference", "p", ":", "accountEditAttributes", ")", "{", "rslt", ".", "remove", "(", "p", ".", "getName", "(", ")", ")", ";", "}", "return", "Collections", ".", "unmodifiableMap", "(", "rslt", ")", ";", "}"], "docstring": "Provides a collection of the user's attributes that are 'custom' in the sense that they are\nnot listed in the <code>accountEditAttributes</code> bean in userContext. This collection is\na subset of those that would be returned by the {@link getAttributes} method. This collection\nis <b>READ ONLY</b>.\n\n@return The user's attributes that are not listed in <code>accountEditAttributes</code>", "docstring_tokens": ["Provides", "a", "collection", "of", "the", "user", "s", "attributes", "that", "are", "custom", "in", "the", "sense", "that", "they", "are", "not", "listed", "in", "the", "<code", ">", "accountEditAttributes<", "/", "code", ">", "bean", "in", "userContext", ".", "This", "collection", "is", "a", "subset", "of", "those", "that", "would", "be", "returned", "by", "the", "{", "@link", "getAttributes", "}", "method", ".", "This", "collection", "is", "<b", ">", "READ", "ONLY<", "/", "b", ">", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/account/PersonForm.java#L83-L90", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-core/src/main/java/org/apereo/portal/services/PersonService.java", "func_name": "PersonService.getPerson", "original_string": "public IPerson getPerson(String username) {\n        final IPerson rslt = new PersonImpl();\n        rslt.setAttribute(IPerson.USERNAME, username);\n        rslt.setID(userIdentityStore.getPortalUserId(username));\n        rslt.setAttributes(personAttributeDao.getPerson(username).getAttributes());\n        return rslt;\n    }", "language": "java", "code": "public IPerson getPerson(String username) {\n        final IPerson rslt = new PersonImpl();\n        rslt.setAttribute(IPerson.USERNAME, username);\n        rslt.setID(userIdentityStore.getPortalUserId(username));\n        rslt.setAttributes(personAttributeDao.getPerson(username).getAttributes());\n        return rslt;\n    }", "code_tokens": ["public", "IPerson", "getPerson", "(", "String", "username", ")", "{", "final", "IPerson", "rslt", "=", "new", "PersonImpl", "(", ")", ";", "rslt", ".", "setAttribute", "(", "IPerson", ".", "USERNAME", ",", "username", ")", ";", "rslt", ".", "setID", "(", "userIdentityStore", ".", "getPortalUserId", "(", "username", ")", ")", ";", "rslt", ".", "setAttributes", "(", "personAttributeDao", ".", "getPerson", "(", "username", ")", ".", "getAttributes", "(", ")", ")", ";", "return", "rslt", ";", "}"], "docstring": "Obtain the fully-constructed {@link IPerson} associated witth the specified username.", "docstring_tokens": ["Obtain", "the", "fully", "-", "constructed", "{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-core/src/main/java/org/apereo/portal/services/PersonService.java#L40-L46", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-persondir/src/main/java/org/apereo/portal/persondir/ImpersonationStatusPersonAttributeDao.java", "func_name": "ImpersonationStatusPersonAttributeDao.getAvailableQueryAttributes", "original_string": "@Override\n    public Set<String> getAvailableQueryAttributes() {\n        final IUsernameAttributeProvider usernameAttributeProvider =\n                super.getUsernameAttributeProvider();\n        return Collections.singleton(usernameAttributeProvider.getUsernameAttribute());\n    }", "language": "java", "code": "@Override\n    public Set<String> getAvailableQueryAttributes() {\n        final IUsernameAttributeProvider usernameAttributeProvider =\n                super.getUsernameAttributeProvider();\n        return Collections.singleton(usernameAttributeProvider.getUsernameAttribute());\n    }", "code_tokens": ["@", "Override", "public", "Set", "<", "String", ">", "getAvailableQueryAttributes", "(", ")", "{", "final", "IUsernameAttributeProvider", "usernameAttributeProvider", "=", "super", ".", "getUsernameAttributeProvider", "(", ")", ";", "return", "Collections", ".", "singleton", "(", "usernameAttributeProvider", ".", "getUsernameAttribute", "(", ")", ")", ";", "}"], "docstring": "Returns an empty <code>Set</code>, per the API documentation, because we don't use any\nattributes in queries.", "docstring_tokens": ["Returns", "an", "empty", "<code", ">", "Set<", "/", "code", ">", "per", "the", "API", "documentation", "because", "we", "don", "t", "use", "any", "attributes", "in", "queries", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-persondir/src/main/java/org/apereo/portal/persondir/ImpersonationStatusPersonAttributeDao.java#L51-L56", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-platform-impl/src/main/java/org/apereo/portal/api/permissions/ApiPermissionsService.java", "func_name": "ApiPermissionsService.createAssignment", "original_string": "private Assignment createAssignment(\n            IPermission permission, IAuthorizationPrincipal authP, boolean inherited) {\n\n        Assignment rslt = null;\n\n        try {\n\n            // Owner\n            IPermissionOwner owner = permissionOwnerDao.getPermissionOwner(permission.getOwner());\n            Owner ownerImpl = new OwnerImpl(permission.getOwner(), owner.getName());\n\n            // Activity\n            IPermissionActivity activity =\n                    permissionOwnerDao.getPermissionActivity(\n                            permission.getOwner(), permission.getActivity());\n            Activity activityImpl = new ActivityImpl(permission.getActivity(), activity.getName());\n\n            // Principal\n            Principal principalImpl = new PrincipalImpl(authP.getKey(), authP.getPrincipalString());\n\n            // Target\n            Target targetImpl = null; // default\n            IPermissionTargetProvider targetProvider =\n                    targetProviderRegistry.getTargetProvider(activity.getTargetProviderKey());\n            IPermissionTarget target = targetProvider.getTarget(permission.getTarget());\n            if (target != null) {\n                targetImpl = new TargetImpl(permission.getTarget(), target.getName());\n            }\n\n            rslt =\n                    new AssignmentImpl(\n                            ownerImpl, activityImpl, principalImpl, targetImpl, inherited);\n\n        } catch (Exception e) {\n            log.warn(\"Exception while adding permission\", e);\n        }\n\n        return rslt;\n    }", "language": "java", "code": "private Assignment createAssignment(\n            IPermission permission, IAuthorizationPrincipal authP, boolean inherited) {\n\n        Assignment rslt = null;\n\n        try {\n\n            // Owner\n            IPermissionOwner owner = permissionOwnerDao.getPermissionOwner(permission.getOwner());\n            Owner ownerImpl = new OwnerImpl(permission.getOwner(), owner.getName());\n\n            // Activity\n            IPermissionActivity activity =\n                    permissionOwnerDao.getPermissionActivity(\n                            permission.getOwner(), permission.getActivity());\n            Activity activityImpl = new ActivityImpl(permission.getActivity(), activity.getName());\n\n            // Principal\n            Principal principalImpl = new PrincipalImpl(authP.getKey(), authP.getPrincipalString());\n\n            // Target\n            Target targetImpl = null; // default\n            IPermissionTargetProvider targetProvider =\n                    targetProviderRegistry.getTargetProvider(activity.getTargetProviderKey());\n            IPermissionTarget target = targetProvider.getTarget(permission.getTarget());\n            if (target != null) {\n                targetImpl = new TargetImpl(permission.getTarget(), target.getName());\n            }\n\n            rslt =\n                    new AssignmentImpl(\n                            ownerImpl, activityImpl, principalImpl, targetImpl, inherited);\n\n        } catch (Exception e) {\n            log.warn(\"Exception while adding permission\", e);\n        }\n\n        return rslt;\n    }", "code_tokens": ["private", "Assignment", "createAssignment", "(", "IPermission", "permission", ",", "IAuthorizationPrincipal", "authP", ",", "boolean", "inherited", ")", "{", "Assignment", "rslt", "=", "null", ";", "try", "{", "// Owner", "IPermissionOwner", "owner", "=", "permissionOwnerDao", ".", "getPermissionOwner", "(", "permission", ".", "getOwner", "(", ")", ")", ";", "Owner", "ownerImpl", "=", "new", "OwnerImpl", "(", "permission", ".", "getOwner", "(", ")", ",", "owner", ".", "getName", "(", ")", ")", ";", "// Activity", "IPermissionActivity", "activity", "=", "permissionOwnerDao", ".", "getPermissionActivity", "(", "permission", ".", "getOwner", "(", ")", ",", "permission", ".", "getActivity", "(", ")", ")", ";", "Activity", "activityImpl", "=", "new", "ActivityImpl", "(", "permission", ".", "getActivity", "(", ")", ",", "activity", ".", "getName", "(", ")", ")", ";", "// Principal", "Principal", "principalImpl", "=", "new", "PrincipalImpl", "(", "authP", ".", "getKey", "(", ")", ",", "authP", ".", "getPrincipalString", "(", ")", ")", ";", "// Target", "Target", "targetImpl", "=", "null", ";", "// default", "IPermissionTargetProvider", "targetProvider", "=", "targetProviderRegistry", ".", "getTargetProvider", "(", "activity", ".", "getTargetProviderKey", "(", ")", ")", ";", "IPermissionTarget", "target", "=", "targetProvider", ".", "getTarget", "(", "permission", ".", "getTarget", "(", ")", ")", ";", "if", "(", "target", "!=", "null", ")", "{", "targetImpl", "=", "new", "TargetImpl", "(", "permission", ".", "getTarget", "(", ")", ",", "target", ".", "getName", "(", ")", ")", ";", "}", "rslt", "=", "new", "AssignmentImpl", "(", "ownerImpl", ",", "activityImpl", ",", "principalImpl", ",", "targetImpl", ",", "inherited", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "log", ".", "warn", "(", "\"Exception while adding permission\"", ",", "e", ")", ";", "}", "return", "rslt", ";", "}"], "docstring": "/*\nImplementation", "docstring_tokens": ["/", "*", "Implementation"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-platform-impl/src/main/java/org/apereo/portal/api/permissions/ApiPermissionsService.java#L107-L145", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/XSLTComponent.java", "func_name": "XSLTComponent.getEventReader", "original_string": "@Override\n    public PipelineEventReader<XMLEventReader, XMLEvent> getEventReader(\n            HttpServletRequest request, HttpServletResponse response) {\n        final PipelineEventReader<XMLEventReader, XMLEvent> pipelineEventReader =\n                this.wrappedComponent.getEventReader(request, response);\n\n        final Transformer transformer = this.transformerSource.getTransformer(request, response);\n\n        // Setup a URIResolver based on the current resource loader\n        transformer.setURIResolver(this.uriResolver);\n\n        // Configure the Transformer via injected class\n        if (this.xsltParameterSource != null) {\n            final Map<String, Object> transformerParameters =\n                    this.xsltParameterSource.getParameters(request, response);\n            if (transformerParameters != null) {\n                this.logger.debug(\n                        \"{} - Setting Transformer Parameters: \",\n                        this.beanName,\n                        transformerParameters);\n                for (final Map.Entry<String, Object> transformerParametersEntry :\n                        transformerParameters.entrySet()) {\n                    final String name = transformerParametersEntry.getKey();\n                    final Object value = transformerParametersEntry.getValue();\n                    if (value != null) {\n                        transformer.setParameter(name, value);\n                    }\n                }\n            }\n\n            final Properties outputProperties =\n                    this.xsltParameterSource.getOutputProperties(request, response);\n            if (outputProperties != null) {\n                this.logger.debug(\n                        \"{} - Setting Transformer Output Properties: \",\n                        this.beanName,\n                        outputProperties);\n                transformer.setOutputProperties(outputProperties);\n            }\n        }\n\n        // The event reader from the previous component in the pipeline\n        final XMLEventReader eventReader = pipelineEventReader.getEventReader();\n\n        // Wrap the event reader in a stream reader to avoid a JDK bug\n        final XMLStreamReader streamReader;\n        try {\n            streamReader = new FixedXMLEventStreamReader(eventReader);\n        } catch (XMLStreamException e) {\n            throw new RuntimeException(\"Failed to create XMLStreamReader from XMLEventReader\", e);\n        }\n        final Source xmlReaderSource = new StAXSource(streamReader);\n\n        // Setup logging for the transform\n        transformer.setErrorListener(this.errorListener);\n\n        // Transform to a SAX ContentHandler to avoid JDK bug:\n        // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6775588\n        final XMLEventBufferWriter eventWriterBuffer = new XMLEventBufferWriter();\n        final ContentHandler contentHandler = StaxUtils.createContentHandler(eventWriterBuffer);\n        contentHandler.setDocumentLocator(new LocatorImpl());\n\n        final SAXResult outputTarget = new SAXResult(contentHandler);\n        try {\n            this.logger.debug(\"{} - Begining XML Transformation\", this.beanName);\n            transformer.transform(xmlReaderSource, outputTarget);\n            this.logger.debug(\"{} - XML Transformation complete\", this.beanName);\n        } catch (TransformerException e) {\n            throw new RuntimeException(\"Failed to transform document\", e);\n        }\n\n        final String mediaType = transformer.getOutputProperty(OutputKeys.MEDIA_TYPE);\n\n        final List<XMLEvent> eventBuffer = eventWriterBuffer.getEventBuffer();\n        final XMLEventReader outputEventReader =\n                new XMLEventBufferReader(eventBuffer.listIterator());\n\n        final Map<String, String> outputProperties = pipelineEventReader.getOutputProperties();\n        final PipelineEventReaderImpl<XMLEventReader, XMLEvent> pipelineEventReaderImpl =\n                new PipelineEventReaderImpl<XMLEventReader, XMLEvent>(\n                        outputEventReader, outputProperties);\n        pipelineEventReaderImpl.setOutputProperty(OutputKeys.MEDIA_TYPE, mediaType);\n        return pipelineEventReaderImpl;\n    }", "language": "java", "code": "@Override\n    public PipelineEventReader<XMLEventReader, XMLEvent> getEventReader(\n            HttpServletRequest request, HttpServletResponse response) {\n        final PipelineEventReader<XMLEventReader, XMLEvent> pipelineEventReader =\n                this.wrappedComponent.getEventReader(request, response);\n\n        final Transformer transformer = this.transformerSource.getTransformer(request, response);\n\n        // Setup a URIResolver based on the current resource loader\n        transformer.setURIResolver(this.uriResolver);\n\n        // Configure the Transformer via injected class\n        if (this.xsltParameterSource != null) {\n            final Map<String, Object> transformerParameters =\n                    this.xsltParameterSource.getParameters(request, response);\n            if (transformerParameters != null) {\n                this.logger.debug(\n                        \"{} - Setting Transformer Parameters: \",\n                        this.beanName,\n                        transformerParameters);\n                for (final Map.Entry<String, Object> transformerParametersEntry :\n                        transformerParameters.entrySet()) {\n                    final String name = transformerParametersEntry.getKey();\n                    final Object value = transformerParametersEntry.getValue();\n                    if (value != null) {\n                        transformer.setParameter(name, value);\n                    }\n                }\n            }\n\n            final Properties outputProperties =\n                    this.xsltParameterSource.getOutputProperties(request, response);\n            if (outputProperties != null) {\n                this.logger.debug(\n                        \"{} - Setting Transformer Output Properties: \",\n                        this.beanName,\n                        outputProperties);\n                transformer.setOutputProperties(outputProperties);\n            }\n        }\n\n        // The event reader from the previous component in the pipeline\n        final XMLEventReader eventReader = pipelineEventReader.getEventReader();\n\n        // Wrap the event reader in a stream reader to avoid a JDK bug\n        final XMLStreamReader streamReader;\n        try {\n            streamReader = new FixedXMLEventStreamReader(eventReader);\n        } catch (XMLStreamException e) {\n            throw new RuntimeException(\"Failed to create XMLStreamReader from XMLEventReader\", e);\n        }\n        final Source xmlReaderSource = new StAXSource(streamReader);\n\n        // Setup logging for the transform\n        transformer.setErrorListener(this.errorListener);\n\n        // Transform to a SAX ContentHandler to avoid JDK bug:\n        // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6775588\n        final XMLEventBufferWriter eventWriterBuffer = new XMLEventBufferWriter();\n        final ContentHandler contentHandler = StaxUtils.createContentHandler(eventWriterBuffer);\n        contentHandler.setDocumentLocator(new LocatorImpl());\n\n        final SAXResult outputTarget = new SAXResult(contentHandler);\n        try {\n            this.logger.debug(\"{} - Begining XML Transformation\", this.beanName);\n            transformer.transform(xmlReaderSource, outputTarget);\n            this.logger.debug(\"{} - XML Transformation complete\", this.beanName);\n        } catch (TransformerException e) {\n            throw new RuntimeException(\"Failed to transform document\", e);\n        }\n\n        final String mediaType = transformer.getOutputProperty(OutputKeys.MEDIA_TYPE);\n\n        final List<XMLEvent> eventBuffer = eventWriterBuffer.getEventBuffer();\n        final XMLEventReader outputEventReader =\n                new XMLEventBufferReader(eventBuffer.listIterator());\n\n        final Map<String, String> outputProperties = pipelineEventReader.getOutputProperties();\n        final PipelineEventReaderImpl<XMLEventReader, XMLEvent> pipelineEventReaderImpl =\n                new PipelineEventReaderImpl<XMLEventReader, XMLEvent>(\n                        outputEventReader, outputProperties);\n        pipelineEventReaderImpl.setOutputProperty(OutputKeys.MEDIA_TYPE, mediaType);\n        return pipelineEventReaderImpl;\n    }", "code_tokens": ["@", "Override", "public", "PipelineEventReader", "<", "XMLEventReader", ",", "XMLEvent", ">", "getEventReader", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "final", "PipelineEventReader", "<", "XMLEventReader", ",", "XMLEvent", ">", "pipelineEventReader", "=", "this", ".", "wrappedComponent", ".", "getEventReader", "(", "request", ",", "response", ")", ";", "final", "Transformer", "transformer", "=", "this", ".", "transformerSource", ".", "getTransformer", "(", "request", ",", "response", ")", ";", "// Setup a URIResolver based on the current resource loader", "transformer", ".", "setURIResolver", "(", "this", ".", "uriResolver", ")", ";", "// Configure the Transformer via injected class", "if", "(", "this", ".", "xsltParameterSource", "!=", "null", ")", "{", "final", "Map", "<", "String", ",", "Object", ">", "transformerParameters", "=", "this", ".", "xsltParameterSource", ".", "getParameters", "(", "request", ",", "response", ")", ";", "if", "(", "transformerParameters", "!=", "null", ")", "{", "this", ".", "logger", ".", "debug", "(", "\"{} - Setting Transformer Parameters: \"", ",", "this", ".", "beanName", ",", "transformerParameters", ")", ";", "for", "(", "final", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "transformerParametersEntry", ":", "transformerParameters", ".", "entrySet", "(", ")", ")", "{", "final", "String", "name", "=", "transformerParametersEntry", ".", "getKey", "(", ")", ";", "final", "Object", "value", "=", "transformerParametersEntry", ".", "getValue", "(", ")", ";", "if", "(", "value", "!=", "null", ")", "{", "transformer", ".", "setParameter", "(", "name", ",", "value", ")", ";", "}", "}", "}", "final", "Properties", "outputProperties", "=", "this", ".", "xsltParameterSource", ".", "getOutputProperties", "(", "request", ",", "response", ")", ";", "if", "(", "outputProperties", "!=", "null", ")", "{", "this", ".", "logger", ".", "debug", "(", "\"{} - Setting Transformer Output Properties: \"", ",", "this", ".", "beanName", ",", "outputProperties", ")", ";", "transformer", ".", "setOutputProperties", "(", "outputProperties", ")", ";", "}", "}", "// The event reader from the previous component in the pipeline", "final", "XMLEventReader", "eventReader", "=", "pipelineEventReader", ".", "getEventReader", "(", ")", ";", "// Wrap the event reader in a stream reader to avoid a JDK bug", "final", "XMLStreamReader", "streamReader", ";", "try", "{", "streamReader", "=", "new", "FixedXMLEventStreamReader", "(", "eventReader", ")", ";", "}", "catch", "(", "XMLStreamException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Failed to create XMLStreamReader from XMLEventReader\"", ",", "e", ")", ";", "}", "final", "Source", "xmlReaderSource", "=", "new", "StAXSource", "(", "streamReader", ")", ";", "// Setup logging for the transform", "transformer", ".", "setErrorListener", "(", "this", ".", "errorListener", ")", ";", "// Transform to a SAX ContentHandler to avoid JDK bug:", "// http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6775588", "final", "XMLEventBufferWriter", "eventWriterBuffer", "=", "new", "XMLEventBufferWriter", "(", ")", ";", "final", "ContentHandler", "contentHandler", "=", "StaxUtils", ".", "createContentHandler", "(", "eventWriterBuffer", ")", ";", "contentHandler", ".", "setDocumentLocator", "(", "new", "LocatorImpl", "(", ")", ")", ";", "final", "SAXResult", "outputTarget", "=", "new", "SAXResult", "(", "contentHandler", ")", ";", "try", "{", "this", ".", "logger", ".", "debug", "(", "\"{} - Begining XML Transformation\"", ",", "this", ".", "beanName", ")", ";", "transformer", ".", "transform", "(", "xmlReaderSource", ",", "outputTarget", ")", ";", "this", ".", "logger", ".", "debug", "(", "\"{} - XML Transformation complete\"", ",", "this", ".", "beanName", ")", ";", "}", "catch", "(", "TransformerException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Failed to transform document\"", ",", "e", ")", ";", "}", "final", "String", "mediaType", "=", "transformer", ".", "getOutputProperty", "(", "OutputKeys", ".", "MEDIA_TYPE", ")", ";", "final", "List", "<", "XMLEvent", ">", "eventBuffer", "=", "eventWriterBuffer", ".", "getEventBuffer", "(", ")", ";", "final", "XMLEventReader", "outputEventReader", "=", "new", "XMLEventBufferReader", "(", "eventBuffer", ".", "listIterator", "(", ")", ")", ";", "final", "Map", "<", "String", ",", "String", ">", "outputProperties", "=", "pipelineEventReader", ".", "getOutputProperties", "(", ")", ";", "final", "PipelineEventReaderImpl", "<", "XMLEventReader", ",", "XMLEvent", ">", "pipelineEventReaderImpl", "=", "new", "PipelineEventReaderImpl", "<", "XMLEventReader", ",", "XMLEvent", ">", "(", "outputEventReader", ",", "outputProperties", ")", ";", "pipelineEventReaderImpl", ".", "setOutputProperty", "(", "OutputKeys", ".", "MEDIA_TYPE", ",", "mediaType", ")", ";", "return", "pipelineEventReaderImpl", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.StAXPipelineComponent#getXmlStreamReader(java.lang.Object, java.lang.Object)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/XSLTComponent.java#L89-L172", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/profile/UserAgentProfileMapper.java", "func_name": "UserAgentProfileMapper.getProfileFname", "original_string": "@Override\n    public String getProfileFname(IPerson person, HttpServletRequest request) {\n        final String userAgent = request.getHeader(this.userAgentHeader);\n        if (userAgent == null) {\n            this.logger.debug(\n                    \"No {} header for {} returning default profile\",\n                    this.userAgentHeader,\n                    person.getUserName());\n            return this.defaultProfileName;\n        }\n\n        for (final Mapping mapping : this.mappings) {\n            final Matcher matcher = mapping.pattern.matcher(userAgent);\n            if (matcher.matches()) {\n                this.logger.debug(\n                        \"Matched {} header {} for {} returning profile {}\",\n                        new Object[] {\n                            this.userAgentHeader, person.getUserName(), mapping.profileName\n                        });\n                return mapping.profileName;\n            }\n        }\n\n        this.logger.debug(\n                \"No matching Mapping for {} header for {} returning default profile\",\n                this.userAgentHeader,\n                person.getUserName());\n        return defaultProfileName;\n    }", "language": "java", "code": "@Override\n    public String getProfileFname(IPerson person, HttpServletRequest request) {\n        final String userAgent = request.getHeader(this.userAgentHeader);\n        if (userAgent == null) {\n            this.logger.debug(\n                    \"No {} header for {} returning default profile\",\n                    this.userAgentHeader,\n                    person.getUserName());\n            return this.defaultProfileName;\n        }\n\n        for (final Mapping mapping : this.mappings) {\n            final Matcher matcher = mapping.pattern.matcher(userAgent);\n            if (matcher.matches()) {\n                this.logger.debug(\n                        \"Matched {} header {} for {} returning profile {}\",\n                        new Object[] {\n                            this.userAgentHeader, person.getUserName(), mapping.profileName\n                        });\n                return mapping.profileName;\n            }\n        }\n\n        this.logger.debug(\n                \"No matching Mapping for {} header for {} returning default profile\",\n                this.userAgentHeader,\n                person.getUserName());\n        return defaultProfileName;\n    }", "code_tokens": ["@", "Override", "public", "String", "getProfileFname", "(", "IPerson", "person", ",", "HttpServletRequest", "request", ")", "{", "final", "String", "userAgent", "=", "request", ".", "getHeader", "(", "this", ".", "userAgentHeader", ")", ";", "if", "(", "userAgent", "==", "null", ")", "{", "this", ".", "logger", ".", "debug", "(", "\"No {} header for {} returning default profile\"", ",", "this", ".", "userAgentHeader", ",", "person", ".", "getUserName", "(", ")", ")", ";", "return", "this", ".", "defaultProfileName", ";", "}", "for", "(", "final", "Mapping", "mapping", ":", "this", ".", "mappings", ")", "{", "final", "Matcher", "matcher", "=", "mapping", ".", "pattern", ".", "matcher", "(", "userAgent", ")", ";", "if", "(", "matcher", ".", "matches", "(", ")", ")", "{", "this", ".", "logger", ".", "debug", "(", "\"Matched {} header {} for {} returning profile {}\"", ",", "new", "Object", "[", "]", "{", "this", ".", "userAgentHeader", ",", "person", ".", "getUserName", "(", ")", ",", "mapping", ".", "profileName", "}", ")", ";", "return", "mapping", ".", "profileName", ";", "}", "}", "this", ".", "logger", ".", "debug", "(", "\"No matching Mapping for {} header for {} returning default profile\"", ",", "this", ".", "userAgentHeader", ",", "person", ".", "getUserName", "(", ")", ")", ";", "return", "defaultProfileName", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.layout.profile.IProfileMapper#getProfileFname(org.apereo.portal.security.IPerson, javax.servlet.http.HttpServletRequest)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/profile/UserAgentProfileMapper.java#L60-L88", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/TransientUserLayoutXMLEventReader.java", "func_name": "TransientUserLayoutXMLEventReader.getAdditionalEvents", "original_string": "@Override\n    protected Deque<XMLEvent> getAdditionalEvents(XMLEvent event) {\n        if (event.isStartElement()) {\n            final StartElement startElement = event.asStartElement();\n\n            // All following logic requires an ID attribute, ignore any element without one\n            final Attribute idAttribute =\n                    startElement.getAttributeByName(IUserLayoutManager.ID_ATTR_NAME);\n            if (idAttribute == null) {\n                return null;\n            }\n\n            // Create and return a transient (dynamically created) folder that includes a transient\n            // channel\n            // if we are processing the tart element of the root node\n            // iff the subscribeId is present and describes a transient channel and not a regular\n            // layout channel.\n            final String subscribeId = this.userLayoutManager.getFocusedId();\n            if (this.rootFolderId.equals(idAttribute.getValue())\n                    && subscribeId != null\n                    && !subscribeId.equals(\"\")\n                    && this.userLayoutManager.isTransientChannel(subscribeId)) {\n\n                IPortletDefinition chanDef = null;\n                try {\n                    chanDef = this.userLayoutManager.getChannelDefinition(subscribeId);\n                } catch (Exception e) {\n                    logger.error(\n                            \"Could not obtain IChannelDefinition for subscribe id: {}\",\n                            subscribeId,\n                            e);\n                }\n\n                if (chanDef != null) {\n                    final QName name = startElement.getName();\n                    final String namespaceURI = name.getNamespaceURI();\n                    final String prefix = name.getPrefix();\n\n                    final Deque<XMLEvent> transientEventBuffer = new LinkedList<XMLEvent>();\n\n                    final Collection<Attribute> transientFolderAttributes =\n                            new LinkedList<Attribute>();\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\n                                    \"ID\", TransientUserLayoutManagerWrapper.TRANSIENT_FOLDER_ID));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\n                                    \"name\", chanDef != null ? chanDef.getTitle() : \"Temporary\"));\n                    transientFolderAttributes.add(EVENT_FACTORY.createAttribute(\"type\", \"regular\"));\n                    transientFolderAttributes.add(EVENT_FACTORY.createAttribute(\"hidden\", \"false\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"unremovable\", \"true\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"immutable\", \"true\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"unremovable\", \"true\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"dlm:addChildAllowed\", \"false\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"dlm:deleteAllowed\", \"false\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"dlm:editAllowed\", \"false\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"dlm:moveAllowed\", \"false\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"dlm:precedence\", \"100.0\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"transient\", \"true\"));\n\n                    final StartElement transientFolder =\n                            EVENT_FACTORY.createStartElement(\n                                    prefix,\n                                    namespaceURI,\n                                    IUserLayoutManager.FOLDER,\n                                    transientFolderAttributes.iterator(),\n                                    null);\n                    transientEventBuffer.add(transientFolder);\n\n                    // TODO Move IChannelDefinition/IPortletDefinition -> StAX events code somewhere\n                    // reusable\n                    final Collection<Attribute> channelAttrs = new LinkedList<Attribute>();\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"ID\", subscribeId));\n                    channelAttrs.add(\n                            EVENT_FACTORY.createAttribute(\n                                    \"typeID\", Integer.toString(chanDef.getType().getId())));\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"hidden\", \"false\"));\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"unremovable\", \"true\"));\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"dlm:deleteAllowed\", \"false\"));\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"dlm:moveAllowed\", \"false\"));\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"name\", chanDef.getName()));\n                    channelAttrs.add(\n                            EVENT_FACTORY.createAttribute(\"description\", chanDef.getDescription()));\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"title\", chanDef.getTitle()));\n                    channelAttrs.add(\n                            EVENT_FACTORY.createAttribute(\n                                    \"chanID\", chanDef.getPortletDefinitionId().getStringId()));\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"fname\", chanDef.getFName()));\n                    channelAttrs.add(\n                            EVENT_FACTORY.createAttribute(\n                                    \"timeout\", Integer.toString(chanDef.getTimeout())));\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"transient\", \"true\"));\n\n                    final StartElement startChannel =\n                            EVENT_FACTORY.createStartElement(\n                                    prefix,\n                                    namespaceURI,\n                                    IUserLayoutManager.CHANNEL,\n                                    channelAttrs.iterator(),\n                                    null);\n                    transientEventBuffer.offer(startChannel);\n\n                    // add channel parameter elements\n                    for (final IPortletDefinitionParameter parm : chanDef.getParameters()) {\n                        final Collection<Attribute> parameterAttrs = new LinkedList<Attribute>();\n                        parameterAttrs.add(EVENT_FACTORY.createAttribute(\"name\", parm.getName()));\n                        parameterAttrs.add(EVENT_FACTORY.createAttribute(\"value\", parm.getValue()));\n\n                        final StartElement startParameter =\n                                EVENT_FACTORY.createStartElement(\n                                        prefix,\n                                        namespaceURI,\n                                        IUserLayoutManager.PARAMETER,\n                                        parameterAttrs.iterator(),\n                                        null);\n                        transientEventBuffer.offer(startParameter);\n\n                        final EndElement endParameter =\n                                EVENT_FACTORY.createEndElement(\n                                        prefix, namespaceURI, IUserLayoutManager.PARAMETER, null);\n                        transientEventBuffer.offer(endParameter);\n                    }\n\n                    final EndElement endChannel =\n                            EVENT_FACTORY.createEndElement(\n                                    prefix, namespaceURI, IUserLayoutManager.CHANNEL, null);\n                    transientEventBuffer.offer(endChannel);\n\n                    final EndElement endFolder =\n                            EVENT_FACTORY.createEndElement(\n                                    prefix, namespaceURI, IUserLayoutManager.FOLDER, null);\n                    transientEventBuffer.offer(endFolder);\n\n                    return transientEventBuffer;\n                } else { // I don't think subscribeId could be null, but log warning if so.\n                    logger.warn(\n                            \"Unable to resolve portlet definition for subscribe ID {}\",\n                            subscribeId);\n                }\n            }\n        }\n\n        return null;\n    }", "language": "java", "code": "@Override\n    protected Deque<XMLEvent> getAdditionalEvents(XMLEvent event) {\n        if (event.isStartElement()) {\n            final StartElement startElement = event.asStartElement();\n\n            // All following logic requires an ID attribute, ignore any element without one\n            final Attribute idAttribute =\n                    startElement.getAttributeByName(IUserLayoutManager.ID_ATTR_NAME);\n            if (idAttribute == null) {\n                return null;\n            }\n\n            // Create and return a transient (dynamically created) folder that includes a transient\n            // channel\n            // if we are processing the tart element of the root node\n            // iff the subscribeId is present and describes a transient channel and not a regular\n            // layout channel.\n            final String subscribeId = this.userLayoutManager.getFocusedId();\n            if (this.rootFolderId.equals(idAttribute.getValue())\n                    && subscribeId != null\n                    && !subscribeId.equals(\"\")\n                    && this.userLayoutManager.isTransientChannel(subscribeId)) {\n\n                IPortletDefinition chanDef = null;\n                try {\n                    chanDef = this.userLayoutManager.getChannelDefinition(subscribeId);\n                } catch (Exception e) {\n                    logger.error(\n                            \"Could not obtain IChannelDefinition for subscribe id: {}\",\n                            subscribeId,\n                            e);\n                }\n\n                if (chanDef != null) {\n                    final QName name = startElement.getName();\n                    final String namespaceURI = name.getNamespaceURI();\n                    final String prefix = name.getPrefix();\n\n                    final Deque<XMLEvent> transientEventBuffer = new LinkedList<XMLEvent>();\n\n                    final Collection<Attribute> transientFolderAttributes =\n                            new LinkedList<Attribute>();\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\n                                    \"ID\", TransientUserLayoutManagerWrapper.TRANSIENT_FOLDER_ID));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\n                                    \"name\", chanDef != null ? chanDef.getTitle() : \"Temporary\"));\n                    transientFolderAttributes.add(EVENT_FACTORY.createAttribute(\"type\", \"regular\"));\n                    transientFolderAttributes.add(EVENT_FACTORY.createAttribute(\"hidden\", \"false\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"unremovable\", \"true\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"immutable\", \"true\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"unremovable\", \"true\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"dlm:addChildAllowed\", \"false\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"dlm:deleteAllowed\", \"false\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"dlm:editAllowed\", \"false\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"dlm:moveAllowed\", \"false\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"dlm:precedence\", \"100.0\"));\n                    transientFolderAttributes.add(\n                            EVENT_FACTORY.createAttribute(\"transient\", \"true\"));\n\n                    final StartElement transientFolder =\n                            EVENT_FACTORY.createStartElement(\n                                    prefix,\n                                    namespaceURI,\n                                    IUserLayoutManager.FOLDER,\n                                    transientFolderAttributes.iterator(),\n                                    null);\n                    transientEventBuffer.add(transientFolder);\n\n                    // TODO Move IChannelDefinition/IPortletDefinition -> StAX events code somewhere\n                    // reusable\n                    final Collection<Attribute> channelAttrs = new LinkedList<Attribute>();\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"ID\", subscribeId));\n                    channelAttrs.add(\n                            EVENT_FACTORY.createAttribute(\n                                    \"typeID\", Integer.toString(chanDef.getType().getId())));\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"hidden\", \"false\"));\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"unremovable\", \"true\"));\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"dlm:deleteAllowed\", \"false\"));\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"dlm:moveAllowed\", \"false\"));\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"name\", chanDef.getName()));\n                    channelAttrs.add(\n                            EVENT_FACTORY.createAttribute(\"description\", chanDef.getDescription()));\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"title\", chanDef.getTitle()));\n                    channelAttrs.add(\n                            EVENT_FACTORY.createAttribute(\n                                    \"chanID\", chanDef.getPortletDefinitionId().getStringId()));\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"fname\", chanDef.getFName()));\n                    channelAttrs.add(\n                            EVENT_FACTORY.createAttribute(\n                                    \"timeout\", Integer.toString(chanDef.getTimeout())));\n                    channelAttrs.add(EVENT_FACTORY.createAttribute(\"transient\", \"true\"));\n\n                    final StartElement startChannel =\n                            EVENT_FACTORY.createStartElement(\n                                    prefix,\n                                    namespaceURI,\n                                    IUserLayoutManager.CHANNEL,\n                                    channelAttrs.iterator(),\n                                    null);\n                    transientEventBuffer.offer(startChannel);\n\n                    // add channel parameter elements\n                    for (final IPortletDefinitionParameter parm : chanDef.getParameters()) {\n                        final Collection<Attribute> parameterAttrs = new LinkedList<Attribute>();\n                        parameterAttrs.add(EVENT_FACTORY.createAttribute(\"name\", parm.getName()));\n                        parameterAttrs.add(EVENT_FACTORY.createAttribute(\"value\", parm.getValue()));\n\n                        final StartElement startParameter =\n                                EVENT_FACTORY.createStartElement(\n                                        prefix,\n                                        namespaceURI,\n                                        IUserLayoutManager.PARAMETER,\n                                        parameterAttrs.iterator(),\n                                        null);\n                        transientEventBuffer.offer(startParameter);\n\n                        final EndElement endParameter =\n                                EVENT_FACTORY.createEndElement(\n                                        prefix, namespaceURI, IUserLayoutManager.PARAMETER, null);\n                        transientEventBuffer.offer(endParameter);\n                    }\n\n                    final EndElement endChannel =\n                            EVENT_FACTORY.createEndElement(\n                                    prefix, namespaceURI, IUserLayoutManager.CHANNEL, null);\n                    transientEventBuffer.offer(endChannel);\n\n                    final EndElement endFolder =\n                            EVENT_FACTORY.createEndElement(\n                                    prefix, namespaceURI, IUserLayoutManager.FOLDER, null);\n                    transientEventBuffer.offer(endFolder);\n\n                    return transientEventBuffer;\n                } else { // I don't think subscribeId could be null, but log warning if so.\n                    logger.warn(\n                            \"Unable to resolve portlet definition for subscribe ID {}\",\n                            subscribeId);\n                }\n            }\n        }\n\n        return null;\n    }", "code_tokens": ["@", "Override", "protected", "Deque", "<", "XMLEvent", ">", "getAdditionalEvents", "(", "XMLEvent", "event", ")", "{", "if", "(", "event", ".", "isStartElement", "(", ")", ")", "{", "final", "StartElement", "startElement", "=", "event", ".", "asStartElement", "(", ")", ";", "// All following logic requires an ID attribute, ignore any element without one", "final", "Attribute", "idAttribute", "=", "startElement", ".", "getAttributeByName", "(", "IUserLayoutManager", ".", "ID_ATTR_NAME", ")", ";", "if", "(", "idAttribute", "==", "null", ")", "{", "return", "null", ";", "}", "// Create and return a transient (dynamically created) folder that includes a transient", "// channel", "// if we are processing the tart element of the root node", "// iff the subscribeId is present and describes a transient channel and not a regular", "// layout channel.", "final", "String", "subscribeId", "=", "this", ".", "userLayoutManager", ".", "getFocusedId", "(", ")", ";", "if", "(", "this", ".", "rootFolderId", ".", "equals", "(", "idAttribute", ".", "getValue", "(", ")", ")", "&&", "subscribeId", "!=", "null", "&&", "!", "subscribeId", ".", "equals", "(", "\"\"", ")", "&&", "this", ".", "userLayoutManager", ".", "isTransientChannel", "(", "subscribeId", ")", ")", "{", "IPortletDefinition", "chanDef", "=", "null", ";", "try", "{", "chanDef", "=", "this", ".", "userLayoutManager", ".", "getChannelDefinition", "(", "subscribeId", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "error", "(", "\"Could not obtain IChannelDefinition for subscribe id: {}\"", ",", "subscribeId", ",", "e", ")", ";", "}", "if", "(", "chanDef", "!=", "null", ")", "{", "final", "QName", "name", "=", "startElement", ".", "getName", "(", ")", ";", "final", "String", "namespaceURI", "=", "name", ".", "getNamespaceURI", "(", ")", ";", "final", "String", "prefix", "=", "name", ".", "getPrefix", "(", ")", ";", "final", "Deque", "<", "XMLEvent", ">", "transientEventBuffer", "=", "new", "LinkedList", "<", "XMLEvent", ">", "(", ")", ";", "final", "Collection", "<", "Attribute", ">", "transientFolderAttributes", "=", "new", "LinkedList", "<", "Attribute", ">", "(", ")", ";", "transientFolderAttributes", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"ID\"", ",", "TransientUserLayoutManagerWrapper", ".", "TRANSIENT_FOLDER_ID", ")", ")", ";", "transientFolderAttributes", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"name\"", ",", "chanDef", "!=", "null", "?", "chanDef", ".", "getTitle", "(", ")", ":", "\"Temporary\"", ")", ")", ";", "transientFolderAttributes", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"type\"", ",", "\"regular\"", ")", ")", ";", "transientFolderAttributes", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"hidden\"", ",", "\"false\"", ")", ")", ";", "transientFolderAttributes", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"unremovable\"", ",", "\"true\"", ")", ")", ";", "transientFolderAttributes", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"immutable\"", ",", "\"true\"", ")", ")", ";", "transientFolderAttributes", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"unremovable\"", ",", "\"true\"", ")", ")", ";", "transientFolderAttributes", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"dlm:addChildAllowed\"", ",", "\"false\"", ")", ")", ";", "transientFolderAttributes", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"dlm:deleteAllowed\"", ",", "\"false\"", ")", ")", ";", "transientFolderAttributes", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"dlm:editAllowed\"", ",", "\"false\"", ")", ")", ";", "transientFolderAttributes", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"dlm:moveAllowed\"", ",", "\"false\"", ")", ")", ";", "transientFolderAttributes", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"dlm:precedence\"", ",", "\"100.0\"", ")", ")", ";", "transientFolderAttributes", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"transient\"", ",", "\"true\"", ")", ")", ";", "final", "StartElement", "transientFolder", "=", "EVENT_FACTORY", ".", "createStartElement", "(", "prefix", ",", "namespaceURI", ",", "IUserLayoutManager", ".", "FOLDER", ",", "transientFolderAttributes", ".", "iterator", "(", ")", ",", "null", ")", ";", "transientEventBuffer", ".", "add", "(", "transientFolder", ")", ";", "// TODO Move IChannelDefinition/IPortletDefinition -> StAX events code somewhere", "// reusable", "final", "Collection", "<", "Attribute", ">", "channelAttrs", "=", "new", "LinkedList", "<", "Attribute", ">", "(", ")", ";", "channelAttrs", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"ID\"", ",", "subscribeId", ")", ")", ";", "channelAttrs", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"typeID\"", ",", "Integer", ".", "toString", "(", "chanDef", ".", "getType", "(", ")", ".", "getId", "(", ")", ")", ")", ")", ";", "channelAttrs", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"hidden\"", ",", "\"false\"", ")", ")", ";", "channelAttrs", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"unremovable\"", ",", "\"true\"", ")", ")", ";", "channelAttrs", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"dlm:deleteAllowed\"", ",", "\"false\"", ")", ")", ";", "channelAttrs", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"dlm:moveAllowed\"", ",", "\"false\"", ")", ")", ";", "channelAttrs", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"name\"", ",", "chanDef", ".", "getName", "(", ")", ")", ")", ";", "channelAttrs", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"description\"", ",", "chanDef", ".", "getDescription", "(", ")", ")", ")", ";", "channelAttrs", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"title\"", ",", "chanDef", ".", "getTitle", "(", ")", ")", ")", ";", "channelAttrs", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"chanID\"", ",", "chanDef", ".", "getPortletDefinitionId", "(", ")", ".", "getStringId", "(", ")", ")", ")", ";", "channelAttrs", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"fname\"", ",", "chanDef", ".", "getFName", "(", ")", ")", ")", ";", "channelAttrs", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"timeout\"", ",", "Integer", ".", "toString", "(", "chanDef", ".", "getTimeout", "(", ")", ")", ")", ")", ";", "channelAttrs", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"transient\"", ",", "\"true\"", ")", ")", ";", "final", "StartElement", "startChannel", "=", "EVENT_FACTORY", ".", "createStartElement", "(", "prefix", ",", "namespaceURI", ",", "IUserLayoutManager", ".", "CHANNEL", ",", "channelAttrs", ".", "iterator", "(", ")", ",", "null", ")", ";", "transientEventBuffer", ".", "offer", "(", "startChannel", ")", ";", "// add channel parameter elements", "for", "(", "final", "IPortletDefinitionParameter", "parm", ":", "chanDef", ".", "getParameters", "(", ")", ")", "{", "final", "Collection", "<", "Attribute", ">", "parameterAttrs", "=", "new", "LinkedList", "<", "Attribute", ">", "(", ")", ";", "parameterAttrs", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"name\"", ",", "parm", ".", "getName", "(", ")", ")", ")", ";", "parameterAttrs", ".", "add", "(", "EVENT_FACTORY", ".", "createAttribute", "(", "\"value\"", ",", "parm", ".", "getValue", "(", ")", ")", ")", ";", "final", "StartElement", "startParameter", "=", "EVENT_FACTORY", ".", "createStartElement", "(", "prefix", ",", "namespaceURI", ",", "IUserLayoutManager", ".", "PARAMETER", ",", "parameterAttrs", ".", "iterator", "(", ")", ",", "null", ")", ";", "transientEventBuffer", ".", "offer", "(", "startParameter", ")", ";", "final", "EndElement", "endParameter", "=", "EVENT_FACTORY", ".", "createEndElement", "(", "prefix", ",", "namespaceURI", ",", "IUserLayoutManager", ".", "PARAMETER", ",", "null", ")", ";", "transientEventBuffer", ".", "offer", "(", "endParameter", ")", ";", "}", "final", "EndElement", "endChannel", "=", "EVENT_FACTORY", ".", "createEndElement", "(", "prefix", ",", "namespaceURI", ",", "IUserLayoutManager", ".", "CHANNEL", ",", "null", ")", ";", "transientEventBuffer", ".", "offer", "(", "endChannel", ")", ";", "final", "EndElement", "endFolder", "=", "EVENT_FACTORY", ".", "createEndElement", "(", "prefix", ",", "namespaceURI", ",", "IUserLayoutManager", ".", "FOLDER", ",", "null", ")", ";", "transientEventBuffer", ".", "offer", "(", "endFolder", ")", ";", "return", "transientEventBuffer", ";", "}", "else", "{", "// I don't think subscribeId could be null, but log warning if so.", "logger", ".", "warn", "(", "\"Unable to resolve portlet definition for subscribe ID {}\"", ",", "subscribeId", ")", ";", "}", "}", "}", "return", "null", ";", "}"], "docstring": "Examines the current token and when appropriate creates and returns dynamically created\ncontent. If dynamic content is not created, return null.\n\n@param event The current event\n@return Dynamic content to inject into document, else null if no additional dynamic content\nwas created.", "docstring_tokens": ["Examines", "the", "current", "token", "and", "when", "appropriate", "creates", "and", "returns", "dynamically", "created", "content", ".", "If", "dynamic", "content", "is", "not", "created", "return", "null", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/TransientUserLayoutXMLEventReader.java#L57-L209", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-spring/src/main/java/org/apereo/portal/spring/properties/PortalPropertyEditorRegistrar.java", "func_name": "PortalPropertyEditorRegistrar.registerCustomEditors", "original_string": "@Override\n    public void registerCustomEditors(PropertyEditorRegistry registry) {\n        if (this.propertyEditors == null) {\n            this.logger.warn(\"No PropertyEditors Map configured, returning with no action taken.\");\n            return;\n        }\n\n        for (final Map.Entry<Class<?>, PropertyEditor> editorEntry :\n                this.propertyEditors.entrySet()) {\n            final Class<?> requiredType = editorEntry.getKey();\n            final PropertyEditor editor = editorEntry.getValue();\n\n            if (this.logger.isTraceEnabled()) {\n                this.logger.trace(\n                        \"Registering PropertyEditor '\"\n                                + editor\n                                + \"' for type '\"\n                                + requiredType\n                                + \"'\");\n            }\n\n            registry.registerCustomEditor(requiredType, editor);\n        }\n    }", "language": "java", "code": "@Override\n    public void registerCustomEditors(PropertyEditorRegistry registry) {\n        if (this.propertyEditors == null) {\n            this.logger.warn(\"No PropertyEditors Map configured, returning with no action taken.\");\n            return;\n        }\n\n        for (final Map.Entry<Class<?>, PropertyEditor> editorEntry :\n                this.propertyEditors.entrySet()) {\n            final Class<?> requiredType = editorEntry.getKey();\n            final PropertyEditor editor = editorEntry.getValue();\n\n            if (this.logger.isTraceEnabled()) {\n                this.logger.trace(\n                        \"Registering PropertyEditor '\"\n                                + editor\n                                + \"' for type '\"\n                                + requiredType\n                                + \"'\");\n            }\n\n            registry.registerCustomEditor(requiredType, editor);\n        }\n    }", "code_tokens": ["@", "Override", "public", "void", "registerCustomEditors", "(", "PropertyEditorRegistry", "registry", ")", "{", "if", "(", "this", ".", "propertyEditors", "==", "null", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"No PropertyEditors Map configured, returning with no action taken.\"", ")", ";", "return", ";", "}", "for", "(", "final", "Map", ".", "Entry", "<", "Class", "<", "?", ">", ",", "PropertyEditor", ">", "editorEntry", ":", "this", ".", "propertyEditors", ".", "entrySet", "(", ")", ")", "{", "final", "Class", "<", "?", ">", "requiredType", "=", "editorEntry", ".", "getKey", "(", ")", ";", "final", "PropertyEditor", "editor", "=", "editorEntry", ".", "getValue", "(", ")", ";", "if", "(", "this", ".", "logger", ".", "isTraceEnabled", "(", ")", ")", "{", "this", ".", "logger", ".", "trace", "(", "\"Registering PropertyEditor '\"", "+", "editor", "+", "\"' for type '\"", "+", "requiredType", "+", "\"'\"", ")", ";", "}", "registry", ".", "registerCustomEditor", "(", "requiredType", ",", "editor", ")", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.springframework.beans.PropertyEditorRegistrar#registerCustomEditors(org.springframework.beans.PropertyEditorRegistry)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-spring/src/main/java/org/apereo/portal/spring/properties/PortalPropertyEditorRegistrar.java#L42-L65", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/ParameterEditManager.java", "func_name": "ParameterEditManager.applyAndUpdateParmEditSet", "original_string": "static void applyAndUpdateParmEditSet(Document plf, Document ilf, IntegrationResult result) {\n\n        Element pSet = null;\n        try {\n            pSet = getParmEditSet(plf, null, false);\n        } catch (Exception e) {\n            LOG.error(\"Exception occurred while getting user's DLM \" + \"paramter-edit-set.\", e);\n        }\n\n        if (pSet == null) return;\n\n        NodeList edits = pSet.getChildNodes();\n\n        for (int i = edits.getLength() - 1; i >= 0; i--) {\n            if (applyEdit((Element) edits.item(i), ilf) == false) {\n                pSet.removeChild(edits.item(i));\n                result.setChangedPLF(true);\n            } else {\n                result.setChangedILF(true);\n            }\n        }\n\n        if (pSet.getChildNodes().getLength() == 0) {\n            plf.getDocumentElement().removeChild(pSet);\n            result.setChangedPLF(true);\n        }\n    }", "language": "java", "code": "static void applyAndUpdateParmEditSet(Document plf, Document ilf, IntegrationResult result) {\n\n        Element pSet = null;\n        try {\n            pSet = getParmEditSet(plf, null, false);\n        } catch (Exception e) {\n            LOG.error(\"Exception occurred while getting user's DLM \" + \"paramter-edit-set.\", e);\n        }\n\n        if (pSet == null) return;\n\n        NodeList edits = pSet.getChildNodes();\n\n        for (int i = edits.getLength() - 1; i >= 0; i--) {\n            if (applyEdit((Element) edits.item(i), ilf) == false) {\n                pSet.removeChild(edits.item(i));\n                result.setChangedPLF(true);\n            } else {\n                result.setChangedILF(true);\n            }\n        }\n\n        if (pSet.getChildNodes().getLength() == 0) {\n            plf.getDocumentElement().removeChild(pSet);\n            result.setChangedPLF(true);\n        }\n    }", "code_tokens": ["static", "void", "applyAndUpdateParmEditSet", "(", "Document", "plf", ",", "Document", "ilf", ",", "IntegrationResult", "result", ")", "{", "Element", "pSet", "=", "null", ";", "try", "{", "pSet", "=", "getParmEditSet", "(", "plf", ",", "null", ",", "false", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOG", ".", "error", "(", "\"Exception occurred while getting user's DLM \"", "+", "\"paramter-edit-set.\"", ",", "e", ")", ";", "}", "if", "(", "pSet", "==", "null", ")", "return", ";", "NodeList", "edits", "=", "pSet", ".", "getChildNodes", "(", ")", ";", "for", "(", "int", "i", "=", "edits", ".", "getLength", "(", ")", "-", "1", ";", "i", ">=", "0", ";", "i", "--", ")", "{", "if", "(", "applyEdit", "(", "(", "Element", ")", "edits", ".", "item", "(", "i", ")", ",", "ilf", ")", "==", "false", ")", "{", "pSet", ".", "removeChild", "(", "edits", ".", "item", "(", "i", ")", ")", ";", "result", ".", "setChangedPLF", "(", "true", ")", ";", "}", "else", "{", "result", ".", "setChangedILF", "(", "true", ")", ";", "}", "}", "if", "(", "pSet", ".", "getChildNodes", "(", ")", ".", "getLength", "(", ")", "==", "0", ")", "{", "plf", ".", "getDocumentElement", "(", ")", ".", "removeChild", "(", "pSet", ")", ";", "result", ".", "setChangedPLF", "(", "true", ")", ";", "}", "}"], "docstring": "Get the parm edit set if any from the plf and process each edit command removing any that\nfail from the set so that the set is self cleaning.\n\n@throws Exception", "docstring_tokens": ["Get", "the", "parm", "edit", "set", "if", "any", "from", "the", "plf", "and", "process", "each", "edit", "command", "removing", "any", "that", "fail", "from", "the", "set", "so", "that", "the", "set", "is", "self", "cleaning", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/ParameterEditManager.java#L59-L85", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/ParameterEditManager.java", "func_name": "ParameterEditManager.applyEdit", "original_string": "private static boolean applyEdit(Element edit, Document ilf) {\n        String nodeID = edit.getAttribute(Constants.ATT_TARGET);\n\n        Element channel = ilf.getElementById(nodeID);\n\n        if (channel == null) return false;\n\n        // now get the name of the parameter to be edited and find that element\n        String parmName = edit.getAttribute(Constants.ATT_NAME);\n        String parmValue = edit.getAttribute(Constants.ATT_USER_VALUE);\n        NodeList ilfParms = channel.getChildNodes();\n        Element targetParm = null;\n\n        for (int i = 0; i < ilfParms.getLength(); i++) {\n            Element ilfParm = (Element) ilfParms.item(i);\n            if (ilfParm.getAttribute(Constants.ATT_NAME).equals(parmName)) {\n                targetParm = ilfParm;\n                break;\n            }\n        }\n        if (targetParm == null) // parameter not found so we are free to set\n        {\n            Element parameter = ilf.createElement(\"parameter\");\n            parameter.setAttribute(\"name\", parmName);\n            parameter.setAttribute(\"value\", parmValue);\n            parameter.setAttribute(\"override\", \"yes\");\n            channel.appendChild(parameter);\n            return true;\n        }\n        /* TODO Add support for fragments to set dlm:editAllowed attribute for\n         * channel parameters. (2005.11.04 mboyd)\n         *\n         * In the commented code below, the check for editAllowed will never be\n         * seen on a parameter element in the\n         * current database schema approach used by DLM. This is because\n         * parameters are second class citizens of the layout structure. They\n         * are not found in the up_layout_struct table but only in the\n         * up_layout_param table. DLM functionality like dlm:editAllowed,\n         * dlm:moveAllowed, dlm:deleteAllowed, and dlm:addChildAllowed were\n         * implemented without schema changes by adding these as parameters to\n         * structural elements and upon loading any parameter that begins with\n         * 'dlm:' is placed as an attribute on the containing structural\n         * element. So any channel parameter entry with dlm:editAllowed has that\n         * value placed as an attribute on the containing channel not on the\n         * parameter that was meant to have it.\n         *\n         * The only solution would be to add special dlm:parm children below\n         * channels that would get the editAllowed value and then when creating\n         * the DOM don't create those as child elements but use them to set the\n         * attribute on the corresponding parameter by having the name of the\n         * dlm:parm element be the name of the parameter to which it is to be\n         * related.\n         *\n         * The result of this lack of functionality is that fragments can't\n         * mark any channel parameters as dlm:editAllowed='false' thereby\n         * further restricting which channel parameters can be edited beyond\n         * what the channel definition specifies during publishing.\n         */\n        // Attr editAllowed = targetParm.getAttributeNode( Constants.ATT_EDIT_ALLOWED );\n        // if ( editAllowed != null && editAllowed.getNodeValue().equals(\"false\"))\n        //    return false;\n\n        // target parm found. See if channel definition will still allow changes.\n\n        Attr override = targetParm.getAttributeNode(Constants.ATT_OVERRIDE);\n        if (override != null && !override.getNodeValue().equals(Constants.CAN_OVERRIDE))\n            return false;\n\n        // now see if the change is still needed\n        if (targetParm.getAttribute(Constants.ATT_VALUE).equals(parmValue))\n            return false; // user's edit same as fragment or chan def\n\n        targetParm.setAttribute(\"value\", parmValue);\n        return true;\n    }", "language": "java", "code": "private static boolean applyEdit(Element edit, Document ilf) {\n        String nodeID = edit.getAttribute(Constants.ATT_TARGET);\n\n        Element channel = ilf.getElementById(nodeID);\n\n        if (channel == null) return false;\n\n        // now get the name of the parameter to be edited and find that element\n        String parmName = edit.getAttribute(Constants.ATT_NAME);\n        String parmValue = edit.getAttribute(Constants.ATT_USER_VALUE);\n        NodeList ilfParms = channel.getChildNodes();\n        Element targetParm = null;\n\n        for (int i = 0; i < ilfParms.getLength(); i++) {\n            Element ilfParm = (Element) ilfParms.item(i);\n            if (ilfParm.getAttribute(Constants.ATT_NAME).equals(parmName)) {\n                targetParm = ilfParm;\n                break;\n            }\n        }\n        if (targetParm == null) // parameter not found so we are free to set\n        {\n            Element parameter = ilf.createElement(\"parameter\");\n            parameter.setAttribute(\"name\", parmName);\n            parameter.setAttribute(\"value\", parmValue);\n            parameter.setAttribute(\"override\", \"yes\");\n            channel.appendChild(parameter);\n            return true;\n        }\n        /* TODO Add support for fragments to set dlm:editAllowed attribute for\n         * channel parameters. (2005.11.04 mboyd)\n         *\n         * In the commented code below, the check for editAllowed will never be\n         * seen on a parameter element in the\n         * current database schema approach used by DLM. This is because\n         * parameters are second class citizens of the layout structure. They\n         * are not found in the up_layout_struct table but only in the\n         * up_layout_param table. DLM functionality like dlm:editAllowed,\n         * dlm:moveAllowed, dlm:deleteAllowed, and dlm:addChildAllowed were\n         * implemented without schema changes by adding these as parameters to\n         * structural elements and upon loading any parameter that begins with\n         * 'dlm:' is placed as an attribute on the containing structural\n         * element. So any channel parameter entry with dlm:editAllowed has that\n         * value placed as an attribute on the containing channel not on the\n         * parameter that was meant to have it.\n         *\n         * The only solution would be to add special dlm:parm children below\n         * channels that would get the editAllowed value and then when creating\n         * the DOM don't create those as child elements but use them to set the\n         * attribute on the corresponding parameter by having the name of the\n         * dlm:parm element be the name of the parameter to which it is to be\n         * related.\n         *\n         * The result of this lack of functionality is that fragments can't\n         * mark any channel parameters as dlm:editAllowed='false' thereby\n         * further restricting which channel parameters can be edited beyond\n         * what the channel definition specifies during publishing.\n         */\n        // Attr editAllowed = targetParm.getAttributeNode( Constants.ATT_EDIT_ALLOWED );\n        // if ( editAllowed != null && editAllowed.getNodeValue().equals(\"false\"))\n        //    return false;\n\n        // target parm found. See if channel definition will still allow changes.\n\n        Attr override = targetParm.getAttributeNode(Constants.ATT_OVERRIDE);\n        if (override != null && !override.getNodeValue().equals(Constants.CAN_OVERRIDE))\n            return false;\n\n        // now see if the change is still needed\n        if (targetParm.getAttribute(Constants.ATT_VALUE).equals(parmValue))\n            return false; // user's edit same as fragment or chan def\n\n        targetParm.setAttribute(\"value\", parmValue);\n        return true;\n    }", "code_tokens": ["private", "static", "boolean", "applyEdit", "(", "Element", "edit", ",", "Document", "ilf", ")", "{", "String", "nodeID", "=", "edit", ".", "getAttribute", "(", "Constants", ".", "ATT_TARGET", ")", ";", "Element", "channel", "=", "ilf", ".", "getElementById", "(", "nodeID", ")", ";", "if", "(", "channel", "==", "null", ")", "return", "false", ";", "// now get the name of the parameter to be edited and find that element", "String", "parmName", "=", "edit", ".", "getAttribute", "(", "Constants", ".", "ATT_NAME", ")", ";", "String", "parmValue", "=", "edit", ".", "getAttribute", "(", "Constants", ".", "ATT_USER_VALUE", ")", ";", "NodeList", "ilfParms", "=", "channel", ".", "getChildNodes", "(", ")", ";", "Element", "targetParm", "=", "null", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "ilfParms", ".", "getLength", "(", ")", ";", "i", "++", ")", "{", "Element", "ilfParm", "=", "(", "Element", ")", "ilfParms", ".", "item", "(", "i", ")", ";", "if", "(", "ilfParm", ".", "getAttribute", "(", "Constants", ".", "ATT_NAME", ")", ".", "equals", "(", "parmName", ")", ")", "{", "targetParm", "=", "ilfParm", ";", "break", ";", "}", "}", "if", "(", "targetParm", "==", "null", ")", "// parameter not found so we are free to set", "{", "Element", "parameter", "=", "ilf", ".", "createElement", "(", "\"parameter\"", ")", ";", "parameter", ".", "setAttribute", "(", "\"name\"", ",", "parmName", ")", ";", "parameter", ".", "setAttribute", "(", "\"value\"", ",", "parmValue", ")", ";", "parameter", ".", "setAttribute", "(", "\"override\"", ",", "\"yes\"", ")", ";", "channel", ".", "appendChild", "(", "parameter", ")", ";", "return", "true", ";", "}", "/* TODO Add support for fragments to set dlm:editAllowed attribute for\n         * channel parameters. (2005.11.04 mboyd)\n         *\n         * In the commented code below, the check for editAllowed will never be\n         * seen on a parameter element in the\n         * current database schema approach used by DLM. This is because\n         * parameters are second class citizens of the layout structure. They\n         * are not found in the up_layout_struct table but only in the\n         * up_layout_param table. DLM functionality like dlm:editAllowed,\n         * dlm:moveAllowed, dlm:deleteAllowed, and dlm:addChildAllowed were\n         * implemented without schema changes by adding these as parameters to\n         * structural elements and upon loading any parameter that begins with\n         * 'dlm:' is placed as an attribute on the containing structural\n         * element. So any channel parameter entry with dlm:editAllowed has that\n         * value placed as an attribute on the containing channel not on the\n         * parameter that was meant to have it.\n         *\n         * The only solution would be to add special dlm:parm children below\n         * channels that would get the editAllowed value and then when creating\n         * the DOM don't create those as child elements but use them to set the\n         * attribute on the corresponding parameter by having the name of the\n         * dlm:parm element be the name of the parameter to which it is to be\n         * related.\n         *\n         * The result of this lack of functionality is that fragments can't\n         * mark any channel parameters as dlm:editAllowed='false' thereby\n         * further restricting which channel parameters can be edited beyond\n         * what the channel definition specifies during publishing.\n         */", "// Attr editAllowed = targetParm.getAttributeNode( Constants.ATT_EDIT_ALLOWED );", "// if ( editAllowed != null && editAllowed.getNodeValue().equals(\"false\"))", "//    return false;", "// target parm found. See if channel definition will still allow changes.", "Attr", "override", "=", "targetParm", ".", "getAttributeNode", "(", "Constants", ".", "ATT_OVERRIDE", ")", ";", "if", "(", "override", "!=", "null", "&&", "!", "override", ".", "getNodeValue", "(", ")", ".", "equals", "(", "Constants", ".", "CAN_OVERRIDE", ")", ")", "return", "false", ";", "// now see if the change is still needed", "if", "(", "targetParm", ".", "getAttribute", "(", "Constants", ".", "ATT_VALUE", ")", ".", "equals", "(", "parmValue", ")", ")", "return", "false", ";", "// user's edit same as fragment or chan def", "targetParm", ".", "setAttribute", "(", "\"value\"", ",", "parmValue", ")", ";", "return", "true", ";", "}"], "docstring": "Attempt to apply a single channel parameter edit command and return true if it succeeds or\nfalse otherwise. If the edit is disallowed or the target element no longer exists in the\ndocument the edit command fails and returns false.\n\n@throws Exception", "docstring_tokens": ["Attempt", "to", "apply", "a", "single", "channel", "parameter", "edit", "command", "and", "return", "true", "if", "it", "succeeds", "or", "false", "otherwise", ".", "If", "the", "edit", "is", "disallowed", "or", "the", "target", "element", "no", "longer", "exists", "in", "the", "document", "the", "edit", "command", "fails", "and", "returns", "false", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/ParameterEditManager.java#L94-L168", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/ParameterEditManager.java", "func_name": "ParameterEditManager.getParmEditSet", "original_string": "private static Element getParmEditSet(Document plf, IPerson person, boolean create)\n            throws PortalException {\n        Node root = plf.getDocumentElement();\n        Node child = root.getFirstChild();\n\n        while (child != null) {\n            if (child.getNodeName().equals(Constants.ELM_PARM_SET)) return (Element) child;\n            child = child.getNextSibling();\n        }\n\n        if (create == false) return null;\n\n        String ID = null;\n\n        try {\n            ID = getDLS().getNextStructDirectiveId(person);\n        } catch (Exception e) {\n            throw new PortalException(\n                    \"Exception encountered while \"\n                            + \"generating new parameter edit set node \"\n                            + \"Id for userId=\"\n                            + person.getID(),\n                    e);\n        }\n        Element parmSet = plf.createElement(Constants.ELM_PARM_SET);\n        parmSet.setAttribute(Constants.ATT_TYPE, Constants.ELM_PARM_SET);\n        parmSet.setAttribute(Constants.ATT_ID, ID);\n        parmSet.setIdAttribute(Constants.ATT_ID, true);\n        root.appendChild(parmSet);\n        return parmSet;\n    }", "language": "java", "code": "private static Element getParmEditSet(Document plf, IPerson person, boolean create)\n            throws PortalException {\n        Node root = plf.getDocumentElement();\n        Node child = root.getFirstChild();\n\n        while (child != null) {\n            if (child.getNodeName().equals(Constants.ELM_PARM_SET)) return (Element) child;\n            child = child.getNextSibling();\n        }\n\n        if (create == false) return null;\n\n        String ID = null;\n\n        try {\n            ID = getDLS().getNextStructDirectiveId(person);\n        } catch (Exception e) {\n            throw new PortalException(\n                    \"Exception encountered while \"\n                            + \"generating new parameter edit set node \"\n                            + \"Id for userId=\"\n                            + person.getID(),\n                    e);\n        }\n        Element parmSet = plf.createElement(Constants.ELM_PARM_SET);\n        parmSet.setAttribute(Constants.ATT_TYPE, Constants.ELM_PARM_SET);\n        parmSet.setAttribute(Constants.ATT_ID, ID);\n        parmSet.setIdAttribute(Constants.ATT_ID, true);\n        root.appendChild(parmSet);\n        return parmSet;\n    }", "code_tokens": ["private", "static", "Element", "getParmEditSet", "(", "Document", "plf", ",", "IPerson", "person", ",", "boolean", "create", ")", "throws", "PortalException", "{", "Node", "root", "=", "plf", ".", "getDocumentElement", "(", ")", ";", "Node", "child", "=", "root", ".", "getFirstChild", "(", ")", ";", "while", "(", "child", "!=", "null", ")", "{", "if", "(", "child", ".", "getNodeName", "(", ")", ".", "equals", "(", "Constants", ".", "ELM_PARM_SET", ")", ")", "return", "(", "Element", ")", "child", ";", "child", "=", "child", ".", "getNextSibling", "(", ")", ";", "}", "if", "(", "create", "==", "false", ")", "return", "null", ";", "String", "ID", "=", "null", ";", "try", "{", "ID", "=", "getDLS", "(", ")", ".", "getNextStructDirectiveId", "(", "person", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "PortalException", "(", "\"Exception encountered while \"", "+", "\"generating new parameter edit set node \"", "+", "\"Id for userId=\"", "+", "person", ".", "getID", "(", ")", ",", "e", ")", ";", "}", "Element", "parmSet", "=", "plf", ".", "createElement", "(", "Constants", ".", "ELM_PARM_SET", ")", ";", "parmSet", ".", "setAttribute", "(", "Constants", ".", "ATT_TYPE", ",", "Constants", ".", "ELM_PARM_SET", ")", ";", "parmSet", ".", "setAttribute", "(", "Constants", ".", "ATT_ID", ",", "ID", ")", ";", "parmSet", ".", "setIdAttribute", "(", "Constants", ".", "ATT_ID", ",", "true", ")", ";", "root", ".", "appendChild", "(", "parmSet", ")", ";", "return", "parmSet", ";", "}"], "docstring": "Get the parameter edits set if any stored in the root of the document or create it if\npassed-in create flag is true.", "docstring_tokens": ["Get", "the", "parameter", "edits", "set", "if", "any", "stored", "in", "the", "root", "of", "the", "document", "or", "create", "it", "if", "passed", "-", "in", "create", "flag", "is", "true", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/ParameterEditManager.java#L174-L204", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/ParameterEditManager.java", "func_name": "ParameterEditManager.addParmEditDirective", "original_string": "public static synchronized void addParmEditDirective(\n            String targetId, String name, String value, IPerson person) throws PortalException {\n        Document plf = (Document) person.getAttribute(Constants.PLF);\n        Element parmSet = getParmEditSet(plf, person, true);\n        NodeList edits = parmSet.getChildNodes();\n        Element existingEdit = null;\n\n        for (int i = 0; i < edits.getLength(); i++) {\n            Element edit = (Element) edits.item(i);\n            if (edit.getAttribute(Constants.ATT_TARGET).equals(targetId)\n                    && edit.getAttribute(Constants.ATT_NAME).equals(name)) {\n                existingEdit = edit;\n                break;\n            }\n        }\n        if (existingEdit == null) // existing one not found, create a new one\n        {\n            addParmEditDirective(targetId, name, value, person, plf, parmSet);\n            return;\n        }\n        existingEdit.setAttribute(Constants.ATT_USER_VALUE, value);\n    }", "language": "java", "code": "public static synchronized void addParmEditDirective(\n            String targetId, String name, String value, IPerson person) throws PortalException {\n        Document plf = (Document) person.getAttribute(Constants.PLF);\n        Element parmSet = getParmEditSet(plf, person, true);\n        NodeList edits = parmSet.getChildNodes();\n        Element existingEdit = null;\n\n        for (int i = 0; i < edits.getLength(); i++) {\n            Element edit = (Element) edits.item(i);\n            if (edit.getAttribute(Constants.ATT_TARGET).equals(targetId)\n                    && edit.getAttribute(Constants.ATT_NAME).equals(name)) {\n                existingEdit = edit;\n                break;\n            }\n        }\n        if (existingEdit == null) // existing one not found, create a new one\n        {\n            addParmEditDirective(targetId, name, value, person, plf, parmSet);\n            return;\n        }\n        existingEdit.setAttribute(Constants.ATT_USER_VALUE, value);\n    }", "code_tokens": ["public", "static", "synchronized", "void", "addParmEditDirective", "(", "String", "targetId", ",", "String", "name", ",", "String", "value", ",", "IPerson", "person", ")", "throws", "PortalException", "{", "Document", "plf", "=", "(", "Document", ")", "person", ".", "getAttribute", "(", "Constants", ".", "PLF", ")", ";", "Element", "parmSet", "=", "getParmEditSet", "(", "plf", ",", "person", ",", "true", ")", ";", "NodeList", "edits", "=", "parmSet", ".", "getChildNodes", "(", ")", ";", "Element", "existingEdit", "=", "null", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "edits", ".", "getLength", "(", ")", ";", "i", "++", ")", "{", "Element", "edit", "=", "(", "Element", ")", "edits", ".", "item", "(", "i", ")", ";", "if", "(", "edit", ".", "getAttribute", "(", "Constants", ".", "ATT_TARGET", ")", ".", "equals", "(", "targetId", ")", "&&", "edit", ".", "getAttribute", "(", "Constants", ".", "ATT_NAME", ")", ".", "equals", "(", "name", ")", ")", "{", "existingEdit", "=", "edit", ";", "break", ";", "}", "}", "if", "(", "existingEdit", "==", "null", ")", "// existing one not found, create a new one", "{", "addParmEditDirective", "(", "targetId", ",", "name", ",", "value", ",", "person", ",", "plf", ",", "parmSet", ")", ";", "return", ";", "}", "existingEdit", ".", "setAttribute", "(", "Constants", ".", "ATT_USER_VALUE", ",", "value", ")", ";", "}"], "docstring": "Create and append a parameter edit directive to parameter edits set for applying a user\nspecified value to a named parameter of the incorporated channel represented by the passed-in\ntarget id. If one already exists for that node and that name then the value of the existing\nedit is changed to the passed-in value.", "docstring_tokens": ["Create", "and", "append", "a", "parameter", "edit", "directive", "to", "parameter", "edits", "set", "for", "applying", "a", "user", "specified", "value", "to", "a", "named", "parameter", "of", "the", "incorporated", "channel", "represented", "by", "the", "passed", "-", "in", "target", "id", ".", "If", "one", "already", "exists", "for", "that", "node", "and", "that", "name", "then", "the", "value", "of", "the", "existing", "edit", "is", "changed", "to", "the", "passed", "-", "in", "value", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/ParameterEditManager.java#L212-L233", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/ParameterEditManager.java", "func_name": "ParameterEditManager.addParmEditDirective", "original_string": "private static void addParmEditDirective(\n            String targetID,\n            String name,\n            String value,\n            IPerson person,\n            Document plf,\n            Element parmSet)\n            throws PortalException {\n\n        String ID = null;\n\n        try {\n            ID = getDLS().getNextStructDirectiveId(person);\n        } catch (Exception e) {\n            throw new PortalException(\n                    \"Exception encountered while \"\n                            + \"generating new parameter edit node \"\n                            + \"Id for userId=\"\n                            + person.getID(),\n                    e);\n        }\n        Element parm = plf.createElement(Constants.ELM_PARM_EDIT);\n        parm.setAttribute(Constants.ATT_TYPE, Constants.ELM_PARM_EDIT);\n        parm.setAttribute(Constants.ATT_ID, ID);\n        parm.setIdAttribute(Constants.ATT_ID, true);\n        parm.setAttributeNS(Constants.NS_URI, Constants.ATT_TARGET, targetID);\n        parm.setAttribute(Constants.ATT_NAME, name);\n        parm.setAttribute(Constants.ATT_USER_VALUE, value);\n        parmSet.appendChild(parm);\n    }", "language": "java", "code": "private static void addParmEditDirective(\n            String targetID,\n            String name,\n            String value,\n            IPerson person,\n            Document plf,\n            Element parmSet)\n            throws PortalException {\n\n        String ID = null;\n\n        try {\n            ID = getDLS().getNextStructDirectiveId(person);\n        } catch (Exception e) {\n            throw new PortalException(\n                    \"Exception encountered while \"\n                            + \"generating new parameter edit node \"\n                            + \"Id for userId=\"\n                            + person.getID(),\n                    e);\n        }\n        Element parm = plf.createElement(Constants.ELM_PARM_EDIT);\n        parm.setAttribute(Constants.ATT_TYPE, Constants.ELM_PARM_EDIT);\n        parm.setAttribute(Constants.ATT_ID, ID);\n        parm.setIdAttribute(Constants.ATT_ID, true);\n        parm.setAttributeNS(Constants.NS_URI, Constants.ATT_TARGET, targetID);\n        parm.setAttribute(Constants.ATT_NAME, name);\n        parm.setAttribute(Constants.ATT_USER_VALUE, value);\n        parmSet.appendChild(parm);\n    }", "code_tokens": ["private", "static", "void", "addParmEditDirective", "(", "String", "targetID", ",", "String", "name", ",", "String", "value", ",", "IPerson", "person", ",", "Document", "plf", ",", "Element", "parmSet", ")", "throws", "PortalException", "{", "String", "ID", "=", "null", ";", "try", "{", "ID", "=", "getDLS", "(", ")", ".", "getNextStructDirectiveId", "(", "person", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "PortalException", "(", "\"Exception encountered while \"", "+", "\"generating new parameter edit node \"", "+", "\"Id for userId=\"", "+", "person", ".", "getID", "(", ")", ",", "e", ")", ";", "}", "Element", "parm", "=", "plf", ".", "createElement", "(", "Constants", ".", "ELM_PARM_EDIT", ")", ";", "parm", ".", "setAttribute", "(", "Constants", ".", "ATT_TYPE", ",", "Constants", ".", "ELM_PARM_EDIT", ")", ";", "parm", ".", "setAttribute", "(", "Constants", ".", "ATT_ID", ",", "ID", ")", ";", "parm", ".", "setIdAttribute", "(", "Constants", ".", "ATT_ID", ",", "true", ")", ";", "parm", ".", "setAttributeNS", "(", "Constants", ".", "NS_URI", ",", "Constants", ".", "ATT_TARGET", ",", "targetID", ")", ";", "parm", ".", "setAttribute", "(", "Constants", ".", "ATT_NAME", ",", "name", ")", ";", "parm", ".", "setAttribute", "(", "Constants", ".", "ATT_USER_VALUE", ",", "value", ")", ";", "parmSet", ".", "appendChild", "(", "parm", ")", ";", "}"], "docstring": "This method does the actual work of adding a newly created parameter edit and adding it to\nthe parameter edits set.", "docstring_tokens": ["This", "method", "does", "the", "actual", "work", "of", "adding", "a", "newly", "created", "parameter", "edit", "and", "adding", "it", "to", "the", "parameter", "edits", "set", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/ParameterEditManager.java#L239-L268", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/ParameterEditManager.java", "func_name": "ParameterEditManager.removeParmEditDirective", "original_string": "public static void removeParmEditDirective(String targetId, String name, IPerson person)\n            throws PortalException {\n        Document plf = (Document) person.getAttribute(Constants.PLF);\n        Element parmSet = getParmEditSet(plf, person, false);\n\n        if (parmSet == null) return; // no set so no edit to remove\n\n        NodeList edits = parmSet.getChildNodes();\n\n        for (int i = 0; i < edits.getLength(); i++) {\n            Element edit = (Element) edits.item(i);\n            if (edit.getAttribute(Constants.ATT_TARGET).equals(targetId)\n                    && edit.getAttribute(Constants.ATT_NAME).equals(name)) {\n                parmSet.removeChild(edit);\n                break;\n            }\n        }\n        if (parmSet.getChildNodes().getLength() == 0) // no more edits, remove\n        {\n            Node parent = parmSet.getParentNode();\n            parent.removeChild(parmSet);\n        }\n    }", "language": "java", "code": "public static void removeParmEditDirective(String targetId, String name, IPerson person)\n            throws PortalException {\n        Document plf = (Document) person.getAttribute(Constants.PLF);\n        Element parmSet = getParmEditSet(plf, person, false);\n\n        if (parmSet == null) return; // no set so no edit to remove\n\n        NodeList edits = parmSet.getChildNodes();\n\n        for (int i = 0; i < edits.getLength(); i++) {\n            Element edit = (Element) edits.item(i);\n            if (edit.getAttribute(Constants.ATT_TARGET).equals(targetId)\n                    && edit.getAttribute(Constants.ATT_NAME).equals(name)) {\n                parmSet.removeChild(edit);\n                break;\n            }\n        }\n        if (parmSet.getChildNodes().getLength() == 0) // no more edits, remove\n        {\n            Node parent = parmSet.getParentNode();\n            parent.removeChild(parmSet);\n        }\n    }", "code_tokens": ["public", "static", "void", "removeParmEditDirective", "(", "String", "targetId", ",", "String", "name", ",", "IPerson", "person", ")", "throws", "PortalException", "{", "Document", "plf", "=", "(", "Document", ")", "person", ".", "getAttribute", "(", "Constants", ".", "PLF", ")", ";", "Element", "parmSet", "=", "getParmEditSet", "(", "plf", ",", "person", ",", "false", ")", ";", "if", "(", "parmSet", "==", "null", ")", "return", ";", "// no set so no edit to remove", "NodeList", "edits", "=", "parmSet", ".", "getChildNodes", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "edits", ".", "getLength", "(", ")", ";", "i", "++", ")", "{", "Element", "edit", "=", "(", "Element", ")", "edits", ".", "item", "(", "i", ")", ";", "if", "(", "edit", ".", "getAttribute", "(", "Constants", ".", "ATT_TARGET", ")", ".", "equals", "(", "targetId", ")", "&&", "edit", ".", "getAttribute", "(", "Constants", ".", "ATT_NAME", ")", ".", "equals", "(", "name", ")", ")", "{", "parmSet", ".", "removeChild", "(", "edit", ")", ";", "break", ";", "}", "}", "if", "(", "parmSet", ".", "getChildNodes", "(", ")", ".", "getLength", "(", ")", "==", "0", ")", "// no more edits, remove", "{", "Node", "parent", "=", "parmSet", ".", "getParentNode", "(", ")", ";", "parent", ".", "removeChild", "(", "parmSet", ")", ";", "}", "}"], "docstring": "Remove a parameter edit directive from the parameter edits set for applying user specified\nvalues to a named parameter of an incorporated channel represented by the passed-in target\nid. If one doesn't exists for that node and that name then this call returns without any\neffects.", "docstring_tokens": ["Remove", "a", "parameter", "edit", "directive", "from", "the", "parameter", "edits", "set", "for", "applying", "user", "specified", "values", "to", "a", "named", "parameter", "of", "an", "incorporated", "channel", "represented", "by", "the", "passed", "-", "in", "target", "id", ".", "If", "one", "doesn", "t", "exists", "for", "that", "node", "and", "that", "name", "then", "this", "call", "returns", "without", "any", "effects", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/ParameterEditManager.java#L275-L297", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/JdbcUtils.java", "func_name": "JdbcUtils.dropTableIfExists", "original_string": "public static final <T> T dropTableIfExists(\n            JdbcOperations jdbcOperations,\n            final String table,\n            final Function<JdbcOperations, T> preDropCallback) {\n        LOGGER.info(\"Dropping table: \" + table);\n\n        final boolean tableExists = doesTableExist(jdbcOperations, table);\n\n        if (tableExists) {\n            final T ret = preDropCallback.apply(jdbcOperations);\n            jdbcOperations.execute(\"DROP TABLE \" + table);\n            return ret;\n        }\n\n        return null;\n    }", "language": "java", "code": "public static final <T> T dropTableIfExists(\n            JdbcOperations jdbcOperations,\n            final String table,\n            final Function<JdbcOperations, T> preDropCallback) {\n        LOGGER.info(\"Dropping table: \" + table);\n\n        final boolean tableExists = doesTableExist(jdbcOperations, table);\n\n        if (tableExists) {\n            final T ret = preDropCallback.apply(jdbcOperations);\n            jdbcOperations.execute(\"DROP TABLE \" + table);\n            return ret;\n        }\n\n        return null;\n    }", "code_tokens": ["public", "static", "final", "<", "T", ">", "T", "dropTableIfExists", "(", "JdbcOperations", "jdbcOperations", ",", "final", "String", "table", ",", "final", "Function", "<", "JdbcOperations", ",", "T", ">", "preDropCallback", ")", "{", "LOGGER", ".", "info", "(", "\"Dropping table: \"", "+", "table", ")", ";", "final", "boolean", "tableExists", "=", "doesTableExist", "(", "jdbcOperations", ",", "table", ")", ";", "if", "(", "tableExists", ")", "{", "final", "T", "ret", "=", "preDropCallback", ".", "apply", "(", "jdbcOperations", ")", ";", "jdbcOperations", ".", "execute", "(", "\"DROP TABLE \"", "+", "table", ")", ";", "return", "ret", ";", "}", "return", "null", ";", "}"], "docstring": "Check if the named table exists, if it does drop it, calling the preDropCallback first\n\n@param jdbcOperations {@link JdbcOperations} used to check if the table exists and execute\nthe drop\n@param table The name of the table to drop, case insensitive\n@param preDropCallback The callback to execute immediately before the table is dropped\n@return The result returned from the callback", "docstring_tokens": ["Check", "if", "the", "named", "table", "exists", "if", "it", "does", "drop", "it", "calling", "the", "preDropCallback", "first"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/JdbcUtils.java#L44-L59", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/JdbcUtils.java", "func_name": "JdbcUtils.doesTableExist", "original_string": "public static boolean doesTableExist(JdbcOperations jdbcOperations, final String table) {\n\n        final boolean tableExists =\n                jdbcOperations.execute(\n                        new ConnectionCallback<Boolean>() {\n                            @Override\n                            public Boolean doInConnection(Connection con)\n                                    throws SQLException, DataAccessException {\n\n                                final DatabaseMetaData metaData = con.getMetaData();\n                                final ResultSet tables =\n                                        metaData.getTables(\n                                                null, null, null, new String[] {\"TABLE\"});\n                                while (tables.next()) {\n                                    final String dbTableName = tables.getString(\"TABLE_NAME\");\n                                    if (table.equalsIgnoreCase(dbTableName)) {\n                                        return true;\n                                    }\n                                }\n\n                                return false;\n                            }\n                        });\n        return tableExists;\n    }", "language": "java", "code": "public static boolean doesTableExist(JdbcOperations jdbcOperations, final String table) {\n\n        final boolean tableExists =\n                jdbcOperations.execute(\n                        new ConnectionCallback<Boolean>() {\n                            @Override\n                            public Boolean doInConnection(Connection con)\n                                    throws SQLException, DataAccessException {\n\n                                final DatabaseMetaData metaData = con.getMetaData();\n                                final ResultSet tables =\n                                        metaData.getTables(\n                                                null, null, null, new String[] {\"TABLE\"});\n                                while (tables.next()) {\n                                    final String dbTableName = tables.getString(\"TABLE_NAME\");\n                                    if (table.equalsIgnoreCase(dbTableName)) {\n                                        return true;\n                                    }\n                                }\n\n                                return false;\n                            }\n                        });\n        return tableExists;\n    }", "code_tokens": ["public", "static", "boolean", "doesTableExist", "(", "JdbcOperations", "jdbcOperations", ",", "final", "String", "table", ")", "{", "final", "boolean", "tableExists", "=", "jdbcOperations", ".", "execute", "(", "new", "ConnectionCallback", "<", "Boolean", ">", "(", ")", "{", "@", "Override", "public", "Boolean", "doInConnection", "(", "Connection", "con", ")", "throws", "SQLException", ",", "DataAccessException", "{", "final", "DatabaseMetaData", "metaData", "=", "con", ".", "getMetaData", "(", ")", ";", "final", "ResultSet", "tables", "=", "metaData", ".", "getTables", "(", "null", ",", "null", ",", "null", ",", "new", "String", "[", "]", "{", "\"TABLE\"", "}", ")", ";", "while", "(", "tables", ".", "next", "(", ")", ")", "{", "final", "String", "dbTableName", "=", "tables", ".", "getString", "(", "\"TABLE_NAME\"", ")", ";", "if", "(", "table", ".", "equalsIgnoreCase", "(", "dbTableName", ")", ")", "{", "return", "true", ";", "}", "}", "return", "false", ";", "}", "}", ")", ";", "return", "tableExists", ";", "}"], "docstring": "Check if the specified table exists", "docstring_tokens": ["Check", "if", "the", "specified", "table", "exists"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/JdbcUtils.java#L62-L86", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-persondir/src/main/java/org/apereo/portal/RDBMUserIdentityStore.java", "func_name": "RDBMUserIdentityStore.removePortalUID", "original_string": "@Override\n    public void removePortalUID(final int uPortalUID) {\n\n        this.transactionOperations.execute(\n                new TransactionCallbackWithoutResult() {\n                    @Override\n                    protected void doInTransactionWithoutResult(TransactionStatus arg0) {\n                        final String name =\n                                jdbcOperations.queryForObject(\n                                        \"SELECT USER_NAME FROM UP_USER WHERE USER_ID=?\",\n                                        String.class,\n                                        uPortalUID);\n                        if (name == null) {\n                            log.warn(\n                                    \"No user exists for id \"\n                                            + uPortalUID\n                                            + \" Nothing will be deleted\");\n                            return;\n                        }\n\n                        removePortalUID(name);\n                    }\n                });\n    }", "language": "java", "code": "@Override\n    public void removePortalUID(final int uPortalUID) {\n\n        this.transactionOperations.execute(\n                new TransactionCallbackWithoutResult() {\n                    @Override\n                    protected void doInTransactionWithoutResult(TransactionStatus arg0) {\n                        final String name =\n                                jdbcOperations.queryForObject(\n                                        \"SELECT USER_NAME FROM UP_USER WHERE USER_ID=?\",\n                                        String.class,\n                                        uPortalUID);\n                        if (name == null) {\n                            log.warn(\n                                    \"No user exists for id \"\n                                            + uPortalUID\n                                            + \" Nothing will be deleted\");\n                            return;\n                        }\n\n                        removePortalUID(name);\n                    }\n                });\n    }", "code_tokens": ["@", "Override", "public", "void", "removePortalUID", "(", "final", "int", "uPortalUID", ")", "{", "this", ".", "transactionOperations", ".", "execute", "(", "new", "TransactionCallbackWithoutResult", "(", ")", "{", "@", "Override", "protected", "void", "doInTransactionWithoutResult", "(", "TransactionStatus", "arg0", ")", "{", "final", "String", "name", "=", "jdbcOperations", ".", "queryForObject", "(", "\"SELECT USER_NAME FROM UP_USER WHERE USER_ID=?\"", ",", "String", ".", "class", ",", "uPortalUID", ")", ";", "if", "(", "name", "==", "null", ")", "{", "log", ".", "warn", "(", "\"No user exists for id \"", "+", "uPortalUID", "+", "\" Nothing will be deleted\"", ")", ";", "return", ";", "}", "removePortalUID", "(", "name", ")", ";", "}", "}", ")", ";", "}"], "docstring": "removeuPortalUID\n\n@param uPortalUID integer key to uPortal data for a user", "docstring_tokens": ["removeuPortalUID"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-persondir/src/main/java/org/apereo/portal/RDBMUserIdentityStore.java#L233-L256", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-persondir/src/main/java/org/apereo/portal/RDBMUserIdentityStore.java", "func_name": "RDBMUserIdentityStore.getPortalUID", "original_string": "@Override\n    public int getPortalUID(IPerson person, boolean createPortalData)\n            throws AuthorizationException {\n        int uid;\n        String username = (String) person.getAttribute(IPerson.USERNAME);\n\n        // only synchronize a non-guest request.\n        if (PersonFactory.getGuestUsernames().contains(username)) {\n            uid = __getPortalUID(person, createPortalData);\n        } else {\n            synchronized (getLock(person)) {\n                uid = __getPortalUID(person, createPortalData);\n            }\n        }\n        return uid;\n    }", "language": "java", "code": "@Override\n    public int getPortalUID(IPerson person, boolean createPortalData)\n            throws AuthorizationException {\n        int uid;\n        String username = (String) person.getAttribute(IPerson.USERNAME);\n\n        // only synchronize a non-guest request.\n        if (PersonFactory.getGuestUsernames().contains(username)) {\n            uid = __getPortalUID(person, createPortalData);\n        } else {\n            synchronized (getLock(person)) {\n                uid = __getPortalUID(person, createPortalData);\n            }\n        }\n        return uid;\n    }", "code_tokens": ["@", "Override", "public", "int", "getPortalUID", "(", "IPerson", "person", ",", "boolean", "createPortalData", ")", "throws", "AuthorizationException", "{", "int", "uid", ";", "String", "username", "=", "(", "String", ")", "person", ".", "getAttribute", "(", "IPerson", ".", "USERNAME", ")", ";", "// only synchronize a non-guest request.", "if", "(", "PersonFactory", ".", "getGuestUsernames", "(", ")", ".", "contains", "(", "username", ")", ")", "{", "uid", "=", "__getPortalUID", "(", "person", ",", "createPortalData", ")", ";", "}", "else", "{", "synchronized", "(", "getLock", "(", "person", ")", ")", "{", "uid", "=", "__getPortalUID", "(", "person", ",", "createPortalData", ")", ";", "}", "}", "return", "uid", ";", "}"], "docstring": "Get the portal user ID for this person object.\n\n@param person The {@link IPerson} for whom a UID is requested\n@param createPortalData indicating whether to try to create all uPortal data for this user\nfrom template prototype\n@return uPortalUID number or -1 if unable to create user.\n@throws AuthorizationException if createPortalData is false and no user is found or if a sql\nerror is encountered", "docstring_tokens": ["Get", "the", "portal", "user", "ID", "for", "this", "person", "object", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-persondir/src/main/java/org/apereo/portal/RDBMUserIdentityStore.java#L268-L283", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-persondir/src/main/java/org/apereo/portal/RDBMUserIdentityStore.java", "func_name": "RDBMUserIdentityStore.getPortalUserName", "original_string": "@Override\n    public String getPortalUserName(final int uPortalUID) {\n        final List<String> results =\n                this.jdbcOperations.queryForList(\n                        \"SELECT USER_NAME FROM UP_USER WHERE USER_ID=?\", String.class, uPortalUID);\n        return DataAccessUtils.singleResult(results);\n    }", "language": "java", "code": "@Override\n    public String getPortalUserName(final int uPortalUID) {\n        final List<String> results =\n                this.jdbcOperations.queryForList(\n                        \"SELECT USER_NAME FROM UP_USER WHERE USER_ID=?\", String.class, uPortalUID);\n        return DataAccessUtils.singleResult(results);\n    }", "code_tokens": ["@", "Override", "public", "String", "getPortalUserName", "(", "final", "int", "uPortalUID", ")", "{", "final", "List", "<", "String", ">", "results", "=", "this", ".", "jdbcOperations", ".", "queryForList", "(", "\"SELECT USER_NAME FROM UP_USER WHERE USER_ID=?\"", ",", "String", ".", "class", ",", "uPortalUID", ")", ";", "return", "DataAccessUtils", ".", "singleResult", "(", "results", ")", ";", "}"], "docstring": "/* (non-javadoc)\n@see org.apereo.portal.IUserIdentityStore#getPortalUserName(int)", "docstring_tokens": ["/", "*", "(", "non", "-", "javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-persondir/src/main/java/org/apereo/portal/RDBMUserIdentityStore.java#L299-L305", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-persondir/src/main/java/org/apereo/portal/RDBMUserIdentityStore.java", "func_name": "RDBMUserIdentityStore.getPortalUserId", "original_string": "@Override\n    public Integer getPortalUserId(String userName) {\n        final List<Integer> results =\n                this.jdbcOperations.queryForList(\n                        \"SELECT USER_ID FROM UP_USER WHERE USER_NAME=?\", Integer.class, userName);\n        return DataAccessUtils.singleResult(results);\n    }", "language": "java", "code": "@Override\n    public Integer getPortalUserId(String userName) {\n        final List<Integer> results =\n                this.jdbcOperations.queryForList(\n                        \"SELECT USER_ID FROM UP_USER WHERE USER_NAME=?\", Integer.class, userName);\n        return DataAccessUtils.singleResult(results);\n    }", "code_tokens": ["@", "Override", "public", "Integer", "getPortalUserId", "(", "String", "userName", ")", "{", "final", "List", "<", "Integer", ">", "results", "=", "this", ".", "jdbcOperations", ".", "queryForList", "(", "\"SELECT USER_ID FROM UP_USER WHERE USER_NAME=?\"", ",", "Integer", ".", "class", ",", "userName", ")", ";", "return", "DataAccessUtils", ".", "singleResult", "(", "results", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.IUserIdentityStore#getPortalUserId(java.lang.String)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-persondir/src/main/java/org/apereo/portal/RDBMUserIdentityStore.java#L310-L316", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-persondir/src/main/java/org/apereo/portal/RDBMUserIdentityStore.java", "func_name": "RDBMUserIdentityStore.getPortalUser", "original_string": "private PortalUser getPortalUser(final String userName) {\n        return jdbcOperations.execute(\n                (ConnectionCallback<PortalUser>)\n                        con -> {\n                            PortalUser portalUser = null;\n                            PreparedStatement pstmt = null;\n\n                            try {\n                                String query = \"SELECT USER_ID FROM UP_USER WHERE USER_NAME=?\";\n\n                                pstmt = con.prepareStatement(query);\n                                pstmt.setString(1, userName);\n\n                                ResultSet rs = null;\n                                try {\n                                    if (log.isDebugEnabled())\n                                        log.debug(\n                                                \"RDBMUserIdentityStore::getPortalUID(userName=\"\n                                                        + userName\n                                                        + \"): \"\n                                                        + query);\n                                    rs = pstmt.executeQuery();\n                                    if (rs.next()) {\n                                        portalUser = new PortalUser();\n                                        portalUser.setUserId(rs.getInt(\"USER_ID\"));\n                                        portalUser.setUserName(userName);\n                                    }\n                                } finally {\n                                    try {\n                                        if (rs != null) {\n                                            rs.close();\n                                        }\n                                    } catch (Exception e) {\n                                    }\n                                }\n                            } finally {\n                                try {\n                                    if (pstmt != null) {\n                                        pstmt.close();\n                                    }\n                                } catch (Exception e) {\n                                }\n                            }\n\n                            return portalUser;\n                        });\n    }", "language": "java", "code": "private PortalUser getPortalUser(final String userName) {\n        return jdbcOperations.execute(\n                (ConnectionCallback<PortalUser>)\n                        con -> {\n                            PortalUser portalUser = null;\n                            PreparedStatement pstmt = null;\n\n                            try {\n                                String query = \"SELECT USER_ID FROM UP_USER WHERE USER_NAME=?\";\n\n                                pstmt = con.prepareStatement(query);\n                                pstmt.setString(1, userName);\n\n                                ResultSet rs = null;\n                                try {\n                                    if (log.isDebugEnabled())\n                                        log.debug(\n                                                \"RDBMUserIdentityStore::getPortalUID(userName=\"\n                                                        + userName\n                                                        + \"): \"\n                                                        + query);\n                                    rs = pstmt.executeQuery();\n                                    if (rs.next()) {\n                                        portalUser = new PortalUser();\n                                        portalUser.setUserId(rs.getInt(\"USER_ID\"));\n                                        portalUser.setUserName(userName);\n                                    }\n                                } finally {\n                                    try {\n                                        if (rs != null) {\n                                            rs.close();\n                                        }\n                                    } catch (Exception e) {\n                                    }\n                                }\n                            } finally {\n                                try {\n                                    if (pstmt != null) {\n                                        pstmt.close();\n                                    }\n                                } catch (Exception e) {\n                                }\n                            }\n\n                            return portalUser;\n                        });\n    }", "code_tokens": ["private", "PortalUser", "getPortalUser", "(", "final", "String", "userName", ")", "{", "return", "jdbcOperations", ".", "execute", "(", "(", "ConnectionCallback", "<", "PortalUser", ">", ")", "con", "->", "{", "PortalUser", "portalUser", "=", "null", ";", "PreparedStatement", "pstmt", "=", "null", ";", "try", "{", "String", "query", "=", "\"SELECT USER_ID FROM UP_USER WHERE USER_NAME=?\"", ";", "pstmt", "=", "con", ".", "prepareStatement", "(", "query", ")", ";", "pstmt", ".", "setString", "(", "1", ",", "userName", ")", ";", "ResultSet", "rs", "=", "null", ";", "try", "{", "if", "(", "log", ".", "isDebugEnabled", "(", ")", ")", "log", ".", "debug", "(", "\"RDBMUserIdentityStore::getPortalUID(userName=\"", "+", "userName", "+", "\"): \"", "+", "query", ")", ";", "rs", "=", "pstmt", ".", "executeQuery", "(", ")", ";", "if", "(", "rs", ".", "next", "(", ")", ")", "{", "portalUser", "=", "new", "PortalUser", "(", ")", ";", "portalUser", ".", "setUserId", "(", "rs", ".", "getInt", "(", "\"USER_ID\"", ")", ")", ";", "portalUser", ".", "setUserName", "(", "userName", ")", ";", "}", "}", "finally", "{", "try", "{", "if", "(", "rs", "!=", "null", ")", "{", "rs", ".", "close", "(", ")", ";", "}", "}", "catch", "(", "Exception", "e", ")", "{", "}", "}", "}", "finally", "{", "try", "{", "if", "(", "pstmt", "!=", "null", ")", "{", "pstmt", ".", "close", "(", ")", ";", "}", "}", "catch", "(", "Exception", "e", ")", "{", "}", "}", "return", "portalUser", ";", "}", ")", ";", "}"], "docstring": "Gets the PortalUser data store object for the specified user name.\n\n@param userName The user's name\n@return A PortalUser object or null if the user doesn't exist.", "docstring_tokens": ["Gets", "the", "PortalUser", "data", "store", "object", "for", "the", "specified", "user", "name", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-persondir/src/main/java/org/apereo/portal/RDBMUserIdentityStore.java#L377-L423", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/MergingTransformerConfigurationSource.java", "func_name": "MergingTransformerConfigurationSource.getCacheKey", "original_string": "@Override\n    public CacheKey getCacheKey(HttpServletRequest request, HttpServletResponse response) {\n        final CacheKeyBuilder cacheKeyBuilder = CacheKey.builder(this.getClass().getName());\n\n        for (final TransformerConfigurationSource source : this.sources) {\n            final CacheKey key = source.getCacheKey(request, response);\n            cacheKeyBuilder.add(key);\n        }\n\n        return cacheKeyBuilder.build();\n    }", "language": "java", "code": "@Override\n    public CacheKey getCacheKey(HttpServletRequest request, HttpServletResponse response) {\n        final CacheKeyBuilder cacheKeyBuilder = CacheKey.builder(this.getClass().getName());\n\n        for (final TransformerConfigurationSource source : this.sources) {\n            final CacheKey key = source.getCacheKey(request, response);\n            cacheKeyBuilder.add(key);\n        }\n\n        return cacheKeyBuilder.build();\n    }", "code_tokens": ["@", "Override", "public", "CacheKey", "getCacheKey", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "final", "CacheKeyBuilder", "cacheKeyBuilder", "=", "CacheKey", ".", "builder", "(", "this", ".", "getClass", "(", ")", ".", "getName", "(", ")", ")", ";", "for", "(", "final", "TransformerConfigurationSource", "source", ":", "this", ".", "sources", ")", "{", "final", "CacheKey", "key", "=", "source", ".", "getCacheKey", "(", "request", ",", "response", ")", ";", "cacheKeyBuilder", ".", "add", "(", "key", ")", ";", "}", "return", "cacheKeyBuilder", ".", "build", "(", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.xslt.TransformerConfigurationSource#getTransformerConfigurationKey(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/MergingTransformerConfigurationSource.java#L37-L47", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/MergingTransformerConfigurationSource.java", "func_name": "MergingTransformerConfigurationSource.getOutputProperties", "original_string": "@Override\n    public Properties getOutputProperties(\n            HttpServletRequest request, HttpServletResponse response) {\n        final Properties mergedProperties = new Properties();\n\n        for (final TransformerConfigurationSource source : this.sources) {\n            final Properties properties = source.getOutputProperties(request, response);\n            if (properties != null) {\n                mergedProperties.putAll(properties);\n            }\n        }\n\n        return mergedProperties;\n    }", "language": "java", "code": "@Override\n    public Properties getOutputProperties(\n            HttpServletRequest request, HttpServletResponse response) {\n        final Properties mergedProperties = new Properties();\n\n        for (final TransformerConfigurationSource source : this.sources) {\n            final Properties properties = source.getOutputProperties(request, response);\n            if (properties != null) {\n                mergedProperties.putAll(properties);\n            }\n        }\n\n        return mergedProperties;\n    }", "code_tokens": ["@", "Override", "public", "Properties", "getOutputProperties", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "final", "Properties", "mergedProperties", "=", "new", "Properties", "(", ")", ";", "for", "(", "final", "TransformerConfigurationSource", "source", ":", "this", ".", "sources", ")", "{", "final", "Properties", "properties", "=", "source", ".", "getOutputProperties", "(", "request", ",", "response", ")", ";", "if", "(", "properties", "!=", "null", ")", "{", "mergedProperties", ".", "putAll", "(", "properties", ")", ";", "}", "}", "return", "mergedProperties", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.xslt.TransformerConfigurationSource#getTransformerOutputProperties(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/MergingTransformerConfigurationSource.java#L52-L65", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/MergingTransformerConfigurationSource.java", "func_name": "MergingTransformerConfigurationSource.getParameters", "original_string": "@Override\n    public Map<String, Object> getParameters(\n            HttpServletRequest request, HttpServletResponse response) {\n        final Map<String, Object> mergedParameters = new LinkedHashMap<String, Object>();\n\n        for (final TransformerConfigurationSource source : this.sources) {\n            final Map<String, Object> parameters = source.getParameters(request, response);\n            if (parameters != null) {\n                mergedParameters.putAll(parameters);\n            }\n        }\n\n        return mergedParameters;\n    }", "language": "java", "code": "@Override\n    public Map<String, Object> getParameters(\n            HttpServletRequest request, HttpServletResponse response) {\n        final Map<String, Object> mergedParameters = new LinkedHashMap<String, Object>();\n\n        for (final TransformerConfigurationSource source : this.sources) {\n            final Map<String, Object> parameters = source.getParameters(request, response);\n            if (parameters != null) {\n                mergedParameters.putAll(parameters);\n            }\n        }\n\n        return mergedParameters;\n    }", "code_tokens": ["@", "Override", "public", "Map", "<", "String", ",", "Object", ">", "getParameters", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "final", "Map", "<", "String", ",", "Object", ">", "mergedParameters", "=", "new", "LinkedHashMap", "<", "String", ",", "Object", ">", "(", ")", ";", "for", "(", "final", "TransformerConfigurationSource", "source", ":", "this", ".", "sources", ")", "{", "final", "Map", "<", "String", ",", "Object", ">", "parameters", "=", "source", ".", "getParameters", "(", "request", ",", "response", ")", ";", "if", "(", "parameters", "!=", "null", ")", "{", "mergedParameters", ".", "putAll", "(", "parameters", ")", ";", "}", "}", "return", "mergedParameters", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.xslt.TransformerConfigurationSource#getTransformerParameters(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/MergingTransformerConfigurationSource.java#L70-L83", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/PagsRESTController.java", "func_name": "PagsRESTController.createPagsGroup", "original_string": "@RequestMapping(\n            value = \"/v4-3/pags/{parentGroupName}.json\",\n            produces = MediaType.APPLICATION_JSON_VALUE,\n            method = RequestMethod.POST)\n    public @ResponseBody String createPagsGroup(\n            HttpServletRequest request,\n            HttpServletResponse res,\n            @PathVariable(\"parentGroupName\") String parentGroupName,\n            @RequestBody String json) {\n\n        res.setContentType(MediaType.APPLICATION_JSON_VALUE);\n\n        /*\n         * This step is necessary;  the incoming URLs will sometimes have '+'\n         * characters for spaces, and the @PathVariable magic doesn't convert them.\n         */\n        String name;\n        try {\n            name = URLDecoder.decode(parentGroupName, \"UTF-8\");\n        } catch (UnsupportedEncodingException e) {\n            res.setStatus(HttpServletResponse.SC_BAD_REQUEST);\n            return \"{ 'error': '\" + e.getMessage() + \"' }\";\n        }\n\n        IPersonAttributesGroupDefinition inpt;\n        try {\n            inpt = objectMapper.readValue(json, PersonAttributesGroupDefinitionImpl.class);\n        } catch (Exception e) {\n            res.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);\n            return \"{ 'error': '\" + e.getMessage() + \"' }\"; // should be escaped\n        }\n\n        // Obtain a real reference to the parent group\n        EntityIdentifier[] eids =\n                GroupService.searchForGroups(\n                        name, IGroupConstants.SearchMethod.DISCRETE, IPerson.class);\n        if (eids.length == 0) {\n            res.setStatus(HttpServletResponse.SC_BAD_REQUEST);\n            return \"{ 'error': 'Parent group does not exist: \" + name + \"' }\";\n        }\n        IEntityGroup parentGroup =\n                (IEntityGroup) GroupService.getGroupMember(eids[0]); // Names must be unique\n\n        IPerson person = personManager.getPerson(request);\n        IPersonAttributesGroupDefinition rslt;\n        try {\n            // A little weird that we need to do both;\n            // need some PAGS DAO/Service refactoring\n            rslt =\n                    pagsService.createPagsDefinition(\n                            person, parentGroup, inpt.getName(), inpt.getDescription());\n            // NOTE:  We are also obligated to establish the backlink\n            // testGroupDef --> groupDef;  arguably this backlink serves\n            // little purpose and could be removed.\n            for (IPersonAttributesGroupTestGroupDefinition testGroupDef : inpt.getTestGroups()) {\n                // NOTE:  The deserializer handles testDef --> testGroupDef\n                testGroupDef.setGroup(rslt);\n            }\n            rslt.setTestGroups(inpt.getTestGroups());\n            rslt.setMembers(inpt.getMembers());\n            pagsService.updatePagsDefinition(person, rslt);\n        } catch (RuntimeAuthorizationException rae) {\n            res.setStatus(HttpServletResponse.SC_FORBIDDEN);\n            return \"{ 'error': 'not authorized' }\";\n        } catch (IllegalArgumentException iae) {\n            res.setStatus(HttpServletResponse.SC_CONFLICT);\n            return \"{ 'error': '\" + iae.getMessage() + \"' }\";\n        } catch (Exception e) {\n            e.printStackTrace();\n            res.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);\n            return \"{ 'error': '\" + e.getMessage() + \"' }\";\n        }\n        return respondPagsGroupJson(res, rslt, person, HttpServletResponse.SC_CREATED);\n    }", "language": "java", "code": "@RequestMapping(\n            value = \"/v4-3/pags/{parentGroupName}.json\",\n            produces = MediaType.APPLICATION_JSON_VALUE,\n            method = RequestMethod.POST)\n    public @ResponseBody String createPagsGroup(\n            HttpServletRequest request,\n            HttpServletResponse res,\n            @PathVariable(\"parentGroupName\") String parentGroupName,\n            @RequestBody String json) {\n\n        res.setContentType(MediaType.APPLICATION_JSON_VALUE);\n\n        /*\n         * This step is necessary;  the incoming URLs will sometimes have '+'\n         * characters for spaces, and the @PathVariable magic doesn't convert them.\n         */\n        String name;\n        try {\n            name = URLDecoder.decode(parentGroupName, \"UTF-8\");\n        } catch (UnsupportedEncodingException e) {\n            res.setStatus(HttpServletResponse.SC_BAD_REQUEST);\n            return \"{ 'error': '\" + e.getMessage() + \"' }\";\n        }\n\n        IPersonAttributesGroupDefinition inpt;\n        try {\n            inpt = objectMapper.readValue(json, PersonAttributesGroupDefinitionImpl.class);\n        } catch (Exception e) {\n            res.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);\n            return \"{ 'error': '\" + e.getMessage() + \"' }\"; // should be escaped\n        }\n\n        // Obtain a real reference to the parent group\n        EntityIdentifier[] eids =\n                GroupService.searchForGroups(\n                        name, IGroupConstants.SearchMethod.DISCRETE, IPerson.class);\n        if (eids.length == 0) {\n            res.setStatus(HttpServletResponse.SC_BAD_REQUEST);\n            return \"{ 'error': 'Parent group does not exist: \" + name + \"' }\";\n        }\n        IEntityGroup parentGroup =\n                (IEntityGroup) GroupService.getGroupMember(eids[0]); // Names must be unique\n\n        IPerson person = personManager.getPerson(request);\n        IPersonAttributesGroupDefinition rslt;\n        try {\n            // A little weird that we need to do both;\n            // need some PAGS DAO/Service refactoring\n            rslt =\n                    pagsService.createPagsDefinition(\n                            person, parentGroup, inpt.getName(), inpt.getDescription());\n            // NOTE:  We are also obligated to establish the backlink\n            // testGroupDef --> groupDef;  arguably this backlink serves\n            // little purpose and could be removed.\n            for (IPersonAttributesGroupTestGroupDefinition testGroupDef : inpt.getTestGroups()) {\n                // NOTE:  The deserializer handles testDef --> testGroupDef\n                testGroupDef.setGroup(rslt);\n            }\n            rslt.setTestGroups(inpt.getTestGroups());\n            rslt.setMembers(inpt.getMembers());\n            pagsService.updatePagsDefinition(person, rslt);\n        } catch (RuntimeAuthorizationException rae) {\n            res.setStatus(HttpServletResponse.SC_FORBIDDEN);\n            return \"{ 'error': 'not authorized' }\";\n        } catch (IllegalArgumentException iae) {\n            res.setStatus(HttpServletResponse.SC_CONFLICT);\n            return \"{ 'error': '\" + iae.getMessage() + \"' }\";\n        } catch (Exception e) {\n            e.printStackTrace();\n            res.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);\n            return \"{ 'error': '\" + e.getMessage() + \"' }\";\n        }\n        return respondPagsGroupJson(res, rslt, person, HttpServletResponse.SC_CREATED);\n    }", "code_tokens": ["@", "RequestMapping", "(", "value", "=", "\"/v4-3/pags/{parentGroupName}.json\"", ",", "produces", "=", "MediaType", ".", "APPLICATION_JSON_VALUE", ",", "method", "=", "RequestMethod", ".", "POST", ")", "public", "@", "ResponseBody", "String", "createPagsGroup", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "res", ",", "@", "PathVariable", "(", "\"parentGroupName\"", ")", "String", "parentGroupName", ",", "@", "RequestBody", "String", "json", ")", "{", "res", ".", "setContentType", "(", "MediaType", ".", "APPLICATION_JSON_VALUE", ")", ";", "/*\n         * This step is necessary;  the incoming URLs will sometimes have '+'\n         * characters for spaces, and the @PathVariable magic doesn't convert them.\n         */", "String", "name", ";", "try", "{", "name", "=", "URLDecoder", ".", "decode", "(", "parentGroupName", ",", "\"UTF-8\"", ")", ";", "}", "catch", "(", "UnsupportedEncodingException", "e", ")", "{", "res", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_BAD_REQUEST", ")", ";", "return", "\"{ 'error': '\"", "+", "e", ".", "getMessage", "(", ")", "+", "\"' }\"", ";", "}", "IPersonAttributesGroupDefinition", "inpt", ";", "try", "{", "inpt", "=", "objectMapper", ".", "readValue", "(", "json", ",", "PersonAttributesGroupDefinitionImpl", ".", "class", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "res", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_INTERNAL_SERVER_ERROR", ")", ";", "return", "\"{ 'error': '\"", "+", "e", ".", "getMessage", "(", ")", "+", "\"' }\"", ";", "// should be escaped", "}", "// Obtain a real reference to the parent group", "EntityIdentifier", "[", "]", "eids", "=", "GroupService", ".", "searchForGroups", "(", "name", ",", "IGroupConstants", ".", "SearchMethod", ".", "DISCRETE", ",", "IPerson", ".", "class", ")", ";", "if", "(", "eids", ".", "length", "==", "0", ")", "{", "res", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_BAD_REQUEST", ")", ";", "return", "\"{ 'error': 'Parent group does not exist: \"", "+", "name", "+", "\"' }\"", ";", "}", "IEntityGroup", "parentGroup", "=", "(", "IEntityGroup", ")", "GroupService", ".", "getGroupMember", "(", "eids", "[", "0", "]", ")", ";", "// Names must be unique", "IPerson", "person", "=", "personManager", ".", "getPerson", "(", "request", ")", ";", "IPersonAttributesGroupDefinition", "rslt", ";", "try", "{", "// A little weird that we need to do both;", "// need some PAGS DAO/Service refactoring", "rslt", "=", "pagsService", ".", "createPagsDefinition", "(", "person", ",", "parentGroup", ",", "inpt", ".", "getName", "(", ")", ",", "inpt", ".", "getDescription", "(", ")", ")", ";", "// NOTE:  We are also obligated to establish the backlink", "// testGroupDef --> groupDef;  arguably this backlink serves", "// little purpose and could be removed.", "for", "(", "IPersonAttributesGroupTestGroupDefinition", "testGroupDef", ":", "inpt", ".", "getTestGroups", "(", ")", ")", "{", "// NOTE:  The deserializer handles testDef --> testGroupDef", "testGroupDef", ".", "setGroup", "(", "rslt", ")", ";", "}", "rslt", ".", "setTestGroups", "(", "inpt", ".", "getTestGroups", "(", ")", ")", ";", "rslt", ".", "setMembers", "(", "inpt", ".", "getMembers", "(", ")", ")", ";", "pagsService", ".", "updatePagsDefinition", "(", "person", ",", "rslt", ")", ";", "}", "catch", "(", "RuntimeAuthorizationException", "rae", ")", "{", "res", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_FORBIDDEN", ")", ";", "return", "\"{ 'error': 'not authorized' }\"", ";", "}", "catch", "(", "IllegalArgumentException", "iae", ")", "{", "res", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_CONFLICT", ")", ";", "return", "\"{ 'error': '\"", "+", "iae", ".", "getMessage", "(", ")", "+", "\"' }\"", ";", "}", "catch", "(", "Exception", "e", ")", "{", "e", ".", "printStackTrace", "(", ")", ";", "res", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_INTERNAL_SERVER_ERROR", ")", ";", "return", "\"{ 'error': '\"", "+", "e", ".", "getMessage", "(", ")", "+", "\"' }\"", ";", "}", "return", "respondPagsGroupJson", "(", "res", ",", "rslt", ",", "person", ",", "HttpServletResponse", ".", "SC_CREATED", ")", ";", "}"], "docstring": "Parent group name is expected to be case sensitive.", "docstring_tokens": ["Parent", "group", "name", "is", "expected", "to", "be", "case", "sensitive", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/PagsRESTController.java#L93-L166", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/PagsRESTController.java", "func_name": "PagsRESTController.respondPagsGroupJson", "original_string": "private String respondPagsGroupJson(\n            HttpServletResponse response,\n            IPersonAttributesGroupDefinition pagsGroup,\n            IPerson person,\n            int status) {\n        if (pagsGroup == null) {\n            response.setStatus(HttpServletResponse.SC_NOT_FOUND);\n            return \"{ 'error': 'Not Found' }\";\n        }\n        try {\n            response.setStatus(status);\n            return objectMapper.writeValueAsString(pagsGroup);\n        } catch (Exception e) {\n            response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);\n            return \"{ 'error': '\" + e.toString() + \"' }\";\n        }\n    }", "language": "java", "code": "private String respondPagsGroupJson(\n            HttpServletResponse response,\n            IPersonAttributesGroupDefinition pagsGroup,\n            IPerson person,\n            int status) {\n        if (pagsGroup == null) {\n            response.setStatus(HttpServletResponse.SC_NOT_FOUND);\n            return \"{ 'error': 'Not Found' }\";\n        }\n        try {\n            response.setStatus(status);\n            return objectMapper.writeValueAsString(pagsGroup);\n        } catch (Exception e) {\n            response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);\n            return \"{ 'error': '\" + e.toString() + \"' }\";\n        }\n    }", "code_tokens": ["private", "String", "respondPagsGroupJson", "(", "HttpServletResponse", "response", ",", "IPersonAttributesGroupDefinition", "pagsGroup", ",", "IPerson", "person", ",", "int", "status", ")", "{", "if", "(", "pagsGroup", "==", "null", ")", "{", "response", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_NOT_FOUND", ")", ";", "return", "\"{ 'error': 'Not Found' }\"", ";", "}", "try", "{", "response", ".", "setStatus", "(", "status", ")", ";", "return", "objectMapper", ".", "writeValueAsString", "(", "pagsGroup", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "response", ".", "setStatus", "(", "HttpServletResponse", ".", "SC_INTERNAL_SERVER_ERROR", ")", ";", "return", "\"{ 'error': '\"", "+", "e", ".", "toString", "(", ")", "+", "\"' }\"", ";", "}", "}"], "docstring": "/*\nImplementation", "docstring_tokens": ["/", "*", "Implementation"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/PagsRESTController.java#L250-L266", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/layout/dlm/remoting/FragmentListController.java", "func_name": "FragmentListController.listFragments", "original_string": "@RequestMapping(method = RequestMethod.GET)\n    public ModelAndView listFragments(\n            HttpServletRequest req,\n            @RequestParam(value = \"sort\", required = false) String sortParam)\n            throws ServletException {\n\n        // Verify that the user is allowed to use this service\n        IPerson user = personManager.getPerson(req);\n        if (!AdminEvaluator.isAdmin(user)) {\n            throw new AuthorizationException(\n                    \"User \" + user.getUserName() + \" not an administrator.\");\n        }\n\n        Map<String, Document> fragmentLayoutMap = null;\n        if (userLayoutStore != null) {\n            try {\n                fragmentLayoutMap = userLayoutStore.getFragmentLayoutCopies();\n            } catch (Exception e) {\n                String msg = \"Failed to access fragment layouts\";\n                log.error(msg, e);\n                throw new ServletException(msg, e);\n            }\n        }\n\n        List<FragmentBean> fragments = new ArrayList<FragmentBean>();\n        for (FragmentDefinition frag : dlmConfig.getFragments()) {\n\n            Document layout =\n                    fragmentLayoutMap != null ? fragmentLayoutMap.get(frag.getOwnerId()) : null;\n\n            List<String> portlets = null;\n            if (layout != null) {\n                portlets = new ArrayList<String>();\n                NodeList channelFNames =\n                        this.xpathOperations.evaluate(\n                                CHANNEL_FNAME_XPATH, layout, XPathConstants.NODESET);\n                for (int i = 0; i < channelFNames.getLength(); i++) {\n                    String fname = channelFNames.item(i).getTextContent();\n                    IPortletDefinition pDef = portletRegistry.getPortletDefinitionByFname(fname);\n\n                    if (null != pDef) {\n                        portlets.add(pDef.getTitle());\n                    }\n                }\n            }\n\n            fragments.add(FragmentBean.create(frag, portlets));\n        }\n\n        // Determine & follow sorting preference...\n        Sort sort = DEFAULT_SORT;\n        if (sortParam != null) {\n            sort = Sort.valueOf(sortParam);\n        }\n        Collections.sort(fragments, sort.getComparator());\n\n        return new ModelAndView(\"jsonView\", \"fragments\", fragments);\n    }", "language": "java", "code": "@RequestMapping(method = RequestMethod.GET)\n    public ModelAndView listFragments(\n            HttpServletRequest req,\n            @RequestParam(value = \"sort\", required = false) String sortParam)\n            throws ServletException {\n\n        // Verify that the user is allowed to use this service\n        IPerson user = personManager.getPerson(req);\n        if (!AdminEvaluator.isAdmin(user)) {\n            throw new AuthorizationException(\n                    \"User \" + user.getUserName() + \" not an administrator.\");\n        }\n\n        Map<String, Document> fragmentLayoutMap = null;\n        if (userLayoutStore != null) {\n            try {\n                fragmentLayoutMap = userLayoutStore.getFragmentLayoutCopies();\n            } catch (Exception e) {\n                String msg = \"Failed to access fragment layouts\";\n                log.error(msg, e);\n                throw new ServletException(msg, e);\n            }\n        }\n\n        List<FragmentBean> fragments = new ArrayList<FragmentBean>();\n        for (FragmentDefinition frag : dlmConfig.getFragments()) {\n\n            Document layout =\n                    fragmentLayoutMap != null ? fragmentLayoutMap.get(frag.getOwnerId()) : null;\n\n            List<String> portlets = null;\n            if (layout != null) {\n                portlets = new ArrayList<String>();\n                NodeList channelFNames =\n                        this.xpathOperations.evaluate(\n                                CHANNEL_FNAME_XPATH, layout, XPathConstants.NODESET);\n                for (int i = 0; i < channelFNames.getLength(); i++) {\n                    String fname = channelFNames.item(i).getTextContent();\n                    IPortletDefinition pDef = portletRegistry.getPortletDefinitionByFname(fname);\n\n                    if (null != pDef) {\n                        portlets.add(pDef.getTitle());\n                    }\n                }\n            }\n\n            fragments.add(FragmentBean.create(frag, portlets));\n        }\n\n        // Determine & follow sorting preference...\n        Sort sort = DEFAULT_SORT;\n        if (sortParam != null) {\n            sort = Sort.valueOf(sortParam);\n        }\n        Collections.sort(fragments, sort.getComparator());\n\n        return new ModelAndView(\"jsonView\", \"fragments\", fragments);\n    }", "code_tokens": ["@", "RequestMapping", "(", "method", "=", "RequestMethod", ".", "GET", ")", "public", "ModelAndView", "listFragments", "(", "HttpServletRequest", "req", ",", "@", "RequestParam", "(", "value", "=", "\"sort\"", ",", "required", "=", "false", ")", "String", "sortParam", ")", "throws", "ServletException", "{", "// Verify that the user is allowed to use this service", "IPerson", "user", "=", "personManager", ".", "getPerson", "(", "req", ")", ";", "if", "(", "!", "AdminEvaluator", ".", "isAdmin", "(", "user", ")", ")", "{", "throw", "new", "AuthorizationException", "(", "\"User \"", "+", "user", ".", "getUserName", "(", ")", "+", "\" not an administrator.\"", ")", ";", "}", "Map", "<", "String", ",", "Document", ">", "fragmentLayoutMap", "=", "null", ";", "if", "(", "userLayoutStore", "!=", "null", ")", "{", "try", "{", "fragmentLayoutMap", "=", "userLayoutStore", ".", "getFragmentLayoutCopies", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "String", "msg", "=", "\"Failed to access fragment layouts\"", ";", "log", ".", "error", "(", "msg", ",", "e", ")", ";", "throw", "new", "ServletException", "(", "msg", ",", "e", ")", ";", "}", "}", "List", "<", "FragmentBean", ">", "fragments", "=", "new", "ArrayList", "<", "FragmentBean", ">", "(", ")", ";", "for", "(", "FragmentDefinition", "frag", ":", "dlmConfig", ".", "getFragments", "(", ")", ")", "{", "Document", "layout", "=", "fragmentLayoutMap", "!=", "null", "?", "fragmentLayoutMap", ".", "get", "(", "frag", ".", "getOwnerId", "(", ")", ")", ":", "null", ";", "List", "<", "String", ">", "portlets", "=", "null", ";", "if", "(", "layout", "!=", "null", ")", "{", "portlets", "=", "new", "ArrayList", "<", "String", ">", "(", ")", ";", "NodeList", "channelFNames", "=", "this", ".", "xpathOperations", ".", "evaluate", "(", "CHANNEL_FNAME_XPATH", ",", "layout", ",", "XPathConstants", ".", "NODESET", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "channelFNames", ".", "getLength", "(", ")", ";", "i", "++", ")", "{", "String", "fname", "=", "channelFNames", ".", "item", "(", "i", ")", ".", "getTextContent", "(", ")", ";", "IPortletDefinition", "pDef", "=", "portletRegistry", ".", "getPortletDefinitionByFname", "(", "fname", ")", ";", "if", "(", "null", "!=", "pDef", ")", "{", "portlets", ".", "add", "(", "pDef", ".", "getTitle", "(", ")", ")", ";", "}", "}", "}", "fragments", ".", "add", "(", "FragmentBean", ".", "create", "(", "frag", ",", "portlets", ")", ")", ";", "}", "// Determine & follow sorting preference...", "Sort", "sort", "=", "DEFAULT_SORT", ";", "if", "(", "sortParam", "!=", "null", ")", "{", "sort", "=", "Sort", ".", "valueOf", "(", "sortParam", ")", ";", "}", "Collections", ".", "sort", "(", "fragments", ",", "sort", ".", "getComparator", "(", ")", ")", ";", "return", "new", "ModelAndView", "(", "\"jsonView\"", ",", "\"fragments\"", ",", "fragments", ")", ";", "}"], "docstring": "Returns a model of fragments --> List<FragmentBean> , sorted by precedence (default) or by\nfragment name depending on sort parameter, to be rendered by the jsonView.\n\n@param req the servlet request, bound via SpringWebMVC to GET method invocations of this\ncontroller.\n@param sortParam PRECEDENCE, NAME, or null.\n@return ModelAndView with a List of FragmentBeans to be rendered by the jsonView.\n@throws ServletException on Exception in underlying attempt to get at the fragments\n@throws AuthorizationException if request is for any user other than a Portal Administrator.\n@throws IllegalArgumentException if sort parameter has an unrecognized value", "docstring_tokens": ["Returns", "a", "model", "of", "fragments", "--", ">", "List<FragmentBean", ">", "sorted", "by", "precedence", "(", "default", ")", "or", "by", "fragment", "name", "depending", "on", "sort", "parameter", "to", "be", "rendered", "by", "the", "jsonView", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/layout/dlm/remoting/FragmentListController.java#L112-L169", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-core/src/main/java/org/apereo/portal/security/provider/AuthorizationPrincipalImpl.java", "func_name": "AuthorizationPrincipalImpl.canManage", "original_string": "@Override\n    public boolean canManage(PortletLifecycleState state, String categoryId)\n            throws AuthorizationException {\n        return getAuthorizationService().canPrincipalManage(this, state, categoryId);\n    }", "language": "java", "code": "@Override\n    public boolean canManage(PortletLifecycleState state, String categoryId)\n            throws AuthorizationException {\n        return getAuthorizationService().canPrincipalManage(this, state, categoryId);\n    }", "code_tokens": ["@", "Override", "public", "boolean", "canManage", "(", "PortletLifecycleState", "state", ",", "String", "categoryId", ")", "throws", "AuthorizationException", "{", "return", "getAuthorizationService", "(", ")", ".", "canPrincipalManage", "(", "this", ",", "state", ",", "categoryId", ")", ";", "}"], "docstring": "Answers if this <code>IAuthorizationPrincipal</code> has permission to publish.\n\n@return boolean\n@exception AuthorizationException thrown when authorization information could not be\nretrieved.", "docstring_tokens": ["Answers", "if", "this", "<code", ">", "IAuthorizationPrincipal<", "/", "code", ">", "has", "permission", "to", "publish", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-core/src/main/java/org/apereo/portal/security/provider/AuthorizationPrincipalImpl.java#L60-L64", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-core/src/main/java/org/apereo/portal/security/provider/AuthorizationPrincipalImpl.java", "func_name": "AuthorizationPrincipalImpl.getAllPermissions", "original_string": "@Override\n    public IPermission[] getAllPermissions(String owner, String activity, String target)\n            throws AuthorizationException {\n        return getAuthorizationService()\n                .getAllPermissionsForPrincipal(this, owner, activity, target);\n    }", "language": "java", "code": "@Override\n    public IPermission[] getAllPermissions(String owner, String activity, String target)\n            throws AuthorizationException {\n        return getAuthorizationService()\n                .getAllPermissionsForPrincipal(this, owner, activity, target);\n    }", "code_tokens": ["@", "Override", "public", "IPermission", "[", "]", "getAllPermissions", "(", "String", "owner", ",", "String", "activity", ",", "String", "target", ")", "throws", "AuthorizationException", "{", "return", "getAuthorizationService", "(", ")", ".", "getAllPermissionsForPrincipal", "(", "this", ",", "owner", ",", "activity", ",", "target", ")", ";", "}"], "docstring": "Returns the <code>IPermissions</code> for this <code>IAuthorizationPrincipal</code> for the\nspecified <code>owner</code>, <code>activity</code> and <code>target</code>. Inherited <code>\nIPermissions</code> are included. Null parameters are ignored, so <code>\ngetPermissions(null, null, null)</code> should retrieve all <code>IPermissions</code> for an\n<code>IAuthorizationPrincipal</code>.\n\n@return org.apereo.portal.security.IPermission[]\n@param owner String\n@param activity String\n@param target String\n@exception AuthorizationException indicates authorization information could not be retrieved.", "docstring_tokens": ["Returns", "the", "<code", ">", "IPermissions<", "/", "code", ">", "for", "this", "<code", ">", "IAuthorizationPrincipal<", "/", "code", ">", "for", "the", "specified", "<code", ">", "owner<", "/", "code", ">", "<code", ">", "activity<", "/", "code", ">", "and", "<code", ">", "target<", "/", "code", ">", ".", "Inherited", "<code", ">", "IPermissions<", "/", "code", ">", "are", "included", ".", "Null", "parameters", "are", "ignored", "so", "<code", ">", "getPermissions", "(", "null", "null", "null", ")", "<", "/", "code", ">", "should", "retrieve", "all", "<code", ">", "IPermissions<", "/", "code", ">", "for", "an", "<code", ">", "IAuthorizationPrincipal<", "/", "code", ">", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-core/src/main/java/org/apereo/portal/security/provider/AuthorizationPrincipalImpl.java#L134-L139", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-core/src/main/java/org/apereo/portal/security/provider/AuthorizationPrincipalImpl.java", "func_name": "AuthorizationPrincipalImpl.getPermissions", "original_string": "@Override\n    public IPermission[] getPermissions(String owner, String activity, String target)\n            throws AuthorizationException {\n        return getAuthorizationService().getPermissionsForPrincipal(this, owner, activity, target);\n    }", "language": "java", "code": "@Override\n    public IPermission[] getPermissions(String owner, String activity, String target)\n            throws AuthorizationException {\n        return getAuthorizationService().getPermissionsForPrincipal(this, owner, activity, target);\n    }", "code_tokens": ["@", "Override", "public", "IPermission", "[", "]", "getPermissions", "(", "String", "owner", ",", "String", "activity", ",", "String", "target", ")", "throws", "AuthorizationException", "{", "return", "getAuthorizationService", "(", ")", ".", "getPermissionsForPrincipal", "(", "this", ",", "owner", ",", "activity", ",", "target", ")", ";", "}"], "docstring": "Returns the <code>IPermissions</code> for this <code>IAuthorizationPrincipal</code> for the\nspecified <code>owner</code>, <code>activity</code> and <code>target</code>. Null parameters\nare ignored, so <code>getPermissions(null, null, null)</code> should retrieve all <code>\nIPermissions</code> for an <code>IAuthorizationPrincipal</code>.\n\n@return org.apereo.portal.security.IPermission[]\n@param owner String\n@param activity String\n@param target String\n@exception AuthorizationException indicates authorization information could not be retrieved.", "docstring_tokens": ["Returns", "the", "<code", ">", "IPermissions<", "/", "code", ">", "for", "this", "<code", ">", "IAuthorizationPrincipal<", "/", "code", ">", "for", "the", "specified", "<code", ">", "owner<", "/", "code", ">", "<code", ">", "activity<", "/", "code", ">", "and", "<code", ">", "target<", "/", "code", ">", ".", "Null", "parameters", "are", "ignored", "so", "<code", ">", "getPermissions", "(", "null", "null", "null", ")", "<", "/", "code", ">", "should", "retrieve", "all", "<code", ">", "IPermissions<", "/", "code", ">", "for", "an", "<code", ">", "IAuthorizationPrincipal<", "/", "code", ">", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-core/src/main/java/org/apereo/portal/security/provider/AuthorizationPrincipalImpl.java#L172-L176", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-core/src/main/java/org/apereo/portal/security/provider/AuthorizationPrincipalImpl.java", "func_name": "AuthorizationPrincipalImpl.hasPermission", "original_string": "@Override\n    public boolean hasPermission(String owner, String activity, String target)\n            throws AuthorizationException {\n        return getAuthorizationService().doesPrincipalHavePermission(this, owner, activity, target);\n    }", "language": "java", "code": "@Override\n    public boolean hasPermission(String owner, String activity, String target)\n            throws AuthorizationException {\n        return getAuthorizationService().doesPrincipalHavePermission(this, owner, activity, target);\n    }", "code_tokens": ["@", "Override", "public", "boolean", "hasPermission", "(", "String", "owner", ",", "String", "activity", ",", "String", "target", ")", "throws", "AuthorizationException", "{", "return", "getAuthorizationService", "(", ")", ".", "doesPrincipalHavePermission", "(", "this", ",", "owner", ",", "activity", ",", "target", ")", ";", "}"], "docstring": "Answers if this <code>IAuthorizationPrincipal</code> has permission to perform the <code>\nactivity</code> on the <code>target</code>. Params <code>owner</code> and <code>activity\n</code> must be non-null. If <code>target</code> is null, then the target is not checked.\n\n@return boolean\n@param owner String\n@param activity String\n@param target String\n@exception AuthorizationException indicates authorization information could not be retrieved.", "docstring_tokens": ["Answers", "if", "this", "<code", ">", "IAuthorizationPrincipal<", "/", "code", ">", "has", "permission", "to", "perform", "the", "<code", ">", "activity<", "/", "code", ">", "on", "the", "<code", ">", "target<", "/", "code", ">", ".", "Params", "<code", ">", "owner<", "/", "code", ">", "and", "<code", ">", "activity", "<", "/", "code", ">", "must", "be", "non", "-", "null", ".", "If", "<code", ">", "target<", "/", "code", ">", "is", "null", "then", "the", "target", "is", "not", "checked", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-core/src/main/java/org/apereo/portal/security/provider/AuthorizationPrincipalImpl.java#L212-L216", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/importexport/ImportExportPortletController.java", "func_name": "ImportExportPortletController.getExportView", "original_string": "@RequestMapping(params = \"action=export\")\n    public ModelAndView getExportView(PortletRequest request) {\n        Map<String, Object> model = new HashMap<String, Object>();\n\n        // add a list of all permitted export types\n        final Iterable<IPortalDataType> exportPortalDataTypes =\n                this.portalDataHandlerService.getExportPortalDataTypes();\n        final List<IPortalDataType> types =\n                getAllowedTypes(request, IPermission.EXPORT_ACTIVITY, exportPortalDataTypes);\n        model.put(\"supportedTypes\", types);\n\n        return new ModelAndView(\"/jsp/ImportExportPortlet/export\", model);\n    }", "language": "java", "code": "@RequestMapping(params = \"action=export\")\n    public ModelAndView getExportView(PortletRequest request) {\n        Map<String, Object> model = new HashMap<String, Object>();\n\n        // add a list of all permitted export types\n        final Iterable<IPortalDataType> exportPortalDataTypes =\n                this.portalDataHandlerService.getExportPortalDataTypes();\n        final List<IPortalDataType> types =\n                getAllowedTypes(request, IPermission.EXPORT_ACTIVITY, exportPortalDataTypes);\n        model.put(\"supportedTypes\", types);\n\n        return new ModelAndView(\"/jsp/ImportExportPortlet/export\", model);\n    }", "code_tokens": ["@", "RequestMapping", "(", "params", "=", "\"action=export\"", ")", "public", "ModelAndView", "getExportView", "(", "PortletRequest", "request", ")", "{", "Map", "<", "String", ",", "Object", ">", "model", "=", "new", "HashMap", "<", "String", ",", "Object", ">", "(", ")", ";", "// add a list of all permitted export types", "final", "Iterable", "<", "IPortalDataType", ">", "exportPortalDataTypes", "=", "this", ".", "portalDataHandlerService", ".", "getExportPortalDataTypes", "(", ")", ";", "final", "List", "<", "IPortalDataType", ">", "types", "=", "getAllowedTypes", "(", "request", ",", "IPermission", ".", "EXPORT_ACTIVITY", ",", "exportPortalDataTypes", ")", ";", "model", ".", "put", "(", "\"supportedTypes\"", ",", "types", ")", ";", "return", "new", "ModelAndView", "(", "\"/jsp/ImportExportPortlet/export\"", ",", "model", ")", ";", "}"], "docstring": "Display the entity export form view.\n\n@param request\n@return", "docstring_tokens": ["Display", "the", "entity", "export", "form", "view", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/importexport/ImportExportPortletController.java#L84-L96", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/importexport/ImportExportPortletController.java", "func_name": "ImportExportPortletController.getDeleteView", "original_string": "@RequestMapping(params = \"action=delete\")\n    public ModelAndView getDeleteView(PortletRequest request) {\n        Map<String, Object> model = new HashMap<String, Object>();\n\n        // add a list of all permitted deletion types\n        final Iterable<IPortalDataType> deletePortalDataTypes =\n                this.portalDataHandlerService.getDeletePortalDataTypes();\n        final List<IPortalDataType> types =\n                getAllowedTypes(request, IPermission.DELETE_ACTIVITY, deletePortalDataTypes);\n        model.put(\"supportedTypes\", types);\n\n        return new ModelAndView(\"/jsp/ImportExportPortlet/delete\", model);\n    }", "language": "java", "code": "@RequestMapping(params = \"action=delete\")\n    public ModelAndView getDeleteView(PortletRequest request) {\n        Map<String, Object> model = new HashMap<String, Object>();\n\n        // add a list of all permitted deletion types\n        final Iterable<IPortalDataType> deletePortalDataTypes =\n                this.portalDataHandlerService.getDeletePortalDataTypes();\n        final List<IPortalDataType> types =\n                getAllowedTypes(request, IPermission.DELETE_ACTIVITY, deletePortalDataTypes);\n        model.put(\"supportedTypes\", types);\n\n        return new ModelAndView(\"/jsp/ImportExportPortlet/delete\", model);\n    }", "code_tokens": ["@", "RequestMapping", "(", "params", "=", "\"action=delete\"", ")", "public", "ModelAndView", "getDeleteView", "(", "PortletRequest", "request", ")", "{", "Map", "<", "String", ",", "Object", ">", "model", "=", "new", "HashMap", "<", "String", ",", "Object", ">", "(", ")", ";", "// add a list of all permitted deletion types", "final", "Iterable", "<", "IPortalDataType", ">", "deletePortalDataTypes", "=", "this", ".", "portalDataHandlerService", ".", "getDeletePortalDataTypes", "(", ")", ";", "final", "List", "<", "IPortalDataType", ">", "types", "=", "getAllowedTypes", "(", "request", ",", "IPermission", ".", "DELETE_ACTIVITY", ",", "deletePortalDataTypes", ")", ";", "model", ".", "put", "(", "\"supportedTypes\"", ",", "types", ")", ";", "return", "new", "ModelAndView", "(", "\"/jsp/ImportExportPortlet/delete\"", ",", "model", ")", ";", "}"], "docstring": "Display the entity deletion form view.\n\n@param request\n@return", "docstring_tokens": ["Display", "the", "entity", "deletion", "form", "view", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/importexport/ImportExportPortletController.java#L104-L116", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/importexport/ImportExportPortletController.java", "func_name": "ImportExportPortletController.getAllowedTypes", "original_string": "protected List<IPortalDataType> getAllowedTypes(\n            PortletRequest request, String activityName, Iterable<IPortalDataType> dataTypes) {\n\n        // get the authorization principal representing the current user\n        final HttpServletRequest httpServletRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPerson person = personManager.getPerson(httpServletRequest);\n        final EntityIdentifier ei = person.getEntityIdentifier();\n        final IAuthorizationPrincipal ap =\n                AuthorizationServiceFacade.instance().newPrincipal(ei.getKey(), ei.getType());\n\n        // filter the list of configured import/export types by user permission\n        final List<IPortalDataType> results = new ArrayList<IPortalDataType>();\n        for (IPortalDataType type : dataTypes) {\n            final String typeId = type.getTypeId();\n            if (ap.hasPermission(IPermission.PORTAL_SYSTEM, activityName, typeId)) {\n                results.add(type);\n            }\n        }\n\n        return results;\n    }", "language": "java", "code": "protected List<IPortalDataType> getAllowedTypes(\n            PortletRequest request, String activityName, Iterable<IPortalDataType> dataTypes) {\n\n        // get the authorization principal representing the current user\n        final HttpServletRequest httpServletRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPerson person = personManager.getPerson(httpServletRequest);\n        final EntityIdentifier ei = person.getEntityIdentifier();\n        final IAuthorizationPrincipal ap =\n                AuthorizationServiceFacade.instance().newPrincipal(ei.getKey(), ei.getType());\n\n        // filter the list of configured import/export types by user permission\n        final List<IPortalDataType> results = new ArrayList<IPortalDataType>();\n        for (IPortalDataType type : dataTypes) {\n            final String typeId = type.getTypeId();\n            if (ap.hasPermission(IPermission.PORTAL_SYSTEM, activityName, typeId)) {\n                results.add(type);\n            }\n        }\n\n        return results;\n    }", "code_tokens": ["protected", "List", "<", "IPortalDataType", ">", "getAllowedTypes", "(", "PortletRequest", "request", ",", "String", "activityName", ",", "Iterable", "<", "IPortalDataType", ">", "dataTypes", ")", "{", "// get the authorization principal representing the current user", "final", "HttpServletRequest", "httpServletRequest", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "request", ")", ";", "final", "IPerson", "person", "=", "personManager", ".", "getPerson", "(", "httpServletRequest", ")", ";", "final", "EntityIdentifier", "ei", "=", "person", ".", "getEntityIdentifier", "(", ")", ";", "final", "IAuthorizationPrincipal", "ap", "=", "AuthorizationServiceFacade", ".", "instance", "(", ")", ".", "newPrincipal", "(", "ei", ".", "getKey", "(", ")", ",", "ei", ".", "getType", "(", ")", ")", ";", "// filter the list of configured import/export types by user permission", "final", "List", "<", "IPortalDataType", ">", "results", "=", "new", "ArrayList", "<", "IPortalDataType", ">", "(", ")", ";", "for", "(", "IPortalDataType", "type", ":", "dataTypes", ")", "{", "final", "String", "typeId", "=", "type", ".", "getTypeId", "(", ")", ";", "if", "(", "ap", ".", "hasPermission", "(", "IPermission", ".", "PORTAL_SYSTEM", ",", "activityName", ",", "typeId", ")", ")", "{", "results", ".", "add", "(", "type", ")", ";", "}", "}", "return", "results", ";", "}"], "docstring": "Return a list of all permitted import/export types for the given permission and the current\nuser.\n\n@param request\n@param activityName\n@return", "docstring_tokens": ["Return", "a", "list", "of", "all", "permitted", "import", "/", "export", "types", "for", "the", "given", "permission", "and", "the", "current", "user", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/importexport/ImportExportPortletController.java#L126-L147", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/groupadmin/GroupFormValidator.java", "func_name": "GroupFormValidator.validateEditDetails", "original_string": "public void validateEditDetails(GroupForm group, MessageContext context) {\n\n        // ensure the group name is set\n        if (StringUtils.isBlank(group.getName())) {\n            context.addMessage(\n                    new MessageBuilder().error().source(\"name\").code(\"please.enter.name\").build());\n        }\n    }", "language": "java", "code": "public void validateEditDetails(GroupForm group, MessageContext context) {\n\n        // ensure the group name is set\n        if (StringUtils.isBlank(group.getName())) {\n            context.addMessage(\n                    new MessageBuilder().error().source(\"name\").code(\"please.enter.name\").build());\n        }\n    }", "code_tokens": ["public", "void", "validateEditDetails", "(", "GroupForm", "group", ",", "MessageContext", "context", ")", "{", "// ensure the group name is set", "if", "(", "StringUtils", ".", "isBlank", "(", "group", ".", "getName", "(", ")", ")", ")", "{", "context", ".", "addMessage", "(", "new", "MessageBuilder", "(", ")", ".", "error", "(", ")", ".", "source", "(", "\"name\"", ")", ".", "code", "(", "\"please.enter.name\"", ")", ".", "build", "(", ")", ")", ";", "}", "}"], "docstring": "Validate the detail editing group view\n\n@param group\n@param context", "docstring_tokens": ["Validate", "the", "detail", "editing", "group", "view"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/groupadmin/GroupFormValidator.java#L30-L37", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceUtils.java", "func_name": "ResourceUtils.getResourceUri", "original_string": "public static String getResourceUri(Resource resource) {\n        try {\n            return resource.getURI().toString();\n        } catch (FileNotFoundException e) {\n            return resource.getDescription();\n        } catch (IOException e) {\n            throw new RuntimeException(\"Could not create URI for resource: \" + resource, e);\n        }\n    }", "language": "java", "code": "public static String getResourceUri(Resource resource) {\n        try {\n            return resource.getURI().toString();\n        } catch (FileNotFoundException e) {\n            return resource.getDescription();\n        } catch (IOException e) {\n            throw new RuntimeException(\"Could not create URI for resource: \" + resource, e);\n        }\n    }", "code_tokens": ["public", "static", "String", "getResourceUri", "(", "Resource", "resource", ")", "{", "try", "{", "return", "resource", ".", "getURI", "(", ")", ".", "toString", "(", ")", ";", "}", "catch", "(", "FileNotFoundException", "e", ")", "{", "return", "resource", ".", "getDescription", "(", ")", ";", "}", "catch", "(", "IOException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Could not create URI for resource: \"", "+", "resource", ",", "e", ")", ";", "}", "}"], "docstring": "First tries {@link Resource#getURI()} and if that fails with a FileNotFoundException then\n{@link Resource#getDescription()} is returned.", "docstring_tokens": ["First", "tries", "{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceUtils.java#L29-L37", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/layout/dlm/remoting/JsonEntityBean.java", "func_name": "JsonEntityBean.getTypeAndIdHash", "original_string": "public String getTypeAndIdHash() {\n        assert (entityType != null);\n        assert (id != null);\n        String idStr = id.replaceAll(\"\\\\W\", \"__\");\n        return entityType.toString().toLowerCase() + \"_\" + idStr;\n    }", "language": "java", "code": "public String getTypeAndIdHash() {\n        assert (entityType != null);\n        assert (id != null);\n        String idStr = id.replaceAll(\"\\\\W\", \"__\");\n        return entityType.toString().toLowerCase() + \"_\" + idStr;\n    }", "code_tokens": ["public", "String", "getTypeAndIdHash", "(", ")", "{", "assert", "(", "entityType", "!=", "null", ")", ";", "assert", "(", "id", "!=", "null", ")", ";", "String", "idStr", "=", "id", ".", "replaceAll", "(", "\"\\\\W\"", ",", "\"__\"", ")", ";", "return", "entityType", ".", "toString", "(", ")", ".", "toLowerCase", "(", ")", "+", "\"_\"", "+", "idStr", ";", "}"], "docstring": "Compute a hash based on type and ID to uniquely identify this bean. This method helps avoid\nthe unlikely case where a group and person in the same principal list have the same ID.\n\n<p>Periods are replaced to avoid issues in JSP EL and form names can't contain spaces. Also\nSpEL parsing of form field names fails with characters such as dash or parenthesis (which\nPAGS groups can have) and likely other characters so they are also replaced with underscores.\n\n@return EntityType + \"_\" + ID", "docstring_tokens": ["Compute", "a", "hash", "based", "on", "type", "and", "ID", "to", "uniquely", "identify", "this", "bean", ".", "This", "method", "helps", "avoid", "the", "unlikely", "case", "where", "a", "group", "and", "person", "in", "the", "same", "principal", "list", "have", "the", "same", "ID", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/layout/dlm/remoting/JsonEntityBean.java#L173-L178", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/googleanalytics/GoogleAnalyticsController.java", "func_name": "GoogleAnalyticsController.filterAnalyticsGroups", "original_string": "private void filterAnalyticsGroups(\n            IGroupMember groupMember, JsonNode config, Map<String, Boolean> isMemberCache) {\n        if (config == null) {\n            return;\n        }\n\n        final JsonNode dimensionGroups = config.get(\"dimensionGroups\");\n        if (dimensionGroups == null) {\n            return;\n        }\n\n        for (final Iterator<JsonNode> groupItr = dimensionGroups.elements(); groupItr.hasNext(); ) {\n            final JsonNode group = groupItr.next();\n\n            final JsonNode valueNode = group.get(\"value\");\n            if (valueNode == null) {\n                continue;\n            }\n\n            final String groupName = valueNode.asText();\n\n            Boolean isMember = isMemberCache.get(groupName);\n            if (isMember == null) {\n                isMember = isMember(groupMember, groupName);\n                isMemberCache.put(groupName, isMember);\n            }\n\n            if (!isMember) {\n                groupItr.remove();\n            }\n        }\n    }", "language": "java", "code": "private void filterAnalyticsGroups(\n            IGroupMember groupMember, JsonNode config, Map<String, Boolean> isMemberCache) {\n        if (config == null) {\n            return;\n        }\n\n        final JsonNode dimensionGroups = config.get(\"dimensionGroups\");\n        if (dimensionGroups == null) {\n            return;\n        }\n\n        for (final Iterator<JsonNode> groupItr = dimensionGroups.elements(); groupItr.hasNext(); ) {\n            final JsonNode group = groupItr.next();\n\n            final JsonNode valueNode = group.get(\"value\");\n            if (valueNode == null) {\n                continue;\n            }\n\n            final String groupName = valueNode.asText();\n\n            Boolean isMember = isMemberCache.get(groupName);\n            if (isMember == null) {\n                isMember = isMember(groupMember, groupName);\n                isMemberCache.put(groupName, isMember);\n            }\n\n            if (!isMember) {\n                groupItr.remove();\n            }\n        }\n    }", "code_tokens": ["private", "void", "filterAnalyticsGroups", "(", "IGroupMember", "groupMember", ",", "JsonNode", "config", ",", "Map", "<", "String", ",", "Boolean", ">", "isMemberCache", ")", "{", "if", "(", "config", "==", "null", ")", "{", "return", ";", "}", "final", "JsonNode", "dimensionGroups", "=", "config", ".", "get", "(", "\"dimensionGroups\"", ")", ";", "if", "(", "dimensionGroups", "==", "null", ")", "{", "return", ";", "}", "for", "(", "final", "Iterator", "<", "JsonNode", ">", "groupItr", "=", "dimensionGroups", ".", "elements", "(", ")", ";", "groupItr", ".", "hasNext", "(", ")", ";", ")", "{", "final", "JsonNode", "group", "=", "groupItr", ".", "next", "(", ")", ";", "final", "JsonNode", "valueNode", "=", "group", ".", "get", "(", "\"value\"", ")", ";", "if", "(", "valueNode", "==", "null", ")", "{", "continue", ";", "}", "final", "String", "groupName", "=", "valueNode", ".", "asText", "(", ")", ";", "Boolean", "isMember", "=", "isMemberCache", ".", "get", "(", "groupName", ")", ";", "if", "(", "isMember", "==", "null", ")", "{", "isMember", "=", "isMember", "(", "groupMember", ",", "groupName", ")", ";", "isMemberCache", ".", "put", "(", "groupName", ",", "isMember", ")", ";", "}", "if", "(", "!", "isMember", ")", "{", "groupItr", ".", "remove", "(", ")", ";", "}", "}", "}"], "docstring": "Remove groups from the AnalyticsConfig that the current user is not a member of", "docstring_tokens": ["Remove", "groups", "from", "the", "AnalyticsConfig", "that", "the", "current", "user", "is", "not", "a", "member", "of"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/googleanalytics/GoogleAnalyticsController.java#L94-L125", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/googleanalytics/GoogleAnalyticsController.java", "func_name": "GoogleAnalyticsController.isMember", "original_string": "private boolean isMember(IGroupMember groupMember, String groupName) {\n        try {\n            IEntityGroup group = GroupService.findGroup(groupName);\n            if (group != null) {\n                return groupMember.isDeepMemberOf(group);\n            }\n\n            final EntityIdentifier[] results =\n                    GroupService.searchForGroups(\n                            groupName, GroupService.SearchMethod.DISCRETE, IPerson.class);\n            if (results == null || results.length == 0) {\n                this.logger.warn(\n                        \"No portal group found for '{}' no users will be placed in that group for analytics\",\n                        groupName);\n                return false;\n            }\n\n            if (results.length > 1) {\n                this.logger.warn(\n                        \"{} groups were found for groupName '{}'. The first result will be used.\",\n                        results.length,\n                        groupName);\n            }\n\n            group = (IEntityGroup) GroupService.getGroupMember(results[0]);\n            return groupMember.isDeepMemberOf(group);\n        } catch (Exception e) {\n            this.logger.warn(\n                    \"Failed to determine if {} is a member of {}, returning false\",\n                    groupMember,\n                    groupName,\n                    e);\n            return false;\n        }\n    }", "language": "java", "code": "private boolean isMember(IGroupMember groupMember, String groupName) {\n        try {\n            IEntityGroup group = GroupService.findGroup(groupName);\n            if (group != null) {\n                return groupMember.isDeepMemberOf(group);\n            }\n\n            final EntityIdentifier[] results =\n                    GroupService.searchForGroups(\n                            groupName, GroupService.SearchMethod.DISCRETE, IPerson.class);\n            if (results == null || results.length == 0) {\n                this.logger.warn(\n                        \"No portal group found for '{}' no users will be placed in that group for analytics\",\n                        groupName);\n                return false;\n            }\n\n            if (results.length > 1) {\n                this.logger.warn(\n                        \"{} groups were found for groupName '{}'. The first result will be used.\",\n                        results.length,\n                        groupName);\n            }\n\n            group = (IEntityGroup) GroupService.getGroupMember(results[0]);\n            return groupMember.isDeepMemberOf(group);\n        } catch (Exception e) {\n            this.logger.warn(\n                    \"Failed to determine if {} is a member of {}, returning false\",\n                    groupMember,\n                    groupName,\n                    e);\n            return false;\n        }\n    }", "code_tokens": ["private", "boolean", "isMember", "(", "IGroupMember", "groupMember", ",", "String", "groupName", ")", "{", "try", "{", "IEntityGroup", "group", "=", "GroupService", ".", "findGroup", "(", "groupName", ")", ";", "if", "(", "group", "!=", "null", ")", "{", "return", "groupMember", ".", "isDeepMemberOf", "(", "group", ")", ";", "}", "final", "EntityIdentifier", "[", "]", "results", "=", "GroupService", ".", "searchForGroups", "(", "groupName", ",", "GroupService", ".", "SearchMethod", ".", "DISCRETE", ",", "IPerson", ".", "class", ")", ";", "if", "(", "results", "==", "null", "||", "results", ".", "length", "==", "0", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"No portal group found for '{}' no users will be placed in that group for analytics\"", ",", "groupName", ")", ";", "return", "false", ";", "}", "if", "(", "results", ".", "length", ">", "1", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"{} groups were found for groupName '{}'. The first result will be used.\"", ",", "results", ".", "length", ",", "groupName", ")", ";", "}", "group", "=", "(", "IEntityGroup", ")", "GroupService", ".", "getGroupMember", "(", "results", "[", "0", "]", ")", ";", "return", "groupMember", ".", "isDeepMemberOf", "(", "group", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"Failed to determine if {} is a member of {}, returning false\"", ",", "groupMember", ",", "groupName", ",", "e", ")", ";", "return", "false", ";", "}", "}"], "docstring": "Check if the user is a member of the specified group name\n\n<p>Internal search, thus case sensitive.", "docstring_tokens": ["Check", "if", "the", "user", "is", "a", "member", "of", "the", "specified", "group", "name"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/googleanalytics/GoogleAnalyticsController.java#L132-L166", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/profile/StickyProfileMapperImpl.java", "func_name": "StickyProfileMapperImpl.warnOnApathyKeyInMappings", "original_string": "@PostConstruct\n    public void warnOnApathyKeyInMappings() {\n        if (null != profileKeyForNoSelection\n                && immutableMappings.containsKey(profileKeyForNoSelection)) {\n            logger.warn(\n                    \"Configured to treat profile key {} as apathy, \"\n                            + \"yet also configured to map that key to profile  fname {}.  Apathy wins.  \"\n                            + \"This is likely just fine, but it might be a misconfiguration.\",\n                    profileKeyForNoSelection,\n                    immutableMappings.get(profileKeyForNoSelection));\n        }\n    }", "language": "java", "code": "@PostConstruct\n    public void warnOnApathyKeyInMappings() {\n        if (null != profileKeyForNoSelection\n                && immutableMappings.containsKey(profileKeyForNoSelection)) {\n            logger.warn(\n                    \"Configured to treat profile key {} as apathy, \"\n                            + \"yet also configured to map that key to profile  fname {}.  Apathy wins.  \"\n                            + \"This is likely just fine, but it might be a misconfiguration.\",\n                    profileKeyForNoSelection,\n                    immutableMappings.get(profileKeyForNoSelection));\n        }\n    }", "code_tokens": ["@", "PostConstruct", "public", "void", "warnOnApathyKeyInMappings", "(", ")", "{", "if", "(", "null", "!=", "profileKeyForNoSelection", "&&", "immutableMappings", ".", "containsKey", "(", "profileKeyForNoSelection", ")", ")", "{", "logger", ".", "warn", "(", "\"Configured to treat profile key {} as apathy, \"", "+", "\"yet also configured to map that key to profile  fname {}.  Apathy wins.  \"", "+", "\"This is likely just fine, but it might be a misconfiguration.\"", ",", "profileKeyForNoSelection", ",", "immutableMappings", ".", "get", "(", "profileKeyForNoSelection", ")", ")", ";", "}", "}"], "docstring": "Log a warning when configured such that a profile key both means apathy and means a\nparticular profile fname.", "docstring_tokens": ["Log", "a", "warning", "when", "configured", "such", "that", "a", "profile", "key", "both", "means", "apathy", "and", "means", "a", "particular", "profile", "fname", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/profile/StickyProfileMapperImpl.java#L81-L92", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/xml/stream/ChunkingEventReader.java", "func_name": "ChunkingEventReader.chunkString", "original_string": "protected void chunkString(\n            final List<CharacterEvent> characterEvents,\n            final CharSequence buffer,\n            int patternIndex) {\n        // Iterate over the chunking patterns\n        for (; patternIndex < this.chunkingPatterns.length; patternIndex++) {\n            final Pattern pattern = this.chunkingPatterns[patternIndex];\n\n            final Matcher matcher = pattern.matcher(buffer);\n            if (matcher.find()) {\n                final CharacterEventSource eventSource =\n                        this.chunkingPatternEventSources.get(pattern);\n                int prevMatchEnd = 0;\n\n                do {\n                    // Add all of the text up to the match as a new chunk, use subSequence to avoid\n                    // extra string alloc\n                    this.chunkString(\n                            characterEvents,\n                            buffer.subSequence(prevMatchEnd, matcher.start()),\n                            patternIndex + 1);\n\n                    // Get the generated CharacterEvents for the match\n                    final MatchResult matchResult = matcher.toMatchResult();\n                    eventSource.generateCharacterEvents(this.request, matchResult, characterEvents);\n\n                    prevMatchEnd = matcher.end();\n                } while (matcher.find());\n\n                // Add any remaining text from the original CharacterDataEvent\n                if (prevMatchEnd < buffer.length()) {\n                    this.chunkString(\n                            characterEvents,\n                            buffer.subSequence(prevMatchEnd, buffer.length()),\n                            patternIndex + 1);\n                }\n\n                return;\n            }\n        }\n\n        // Buffer didn't match anything, just append the string data\n\n        // de-duplication of the event string data\n        final String eventString = buffer.toString();\n        characterEvents.add(CharacterDataEventImpl.create(eventString));\n    }", "language": "java", "code": "protected void chunkString(\n            final List<CharacterEvent> characterEvents,\n            final CharSequence buffer,\n            int patternIndex) {\n        // Iterate over the chunking patterns\n        for (; patternIndex < this.chunkingPatterns.length; patternIndex++) {\n            final Pattern pattern = this.chunkingPatterns[patternIndex];\n\n            final Matcher matcher = pattern.matcher(buffer);\n            if (matcher.find()) {\n                final CharacterEventSource eventSource =\n                        this.chunkingPatternEventSources.get(pattern);\n                int prevMatchEnd = 0;\n\n                do {\n                    // Add all of the text up to the match as a new chunk, use subSequence to avoid\n                    // extra string alloc\n                    this.chunkString(\n                            characterEvents,\n                            buffer.subSequence(prevMatchEnd, matcher.start()),\n                            patternIndex + 1);\n\n                    // Get the generated CharacterEvents for the match\n                    final MatchResult matchResult = matcher.toMatchResult();\n                    eventSource.generateCharacterEvents(this.request, matchResult, characterEvents);\n\n                    prevMatchEnd = matcher.end();\n                } while (matcher.find());\n\n                // Add any remaining text from the original CharacterDataEvent\n                if (prevMatchEnd < buffer.length()) {\n                    this.chunkString(\n                            characterEvents,\n                            buffer.subSequence(prevMatchEnd, buffer.length()),\n                            patternIndex + 1);\n                }\n\n                return;\n            }\n        }\n\n        // Buffer didn't match anything, just append the string data\n\n        // de-duplication of the event string data\n        final String eventString = buffer.toString();\n        characterEvents.add(CharacterDataEventImpl.create(eventString));\n    }", "code_tokens": ["protected", "void", "chunkString", "(", "final", "List", "<", "CharacterEvent", ">", "characterEvents", ",", "final", "CharSequence", "buffer", ",", "int", "patternIndex", ")", "{", "// Iterate over the chunking patterns", "for", "(", ";", "patternIndex", "<", "this", ".", "chunkingPatterns", ".", "length", ";", "patternIndex", "++", ")", "{", "final", "Pattern", "pattern", "=", "this", ".", "chunkingPatterns", "[", "patternIndex", "]", ";", "final", "Matcher", "matcher", "=", "pattern", ".", "matcher", "(", "buffer", ")", ";", "if", "(", "matcher", ".", "find", "(", ")", ")", "{", "final", "CharacterEventSource", "eventSource", "=", "this", ".", "chunkingPatternEventSources", ".", "get", "(", "pattern", ")", ";", "int", "prevMatchEnd", "=", "0", ";", "do", "{", "// Add all of the text up to the match as a new chunk, use subSequence to avoid", "// extra string alloc", "this", ".", "chunkString", "(", "characterEvents", ",", "buffer", ".", "subSequence", "(", "prevMatchEnd", ",", "matcher", ".", "start", "(", ")", ")", ",", "patternIndex", "+", "1", ")", ";", "// Get the generated CharacterEvents for the match", "final", "MatchResult", "matchResult", "=", "matcher", ".", "toMatchResult", "(", ")", ";", "eventSource", ".", "generateCharacterEvents", "(", "this", ".", "request", ",", "matchResult", ",", "characterEvents", ")", ";", "prevMatchEnd", "=", "matcher", ".", "end", "(", ")", ";", "}", "while", "(", "matcher", ".", "find", "(", ")", ")", ";", "// Add any remaining text from the original CharacterDataEvent", "if", "(", "prevMatchEnd", "<", "buffer", ".", "length", "(", ")", ")", "{", "this", ".", "chunkString", "(", "characterEvents", ",", "buffer", ".", "subSequence", "(", "prevMatchEnd", ",", "buffer", ".", "length", "(", ")", ")", ",", "patternIndex", "+", "1", ")", ";", "}", "return", ";", "}", "}", "// Buffer didn't match anything, just append the string data", "// de-duplication of the event string data", "final", "String", "eventString", "=", "buffer", ".", "toString", "(", ")", ";", "characterEvents", ".", "add", "(", "CharacterDataEventImpl", ".", "create", "(", "eventString", ")", ")", ";", "}"], "docstring": "Breaks up the String into a List of CharacterEvents based on the configured Map of Patterns\nto CharacterEventSources", "docstring_tokens": ["Breaks", "up", "the", "String", "into", "a", "List", "of", "CharacterEvents", "based", "on", "the", "configured", "Map", "of", "Patterns", "to", "CharacterEventSources"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/xml/stream/ChunkingEventReader.java#L192-L238", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/cache/MapCacheFactoryBean.java", "func_name": "MapCacheFactoryBean.createInstance", "original_string": "@Override\n    protected Map<Serializable, Object> createInstance() throws Exception {\n        final Map<Serializable, Object> cache;\n        if (this.cacheName != null) {\n            cache = this.cacheFactory.getCache(this.cacheName);\n        } else {\n            cache = this.cacheFactory.getCache();\n        }\n\n        return cache;\n    }", "language": "java", "code": "@Override\n    protected Map<Serializable, Object> createInstance() throws Exception {\n        final Map<Serializable, Object> cache;\n        if (this.cacheName != null) {\n            cache = this.cacheFactory.getCache(this.cacheName);\n        } else {\n            cache = this.cacheFactory.getCache();\n        }\n\n        return cache;\n    }", "code_tokens": ["@", "Override", "protected", "Map", "<", "Serializable", ",", "Object", ">", "createInstance", "(", ")", "throws", "Exception", "{", "final", "Map", "<", "Serializable", ",", "Object", ">", "cache", ";", "if", "(", "this", ".", "cacheName", "!=", "null", ")", "{", "cache", "=", "this", ".", "cacheFactory", ".", "getCache", "(", "this", ".", "cacheName", ")", ";", "}", "else", "{", "cache", "=", "this", ".", "cacheFactory", ".", "getCache", "(", ")", ";", "}", "return", "cache", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.springframework.beans.factory.config.AbstractFactoryBean#createInstance()", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/cache/MapCacheFactoryBean.java#L52-L62", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/url/PortletURLProviderImpl.java", "func_name": "PortletURLProviderImpl.getType", "original_string": "@Override\n    public TYPE getType() {\n        final IPortalUrlBuilder portalUrlBuilder = this.portletUrlBuilder.getPortalUrlBuilder();\n        final UrlType urlType = portalUrlBuilder.getUrlType();\n        return urlType.getPortletUrlType();\n    }", "language": "java", "code": "@Override\n    public TYPE getType() {\n        final IPortalUrlBuilder portalUrlBuilder = this.portletUrlBuilder.getPortalUrlBuilder();\n        final UrlType urlType = portalUrlBuilder.getUrlType();\n        return urlType.getPortletUrlType();\n    }", "code_tokens": ["@", "Override", "public", "TYPE", "getType", "(", ")", "{", "final", "IPortalUrlBuilder", "portalUrlBuilder", "=", "this", ".", "portletUrlBuilder", ".", "getPortalUrlBuilder", "(", ")", ";", "final", "UrlType", "urlType", "=", "portalUrlBuilder", ".", "getUrlType", "(", ")", ";", "return", "urlType", ".", "getPortletUrlType", "(", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apache.pluto.container.PortletURLProvider#getType()", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/url/PortletURLProviderImpl.java#L92-L97", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/url/PortletURLProviderImpl.java", "func_name": "PortletURLProviderImpl.write", "original_string": "@Override\n    public void write(Writer out, boolean escapeXML) throws IOException {\n        final String url = this.toURL();\n        if (escapeXML) {\n            StringEscapeUtils.escapeXml(out, url);\n        } else {\n            out.write(url);\n        }\n    }", "language": "java", "code": "@Override\n    public void write(Writer out, boolean escapeXML) throws IOException {\n        final String url = this.toURL();\n        if (escapeXML) {\n            StringEscapeUtils.escapeXml(out, url);\n        } else {\n            out.write(url);\n        }\n    }", "code_tokens": ["@", "Override", "public", "void", "write", "(", "Writer", "out", ",", "boolean", "escapeXML", ")", "throws", "IOException", "{", "final", "String", "url", "=", "this", ".", "toURL", "(", ")", ";", "if", "(", "escapeXML", ")", "{", "StringEscapeUtils", ".", "escapeXml", "(", "out", ",", "url", ")", ";", "}", "else", "{", "out", ".", "write", "(", "url", ")", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.apache.pluto.container.PortletURLProvider#write(java.io.Writer, boolean)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/url/PortletURLProviderImpl.java#L168-L176", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-authn/src/main/java/org/apereo/portal/security/provider/RemoteUserPersonManager.java", "func_name": "RemoteUserPersonManager.getPerson", "original_string": "@Override\n    public IPerson getPerson(HttpServletRequest request) throws PortalSecurityException {\n\n        /*\n         * This method overrides the implementation of getPerson() in BasePersonManager, but we only\n         * want the RemoteUser behavior here if we're using RemoteUser AuthN.\n         */\n        if (!remoteUserSecurityContextFactory.isEnabled()) {\n            return super.getPerson(request);\n        }\n\n        // Return the person object if it exists in the user's session\n        final HttpSession session = request.getSession(false);\n        IPerson person = null;\n        if (session != null) {\n            person = (IPerson) session.getAttribute(PERSON_SESSION_KEY);\n            if (person != null) {\n                return person;\n            }\n        }\n\n        try {\n            // Create a new instance of a person\n            person = createPersonForRequest(request);\n\n            // If the user has authenticated with the server which has implemented web\n            // authentication,\n            // the REMOTE_USER environment variable will be set.\n            String remoteUser = request.getRemoteUser();\n\n            // We don't want to ignore the security contexts which are already configured in\n            // security.properties, so we\n            // retrieve the existing security contexts.  If one of the existing security contexts is\n            // a RemoteUserSecurityContext,\n            // we set the REMOTE_USER field of the existing RemoteUserSecurityContext context.\n            //\n            // If a RemoteUserSecurityContext does not already exist, we create one and populate the\n            // REMOTE_USER field.\n\n            ISecurityContext context;\n            Enumeration subContexts = null;\n            boolean remoteUserSecurityContextExists = false;\n\n            // Retrieve existing security contexts.\n            context = person.getSecurityContext();\n            if (context != null) subContexts = context.getSubContexts();\n\n            if (subContexts != null) {\n                while (subContexts.hasMoreElements()) {\n                    ISecurityContext ctx = (ISecurityContext) subContexts.nextElement();\n                    // Check to see if a RemoteUserSecurityContext already exists, and set the\n                    // REMOTE_USER\n                    if (ctx instanceof RemoteUserSecurityContext) {\n                        RemoteUserSecurityContext remoteuserctx = (RemoteUserSecurityContext) ctx;\n                        remoteuserctx.setRemoteUser(remoteUser);\n                        remoteUserSecurityContextExists = true;\n                    }\n                }\n            }\n\n            // If a RemoteUserSecurityContext doesn't already exist, create one.\n            // This preserves the default behavior of this class.\n            if (!remoteUserSecurityContextExists) {\n                RemoteUserSecurityContext remoteuserctx = new RemoteUserSecurityContext(remoteUser);\n                person.setSecurityContext(remoteuserctx);\n            }\n        } catch (Exception e) {\n            // Log the exception\n            logger.error(\"Exception creating person for request: {}\", request, e);\n        }\n        if (session != null) {\n            // Add this person object to the user's session\n            session.setAttribute(PERSON_SESSION_KEY, person);\n        }\n        // Return the new person object\n        return (person);\n    }", "language": "java", "code": "@Override\n    public IPerson getPerson(HttpServletRequest request) throws PortalSecurityException {\n\n        /*\n         * This method overrides the implementation of getPerson() in BasePersonManager, but we only\n         * want the RemoteUser behavior here if we're using RemoteUser AuthN.\n         */\n        if (!remoteUserSecurityContextFactory.isEnabled()) {\n            return super.getPerson(request);\n        }\n\n        // Return the person object if it exists in the user's session\n        final HttpSession session = request.getSession(false);\n        IPerson person = null;\n        if (session != null) {\n            person = (IPerson) session.getAttribute(PERSON_SESSION_KEY);\n            if (person != null) {\n                return person;\n            }\n        }\n\n        try {\n            // Create a new instance of a person\n            person = createPersonForRequest(request);\n\n            // If the user has authenticated with the server which has implemented web\n            // authentication,\n            // the REMOTE_USER environment variable will be set.\n            String remoteUser = request.getRemoteUser();\n\n            // We don't want to ignore the security contexts which are already configured in\n            // security.properties, so we\n            // retrieve the existing security contexts.  If one of the existing security contexts is\n            // a RemoteUserSecurityContext,\n            // we set the REMOTE_USER field of the existing RemoteUserSecurityContext context.\n            //\n            // If a RemoteUserSecurityContext does not already exist, we create one and populate the\n            // REMOTE_USER field.\n\n            ISecurityContext context;\n            Enumeration subContexts = null;\n            boolean remoteUserSecurityContextExists = false;\n\n            // Retrieve existing security contexts.\n            context = person.getSecurityContext();\n            if (context != null) subContexts = context.getSubContexts();\n\n            if (subContexts != null) {\n                while (subContexts.hasMoreElements()) {\n                    ISecurityContext ctx = (ISecurityContext) subContexts.nextElement();\n                    // Check to see if a RemoteUserSecurityContext already exists, and set the\n                    // REMOTE_USER\n                    if (ctx instanceof RemoteUserSecurityContext) {\n                        RemoteUserSecurityContext remoteuserctx = (RemoteUserSecurityContext) ctx;\n                        remoteuserctx.setRemoteUser(remoteUser);\n                        remoteUserSecurityContextExists = true;\n                    }\n                }\n            }\n\n            // If a RemoteUserSecurityContext doesn't already exist, create one.\n            // This preserves the default behavior of this class.\n            if (!remoteUserSecurityContextExists) {\n                RemoteUserSecurityContext remoteuserctx = new RemoteUserSecurityContext(remoteUser);\n                person.setSecurityContext(remoteuserctx);\n            }\n        } catch (Exception e) {\n            // Log the exception\n            logger.error(\"Exception creating person for request: {}\", request, e);\n        }\n        if (session != null) {\n            // Add this person object to the user's session\n            session.setAttribute(PERSON_SESSION_KEY, person);\n        }\n        // Return the new person object\n        return (person);\n    }", "code_tokens": ["@", "Override", "public", "IPerson", "getPerson", "(", "HttpServletRequest", "request", ")", "throws", "PortalSecurityException", "{", "/*\n         * This method overrides the implementation of getPerson() in BasePersonManager, but we only\n         * want the RemoteUser behavior here if we're using RemoteUser AuthN.\n         */", "if", "(", "!", "remoteUserSecurityContextFactory", ".", "isEnabled", "(", ")", ")", "{", "return", "super", ".", "getPerson", "(", "request", ")", ";", "}", "// Return the person object if it exists in the user's session", "final", "HttpSession", "session", "=", "request", ".", "getSession", "(", "false", ")", ";", "IPerson", "person", "=", "null", ";", "if", "(", "session", "!=", "null", ")", "{", "person", "=", "(", "IPerson", ")", "session", ".", "getAttribute", "(", "PERSON_SESSION_KEY", ")", ";", "if", "(", "person", "!=", "null", ")", "{", "return", "person", ";", "}", "}", "try", "{", "// Create a new instance of a person", "person", "=", "createPersonForRequest", "(", "request", ")", ";", "// If the user has authenticated with the server which has implemented web", "// authentication,", "// the REMOTE_USER environment variable will be set.", "String", "remoteUser", "=", "request", ".", "getRemoteUser", "(", ")", ";", "// We don't want to ignore the security contexts which are already configured in", "// security.properties, so we", "// retrieve the existing security contexts.  If one of the existing security contexts is", "// a RemoteUserSecurityContext,", "// we set the REMOTE_USER field of the existing RemoteUserSecurityContext context.", "//", "// If a RemoteUserSecurityContext does not already exist, we create one and populate the", "// REMOTE_USER field.", "ISecurityContext", "context", ";", "Enumeration", "subContexts", "=", "null", ";", "boolean", "remoteUserSecurityContextExists", "=", "false", ";", "// Retrieve existing security contexts.", "context", "=", "person", ".", "getSecurityContext", "(", ")", ";", "if", "(", "context", "!=", "null", ")", "subContexts", "=", "context", ".", "getSubContexts", "(", ")", ";", "if", "(", "subContexts", "!=", "null", ")", "{", "while", "(", "subContexts", ".", "hasMoreElements", "(", ")", ")", "{", "ISecurityContext", "ctx", "=", "(", "ISecurityContext", ")", "subContexts", ".", "nextElement", "(", ")", ";", "// Check to see if a RemoteUserSecurityContext already exists, and set the", "// REMOTE_USER", "if", "(", "ctx", "instanceof", "RemoteUserSecurityContext", ")", "{", "RemoteUserSecurityContext", "remoteuserctx", "=", "(", "RemoteUserSecurityContext", ")", "ctx", ";", "remoteuserctx", ".", "setRemoteUser", "(", "remoteUser", ")", ";", "remoteUserSecurityContextExists", "=", "true", ";", "}", "}", "}", "// If a RemoteUserSecurityContext doesn't already exist, create one.", "// This preserves the default behavior of this class.", "if", "(", "!", "remoteUserSecurityContextExists", ")", "{", "RemoteUserSecurityContext", "remoteuserctx", "=", "new", "RemoteUserSecurityContext", "(", "remoteUser", ")", ";", "person", ".", "setSecurityContext", "(", "remoteuserctx", ")", ";", "}", "}", "catch", "(", "Exception", "e", ")", "{", "// Log the exception", "logger", ".", "error", "(", "\"Exception creating person for request: {}\"", ",", "request", ",", "e", ")", ";", "}", "if", "(", "session", "!=", "null", ")", "{", "// Add this person object to the user's session", "session", ".", "setAttribute", "(", "PERSON_SESSION_KEY", ",", "person", ")", ";", "}", "// Return the new person object", "return", "(", "person", ")", ";", "}"], "docstring": "Retrieve an IPerson object for the incoming request\n\n@param request The current HttpServletRequest\n@return IPerson object for the incoming request\n@exception PortalSecurityException Description of the Exception", "docstring_tokens": ["Retrieve", "an", "IPerson", "object", "for", "the", "incoming", "request"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-authn/src/main/java/org/apereo/portal/security/provider/RemoteUserPersonManager.java#L45-L121", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-tools/src/main/java/org/apereo/portal/tools/dbloader/TableXmlHandler.java", "func_name": "TableXmlHandler.startElement", "original_string": "@Override\n    public void startElement(String uri, String localName, String name, Attributes attributes)\n            throws SAXException {\n        if (\"table\".equals(name)) {\n            this.currentColumns = new LinkedHashMap<String, Column>();\n            this.currentColumnTypes = new TreeMap<String, Integer>(String.CASE_INSENSITIVE_ORDER);\n        } else if (\"index\".equals(name)) {\n            this.currentIndex = new Index();\n            this.currentIndex.setTable(this.currentTable);\n        } else if (\"unique\".equals(name)) {\n            this.currentUnique = new UniqueKey();\n            this.currentUnique.setTable(this.currentTable);\n        }\n\n        this.chars = new StringBuilder();\n    }", "language": "java", "code": "@Override\n    public void startElement(String uri, String localName, String name, Attributes attributes)\n            throws SAXException {\n        if (\"table\".equals(name)) {\n            this.currentColumns = new LinkedHashMap<String, Column>();\n            this.currentColumnTypes = new TreeMap<String, Integer>(String.CASE_INSENSITIVE_ORDER);\n        } else if (\"index\".equals(name)) {\n            this.currentIndex = new Index();\n            this.currentIndex.setTable(this.currentTable);\n        } else if (\"unique\".equals(name)) {\n            this.currentUnique = new UniqueKey();\n            this.currentUnique.setTable(this.currentTable);\n        }\n\n        this.chars = new StringBuilder();\n    }", "code_tokens": ["@", "Override", "public", "void", "startElement", "(", "String", "uri", ",", "String", "localName", ",", "String", "name", ",", "Attributes", "attributes", ")", "throws", "SAXException", "{", "if", "(", "\"table\"", ".", "equals", "(", "name", ")", ")", "{", "this", ".", "currentColumns", "=", "new", "LinkedHashMap", "<", "String", ",", "Column", ">", "(", ")", ";", "this", ".", "currentColumnTypes", "=", "new", "TreeMap", "<", "String", ",", "Integer", ">", "(", "String", ".", "CASE_INSENSITIVE_ORDER", ")", ";", "}", "else", "if", "(", "\"index\"", ".", "equals", "(", "name", ")", ")", "{", "this", ".", "currentIndex", "=", "new", "Index", "(", ")", ";", "this", ".", "currentIndex", ".", "setTable", "(", "this", ".", "currentTable", ")", ";", "}", "else", "if", "(", "\"unique\"", ".", "equals", "(", "name", ")", ")", "{", "this", ".", "currentUnique", "=", "new", "UniqueKey", "(", ")", ";", "this", ".", "currentUnique", ".", "setTable", "(", "this", ".", "currentTable", ")", ";", "}", "this", ".", "chars", "=", "new", "StringBuilder", "(", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.xml.sax.helpers.DefaultHandler#startElement(java.lang.String, java.lang.String, java.lang.String, org.xml.sax.Attributes)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-tools/src/main/java/org/apereo/portal/tools/dbloader/TableXmlHandler.java#L72-L87", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-tools/src/main/java/org/apereo/portal/tools/dbloader/TableXmlHandler.java", "func_name": "TableXmlHandler.endElement", "original_string": "@Override\n    public void endElement(String uri, String localName, String name) throws SAXException {\n        if (\"table\".equals(name)) {\n            for (final Column column : this.currentColumns.values()) {\n                this.currentTable.addColumn(column);\n            }\n\n            if (this.primaryKey != null) {\n                this.currentTable.setPrimaryKey(this.primaryKey);\n            }\n\n            this.tables.put(this.currentTable.getName(), this.currentTable);\n            this.tableColumnTypes.put(this.currentTable.getName(), this.currentColumnTypes);\n            this.primaryKey = null;\n            this.currentColumns = null;\n            this.currentColumnTypes = null;\n            this.currentTable = null;\n        } else if (\"column\".equals(name)) {\n            this.currentColumns.put(this.currentColumn.getName(), this.currentColumn);\n            this.currentColumn = null;\n        } else if (\"name\".equals(name)) {\n            final String itemName = this.chars.toString().trim();\n\n            if (this.currentIndex != null) {\n                this.currentIndex.setName(itemName);\n            } else if (this.currentUnique != null) {\n                this.currentUnique.setName(itemName);\n            } else if (this.currentTable == null) {\n                this.currentTable = new Table(itemName);\n            } else if (this.currentColumn == null) {\n                this.currentColumn = new Column(itemName);\n            }\n        } else if (\"type\".equals(name)) {\n            final String sqlTypeName = this.chars.toString().trim();\n\n            final int sqlType = this.getSqlType(sqlTypeName);\n            this.currentColumnTypes.put(this.currentColumn.getName(), sqlType);\n\n            final String hibType = this.getHibernateType(sqlType);\n\n            final SimpleValue value = new SimpleValue(this.mappings, this.currentTable);\n            value.setTypeName(hibType);\n\n            this.currentColumn.setValue(value);\n        } else if (\"param\".equals(name)) {\n            final String param = this.chars.toString().trim();\n\n            final Integer length = Integer.valueOf(param);\n            this.currentColumn.setLength(length);\n        } else if (\"primary-key\".equals(name)) {\n            final String columnName = this.chars.toString().trim();\n\n            if (this.primaryKey == null) {\n                this.primaryKey = new PrimaryKey();\n            }\n\n            final Column column = this.currentColumns.get(columnName);\n            this.primaryKey.addColumn(column);\n        } else if (\"not-null\".equals(name)) {\n            final String columnName = this.chars.toString().trim();\n            final Column column = this.currentColumns.get(columnName);\n            column.setNullable(false);\n        } else if (\"column-ref\".equals(name)) {\n            final String columnName = this.chars.toString().trim();\n            final Column column = this.currentColumns.get(columnName);\n\n            if (this.currentIndex != null) {\n                this.currentIndex.addColumn(column);\n            } else if (this.currentUnique != null) {\n                this.currentUnique.addColumn(column);\n            }\n        } else if (\"index\".equals(name)) {\n            this.currentTable.addIndex(this.currentIndex);\n            this.currentIndex = null;\n        } else if (\"unique\".equals(name)) {\n            this.currentTable.addUniqueKey(this.currentUnique);\n            this.currentUnique = null;\n        } else if (\"key\".equals(name)) {\n            this.logger.warn(\n                    \"the 'key' element is ignored, use the table level 'primary-key' element instead\");\n        }\n\n        this.chars = null;\n    }", "language": "java", "code": "@Override\n    public void endElement(String uri, String localName, String name) throws SAXException {\n        if (\"table\".equals(name)) {\n            for (final Column column : this.currentColumns.values()) {\n                this.currentTable.addColumn(column);\n            }\n\n            if (this.primaryKey != null) {\n                this.currentTable.setPrimaryKey(this.primaryKey);\n            }\n\n            this.tables.put(this.currentTable.getName(), this.currentTable);\n            this.tableColumnTypes.put(this.currentTable.getName(), this.currentColumnTypes);\n            this.primaryKey = null;\n            this.currentColumns = null;\n            this.currentColumnTypes = null;\n            this.currentTable = null;\n        } else if (\"column\".equals(name)) {\n            this.currentColumns.put(this.currentColumn.getName(), this.currentColumn);\n            this.currentColumn = null;\n        } else if (\"name\".equals(name)) {\n            final String itemName = this.chars.toString().trim();\n\n            if (this.currentIndex != null) {\n                this.currentIndex.setName(itemName);\n            } else if (this.currentUnique != null) {\n                this.currentUnique.setName(itemName);\n            } else if (this.currentTable == null) {\n                this.currentTable = new Table(itemName);\n            } else if (this.currentColumn == null) {\n                this.currentColumn = new Column(itemName);\n            }\n        } else if (\"type\".equals(name)) {\n            final String sqlTypeName = this.chars.toString().trim();\n\n            final int sqlType = this.getSqlType(sqlTypeName);\n            this.currentColumnTypes.put(this.currentColumn.getName(), sqlType);\n\n            final String hibType = this.getHibernateType(sqlType);\n\n            final SimpleValue value = new SimpleValue(this.mappings, this.currentTable);\n            value.setTypeName(hibType);\n\n            this.currentColumn.setValue(value);\n        } else if (\"param\".equals(name)) {\n            final String param = this.chars.toString().trim();\n\n            final Integer length = Integer.valueOf(param);\n            this.currentColumn.setLength(length);\n        } else if (\"primary-key\".equals(name)) {\n            final String columnName = this.chars.toString().trim();\n\n            if (this.primaryKey == null) {\n                this.primaryKey = new PrimaryKey();\n            }\n\n            final Column column = this.currentColumns.get(columnName);\n            this.primaryKey.addColumn(column);\n        } else if (\"not-null\".equals(name)) {\n            final String columnName = this.chars.toString().trim();\n            final Column column = this.currentColumns.get(columnName);\n            column.setNullable(false);\n        } else if (\"column-ref\".equals(name)) {\n            final String columnName = this.chars.toString().trim();\n            final Column column = this.currentColumns.get(columnName);\n\n            if (this.currentIndex != null) {\n                this.currentIndex.addColumn(column);\n            } else if (this.currentUnique != null) {\n                this.currentUnique.addColumn(column);\n            }\n        } else if (\"index\".equals(name)) {\n            this.currentTable.addIndex(this.currentIndex);\n            this.currentIndex = null;\n        } else if (\"unique\".equals(name)) {\n            this.currentTable.addUniqueKey(this.currentUnique);\n            this.currentUnique = null;\n        } else if (\"key\".equals(name)) {\n            this.logger.warn(\n                    \"the 'key' element is ignored, use the table level 'primary-key' element instead\");\n        }\n\n        this.chars = null;\n    }", "code_tokens": ["@", "Override", "public", "void", "endElement", "(", "String", "uri", ",", "String", "localName", ",", "String", "name", ")", "throws", "SAXException", "{", "if", "(", "\"table\"", ".", "equals", "(", "name", ")", ")", "{", "for", "(", "final", "Column", "column", ":", "this", ".", "currentColumns", ".", "values", "(", ")", ")", "{", "this", ".", "currentTable", ".", "addColumn", "(", "column", ")", ";", "}", "if", "(", "this", ".", "primaryKey", "!=", "null", ")", "{", "this", ".", "currentTable", ".", "setPrimaryKey", "(", "this", ".", "primaryKey", ")", ";", "}", "this", ".", "tables", ".", "put", "(", "this", ".", "currentTable", ".", "getName", "(", ")", ",", "this", ".", "currentTable", ")", ";", "this", ".", "tableColumnTypes", ".", "put", "(", "this", ".", "currentTable", ".", "getName", "(", ")", ",", "this", ".", "currentColumnTypes", ")", ";", "this", ".", "primaryKey", "=", "null", ";", "this", ".", "currentColumns", "=", "null", ";", "this", ".", "currentColumnTypes", "=", "null", ";", "this", ".", "currentTable", "=", "null", ";", "}", "else", "if", "(", "\"column\"", ".", "equals", "(", "name", ")", ")", "{", "this", ".", "currentColumns", ".", "put", "(", "this", ".", "currentColumn", ".", "getName", "(", ")", ",", "this", ".", "currentColumn", ")", ";", "this", ".", "currentColumn", "=", "null", ";", "}", "else", "if", "(", "\"name\"", ".", "equals", "(", "name", ")", ")", "{", "final", "String", "itemName", "=", "this", ".", "chars", ".", "toString", "(", ")", ".", "trim", "(", ")", ";", "if", "(", "this", ".", "currentIndex", "!=", "null", ")", "{", "this", ".", "currentIndex", ".", "setName", "(", "itemName", ")", ";", "}", "else", "if", "(", "this", ".", "currentUnique", "!=", "null", ")", "{", "this", ".", "currentUnique", ".", "setName", "(", "itemName", ")", ";", "}", "else", "if", "(", "this", ".", "currentTable", "==", "null", ")", "{", "this", ".", "currentTable", "=", "new", "Table", "(", "itemName", ")", ";", "}", "else", "if", "(", "this", ".", "currentColumn", "==", "null", ")", "{", "this", ".", "currentColumn", "=", "new", "Column", "(", "itemName", ")", ";", "}", "}", "else", "if", "(", "\"type\"", ".", "equals", "(", "name", ")", ")", "{", "final", "String", "sqlTypeName", "=", "this", ".", "chars", ".", "toString", "(", ")", ".", "trim", "(", ")", ";", "final", "int", "sqlType", "=", "this", ".", "getSqlType", "(", "sqlTypeName", ")", ";", "this", ".", "currentColumnTypes", ".", "put", "(", "this", ".", "currentColumn", ".", "getName", "(", ")", ",", "sqlType", ")", ";", "final", "String", "hibType", "=", "this", ".", "getHibernateType", "(", "sqlType", ")", ";", "final", "SimpleValue", "value", "=", "new", "SimpleValue", "(", "this", ".", "mappings", ",", "this", ".", "currentTable", ")", ";", "value", ".", "setTypeName", "(", "hibType", ")", ";", "this", ".", "currentColumn", ".", "setValue", "(", "value", ")", ";", "}", "else", "if", "(", "\"param\"", ".", "equals", "(", "name", ")", ")", "{", "final", "String", "param", "=", "this", ".", "chars", ".", "toString", "(", ")", ".", "trim", "(", ")", ";", "final", "Integer", "length", "=", "Integer", ".", "valueOf", "(", "param", ")", ";", "this", ".", "currentColumn", ".", "setLength", "(", "length", ")", ";", "}", "else", "if", "(", "\"primary-key\"", ".", "equals", "(", "name", ")", ")", "{", "final", "String", "columnName", "=", "this", ".", "chars", ".", "toString", "(", ")", ".", "trim", "(", ")", ";", "if", "(", "this", ".", "primaryKey", "==", "null", ")", "{", "this", ".", "primaryKey", "=", "new", "PrimaryKey", "(", ")", ";", "}", "final", "Column", "column", "=", "this", ".", "currentColumns", ".", "get", "(", "columnName", ")", ";", "this", ".", "primaryKey", ".", "addColumn", "(", "column", ")", ";", "}", "else", "if", "(", "\"not-null\"", ".", "equals", "(", "name", ")", ")", "{", "final", "String", "columnName", "=", "this", ".", "chars", ".", "toString", "(", ")", ".", "trim", "(", ")", ";", "final", "Column", "column", "=", "this", ".", "currentColumns", ".", "get", "(", "columnName", ")", ";", "column", ".", "setNullable", "(", "false", ")", ";", "}", "else", "if", "(", "\"column-ref\"", ".", "equals", "(", "name", ")", ")", "{", "final", "String", "columnName", "=", "this", ".", "chars", ".", "toString", "(", ")", ".", "trim", "(", ")", ";", "final", "Column", "column", "=", "this", ".", "currentColumns", ".", "get", "(", "columnName", ")", ";", "if", "(", "this", ".", "currentIndex", "!=", "null", ")", "{", "this", ".", "currentIndex", ".", "addColumn", "(", "column", ")", ";", "}", "else", "if", "(", "this", ".", "currentUnique", "!=", "null", ")", "{", "this", ".", "currentUnique", ".", "addColumn", "(", "column", ")", ";", "}", "}", "else", "if", "(", "\"index\"", ".", "equals", "(", "name", ")", ")", "{", "this", ".", "currentTable", ".", "addIndex", "(", "this", ".", "currentIndex", ")", ";", "this", ".", "currentIndex", "=", "null", ";", "}", "else", "if", "(", "\"unique\"", ".", "equals", "(", "name", ")", ")", "{", "this", ".", "currentTable", ".", "addUniqueKey", "(", "this", ".", "currentUnique", ")", ";", "this", ".", "currentUnique", "=", "null", ";", "}", "else", "if", "(", "\"key\"", ".", "equals", "(", "name", ")", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"the 'key' element is ignored, use the table level 'primary-key' element instead\"", ")", ";", "}", "this", ".", "chars", "=", "null", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.xml.sax.helpers.DefaultHandler#endElement(java.lang.String, java.lang.String, java.lang.String)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-tools/src/main/java/org/apereo/portal/tools/dbloader/TableXmlHandler.java#L92-L175", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/SafeFilenameUtils.java", "func_name": "SafeFilenameUtils.makeSafeFilename", "original_string": "public static String makeSafeFilename(String filename) {\n        // Replace invalid characters\n        for (final Map.Entry<Pattern, String> pair : REPLACEMENT_PAIRS.entrySet()) {\n            final Pattern pattern = pair.getKey();\n            final Matcher matcher = pattern.matcher(filename);\n            filename = matcher.replaceAll(pair.getValue());\n        }\n\n        // Make sure the name doesn't violate a Windows reserved word...\n        for (Pattern pattern : WINDOWS_INVALID_PATTERNS) {\n            if (pattern.matcher(filename).matches()) {\n                filename = \"uP-\" + filename;\n                break;\n            }\n        }\n\n        return filename;\n    }", "language": "java", "code": "public static String makeSafeFilename(String filename) {\n        // Replace invalid characters\n        for (final Map.Entry<Pattern, String> pair : REPLACEMENT_PAIRS.entrySet()) {\n            final Pattern pattern = pair.getKey();\n            final Matcher matcher = pattern.matcher(filename);\n            filename = matcher.replaceAll(pair.getValue());\n        }\n\n        // Make sure the name doesn't violate a Windows reserved word...\n        for (Pattern pattern : WINDOWS_INVALID_PATTERNS) {\n            if (pattern.matcher(filename).matches()) {\n                filename = \"uP-\" + filename;\n                break;\n            }\n        }\n\n        return filename;\n    }", "code_tokens": ["public", "static", "String", "makeSafeFilename", "(", "String", "filename", ")", "{", "// Replace invalid characters", "for", "(", "final", "Map", ".", "Entry", "<", "Pattern", ",", "String", ">", "pair", ":", "REPLACEMENT_PAIRS", ".", "entrySet", "(", ")", ")", "{", "final", "Pattern", "pattern", "=", "pair", ".", "getKey", "(", ")", ";", "final", "Matcher", "matcher", "=", "pattern", ".", "matcher", "(", "filename", ")", ";", "filename", "=", "matcher", ".", "replaceAll", "(", "pair", ".", "getValue", "(", ")", ")", ";", "}", "// Make sure the name doesn't violate a Windows reserved word...", "for", "(", "Pattern", "pattern", ":", "WINDOWS_INVALID_PATTERNS", ")", "{", "if", "(", "pattern", ".", "matcher", "(", "filename", ")", ".", "matches", "(", ")", ")", "{", "filename", "=", "\"uP-\"", "+", "filename", ";", "break", ";", "}", "}", "return", "filename", ";", "}"], "docstring": "Makes 'safe' filename", "docstring_tokens": ["Makes", "safe", "filename"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/SafeFilenameUtils.java#L48-L65", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/xml/dlm/FragmentDefinitionExporter.java", "func_name": "FragmentDefinitionExporter.exportDataElement", "original_string": "@Override\n    protected Element exportDataElement(String id) {\n        final FragmentDefinition fragmentDefinition =\n                fragmentDefinitionDao.getFragmentDefinition(id);\n        if (fragmentDefinition == null) {\n            return null;\n        }\n\n        final org.dom4j.Document fragmentDefDoc = new org.dom4j.DocumentFactory().createDocument();\n        final Element fragmentDefElement = fragmentDefDoc.addElement(\"fragment-definition\");\n        fragmentDefElement.addNamespace(\"dlm\", Constants.NS_URI);\n        fragmentDefElement.addAttribute(\n                \"script\", \"classpath://org/jasig/portal/io/import-fragment-definition_v3-1.crn\");\n        fragmentDefinition.toElement(fragmentDefElement);\n\n        return fragmentDefElement;\n    }", "language": "java", "code": "@Override\n    protected Element exportDataElement(String id) {\n        final FragmentDefinition fragmentDefinition =\n                fragmentDefinitionDao.getFragmentDefinition(id);\n        if (fragmentDefinition == null) {\n            return null;\n        }\n\n        final org.dom4j.Document fragmentDefDoc = new org.dom4j.DocumentFactory().createDocument();\n        final Element fragmentDefElement = fragmentDefDoc.addElement(\"fragment-definition\");\n        fragmentDefElement.addNamespace(\"dlm\", Constants.NS_URI);\n        fragmentDefElement.addAttribute(\n                \"script\", \"classpath://org/jasig/portal/io/import-fragment-definition_v3-1.crn\");\n        fragmentDefinition.toElement(fragmentDefElement);\n\n        return fragmentDefElement;\n    }", "code_tokens": ["@", "Override", "protected", "Element", "exportDataElement", "(", "String", "id", ")", "{", "final", "FragmentDefinition", "fragmentDefinition", "=", "fragmentDefinitionDao", ".", "getFragmentDefinition", "(", "id", ")", ";", "if", "(", "fragmentDefinition", "==", "null", ")", "{", "return", "null", ";", "}", "final", "org", ".", "dom4j", ".", "Document", "fragmentDefDoc", "=", "new", "org", ".", "dom4j", ".", "DocumentFactory", "(", ")", ".", "createDocument", "(", ")", ";", "final", "Element", "fragmentDefElement", "=", "fragmentDefDoc", ".", "addElement", "(", "\"fragment-definition\"", ")", ";", "fragmentDefElement", ".", "addNamespace", "(", "\"dlm\"", ",", "Constants", ".", "NS_URI", ")", ";", "fragmentDefElement", ".", "addAttribute", "(", "\"script\"", ",", "\"classpath://org/jasig/portal/io/import-fragment-definition_v3-1.crn\"", ")", ";", "fragmentDefinition", ".", "toElement", "(", "fragmentDefElement", ")", ";", "return", "fragmentDefElement", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.io.xml.crn.AbstractDom4jExporter#exportDataElement(java.lang.String)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/xml/dlm/FragmentDefinitionExporter.java#L36-L52", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/cache/PortletCacheControlServiceImpl.java", "func_name": "PortletCacheControlServiceImpl.getPortletCacheState", "original_string": "@SuppressWarnings(\"unchecked\")\n    protected <D extends CachedPortletResultHolder<T>, T extends Serializable>\n            CacheState<D, T> getPortletCacheState(\n                    HttpServletRequest request,\n                    IPortletWindow portletWindow,\n                    PublicPortletCacheKey publicCacheKey,\n                    Ehcache publicOutputCache,\n                    Ehcache privateOutputCache) {\n\n        final CacheState<D, T> cacheState = new CacheState<D, T>();\n        cacheState.setPublicPortletCacheKey(publicCacheKey);\n\n        final IPortletWindowId portletWindowId = portletWindow.getPortletWindowId();\n\n        // Check for publicly cached data\n        D cachedPortletData =\n                (D) this.getCachedPortletData(publicCacheKey, publicOutputCache, portletWindow);\n        if (cachedPortletData != null) {\n            cacheState.setCachedPortletData(cachedPortletData);\n            return cacheState;\n        }\n\n        // Generate private cache key\n        final HttpSession session = request.getSession();\n        final String sessionId = session.getId();\n        final IPortletEntityId entityId = portletWindow.getPortletEntityId();\n        final PrivatePortletCacheKey privateCacheKey =\n                new PrivatePortletCacheKey(sessionId, portletWindowId, entityId, publicCacheKey);\n        cacheState.setPrivatePortletCacheKey(privateCacheKey);\n\n        // Check for privately cached data\n        cachedPortletData =\n                (D) this.getCachedPortletData(privateCacheKey, privateOutputCache, portletWindow);\n        if (cachedPortletData != null) {\n            cacheState.setCachedPortletData(cachedPortletData);\n            return cacheState;\n        }\n\n        return cacheState;\n    }", "language": "java", "code": "@SuppressWarnings(\"unchecked\")\n    protected <D extends CachedPortletResultHolder<T>, T extends Serializable>\n            CacheState<D, T> getPortletCacheState(\n                    HttpServletRequest request,\n                    IPortletWindow portletWindow,\n                    PublicPortletCacheKey publicCacheKey,\n                    Ehcache publicOutputCache,\n                    Ehcache privateOutputCache) {\n\n        final CacheState<D, T> cacheState = new CacheState<D, T>();\n        cacheState.setPublicPortletCacheKey(publicCacheKey);\n\n        final IPortletWindowId portletWindowId = portletWindow.getPortletWindowId();\n\n        // Check for publicly cached data\n        D cachedPortletData =\n                (D) this.getCachedPortletData(publicCacheKey, publicOutputCache, portletWindow);\n        if (cachedPortletData != null) {\n            cacheState.setCachedPortletData(cachedPortletData);\n            return cacheState;\n        }\n\n        // Generate private cache key\n        final HttpSession session = request.getSession();\n        final String sessionId = session.getId();\n        final IPortletEntityId entityId = portletWindow.getPortletEntityId();\n        final PrivatePortletCacheKey privateCacheKey =\n                new PrivatePortletCacheKey(sessionId, portletWindowId, entityId, publicCacheKey);\n        cacheState.setPrivatePortletCacheKey(privateCacheKey);\n\n        // Check for privately cached data\n        cachedPortletData =\n                (D) this.getCachedPortletData(privateCacheKey, privateOutputCache, portletWindow);\n        if (cachedPortletData != null) {\n            cacheState.setCachedPortletData(cachedPortletData);\n            return cacheState;\n        }\n\n        return cacheState;\n    }", "code_tokens": ["@", "SuppressWarnings", "(", "\"unchecked\"", ")", "protected", "<", "D", "extends", "CachedPortletResultHolder", "<", "T", ">", ",", "T", "extends", "Serializable", ">", "CacheState", "<", "D", ",", "T", ">", "getPortletCacheState", "(", "HttpServletRequest", "request", ",", "IPortletWindow", "portletWindow", ",", "PublicPortletCacheKey", "publicCacheKey", ",", "Ehcache", "publicOutputCache", ",", "Ehcache", "privateOutputCache", ")", "{", "final", "CacheState", "<", "D", ",", "T", ">", "cacheState", "=", "new", "CacheState", "<", "D", ",", "T", ">", "(", ")", ";", "cacheState", ".", "setPublicPortletCacheKey", "(", "publicCacheKey", ")", ";", "final", "IPortletWindowId", "portletWindowId", "=", "portletWindow", ".", "getPortletWindowId", "(", ")", ";", "// Check for publicly cached data", "D", "cachedPortletData", "=", "(", "D", ")", "this", ".", "getCachedPortletData", "(", "publicCacheKey", ",", "publicOutputCache", ",", "portletWindow", ")", ";", "if", "(", "cachedPortletData", "!=", "null", ")", "{", "cacheState", ".", "setCachedPortletData", "(", "cachedPortletData", ")", ";", "return", "cacheState", ";", "}", "// Generate private cache key", "final", "HttpSession", "session", "=", "request", ".", "getSession", "(", ")", ";", "final", "String", "sessionId", "=", "session", ".", "getId", "(", ")", ";", "final", "IPortletEntityId", "entityId", "=", "portletWindow", ".", "getPortletEntityId", "(", ")", ";", "final", "PrivatePortletCacheKey", "privateCacheKey", "=", "new", "PrivatePortletCacheKey", "(", "sessionId", ",", "portletWindowId", ",", "entityId", ",", "publicCacheKey", ")", ";", "cacheState", ".", "setPrivatePortletCacheKey", "(", "privateCacheKey", ")", ";", "// Check for privately cached data", "cachedPortletData", "=", "(", "D", ")", "this", ".", "getCachedPortletData", "(", "privateCacheKey", ",", "privateOutputCache", ",", "portletWindow", ")", ";", "if", "(", "cachedPortletData", "!=", "null", ")", "{", "cacheState", ".", "setCachedPortletData", "(", "cachedPortletData", ")", ";", "return", "cacheState", ";", "}", "return", "cacheState", ";", "}"], "docstring": "Get the cached portlet data looking in both the public and then private caches returning the\nfirst found\n\n@param request The current request\n@param portletWindow The window to get data for\n@param publicCacheKey The public cache key\n@param publicOutputCache The public cache\n@param privateOutputCache The private cache", "docstring_tokens": ["Get", "the", "cached", "portlet", "data", "looking", "in", "both", "the", "public", "and", "then", "private", "caches", "returning", "the", "first", "found"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/cache/PortletCacheControlServiceImpl.java#L345-L384", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/cache/PortletCacheControlServiceImpl.java", "func_name": "PortletCacheControlServiceImpl.getCachedPortletData", "original_string": "@SuppressWarnings(\"unchecked\")\n    protected <T extends Serializable> CachedPortletResultHolder<T> getCachedPortletData(\n            Serializable cacheKey, Ehcache outputCache, IPortletWindow portletWindow) {\n\n        final Element publicCacheElement = outputCache.get(cacheKey);\n        if (publicCacheElement == null) {\n            logger.debug(\"No cached output for key {}\", cacheKey);\n            return null;\n        }\n\n        final CachedPortletResultHolder<T> cachedPortletData =\n                (CachedPortletResultHolder<T>) publicCacheElement.getObjectValue();\n        if (publicCacheElement.isExpired() && cachedPortletData.getEtag() == null) {\n            logger.debug(\"Cached output for key {} is expired\", cacheKey);\n            outputCache.remove(cacheKey);\n            return null;\n        }\n\n        logger.debug(\"Returning cached output with key {} for {}\", cacheKey, portletWindow);\n        return (CachedPortletResultHolder<T>) publicCacheElement.getObjectValue();\n    }", "language": "java", "code": "@SuppressWarnings(\"unchecked\")\n    protected <T extends Serializable> CachedPortletResultHolder<T> getCachedPortletData(\n            Serializable cacheKey, Ehcache outputCache, IPortletWindow portletWindow) {\n\n        final Element publicCacheElement = outputCache.get(cacheKey);\n        if (publicCacheElement == null) {\n            logger.debug(\"No cached output for key {}\", cacheKey);\n            return null;\n        }\n\n        final CachedPortletResultHolder<T> cachedPortletData =\n                (CachedPortletResultHolder<T>) publicCacheElement.getObjectValue();\n        if (publicCacheElement.isExpired() && cachedPortletData.getEtag() == null) {\n            logger.debug(\"Cached output for key {} is expired\", cacheKey);\n            outputCache.remove(cacheKey);\n            return null;\n        }\n\n        logger.debug(\"Returning cached output with key {} for {}\", cacheKey, portletWindow);\n        return (CachedPortletResultHolder<T>) publicCacheElement.getObjectValue();\n    }", "code_tokens": ["@", "SuppressWarnings", "(", "\"unchecked\"", ")", "protected", "<", "T", "extends", "Serializable", ">", "CachedPortletResultHolder", "<", "T", ">", "getCachedPortletData", "(", "Serializable", "cacheKey", ",", "Ehcache", "outputCache", ",", "IPortletWindow", "portletWindow", ")", "{", "final", "Element", "publicCacheElement", "=", "outputCache", ".", "get", "(", "cacheKey", ")", ";", "if", "(", "publicCacheElement", "==", "null", ")", "{", "logger", ".", "debug", "(", "\"No cached output for key {}\"", ",", "cacheKey", ")", ";", "return", "null", ";", "}", "final", "CachedPortletResultHolder", "<", "T", ">", "cachedPortletData", "=", "(", "CachedPortletResultHolder", "<", "T", ">", ")", "publicCacheElement", ".", "getObjectValue", "(", ")", ";", "if", "(", "publicCacheElement", ".", "isExpired", "(", ")", "&&", "cachedPortletData", ".", "getEtag", "(", ")", "==", "null", ")", "{", "logger", ".", "debug", "(", "\"Cached output for key {} is expired\"", ",", "cacheKey", ")", ";", "outputCache", ".", "remove", "(", "cacheKey", ")", ";", "return", "null", ";", "}", "logger", ".", "debug", "(", "\"Returning cached output with key {} for {}\"", ",", "cacheKey", ",", "portletWindow", ")", ";", "return", "(", "CachedPortletResultHolder", "<", "T", ">", ")", "publicCacheElement", ".", "getObjectValue", "(", ")", ";", "}"], "docstring": "Get the cached portlet data for the key, cache and window. If there is {@link\nCachedPortletData} in the cache it will only be returned if {@link\nCachedPortletData#isExpired()} is false or {@link CachedPortletData#getEtag()} is not null.\n\n@param cacheKey The cache key\n@param outputCache The cache\n@param portletWindow The portlet window the lookup is for\n@return The cache data for the portlet window", "docstring_tokens": ["Get", "the", "cached", "portlet", "data", "for", "the", "key", "cache", "and", "window", ".", "If", "there", "is", "{", "@link", "CachedPortletData", "}", "in", "the", "cache", "it", "will", "only", "be", "returned", "if", "{", "@link", "CachedPortletData#isExpired", "()", "}", "is", "false", "or", "{", "@link", "CachedPortletData#getEtag", "()", "}", "is", "not", "null", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/cache/PortletCacheControlServiceImpl.java#L396-L416", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/cache/PortletCacheControlServiceImpl.java", "func_name": "PortletCacheControlServiceImpl.cacheElement", "original_string": "protected void cacheElement(\n            Ehcache cache,\n            Serializable cacheKey,\n            CachedPortletResultHolder<?> data,\n            CacheControl cacheControl) {\n        // using validation method, ignore expirationTime and defer to cache configuration\n        if (cacheControl.getETag() != null) {\n            final Element element = new Element(cacheKey, data);\n            cache.put(element);\n            return;\n        }\n\n        // using expiration method, -1 for CacheControl#expirationTime means \"forever\" (e.g. ignore\n        // and defer to cache configuration)\n        final int expirationTime = cacheControl.getExpirationTime();\n        if (expirationTime == -1) {\n            final Element element = new Element(cacheKey, data);\n            cache.put(element);\n            return;\n        }\n\n        // using expiration method with a positive expiration, set that value as the element's TTL\n        // if it is lower than the configured cache TTL\n        final CacheConfiguration cacheConfiguration = cache.getCacheConfiguration();\n        final Element element = new Element(cacheKey, data);\n        final long cacheTTL = cacheConfiguration.getTimeToLiveSeconds();\n        if (expirationTime < cacheTTL) {\n            element.setTimeToLive(expirationTime);\n        }\n        cache.put(element);\n    }", "language": "java", "code": "protected void cacheElement(\n            Ehcache cache,\n            Serializable cacheKey,\n            CachedPortletResultHolder<?> data,\n            CacheControl cacheControl) {\n        // using validation method, ignore expirationTime and defer to cache configuration\n        if (cacheControl.getETag() != null) {\n            final Element element = new Element(cacheKey, data);\n            cache.put(element);\n            return;\n        }\n\n        // using expiration method, -1 for CacheControl#expirationTime means \"forever\" (e.g. ignore\n        // and defer to cache configuration)\n        final int expirationTime = cacheControl.getExpirationTime();\n        if (expirationTime == -1) {\n            final Element element = new Element(cacheKey, data);\n            cache.put(element);\n            return;\n        }\n\n        // using expiration method with a positive expiration, set that value as the element's TTL\n        // if it is lower than the configured cache TTL\n        final CacheConfiguration cacheConfiguration = cache.getCacheConfiguration();\n        final Element element = new Element(cacheKey, data);\n        final long cacheTTL = cacheConfiguration.getTimeToLiveSeconds();\n        if (expirationTime < cacheTTL) {\n            element.setTimeToLive(expirationTime);\n        }\n        cache.put(element);\n    }", "code_tokens": ["protected", "void", "cacheElement", "(", "Ehcache", "cache", ",", "Serializable", "cacheKey", ",", "CachedPortletResultHolder", "<", "?", ">", "data", ",", "CacheControl", "cacheControl", ")", "{", "// using validation method, ignore expirationTime and defer to cache configuration", "if", "(", "cacheControl", ".", "getETag", "(", ")", "!=", "null", ")", "{", "final", "Element", "element", "=", "new", "Element", "(", "cacheKey", ",", "data", ")", ";", "cache", ".", "put", "(", "element", ")", ";", "return", ";", "}", "// using expiration method, -1 for CacheControl#expirationTime means \"forever\" (e.g. ignore", "// and defer to cache configuration)", "final", "int", "expirationTime", "=", "cacheControl", ".", "getExpirationTime", "(", ")", ";", "if", "(", "expirationTime", "==", "-", "1", ")", "{", "final", "Element", "element", "=", "new", "Element", "(", "cacheKey", ",", "data", ")", ";", "cache", ".", "put", "(", "element", ")", ";", "return", ";", "}", "// using expiration method with a positive expiration, set that value as the element's TTL", "// if it is lower than the configured cache TTL", "final", "CacheConfiguration", "cacheConfiguration", "=", "cache", ".", "getCacheConfiguration", "(", ")", ";", "final", "Element", "element", "=", "new", "Element", "(", "cacheKey", ",", "data", ")", ";", "final", "long", "cacheTTL", "=", "cacheConfiguration", ".", "getTimeToLiveSeconds", "(", ")", ";", "if", "(", "expirationTime", "<", "cacheTTL", ")", "{", "element", ".", "setTimeToLive", "(", "expirationTime", ")", ";", "}", "cache", ".", "put", "(", "element", ")", ";", "}"], "docstring": "Construct an appropriate Cache {@link Element} for the cacheKey and data. The element's ttl\nwill be set depending on whether expiration or validation method is indicated from the\nCacheControl and the cache's configuration.", "docstring_tokens": ["Construct", "an", "appropriate", "Cache", "{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/cache/PortletCacheControlServiceImpl.java#L517-L547", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-events/src/main/java/org/apereo/portal/events/handlers/UserFilteringPortalEventHandler.java", "func_name": "UserFilteringPortalEventHandler.setSupportedUserNames", "original_string": "public void setSupportedUserNames(Collection<String> supportedUserNames) {\n        if (supportedUserNames == null) {\n            this.supportedUserNames = null;\n        } else {\n            this.supportedUserNames = ImmutableSet.copyOf(supportedUserNames);\n        }\n    }", "language": "java", "code": "public void setSupportedUserNames(Collection<String> supportedUserNames) {\n        if (supportedUserNames == null) {\n            this.supportedUserNames = null;\n        } else {\n            this.supportedUserNames = ImmutableSet.copyOf(supportedUserNames);\n        }\n    }", "code_tokens": ["public", "void", "setSupportedUserNames", "(", "Collection", "<", "String", ">", "supportedUserNames", ")", "{", "if", "(", "supportedUserNames", "==", "null", ")", "{", "this", ".", "supportedUserNames", "=", "null", ";", "}", "else", "{", "this", ".", "supportedUserNames", "=", "ImmutableSet", ".", "copyOf", "(", "supportedUserNames", ")", ";", "}", "}"], "docstring": "If no <code>supportedUserNames</code> {@link Collection} is configured all user-names are\nsupported otherwise exact String equality matching is done to determine supported userNames.\nThe property defaults to null (all user names)\n\n@param supportedUserNames the supportedUserNames to set", "docstring_tokens": ["If", "no", "<code", ">", "supportedUserNames<", "/", "code", ">", "{", "@link", "Collection", "}", "is", "configured", "all", "user", "-", "names", "are", "supported", "otherwise", "exact", "String", "equality", "matching", "is", "done", "to", "determine", "supported", "userNames", ".", "The", "property", "defaults", "to", "null", "(", "all", "user", "names", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-events/src/main/java/org/apereo/portal/events/handlers/UserFilteringPortalEventHandler.java#L47-L53", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-events/src/main/java/org/apereo/portal/events/handlers/UserFilteringPortalEventHandler.java", "func_name": "UserFilteringPortalEventHandler.setIgnoredUserNames", "original_string": "public void setIgnoredUserNames(Collection<String> ignoredUserNames) {\n        if (ignoredUserNames == null) {\n            this.ignoredUserNames = null;\n        } else {\n            this.ignoredUserNames = ImmutableSet.copyOf(ignoredUserNames);\n        }\n    }", "language": "java", "code": "public void setIgnoredUserNames(Collection<String> ignoredUserNames) {\n        if (ignoredUserNames == null) {\n            this.ignoredUserNames = null;\n        } else {\n            this.ignoredUserNames = ImmutableSet.copyOf(ignoredUserNames);\n        }\n    }", "code_tokens": ["public", "void", "setIgnoredUserNames", "(", "Collection", "<", "String", ">", "ignoredUserNames", ")", "{", "if", "(", "ignoredUserNames", "==", "null", ")", "{", "this", ".", "ignoredUserNames", "=", "null", ";", "}", "else", "{", "this", ".", "ignoredUserNames", "=", "ImmutableSet", ".", "copyOf", "(", "ignoredUserNames", ")", ";", "}", "}"], "docstring": "If no <code>ignoredUserNames</code> {@link Collection} is configured all user-names are\nsupported otherwise exact String equality matching is done to determine ignored userNames.\nThe property defaults to null (all user names)\n\n@param ignoredUserNames the ignoredUserNames to set", "docstring_tokens": ["If", "no", "<code", ">", "ignoredUserNames<", "/", "code", ">", "{", "@link", "Collection", "}", "is", "configured", "all", "user", "-", "names", "are", "supported", "otherwise", "exact", "String", "equality", "matching", "is", "done", "to", "determine", "ignored", "userNames", ".", "The", "property", "defaults", "to", "null", "(", "all", "user", "names", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-events/src/main/java/org/apereo/portal/events/handlers/UserFilteringPortalEventHandler.java#L62-L68", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-events/src/main/java/org/apereo/portal/events/handlers/UserFilteringPortalEventHandler.java", "func_name": "UserFilteringPortalEventHandler.setIgnoredUserNamePatterns", "original_string": "public void setIgnoredUserNamePatterns(Collection<Pattern> ignoredUserNamePatterns) {\n        if (ignoredUserNamePatterns == null) {\n            this.ignoredUserNamePatterns = null;\n        } else {\n            this.ignoredUserNamePatterns = ImmutableSet.copyOf(ignoredUserNamePatterns);\n        }\n    }", "language": "java", "code": "public void setIgnoredUserNamePatterns(Collection<Pattern> ignoredUserNamePatterns) {\n        if (ignoredUserNamePatterns == null) {\n            this.ignoredUserNamePatterns = null;\n        } else {\n            this.ignoredUserNamePatterns = ImmutableSet.copyOf(ignoredUserNamePatterns);\n        }\n    }", "code_tokens": ["public", "void", "setIgnoredUserNamePatterns", "(", "Collection", "<", "Pattern", ">", "ignoredUserNamePatterns", ")", "{", "if", "(", "ignoredUserNamePatterns", "==", "null", ")", "{", "this", ".", "ignoredUserNamePatterns", "=", "null", ";", "}", "else", "{", "this", ".", "ignoredUserNamePatterns", "=", "ImmutableSet", ".", "copyOf", "(", "ignoredUserNamePatterns", ")", ";", "}", "}"], "docstring": "If no <code>ignoredUserNamePatterns</code> {@link Collection} is configured all user-names\nare supported otherwise exact regex pattern matching is done to determine ignored userNames.\nThe property defaults to null (all user names)\n\n@param ignoredUserNamePatterns the ignoredUserNamePatterns to set", "docstring_tokens": ["If", "no", "<code", ">", "ignoredUserNamePatterns<", "/", "code", ">", "{", "@link", "Collection", "}", "is", "configured", "all", "user", "-", "names", "are", "supported", "otherwise", "exact", "regex", "pattern", "matching", "is", "done", "to", "determine", "ignored", "userNames", ".", "The", "property", "defaults", "to", "null", "(", "all", "user", "names", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-events/src/main/java/org/apereo/portal/events/handlers/UserFilteringPortalEventHandler.java#L77-L83", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/node/UserLayoutNodeDescription.java", "func_name": "UserLayoutNodeDescription.addNodeAttributes", "original_string": "@Override\n    public void addNodeAttributes(Element node) {\n        node.setAttribute(\"ID\", this.getId());\n        node.setAttribute(\"name\", this.getName());\n        node.setAttribute(\"unremovable\", String.valueOf(this.isUnremovable()));\n        node.setAttribute(\"immutable\", String.valueOf(this.isImmutable()));\n        node.setAttribute(\"hidden\", String.valueOf(this.isHidden()));\n\n        if (!this.isDeleteAllowed())\n            node.setAttributeNS(Constants.NS_URI, Constants.ATT_DELETE_ALLOWED, \"false\");\n        if (!this.isMoveAllowed())\n            node.setAttributeNS(Constants.NS_URI, Constants.ATT_MOVE_ALLOWED, \"false\");\n        if (!this.isEditAllowed())\n            node.setAttributeNS(Constants.NS_URI, Constants.ATT_EDIT_ALLOWED, \"false\");\n        if (!this.isAddChildAllowed())\n            node.setAttributeNS(Constants.NS_URI, Constants.ATT_ADD_CHILD_ALLOWED, \"false\");\n        if (this.getPrecedence() != 0.0)\n            node.setAttributeNS(\n                    Constants.NS_URI,\n                    Constants.ATT_PRECEDENCE,\n                    Double.toString(this.getPrecedence()));\n    }", "language": "java", "code": "@Override\n    public void addNodeAttributes(Element node) {\n        node.setAttribute(\"ID\", this.getId());\n        node.setAttribute(\"name\", this.getName());\n        node.setAttribute(\"unremovable\", String.valueOf(this.isUnremovable()));\n        node.setAttribute(\"immutable\", String.valueOf(this.isImmutable()));\n        node.setAttribute(\"hidden\", String.valueOf(this.isHidden()));\n\n        if (!this.isDeleteAllowed())\n            node.setAttributeNS(Constants.NS_URI, Constants.ATT_DELETE_ALLOWED, \"false\");\n        if (!this.isMoveAllowed())\n            node.setAttributeNS(Constants.NS_URI, Constants.ATT_MOVE_ALLOWED, \"false\");\n        if (!this.isEditAllowed())\n            node.setAttributeNS(Constants.NS_URI, Constants.ATT_EDIT_ALLOWED, \"false\");\n        if (!this.isAddChildAllowed())\n            node.setAttributeNS(Constants.NS_URI, Constants.ATT_ADD_CHILD_ALLOWED, \"false\");\n        if (this.getPrecedence() != 0.0)\n            node.setAttributeNS(\n                    Constants.NS_URI,\n                    Constants.ATT_PRECEDENCE,\n                    Double.toString(this.getPrecedence()));\n    }", "code_tokens": ["@", "Override", "public", "void", "addNodeAttributes", "(", "Element", "node", ")", "{", "node", ".", "setAttribute", "(", "\"ID\"", ",", "this", ".", "getId", "(", ")", ")", ";", "node", ".", "setAttribute", "(", "\"name\"", ",", "this", ".", "getName", "(", ")", ")", ";", "node", ".", "setAttribute", "(", "\"unremovable\"", ",", "String", ".", "valueOf", "(", "this", ".", "isUnremovable", "(", ")", ")", ")", ";", "node", ".", "setAttribute", "(", "\"immutable\"", ",", "String", ".", "valueOf", "(", "this", ".", "isImmutable", "(", ")", ")", ")", ";", "node", ".", "setAttribute", "(", "\"hidden\"", ",", "String", ".", "valueOf", "(", "this", ".", "isHidden", "(", ")", ")", ")", ";", "if", "(", "!", "this", ".", "isDeleteAllowed", "(", ")", ")", "node", ".", "setAttributeNS", "(", "Constants", ".", "NS_URI", ",", "Constants", ".", "ATT_DELETE_ALLOWED", ",", "\"false\"", ")", ";", "if", "(", "!", "this", ".", "isMoveAllowed", "(", ")", ")", "node", ".", "setAttributeNS", "(", "Constants", ".", "NS_URI", ",", "Constants", ".", "ATT_MOVE_ALLOWED", ",", "\"false\"", ")", ";", "if", "(", "!", "this", ".", "isEditAllowed", "(", ")", ")", "node", ".", "setAttributeNS", "(", "Constants", ".", "NS_URI", ",", "Constants", ".", "ATT_EDIT_ALLOWED", ",", "\"false\"", ")", ";", "if", "(", "!", "this", ".", "isAddChildAllowed", "(", ")", ")", "node", ".", "setAttributeNS", "(", "Constants", ".", "NS_URI", ",", "Constants", ".", "ATT_ADD_CHILD_ALLOWED", ",", "\"false\"", ")", ";", "if", "(", "this", ".", "getPrecedence", "(", ")", "!=", "0.0", ")", "node", ".", "setAttributeNS", "(", "Constants", ".", "NS_URI", ",", "Constants", ".", "ATT_PRECEDENCE", ",", "Double", ".", "toString", "(", "this", ".", "getPrecedence", "(", ")", ")", ")", ";", "}"], "docstring": "Add all of common node attributes to the <code>Element</code>.\n\n@param node an <code>Element</code> value", "docstring_tokens": ["Add", "all", "of", "common", "node", "attributes", "to", "the", "<code", ">", "Element<", "/", "code", ">", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/node/UserLayoutNodeDescription.java#L218-L239", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/node/UserLayoutNodeDescription.java", "func_name": "UserLayoutNodeDescription.createUserLayoutNodeDescription", "original_string": "public static UserLayoutNodeDescription createUserLayoutNodeDescription(Element xmlNode)\n            throws PortalException {\n        // is this a folder or a channel ?\n        String nodeName = xmlNode.getNodeName();\n        if (nodeName.equals(\"channel\")) {\n            return new UserLayoutChannelDescription(xmlNode);\n        } else if (nodeName.equals(\"folder\")) {\n            return new UserLayoutFolderDescription(xmlNode);\n        } else {\n            throw new PortalException(\n                    \"Given XML element '\" + nodeName + \"' is neither folder nor channel\");\n        }\n    }", "language": "java", "code": "public static UserLayoutNodeDescription createUserLayoutNodeDescription(Element xmlNode)\n            throws PortalException {\n        // is this a folder or a channel ?\n        String nodeName = xmlNode.getNodeName();\n        if (nodeName.equals(\"channel\")) {\n            return new UserLayoutChannelDescription(xmlNode);\n        } else if (nodeName.equals(\"folder\")) {\n            return new UserLayoutFolderDescription(xmlNode);\n        } else {\n            throw new PortalException(\n                    \"Given XML element '\" + nodeName + \"' is neither folder nor channel\");\n        }\n    }", "code_tokens": ["public", "static", "UserLayoutNodeDescription", "createUserLayoutNodeDescription", "(", "Element", "xmlNode", ")", "throws", "PortalException", "{", "// is this a folder or a channel ?", "String", "nodeName", "=", "xmlNode", ".", "getNodeName", "(", ")", ";", "if", "(", "nodeName", ".", "equals", "(", "\"channel\"", ")", ")", "{", "return", "new", "UserLayoutChannelDescription", "(", "xmlNode", ")", ";", "}", "else", "if", "(", "nodeName", ".", "equals", "(", "\"folder\"", ")", ")", "{", "return", "new", "UserLayoutFolderDescription", "(", "xmlNode", ")", ";", "}", "else", "{", "throw", "new", "PortalException", "(", "\"Given XML element '\"", "+", "nodeName", "+", "\"' is neither folder nor channel\"", ")", ";", "}", "}"], "docstring": "A factory method to create a <code>UserLayoutNodeDescription</code> instance, based on the\ninformation provided in the user layout <code>Element</code>.\n\n@param xmlNode a user layout DTD folder/channel <code>Element</code> value\n@return an <code>UserLayoutNodeDescription</code> value\n@exception PortalException if the xml passed is somehow invalid.", "docstring_tokens": ["A", "factory", "method", "to", "create", "a", "<code", ">", "UserLayoutNodeDescription<", "/", "code", ">", "instance", "based", "on", "the", "information", "provided", "in", "the", "user", "layout", "<code", ">", "Element<", "/", "code", ">", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/node/UserLayoutNodeDescription.java#L249-L261", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/PrincipalsRESTController.java", "func_name": "PrincipalsRESTController.getPrincipals", "original_string": "@PreAuthorize(\n            \"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\")\n    @RequestMapping(value = \"/permissions/principals.json\", method = RequestMethod.GET)\n    public ModelAndView getPrincipals(\n            @RequestParam(value = \"q\") String query,\n            HttpServletRequest request,\n            HttpServletResponse response)\n            throws Exception {\n\n        /*\n         *  Add groups and people matching the search query to the JSON model\n         */\n\n        ModelAndView mv = new ModelAndView();\n        List<JsonEntityBean> groups = new ArrayList<JsonEntityBean>();\n        groups.addAll(listHelper.search(EntityEnum.GROUP.toString(), query));\n        Collections.sort(groups);\n        mv.addObject(\"groups\", groups);\n\n        List<JsonEntityBean> people = new ArrayList<JsonEntityBean>();\n        people.addAll(listHelper.search(EntityEnum.PERSON.toString(), query));\n        Collections.sort(people);\n        mv.addObject(\"people\", people);\n        mv.setViewName(\"json\");\n\n        return mv;\n    }", "language": "java", "code": "@PreAuthorize(\n            \"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\")\n    @RequestMapping(value = \"/permissions/principals.json\", method = RequestMethod.GET)\n    public ModelAndView getPrincipals(\n            @RequestParam(value = \"q\") String query,\n            HttpServletRequest request,\n            HttpServletResponse response)\n            throws Exception {\n\n        /*\n         *  Add groups and people matching the search query to the JSON model\n         */\n\n        ModelAndView mv = new ModelAndView();\n        List<JsonEntityBean> groups = new ArrayList<JsonEntityBean>();\n        groups.addAll(listHelper.search(EntityEnum.GROUP.toString(), query));\n        Collections.sort(groups);\n        mv.addObject(\"groups\", groups);\n\n        List<JsonEntityBean> people = new ArrayList<JsonEntityBean>();\n        people.addAll(listHelper.search(EntityEnum.PERSON.toString(), query));\n        Collections.sort(people);\n        mv.addObject(\"people\", people);\n        mv.setViewName(\"json\");\n\n        return mv;\n    }", "code_tokens": ["@", "PreAuthorize", "(", "\"hasPermission('ALL', 'java.lang.String', new org.apereo.portal.spring.security.evaluator.AuthorizableActivity('UP_PERMISSIONS', 'VIEW_PERMISSIONS'))\"", ")", "@", "RequestMapping", "(", "value", "=", "\"/permissions/principals.json\"", ",", "method", "=", "RequestMethod", ".", "GET", ")", "public", "ModelAndView", "getPrincipals", "(", "@", "RequestParam", "(", "value", "=", "\"q\"", ")", "String", "query", ",", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "throws", "Exception", "{", "/*\n         *  Add groups and people matching the search query to the JSON model\n         */", "ModelAndView", "mv", "=", "new", "ModelAndView", "(", ")", ";", "List", "<", "JsonEntityBean", ">", "groups", "=", "new", "ArrayList", "<", "JsonEntityBean", ">", "(", ")", ";", "groups", ".", "addAll", "(", "listHelper", ".", "search", "(", "EntityEnum", ".", "GROUP", ".", "toString", "(", ")", ",", "query", ")", ")", ";", "Collections", ".", "sort", "(", "groups", ")", ";", "mv", ".", "addObject", "(", "\"groups\"", ",", "groups", ")", ";", "List", "<", "JsonEntityBean", ">", "people", "=", "new", "ArrayList", "<", "JsonEntityBean", ">", "(", ")", ";", "people", ".", "addAll", "(", "listHelper", ".", "search", "(", "EntityEnum", ".", "PERSON", ".", "toString", "(", ")", ",", "query", ")", ")", ";", "Collections", ".", "sort", "(", "people", ")", ";", "mv", ".", "addObject", "(", "\"people\"", ",", "people", ")", ";", "mv", ".", "setViewName", "(", "\"json\"", ")", ";", "return", "mv", ";", "}"], "docstring": "Return a JSON view of the uPortal principals matching the supplied query string.\n\n@param query\n@param request\n@param response\n@return\n@throws Exception", "docstring_tokens": ["Return", "a", "JSON", "view", "of", "the", "uPortal", "principals", "matching", "the", "supplied", "query", "string", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/PrincipalsRESTController.java#L53-L79", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/GetMemberServicePhrase.java", "func_name": "GetMemberServicePhrase.getPhrase", "original_string": "public static String getPhrase(String name, String memberValue) {\n        String rslt = null;\n\n        // We can (and must) cut & run if the element is a <literal> or a <channel>...\n        if (name.equals(\"literal\") || name.equals(\"channel\")) {\n            return \"local\";\n        }\n\n        try {\n\n            Class[] leafTypes = new Class[] {IPerson.class, IPortletDefinition.class};\n            for (int i = 0; i < leafTypes.length && rslt == null; i++) {\n                EntityIdentifier[] eis =\n                        GroupService.searchForGroups(\n                                memberValue, IGroupConstants.SearchMethod.DISCRETE, leafTypes[i]);\n                if (eis.length == 1) {\n                    // Match!\n                    if (eis[0].getType() == IEntityGroup.class) {\n                        IEntityGroup g = GroupService.findGroup(eis[0].getKey());\n                        rslt = g.getServiceName().toString();\n                    } else {\n                        String msg = \"The specified entity is not a group:  \" + memberValue;\n                        throw new RuntimeException(msg);\n                    }\n                    break;\n                } else if (eis.length > 1) {\n                    String msg = \"Ambiguous member name:  \" + memberValue;\n                    throw new RuntimeException(msg);\n                }\n            }\n\n        } catch (Throwable t) {\n            String msg = \"Error looking up the specified member:  \" + memberValue;\n            throw new RuntimeException(msg, t);\n        }\n\n        if (rslt == null) {\n            String msg = \"The specified member was not found:  \" + memberValue;\n            throw new RuntimeException(msg);\n        }\n\n        return rslt;\n    }", "language": "java", "code": "public static String getPhrase(String name, String memberValue) {\n        String rslt = null;\n\n        // We can (and must) cut & run if the element is a <literal> or a <channel>...\n        if (name.equals(\"literal\") || name.equals(\"channel\")) {\n            return \"local\";\n        }\n\n        try {\n\n            Class[] leafTypes = new Class[] {IPerson.class, IPortletDefinition.class};\n            for (int i = 0; i < leafTypes.length && rslt == null; i++) {\n                EntityIdentifier[] eis =\n                        GroupService.searchForGroups(\n                                memberValue, IGroupConstants.SearchMethod.DISCRETE, leafTypes[i]);\n                if (eis.length == 1) {\n                    // Match!\n                    if (eis[0].getType() == IEntityGroup.class) {\n                        IEntityGroup g = GroupService.findGroup(eis[0].getKey());\n                        rslt = g.getServiceName().toString();\n                    } else {\n                        String msg = \"The specified entity is not a group:  \" + memberValue;\n                        throw new RuntimeException(msg);\n                    }\n                    break;\n                } else if (eis.length > 1) {\n                    String msg = \"Ambiguous member name:  \" + memberValue;\n                    throw new RuntimeException(msg);\n                }\n            }\n\n        } catch (Throwable t) {\n            String msg = \"Error looking up the specified member:  \" + memberValue;\n            throw new RuntimeException(msg, t);\n        }\n\n        if (rslt == null) {\n            String msg = \"The specified member was not found:  \" + memberValue;\n            throw new RuntimeException(msg);\n        }\n\n        return rslt;\n    }", "code_tokens": ["public", "static", "String", "getPhrase", "(", "String", "name", ",", "String", "memberValue", ")", "{", "String", "rslt", "=", "null", ";", "// We can (and must) cut & run if the element is a <literal> or a <channel>...", "if", "(", "name", ".", "equals", "(", "\"literal\"", ")", "||", "name", ".", "equals", "(", "\"channel\"", ")", ")", "{", "return", "\"local\"", ";", "}", "try", "{", "Class", "[", "]", "leafTypes", "=", "new", "Class", "[", "]", "{", "IPerson", ".", "class", ",", "IPortletDefinition", ".", "class", "}", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "leafTypes", ".", "length", "&&", "rslt", "==", "null", ";", "i", "++", ")", "{", "EntityIdentifier", "[", "]", "eis", "=", "GroupService", ".", "searchForGroups", "(", "memberValue", ",", "IGroupConstants", ".", "SearchMethod", ".", "DISCRETE", ",", "leafTypes", "[", "i", "]", ")", ";", "if", "(", "eis", ".", "length", "==", "1", ")", "{", "// Match!", "if", "(", "eis", "[", "0", "]", ".", "getType", "(", ")", "==", "IEntityGroup", ".", "class", ")", "{", "IEntityGroup", "g", "=", "GroupService", ".", "findGroup", "(", "eis", "[", "0", "]", ".", "getKey", "(", ")", ")", ";", "rslt", "=", "g", ".", "getServiceName", "(", ")", ".", "toString", "(", ")", ";", "}", "else", "{", "String", "msg", "=", "\"The specified entity is not a group:  \"", "+", "memberValue", ";", "throw", "new", "RuntimeException", "(", "msg", ")", ";", "}", "break", ";", "}", "else", "if", "(", "eis", ".", "length", ">", "1", ")", "{", "String", "msg", "=", "\"Ambiguous member name:  \"", "+", "memberValue", ";", "throw", "new", "RuntimeException", "(", "msg", ")", ";", "}", "}", "}", "catch", "(", "Throwable", "t", ")", "{", "String", "msg", "=", "\"Error looking up the specified member:  \"", "+", "memberValue", ";", "throw", "new", "RuntimeException", "(", "msg", ",", "t", ")", ";", "}", "if", "(", "rslt", "==", "null", ")", "{", "String", "msg", "=", "\"The specified member was not found:  \"", "+", "memberValue", ";", "throw", "new", "RuntimeException", "(", "msg", ")", ";", "}", "return", "rslt", ";", "}"], "docstring": "Internal search, thus case sensitive.", "docstring_tokens": ["Internal", "search", "thus", "case", "sensitive", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/GetMemberServicePhrase.java#L71-L113", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-spring/src/main/java/org/apereo/portal/spring/web/context/support/FailsafeSingletonScope.java", "func_name": "FailsafeSingletonScope.destroy", "original_string": "@Override\n    public void destroy() throws Exception {\n        for (final InstanceHolder instanceHolder : this.instances.values()) {\n            if (instanceHolder.destructionCallback != null) {\n                try {\n                    instanceHolder.destructionCallback.run();\n                } catch (Exception e) {\n                    this.logger.warn(\n                            \"Destruction callback for bean named '\"\n                                    + instanceHolder.name\n                                    + \"' failed.\",\n                            e);\n                }\n            }\n        }\n\n        this.instances.clear();\n    }", "language": "java", "code": "@Override\n    public void destroy() throws Exception {\n        for (final InstanceHolder instanceHolder : this.instances.values()) {\n            if (instanceHolder.destructionCallback != null) {\n                try {\n                    instanceHolder.destructionCallback.run();\n                } catch (Exception e) {\n                    this.logger.warn(\n                            \"Destruction callback for bean named '\"\n                                    + instanceHolder.name\n                                    + \"' failed.\",\n                            e);\n                }\n            }\n        }\n\n        this.instances.clear();\n    }", "code_tokens": ["@", "Override", "public", "void", "destroy", "(", ")", "throws", "Exception", "{", "for", "(", "final", "InstanceHolder", "instanceHolder", ":", "this", ".", "instances", ".", "values", "(", ")", ")", "{", "if", "(", "instanceHolder", ".", "destructionCallback", "!=", "null", ")", "{", "try", "{", "instanceHolder", ".", "destructionCallback", ".", "run", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"Destruction callback for bean named '\"", "+", "instanceHolder", ".", "name", "+", "\"' failed.\"", ",", "e", ")", ";", "}", "}", "}", "this", ".", "instances", ".", "clear", "(", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.springframework.beans.factory.DisposableBean#destroy()", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-spring/src/main/java/org/apereo/portal/spring/web/context/support/FailsafeSingletonScope.java#L46-L63", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/services/MergingUserInfoService.java", "func_name": "MergingUserInfoService.getUserInfo", "original_string": "@Override\n    public Map<String, String> getUserInfo(PortletRequest request, PortletWindow portletWindow)\n            throws PortletContainerException {\n\n        Map<String, String> mergedInfo = new HashMap<String, String>();\n\n        // iterate over all supplied user info services and add their\n        // resulting key/value pairs to our merged map\n        for (final UserInfoService service : this.userInfoServices) {\n\n            Map<String, String> userInfo = service.getUserInfo(request, portletWindow);\n            if (userInfo != null) {\n                for (final Map.Entry<String, String> entry : userInfo.entrySet()) {\n                    final String attributeName = entry.getKey();\n                    final String valueObj = entry.getValue();\n                    mergedInfo.put(attributeName, valueObj);\n                }\n            }\n        }\n\n        return mergedInfo;\n    }", "language": "java", "code": "@Override\n    public Map<String, String> getUserInfo(PortletRequest request, PortletWindow portletWindow)\n            throws PortletContainerException {\n\n        Map<String, String> mergedInfo = new HashMap<String, String>();\n\n        // iterate over all supplied user info services and add their\n        // resulting key/value pairs to our merged map\n        for (final UserInfoService service : this.userInfoServices) {\n\n            Map<String, String> userInfo = service.getUserInfo(request, portletWindow);\n            if (userInfo != null) {\n                for (final Map.Entry<String, String> entry : userInfo.entrySet()) {\n                    final String attributeName = entry.getKey();\n                    final String valueObj = entry.getValue();\n                    mergedInfo.put(attributeName, valueObj);\n                }\n            }\n        }\n\n        return mergedInfo;\n    }", "code_tokens": ["@", "Override", "public", "Map", "<", "String", ",", "String", ">", "getUserInfo", "(", "PortletRequest", "request", ",", "PortletWindow", "portletWindow", ")", "throws", "PortletContainerException", "{", "Map", "<", "String", ",", "String", ">", "mergedInfo", "=", "new", "HashMap", "<", "String", ",", "String", ">", "(", ")", ";", "// iterate over all supplied user info services and add their", "// resulting key/value pairs to our merged map", "for", "(", "final", "UserInfoService", "service", ":", "this", ".", "userInfoServices", ")", "{", "Map", "<", "String", ",", "String", ">", "userInfo", "=", "service", ".", "getUserInfo", "(", "request", ",", "portletWindow", ")", ";", "if", "(", "userInfo", "!=", "null", ")", "{", "for", "(", "final", "Map", ".", "Entry", "<", "String", ",", "String", ">", "entry", ":", "userInfo", ".", "entrySet", "(", ")", ")", "{", "final", "String", "attributeName", "=", "entry", ".", "getKey", "(", ")", ";", "final", "String", "valueObj", "=", "entry", ".", "getValue", "(", ")", ";", "mergedInfo", ".", "put", "(", "attributeName", ",", "valueObj", ")", ";", "}", "}", "}", "return", "mergedInfo", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apache.pluto.spi.optional.UserInfoService#getUserInfo(javax.portlet.PortletRequest, org.apache.pluto.PortletWindow)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/services/MergingUserInfoService.java#L50-L71", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/StylesheetUserPreferencesTransformerConfigurationSource.java", "func_name": "StylesheetUserPreferencesTransformerConfigurationSource.getCacheKey", "original_string": "@Override\n    public final CacheKey getCacheKey(HttpServletRequest request, HttpServletResponse response) {\n        final CacheKeyBuilder<String, String> cacheKeyBuilder = CacheKey.builder(getName());\n\n        final PreferencesScope stylesheetPreferencesScope =\n                this.getStylesheetPreferencesScope(request);\n\n        this.stylesheetUserPreferencesService.populateStylesheetParameters(\n                request, stylesheetPreferencesScope, cacheKeyBuilder);\n\n        this.stylesheetUserPreferencesService.populateOutputProperties(\n                request, stylesheetPreferencesScope, cacheKeyBuilder);\n\n        return cacheKeyBuilder.build();\n    }", "language": "java", "code": "@Override\n    public final CacheKey getCacheKey(HttpServletRequest request, HttpServletResponse response) {\n        final CacheKeyBuilder<String, String> cacheKeyBuilder = CacheKey.builder(getName());\n\n        final PreferencesScope stylesheetPreferencesScope =\n                this.getStylesheetPreferencesScope(request);\n\n        this.stylesheetUserPreferencesService.populateStylesheetParameters(\n                request, stylesheetPreferencesScope, cacheKeyBuilder);\n\n        this.stylesheetUserPreferencesService.populateOutputProperties(\n                request, stylesheetPreferencesScope, cacheKeyBuilder);\n\n        return cacheKeyBuilder.build();\n    }", "code_tokens": ["@", "Override", "public", "final", "CacheKey", "getCacheKey", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "final", "CacheKeyBuilder", "<", "String", ",", "String", ">", "cacheKeyBuilder", "=", "CacheKey", ".", "builder", "(", "getName", "(", ")", ")", ";", "final", "PreferencesScope", "stylesheetPreferencesScope", "=", "this", ".", "getStylesheetPreferencesScope", "(", "request", ")", ";", "this", ".", "stylesheetUserPreferencesService", ".", "populateStylesheetParameters", "(", "request", ",", "stylesheetPreferencesScope", ",", "cacheKeyBuilder", ")", ";", "this", ".", "stylesheetUserPreferencesService", ".", "populateOutputProperties", "(", "request", ",", "stylesheetPreferencesScope", ",", "cacheKeyBuilder", ")", ";", "return", "cacheKeyBuilder", ".", "build", "(", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.xslt.TransformerConfigurationSource#getTransformerConfigurationKey(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/StylesheetUserPreferencesTransformerConfigurationSource.java#L55-L69", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/StylesheetUserPreferencesTransformerConfigurationSource.java", "func_name": "StylesheetUserPreferencesTransformerConfigurationSource.getParameters", "original_string": "@Override\n    public final Map<String, Object> getParameters(\n            HttpServletRequest request, HttpServletResponse response) {\n        final PreferencesScope stylesheetPreferencesScope =\n                this.getStylesheetPreferencesScope(request);\n\n        final LinkedHashMap<String, Object> stylesheetParameters =\n                new LinkedHashMap<String, Object>();\n\n        this.stylesheetUserPreferencesService.populateStylesheetParameters(\n                request,\n                stylesheetPreferencesScope,\n                new MapPopulator<String, String>(stylesheetParameters));\n\n        return stylesheetParameters;\n    }", "language": "java", "code": "@Override\n    public final Map<String, Object> getParameters(\n            HttpServletRequest request, HttpServletResponse response) {\n        final PreferencesScope stylesheetPreferencesScope =\n                this.getStylesheetPreferencesScope(request);\n\n        final LinkedHashMap<String, Object> stylesheetParameters =\n                new LinkedHashMap<String, Object>();\n\n        this.stylesheetUserPreferencesService.populateStylesheetParameters(\n                request,\n                stylesheetPreferencesScope,\n                new MapPopulator<String, String>(stylesheetParameters));\n\n        return stylesheetParameters;\n    }", "code_tokens": ["@", "Override", "public", "final", "Map", "<", "String", ",", "Object", ">", "getParameters", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "final", "PreferencesScope", "stylesheetPreferencesScope", "=", "this", ".", "getStylesheetPreferencesScope", "(", "request", ")", ";", "final", "LinkedHashMap", "<", "String", ",", "Object", ">", "stylesheetParameters", "=", "new", "LinkedHashMap", "<", "String", ",", "Object", ">", "(", ")", ";", "this", ".", "stylesheetUserPreferencesService", ".", "populateStylesheetParameters", "(", "request", ",", "stylesheetPreferencesScope", ",", "new", "MapPopulator", "<", "String", ",", "String", ">", "(", "stylesheetParameters", ")", ")", ";", "return", "stylesheetParameters", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.xslt.TransformerConfigurationSource#getTransformerParameters(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/StylesheetUserPreferencesTransformerConfigurationSource.java#L74-L89", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/PLFIntegrator.java", "func_name": "PLFIntegrator.appendChild", "original_string": "static Element appendChild(Element plfChild, Element parent, boolean copyChildren) {\n        Document document = parent.getOwnerDocument();\n        Element copy = (Element) document.importNode(plfChild, false);\n        parent.appendChild(copy);\n\n        // set the identifier for the doc if warrented\n        String id = copy.getAttribute(Constants.ATT_ID);\n        if (id != null && !id.equals(\"\")) copy.setIdAttribute(Constants.ATT_ID, true);\n\n        if (copyChildren) {\n            NodeList children = plfChild.getChildNodes();\n            for (int i = 0; i < children.getLength(); i++) {\n                if (children.item(i) instanceof Element)\n                    appendChild((Element) children.item(i), copy, true);\n            }\n        }\n        return copy;\n    }", "language": "java", "code": "static Element appendChild(Element plfChild, Element parent, boolean copyChildren) {\n        Document document = parent.getOwnerDocument();\n        Element copy = (Element) document.importNode(plfChild, false);\n        parent.appendChild(copy);\n\n        // set the identifier for the doc if warrented\n        String id = copy.getAttribute(Constants.ATT_ID);\n        if (id != null && !id.equals(\"\")) copy.setIdAttribute(Constants.ATT_ID, true);\n\n        if (copyChildren) {\n            NodeList children = plfChild.getChildNodes();\n            for (int i = 0; i < children.getLength(); i++) {\n                if (children.item(i) instanceof Element)\n                    appendChild((Element) children.item(i), copy, true);\n            }\n        }\n        return copy;\n    }", "code_tokens": ["static", "Element", "appendChild", "(", "Element", "plfChild", ",", "Element", "parent", ",", "boolean", "copyChildren", ")", "{", "Document", "document", "=", "parent", ".", "getOwnerDocument", "(", ")", ";", "Element", "copy", "=", "(", "Element", ")", "document", ".", "importNode", "(", "plfChild", ",", "false", ")", ";", "parent", ".", "appendChild", "(", "copy", ")", ";", "// set the identifier for the doc if warrented", "String", "id", "=", "copy", ".", "getAttribute", "(", "Constants", ".", "ATT_ID", ")", ";", "if", "(", "id", "!=", "null", "&&", "!", "id", ".", "equals", "(", "\"\"", ")", ")", "copy", ".", "setIdAttribute", "(", "Constants", ".", "ATT_ID", ",", "true", ")", ";", "if", "(", "copyChildren", ")", "{", "NodeList", "children", "=", "plfChild", ".", "getChildNodes", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "children", ".", "getLength", "(", ")", ";", "i", "++", ")", "{", "if", "(", "children", ".", "item", "(", "i", ")", "instanceof", "Element", ")", "appendChild", "(", "(", "Element", ")", "children", ".", "item", "(", "i", ")", ",", "copy", ",", "true", ")", ";", "}", "}", "return", "copy", ";", "}"], "docstring": "This method copies a plf node and any of its children into the passed in compViewParent.", "docstring_tokens": ["This", "method", "copies", "a", "plf", "node", "and", "any", "of", "its", "children", "into", "the", "passed", "in", "compViewParent", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/PLFIntegrator.java#L208-L225", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-spring/src/main/java/org/apereo/portal/spring/web/context/support/PortalSessionScope.java", "func_name": "PortalSessionScope.get", "original_string": "@Override\n    public Object get(String name, ObjectFactory<?> objectFactory) {\n        final HttpSession session = this.getPortalSesion(true);\n\n        final Object sessionMutex = WebUtils.getSessionMutex(session);\n        synchronized (sessionMutex) {\n            Object scopedObject = session.getAttribute(name);\n            if (scopedObject == null) {\n                scopedObject = objectFactory.getObject();\n                session.setAttribute(name, scopedObject);\n            }\n\n            return scopedObject;\n        }\n    }", "language": "java", "code": "@Override\n    public Object get(String name, ObjectFactory<?> objectFactory) {\n        final HttpSession session = this.getPortalSesion(true);\n\n        final Object sessionMutex = WebUtils.getSessionMutex(session);\n        synchronized (sessionMutex) {\n            Object scopedObject = session.getAttribute(name);\n            if (scopedObject == null) {\n                scopedObject = objectFactory.getObject();\n                session.setAttribute(name, scopedObject);\n            }\n\n            return scopedObject;\n        }\n    }", "code_tokens": ["@", "Override", "public", "Object", "get", "(", "String", "name", ",", "ObjectFactory", "<", "?", ">", "objectFactory", ")", "{", "final", "HttpSession", "session", "=", "this", ".", "getPortalSesion", "(", "true", ")", ";", "final", "Object", "sessionMutex", "=", "WebUtils", ".", "getSessionMutex", "(", "session", ")", ";", "synchronized", "(", "sessionMutex", ")", "{", "Object", "scopedObject", "=", "session", ".", "getAttribute", "(", "name", ")", ";", "if", "(", "scopedObject", "==", "null", ")", "{", "scopedObject", "=", "objectFactory", ".", "getObject", "(", ")", ";", "session", ".", "setAttribute", "(", "name", ",", "scopedObject", ")", ";", "}", "return", "scopedObject", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.springframework.beans.factory.config.Scope#get(java.lang.String, org.springframework.beans.factory.ObjectFactory)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-spring/src/main/java/org/apereo/portal/spring/web/context/support/PortalSessionScope.java#L60-L74", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-spring/src/main/java/org/apereo/portal/spring/web/context/support/PortalSessionScope.java", "func_name": "PortalSessionScope.getConversationId", "original_string": "@Override\n    public String getConversationId() {\n        final HttpSession session = this.getPortalSesion(false);\n\n        if (session == null) {\n            return null;\n        }\n\n        return session.getId();\n    }", "language": "java", "code": "@Override\n    public String getConversationId() {\n        final HttpSession session = this.getPortalSesion(false);\n\n        if (session == null) {\n            return null;\n        }\n\n        return session.getId();\n    }", "code_tokens": ["@", "Override", "public", "String", "getConversationId", "(", ")", "{", "final", "HttpSession", "session", "=", "this", ".", "getPortalSesion", "(", "false", ")", ";", "if", "(", "session", "==", "null", ")", "{", "return", "null", ";", "}", "return", "session", ".", "getId", "(", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.springframework.beans.factory.config.Scope#getConversationId()", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-spring/src/main/java/org/apereo/portal/spring/web/context/support/PortalSessionScope.java#L79-L88", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-spring/src/main/java/org/apereo/portal/spring/web/context/support/PortalSessionScope.java", "func_name": "PortalSessionScope.registerDestructionCallback", "original_string": "@Override\n    public void registerDestructionCallback(String name, Runnable callback) {\n        final HttpSession session = this.getPortalSesion(true);\n        final DestructionCallbackBindingListener callbackListener =\n                new DestructionCallbackBindingListener(callback);\n        session.setAttribute(DESTRUCTION_CALLBACK_NAME_PREFIX + name, callbackListener);\n    }", "language": "java", "code": "@Override\n    public void registerDestructionCallback(String name, Runnable callback) {\n        final HttpSession session = this.getPortalSesion(true);\n        final DestructionCallbackBindingListener callbackListener =\n                new DestructionCallbackBindingListener(callback);\n        session.setAttribute(DESTRUCTION_CALLBACK_NAME_PREFIX + name, callbackListener);\n    }", "code_tokens": ["@", "Override", "public", "void", "registerDestructionCallback", "(", "String", "name", ",", "Runnable", "callback", ")", "{", "final", "HttpSession", "session", "=", "this", ".", "getPortalSesion", "(", "true", ")", ";", "final", "DestructionCallbackBindingListener", "callbackListener", "=", "new", "DestructionCallbackBindingListener", "(", "callback", ")", ";", "session", ".", "setAttribute", "(", "DESTRUCTION_CALLBACK_NAME_PREFIX", "+", "name", ",", "callbackListener", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.springframework.beans.factory.config.Scope#registerDestructionCallback(java.lang.String, java.lang.Runnable)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-spring/src/main/java/org/apereo/portal/spring/web/context/support/PortalSessionScope.java#L93-L99", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-spring/src/main/java/org/apereo/portal/spring/web/context/support/PortalSessionScope.java", "func_name": "PortalSessionScope.remove", "original_string": "@Override\n    public Object remove(String name) {\n        final HttpSession session = this.getPortalSesion(false);\n        if (session == null) {\n            return null;\n        }\n\n        final Object sessionMutex = WebUtils.getSessionMutex(session);\n        synchronized (sessionMutex) {\n            final Object attribute = session.getAttribute(name);\n            if (attribute != null) {\n                session.removeAttribute(name);\n            }\n\n            return attribute;\n        }\n    }", "language": "java", "code": "@Override\n    public Object remove(String name) {\n        final HttpSession session = this.getPortalSesion(false);\n        if (session == null) {\n            return null;\n        }\n\n        final Object sessionMutex = WebUtils.getSessionMutex(session);\n        synchronized (sessionMutex) {\n            final Object attribute = session.getAttribute(name);\n            if (attribute != null) {\n                session.removeAttribute(name);\n            }\n\n            return attribute;\n        }\n    }", "code_tokens": ["@", "Override", "public", "Object", "remove", "(", "String", "name", ")", "{", "final", "HttpSession", "session", "=", "this", ".", "getPortalSesion", "(", "false", ")", ";", "if", "(", "session", "==", "null", ")", "{", "return", "null", ";", "}", "final", "Object", "sessionMutex", "=", "WebUtils", ".", "getSessionMutex", "(", "session", ")", ";", "synchronized", "(", "sessionMutex", ")", "{", "final", "Object", "attribute", "=", "session", ".", "getAttribute", "(", "name", ")", ";", "if", "(", "attribute", "!=", "null", ")", "{", "session", ".", "removeAttribute", "(", "name", ")", ";", "}", "return", "attribute", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.springframework.beans.factory.config.Scope#remove(java.lang.String)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-spring/src/main/java/org/apereo/portal/spring/web/context/support/PortalSessionScope.java#L104-L120", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java", "func_name": "ReferenceEntityLockService.convert", "original_string": "@Override\n    public void convert(IEntityLock lock, int newType) throws LockingException {\n        convert(lock, newType, defaultLockPeriod);\n    }", "language": "java", "code": "@Override\n    public void convert(IEntityLock lock, int newType) throws LockingException {\n        convert(lock, newType, defaultLockPeriod);\n    }", "code_tokens": ["@", "Override", "public", "void", "convert", "(", "IEntityLock", "lock", ",", "int", "newType", ")", "throws", "LockingException", "{", "convert", "(", "lock", ",", "newType", ",", "defaultLockPeriod", ")", ";", "}"], "docstring": "Attempts to change the lock's <code>lockType</code> to <code>newType</code>.\n\n@param lock IEntityLock\n@param newType int\n@exception org.apereo.portal.concurrency.LockingException", "docstring_tokens": ["Attempts", "to", "change", "the", "lock", "s", "<code", ">", "lockType<", "/", "code", ">", "to", "<code", ">", "newType<", "/", "code", ">", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java#L63-L66", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java", "func_name": "ReferenceEntityLockService.convert", "original_string": "@Override\n    public void convert(IEntityLock lock, int newType, int newDuration) throws LockingException {\n        if (lock.getLockType() == newType) {\n            throw new LockingException(\n                    \"Could not convert \" + lock + \" : old and new lock TYPEs are the same.\");\n        }\n\n        if (!isValidLockType(newType)) {\n            throw new LockingException(\n                    \"Could not convert \" + lock + \" : lock TYPE \" + newType + \" is invalid.\");\n        }\n\n        if (!isValid(lock)) {\n            throw new LockingException(\"Could not convert \" + lock + \" : lock is invalid.\");\n        }\n\n        if (newType == WRITE_LOCK\n                && retrieveLocks(lock.getEntityType(), lock.getEntityKey(), null).length > 1) {\n            throw new LockingException(\n                    \"Could not convert \" + lock + \" : another lock already exists.\");\n        }\n\n        if (newType == READ_LOCK) {\n            /* Can always convert to READ */\n        }\n\n        Date newExpiration = getNewExpiration(newDuration);\n        getLockStore().update(lock, newExpiration, newType);\n        ((EntityLockImpl) lock).setLockType(newType);\n        ((EntityLockImpl) lock).setExpirationTime(newExpiration);\n    }", "language": "java", "code": "@Override\n    public void convert(IEntityLock lock, int newType, int newDuration) throws LockingException {\n        if (lock.getLockType() == newType) {\n            throw new LockingException(\n                    \"Could not convert \" + lock + \" : old and new lock TYPEs are the same.\");\n        }\n\n        if (!isValidLockType(newType)) {\n            throw new LockingException(\n                    \"Could not convert \" + lock + \" : lock TYPE \" + newType + \" is invalid.\");\n        }\n\n        if (!isValid(lock)) {\n            throw new LockingException(\"Could not convert \" + lock + \" : lock is invalid.\");\n        }\n\n        if (newType == WRITE_LOCK\n                && retrieveLocks(lock.getEntityType(), lock.getEntityKey(), null).length > 1) {\n            throw new LockingException(\n                    \"Could not convert \" + lock + \" : another lock already exists.\");\n        }\n\n        if (newType == READ_LOCK) {\n            /* Can always convert to READ */\n        }\n\n        Date newExpiration = getNewExpiration(newDuration);\n        getLockStore().update(lock, newExpiration, newType);\n        ((EntityLockImpl) lock).setLockType(newType);\n        ((EntityLockImpl) lock).setExpirationTime(newExpiration);\n    }", "code_tokens": ["@", "Override", "public", "void", "convert", "(", "IEntityLock", "lock", ",", "int", "newType", ",", "int", "newDuration", ")", "throws", "LockingException", "{", "if", "(", "lock", ".", "getLockType", "(", ")", "==", "newType", ")", "{", "throw", "new", "LockingException", "(", "\"Could not convert \"", "+", "lock", "+", "\" : old and new lock TYPEs are the same.\"", ")", ";", "}", "if", "(", "!", "isValidLockType", "(", "newType", ")", ")", "{", "throw", "new", "LockingException", "(", "\"Could not convert \"", "+", "lock", "+", "\" : lock TYPE \"", "+", "newType", "+", "\" is invalid.\"", ")", ";", "}", "if", "(", "!", "isValid", "(", "lock", ")", ")", "{", "throw", "new", "LockingException", "(", "\"Could not convert \"", "+", "lock", "+", "\" : lock is invalid.\"", ")", ";", "}", "if", "(", "newType", "==", "WRITE_LOCK", "&&", "retrieveLocks", "(", "lock", ".", "getEntityType", "(", ")", ",", "lock", ".", "getEntityKey", "(", ")", ",", "null", ")", ".", "length", ">", "1", ")", "{", "throw", "new", "LockingException", "(", "\"Could not convert \"", "+", "lock", "+", "\" : another lock already exists.\"", ")", ";", "}", "if", "(", "newType", "==", "READ_LOCK", ")", "{", "/* Can always convert to READ */", "}", "Date", "newExpiration", "=", "getNewExpiration", "(", "newDuration", ")", ";", "getLockStore", "(", ")", ".", "update", "(", "lock", ",", "newExpiration", ",", "newType", ")", ";", "(", "(", "EntityLockImpl", ")", "lock", ")", ".", "setLockType", "(", "newType", ")", ";", "(", "(", "EntityLockImpl", ")", "lock", ")", ".", "setExpirationTime", "(", "newExpiration", ")", ";", "}"], "docstring": "Attempts to change the lock's <code>lockType</code> to <code>newType</code>.\n\n@param lock IEntityLock\n@param newType int\n@param newDuration int\n@exception org.apereo.portal.concurrency.LockingException", "docstring_tokens": ["Attempts", "to", "change", "the", "lock", "s", "<code", ">", "lockType<", "/", "code", ">", "to", "<code", ">", "newType<", "/", "code", ">", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java#L75-L105", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java", "func_name": "ReferenceEntityLockService.existsInStore", "original_string": "@Override\n    public boolean existsInStore(IEntityLock lock) throws LockingException {\n        Class entityType = lock.getEntityType();\n        String key = lock.getEntityKey();\n        Integer lockType = lock.getLockType();\n        Date expiration = lock.getExpirationTime();\n        String owner = lock.getLockOwner();\n        IEntityLock[] lockArray = getLockStore().find(entityType, key, lockType, expiration, owner);\n\n        return (lockArray.length > 0);\n    }", "language": "java", "code": "@Override\n    public boolean existsInStore(IEntityLock lock) throws LockingException {\n        Class entityType = lock.getEntityType();\n        String key = lock.getEntityKey();\n        Integer lockType = lock.getLockType();\n        Date expiration = lock.getExpirationTime();\n        String owner = lock.getLockOwner();\n        IEntityLock[] lockArray = getLockStore().find(entityType, key, lockType, expiration, owner);\n\n        return (lockArray.length > 0);\n    }", "code_tokens": ["@", "Override", "public", "boolean", "existsInStore", "(", "IEntityLock", "lock", ")", "throws", "LockingException", "{", "Class", "entityType", "=", "lock", ".", "getEntityType", "(", ")", ";", "String", "key", "=", "lock", ".", "getEntityKey", "(", ")", ";", "Integer", "lockType", "=", "lock", ".", "getLockType", "(", ")", ";", "Date", "expiration", "=", "lock", ".", "getExpirationTime", "(", ")", ";", "String", "owner", "=", "lock", ".", "getLockOwner", "(", ")", ";", "IEntityLock", "[", "]", "lockArray", "=", "getLockStore", "(", ")", ".", "find", "(", "entityType", ",", "key", ",", "lockType", ",", "expiration", ",", "owner", ")", ";", "return", "(", "lockArray", ".", "length", ">", "0", ")", ";", "}"], "docstring": "Answer if this <code>IEntityLock</code> exists in the store.\n\n@param lock\n@return boolean", "docstring_tokens": ["Answer", "if", "this", "<code", ">", "IEntityLock<", "/", "code", ">", "exists", "in", "the", "store", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java#L113-L123", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java", "func_name": "ReferenceEntityLockService.isLocked", "original_string": "private boolean isLocked(Class entityType, String entityKey) throws LockingException {\n        return isLocked(entityType, entityKey, null);\n    }", "language": "java", "code": "private boolean isLocked(Class entityType, String entityKey) throws LockingException {\n        return isLocked(entityType, entityKey, null);\n    }", "code_tokens": ["private", "boolean", "isLocked", "(", "Class", "entityType", ",", "String", "entityKey", ")", "throws", "LockingException", "{", "return", "isLocked", "(", "entityType", ",", "entityKey", ",", "null", ")", ";", "}"], "docstring": "Answers if the entity represented by the entityType and entityKey already has a lock of some\ntype.\n\n@param entityType\n@param entityKey\n@exception org.apereo.portal.concurrency.LockingException", "docstring_tokens": ["Answers", "if", "the", "entity", "represented", "by", "the", "entityType", "and", "entityKey", "already", "has", "a", "lock", "of", "some", "type", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java#L190-L192", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java", "func_name": "ReferenceEntityLockService.isLocked", "original_string": "private boolean isLocked(Class entityType, String entityKey, Integer lockType)\n            throws LockingException {\n        IEntityLock[] locks = retrieveLocks(entityType, entityKey, lockType);\n        return locks.length > 0;\n    }", "language": "java", "code": "private boolean isLocked(Class entityType, String entityKey, Integer lockType)\n            throws LockingException {\n        IEntityLock[] locks = retrieveLocks(entityType, entityKey, lockType);\n        return locks.length > 0;\n    }", "code_tokens": ["private", "boolean", "isLocked", "(", "Class", "entityType", ",", "String", "entityKey", ",", "Integer", "lockType", ")", "throws", "LockingException", "{", "IEntityLock", "[", "]", "locks", "=", "retrieveLocks", "(", "entityType", ",", "entityKey", ",", "lockType", ")", ";", "return", "locks", ".", "length", ">", "0", ";", "}"], "docstring": "Answers if the entity represented by entityType and entityKey has one or more locks. Param\n<code>lockType</code> can be null.\n\n@param entityType\n@param entityKey\n@param lockType (optional)\n@exception org.apereo.portal.concurrency.LockingException", "docstring_tokens": ["Answers", "if", "the", "entity", "represented", "by", "entityType", "and", "entityKey", "has", "one", "or", "more", "locks", ".", "Param", "<code", ">", "lockType<", "/", "code", ">", "can", "be", "null", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java#L202-L206", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java", "func_name": "ReferenceEntityLockService.newLock", "original_string": "@Override\n    public IEntityLock newLock(Class entityType, String entityKey, int lockType, String owner)\n            throws LockingException {\n        return newLock(entityType, entityKey, lockType, owner, defaultLockPeriod);\n    }", "language": "java", "code": "@Override\n    public IEntityLock newLock(Class entityType, String entityKey, int lockType, String owner)\n            throws LockingException {\n        return newLock(entityType, entityKey, lockType, owner, defaultLockPeriod);\n    }", "code_tokens": ["@", "Override", "public", "IEntityLock", "newLock", "(", "Class", "entityType", ",", "String", "entityKey", ",", "int", "lockType", ",", "String", "owner", ")", "throws", "LockingException", "{", "return", "newLock", "(", "entityType", ",", "entityKey", ",", "lockType", ",", "owner", ",", "defaultLockPeriod", ")", ";", "}"], "docstring": "Returns a lock for the entity, lock type and owner if no conflicting locks exist.\n\n@param entityType\n@param entityKey\n@param lockType\n@param owner\n@return org.apereo.portal.groups.IEntityLock\n@exception LockingException", "docstring_tokens": ["Returns", "a", "lock", "for", "the", "entity", "lock", "type", "and", "owner", "if", "no", "conflicting", "locks", "exist", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java#L244-L248", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java", "func_name": "ReferenceEntityLockService.newLock", "original_string": "@Override\n    public IEntityLock newLock(\n            Class entityType, String entityKey, int lockType, String owner, int durationSecs)\n            throws LockingException {\n        int expirationSecs = durationSecs;\n        Date expires = getNewExpiration(expirationSecs);\n        IEntityLock newLock =\n                new EntityLockImpl(entityType, entityKey, lockType, expires, owner, this);\n\n        // retrieve potentially conflicting locks:\n        IEntityLock[] locks = retrieveLocks(entityType, entityKey, null);\n\n        if (lockType == WRITE_LOCK) {\n            if (locks.length > 0) {\n                throw new LockingException(\"Could not create lock: entity already locked.\");\n            }\n\n            getLockStore().add(newLock);\n\n            locks = retrieveLocks(entityType, entityKey, null);\n            if (locks.length > 1) // another lock snuck in\n            {\n                release(newLock);\n                throw new LockingException(\"Could not create lock: entity already locked.\");\n            }\n        } else // ( lockType == READ_LOCK )\n        {\n            for (int i = 0; i < locks.length; i++) {\n                if (locks[i].getLockType() == WRITE_LOCK) {\n                    throw new LockingException(\n                            \"Could not create lock: entity already write locked.\");\n                } else {\n                    if (locks[i].equals(newLock)) {\n                        // another read lock from the same owner; bump the expiration time.\n                        expirationSecs++;\n                        expires = getNewExpiration(expirationSecs);\n                        newLock =\n                                new EntityLockImpl(\n                                        entityType, entityKey, lockType, expires, owner, this);\n                    }\n                }\n            }\n            getLockStore().add(newLock);\n        }\n        return newLock;\n    }", "language": "java", "code": "@Override\n    public IEntityLock newLock(\n            Class entityType, String entityKey, int lockType, String owner, int durationSecs)\n            throws LockingException {\n        int expirationSecs = durationSecs;\n        Date expires = getNewExpiration(expirationSecs);\n        IEntityLock newLock =\n                new EntityLockImpl(entityType, entityKey, lockType, expires, owner, this);\n\n        // retrieve potentially conflicting locks:\n        IEntityLock[] locks = retrieveLocks(entityType, entityKey, null);\n\n        if (lockType == WRITE_LOCK) {\n            if (locks.length > 0) {\n                throw new LockingException(\"Could not create lock: entity already locked.\");\n            }\n\n            getLockStore().add(newLock);\n\n            locks = retrieveLocks(entityType, entityKey, null);\n            if (locks.length > 1) // another lock snuck in\n            {\n                release(newLock);\n                throw new LockingException(\"Could not create lock: entity already locked.\");\n            }\n        } else // ( lockType == READ_LOCK )\n        {\n            for (int i = 0; i < locks.length; i++) {\n                if (locks[i].getLockType() == WRITE_LOCK) {\n                    throw new LockingException(\n                            \"Could not create lock: entity already write locked.\");\n                } else {\n                    if (locks[i].equals(newLock)) {\n                        // another read lock from the same owner; bump the expiration time.\n                        expirationSecs++;\n                        expires = getNewExpiration(expirationSecs);\n                        newLock =\n                                new EntityLockImpl(\n                                        entityType, entityKey, lockType, expires, owner, this);\n                    }\n                }\n            }\n            getLockStore().add(newLock);\n        }\n        return newLock;\n    }", "code_tokens": ["@", "Override", "public", "IEntityLock", "newLock", "(", "Class", "entityType", ",", "String", "entityKey", ",", "int", "lockType", ",", "String", "owner", ",", "int", "durationSecs", ")", "throws", "LockingException", "{", "int", "expirationSecs", "=", "durationSecs", ";", "Date", "expires", "=", "getNewExpiration", "(", "expirationSecs", ")", ";", "IEntityLock", "newLock", "=", "new", "EntityLockImpl", "(", "entityType", ",", "entityKey", ",", "lockType", ",", "expires", ",", "owner", ",", "this", ")", ";", "// retrieve potentially conflicting locks:", "IEntityLock", "[", "]", "locks", "=", "retrieveLocks", "(", "entityType", ",", "entityKey", ",", "null", ")", ";", "if", "(", "lockType", "==", "WRITE_LOCK", ")", "{", "if", "(", "locks", ".", "length", ">", "0", ")", "{", "throw", "new", "LockingException", "(", "\"Could not create lock: entity already locked.\"", ")", ";", "}", "getLockStore", "(", ")", ".", "add", "(", "newLock", ")", ";", "locks", "=", "retrieveLocks", "(", "entityType", ",", "entityKey", ",", "null", ")", ";", "if", "(", "locks", ".", "length", ">", "1", ")", "// another lock snuck in", "{", "release", "(", "newLock", ")", ";", "throw", "new", "LockingException", "(", "\"Could not create lock: entity already locked.\"", ")", ";", "}", "}", "else", "// ( lockType == READ_LOCK )", "{", "for", "(", "int", "i", "=", "0", ";", "i", "<", "locks", ".", "length", ";", "i", "++", ")", "{", "if", "(", "locks", "[", "i", "]", ".", "getLockType", "(", ")", "==", "WRITE_LOCK", ")", "{", "throw", "new", "LockingException", "(", "\"Could not create lock: entity already write locked.\"", ")", ";", "}", "else", "{", "if", "(", "locks", "[", "i", "]", ".", "equals", "(", "newLock", ")", ")", "{", "// another read lock from the same owner; bump the expiration time.", "expirationSecs", "++", ";", "expires", "=", "getNewExpiration", "(", "expirationSecs", ")", ";", "newLock", "=", "new", "EntityLockImpl", "(", "entityType", ",", "entityKey", ",", "lockType", ",", "expires", ",", "owner", ",", "this", ")", ";", "}", "}", "}", "getLockStore", "(", ")", ".", "add", "(", "newLock", ")", ";", "}", "return", "newLock", ";", "}"], "docstring": "Returns a lock for the entity, lock type and owner if no conflicting locks exist.\n\n@param entityType\n@param entityKey\n@param lockType\n@param owner\n@param durationSecs\n@return org.apereo.portal.groups.IEntityLock\n@exception LockingException\n<p>Retrieves potentially conflicting locks and checks them before adding the new lock to\nthe store. The add of a write lock will fail if any other lock exists for the entity. The\nadd of a read lock will fail if a write lock exists for the entity. After we add a write\nlock we check the store a second time and roll back if any other lock has snuck in. I\nthink this is slightly safer than depending on the db isolation level for transactional\nintegrity.", "docstring_tokens": ["Returns", "a", "lock", "for", "the", "entity", "lock", "type", "and", "owner", "if", "no", "conflicting", "locks", "exist", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java#L267-L312", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java", "func_name": "ReferenceEntityLockService.newLock", "original_string": "@Override\n    public IEntityLock newLock(\n            EntityIdentifier entityID, int lockType, String owner, int durationSecs)\n            throws LockingException {\n        return newLock(entityID.getType(), entityID.getKey(), lockType, owner, durationSecs);\n    }", "language": "java", "code": "@Override\n    public IEntityLock newLock(\n            EntityIdentifier entityID, int lockType, String owner, int durationSecs)\n            throws LockingException {\n        return newLock(entityID.getType(), entityID.getKey(), lockType, owner, durationSecs);\n    }", "code_tokens": ["@", "Override", "public", "IEntityLock", "newLock", "(", "EntityIdentifier", "entityID", ",", "int", "lockType", ",", "String", "owner", ",", "int", "durationSecs", ")", "throws", "LockingException", "{", "return", "newLock", "(", "entityID", ".", "getType", "(", ")", ",", "entityID", ".", "getKey", "(", ")", ",", "lockType", ",", "owner", ",", "durationSecs", ")", ";", "}"], "docstring": "Returns a lock for the entity, lock type and owner if no conflicting locks exist.\n\n@return org.apereo.portal.groups.IEntityLock\n@param entityID org.apereo.portal.EntityIdentifier\n@param lockType int\n@param owner String\n@param durationSecs int\n@exception LockingException", "docstring_tokens": ["Returns", "a", "lock", "for", "the", "entity", "lock", "type", "and", "owner", "if", "no", "conflicting", "locks", "exist", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java#L337-L342", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java", "func_name": "ReferenceEntityLockService.release", "original_string": "@Override\n    public void release(IEntityLock lock) throws LockingException {\n        getLockStore().delete(lock);\n        ((EntityLockImpl) lock).setExpirationTime(new Date(0));\n    }", "language": "java", "code": "@Override\n    public void release(IEntityLock lock) throws LockingException {\n        getLockStore().delete(lock);\n        ((EntityLockImpl) lock).setExpirationTime(new Date(0));\n    }", "code_tokens": ["@", "Override", "public", "void", "release", "(", "IEntityLock", "lock", ")", "throws", "LockingException", "{", "getLockStore", "(", ")", ".", "delete", "(", "lock", ")", ";", "(", "(", "EntityLockImpl", ")", "lock", ")", ".", "setExpirationTime", "(", "new", "Date", "(", "0", ")", ")", ";", "}"], "docstring": "Releases the <code>IEntityLock</code>.\n\n@param lock IEntityLock\n@exception LockingException", "docstring_tokens": ["Releases", "the", "<code", ">", "IEntityLock<", "/", "code", ">", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java#L349-L353", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java", "func_name": "ReferenceEntityLockService.renew", "original_string": "@Override\n    public void renew(IEntityLock lock, int duration) throws LockingException {\n        if (isValid(lock)) {\n            Date newExpiration = getNewExpiration(duration);\n            getLockStore().update(lock, newExpiration);\n            ((EntityLockImpl) lock).setExpirationTime(newExpiration);\n        } else {\n            throw new LockingException(\"Could not renew \" + lock + \" : lock is invalid.\");\n        }\n    }", "language": "java", "code": "@Override\n    public void renew(IEntityLock lock, int duration) throws LockingException {\n        if (isValid(lock)) {\n            Date newExpiration = getNewExpiration(duration);\n            getLockStore().update(lock, newExpiration);\n            ((EntityLockImpl) lock).setExpirationTime(newExpiration);\n        } else {\n            throw new LockingException(\"Could not renew \" + lock + \" : lock is invalid.\");\n        }\n    }", "code_tokens": ["@", "Override", "public", "void", "renew", "(", "IEntityLock", "lock", ",", "int", "duration", ")", "throws", "LockingException", "{", "if", "(", "isValid", "(", "lock", ")", ")", "{", "Date", "newExpiration", "=", "getNewExpiration", "(", "duration", ")", ";", "getLockStore", "(", ")", ".", "update", "(", "lock", ",", "newExpiration", ")", ";", "(", "(", "EntityLockImpl", ")", "lock", ")", ".", "setExpirationTime", "(", "newExpiration", ")", ";", "}", "else", "{", "throw", "new", "LockingException", "(", "\"Could not renew \"", "+", "lock", "+", "\" : lock is invalid.\"", ")", ";", "}", "}"], "docstring": "Extends the expiration time of the lock by some service-defined increment.\n\n@param lock IEntityLock\n@exception LockingException", "docstring_tokens": ["Extends", "the", "expiration", "time", "of", "the", "lock", "by", "some", "service", "-", "defined", "increment", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java#L370-L379", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java", "func_name": "ReferenceEntityLockService.retrieveLocks", "original_string": "private IEntityLock[] retrieveLocks(Class entityType, String entityKey, Integer lockType)\n            throws LockingException {\n        Date expiration =\n                (multiServer)\n                        ? new Date(System.currentTimeMillis() - getLockToleranceMillis())\n                        : new Date();\n\n        return getLockStore().findUnexpired(expiration, entityType, entityKey, lockType, null);\n    }", "language": "java", "code": "private IEntityLock[] retrieveLocks(Class entityType, String entityKey, Integer lockType)\n            throws LockingException {\n        Date expiration =\n                (multiServer)\n                        ? new Date(System.currentTimeMillis() - getLockToleranceMillis())\n                        : new Date();\n\n        return getLockStore().findUnexpired(expiration, entityType, entityKey, lockType, null);\n    }", "code_tokens": ["private", "IEntityLock", "[", "]", "retrieveLocks", "(", "Class", "entityType", ",", "String", "entityKey", ",", "Integer", "lockType", ")", "throws", "LockingException", "{", "Date", "expiration", "=", "(", "multiServer", ")", "?", "new", "Date", "(", "System", ".", "currentTimeMillis", "(", ")", "-", "getLockToleranceMillis", "(", ")", ")", ":", "new", "Date", "(", ")", ";", "return", "getLockStore", "(", ")", ".", "findUnexpired", "(", "expiration", ",", "entityType", ",", "entityKey", ",", "lockType", ",", "null", ")", ";", "}"], "docstring": "Returns an IEntityLock[] containing unexpired locks for the entityType, entityKey and\nlockType. Param <code>lockType</code> can be null.\n\n@param entityType\n@param entityKey\n@param lockType (optional)\n@exception LockingException", "docstring_tokens": ["Returns", "an", "IEntityLock", "[]", "containing", "unexpired", "locks", "for", "the", "entityType", "entityKey", "and", "lockType", ".", "Param", "<code", ">", "lockType<", "/", "code", ">", "can", "be", "null", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/ReferenceEntityLockService.java#L389-L397", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/xml/crn/AbstractDom4jExporter.java", "func_name": "AbstractDom4jExporter.exportData", "original_string": "@Override\n    public Tuple<String, Element> exportData(String id) {\n        final Element node = this.exportDataElement(id);\n        if (node == null) {\n            return null;\n        }\n\n        return new Tuple<String, Element>(id, node);\n    }", "language": "java", "code": "@Override\n    public Tuple<String, Element> exportData(String id) {\n        final Element node = this.exportDataElement(id);\n        if (node == null) {\n            return null;\n        }\n\n        return new Tuple<String, Element>(id, node);\n    }", "code_tokens": ["@", "Override", "public", "Tuple", "<", "String", ",", "Element", ">", "exportData", "(", "String", "id", ")", "{", "final", "Element", "node", "=", "this", ".", "exportDataElement", "(", "id", ")", ";", "if", "(", "node", "==", "null", ")", "{", "return", "null", ";", "}", "return", "new", "Tuple", "<", "String", ",", "Element", ">", "(", "id", ",", "node", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.io.xml.IDataExporter#exportData(java.lang.String)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/xml/crn/AbstractDom4jExporter.java#L83-L91", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/xml/crn/AbstractDom4jExporter.java", "func_name": "AbstractDom4jExporter.getFileName", "original_string": "@Override\n    public String getFileName(Tuple<String, Element> data) {\n        return SafeFilenameUtils.makeSafeFilename(data.first);\n    }", "language": "java", "code": "@Override\n    public String getFileName(Tuple<String, Element> data) {\n        return SafeFilenameUtils.makeSafeFilename(data.first);\n    }", "code_tokens": ["@", "Override", "public", "String", "getFileName", "(", "Tuple", "<", "String", ",", "Element", ">", "data", ")", "{", "return", "SafeFilenameUtils", ".", "makeSafeFilename", "(", "data", ".", "first", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.io.xml.IDataExporter#getFileName(java.lang.Object)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/xml/crn/AbstractDom4jExporter.java#L98-L101", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/xml/crn/AbstractDom4jExporter.java", "func_name": "AbstractDom4jExporter.marshal", "original_string": "@Override\n    public void marshal(Object graph, Result result) throws IOException, XmlMappingException {\n        @SuppressWarnings(\"unchecked\")\n        final Tuple<String, Element> data = (Tuple<String, Element>) graph;\n\n        final Transformer transformer;\n        try {\n            transformer = this.xmlUtilities.getIdentityTransformer();\n        } catch (TransformerConfigurationException e) {\n            throw new RuntimeException(\"Failed to load identity Transformer\", e);\n        }\n\n        // Setup the transformer to pretty-print the output\n        transformer.setOutputProperty(OutputKeys.INDENT, \"yes\");\n        transformer.setOutputProperty(\"{http://xml.apache.org/xslt}indent-amount\", \"2\");\n\n        try {\n            transformer.transform(new DocumentSource(data.second), result);\n        } catch (TransformerException e) {\n            throw new RuntimeException(\"Failed to write Element to Result for: \" + data.first, e);\n        }\n    }", "language": "java", "code": "@Override\n    public void marshal(Object graph, Result result) throws IOException, XmlMappingException {\n        @SuppressWarnings(\"unchecked\")\n        final Tuple<String, Element> data = (Tuple<String, Element>) graph;\n\n        final Transformer transformer;\n        try {\n            transformer = this.xmlUtilities.getIdentityTransformer();\n        } catch (TransformerConfigurationException e) {\n            throw new RuntimeException(\"Failed to load identity Transformer\", e);\n        }\n\n        // Setup the transformer to pretty-print the output\n        transformer.setOutputProperty(OutputKeys.INDENT, \"yes\");\n        transformer.setOutputProperty(\"{http://xml.apache.org/xslt}indent-amount\", \"2\");\n\n        try {\n            transformer.transform(new DocumentSource(data.second), result);\n        } catch (TransformerException e) {\n            throw new RuntimeException(\"Failed to write Element to Result for: \" + data.first, e);\n        }\n    }", "code_tokens": ["@", "Override", "public", "void", "marshal", "(", "Object", "graph", ",", "Result", "result", ")", "throws", "IOException", ",", "XmlMappingException", "{", "@", "SuppressWarnings", "(", "\"unchecked\"", ")", "final", "Tuple", "<", "String", ",", "Element", ">", "data", "=", "(", "Tuple", "<", "String", ",", "Element", ">", ")", "graph", ";", "final", "Transformer", "transformer", ";", "try", "{", "transformer", "=", "this", ".", "xmlUtilities", ".", "getIdentityTransformer", "(", ")", ";", "}", "catch", "(", "TransformerConfigurationException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Failed to load identity Transformer\"", ",", "e", ")", ";", "}", "// Setup the transformer to pretty-print the output", "transformer", ".", "setOutputProperty", "(", "OutputKeys", ".", "INDENT", ",", "\"yes\"", ")", ";", "transformer", ".", "setOutputProperty", "(", "\"{http://xml.apache.org/xslt}indent-amount\"", ",", "\"2\"", ")", ";", "try", "{", "transformer", ".", "transform", "(", "new", "DocumentSource", "(", "data", ".", "second", ")", ",", "result", ")", ";", "}", "catch", "(", "TransformerException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Failed to write Element to Result for: \"", "+", "data", ".", "first", ",", "e", ")", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.springframework.oxm.Marshaller#marshal(java.lang.Object, javax.xml.transform.Result)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-types/src/main/java/org/apereo/portal/io/xml/crn/AbstractDom4jExporter.java#L122-L143", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/character/stream/PortletPlaceholderEventSource.java", "func_name": "PortletPlaceholderEventSource.generateCharacterEvents", "original_string": "protected void generateCharacterEvents(\n            IPortletWindowId portletWindowId,\n            XMLEventReader eventReader,\n            StartElement event,\n            Collection<CharacterEvent> eventBuffer)\n            throws XMLStreamException {\n        this.generateCharacterEvents(portletWindowId, event, eventBuffer);\n        this.readToEndElement(eventReader, event);\n    }", "language": "java", "code": "protected void generateCharacterEvents(\n            IPortletWindowId portletWindowId,\n            XMLEventReader eventReader,\n            StartElement event,\n            Collection<CharacterEvent> eventBuffer)\n            throws XMLStreamException {\n        this.generateCharacterEvents(portletWindowId, event, eventBuffer);\n        this.readToEndElement(eventReader, event);\n    }", "code_tokens": ["protected", "void", "generateCharacterEvents", "(", "IPortletWindowId", "portletWindowId", ",", "XMLEventReader", "eventReader", ",", "StartElement", "event", ",", "Collection", "<", "CharacterEvent", ">", "eventBuffer", ")", "throws", "XMLStreamException", "{", "this", ".", "generateCharacterEvents", "(", "portletWindowId", ",", "event", ",", "eventBuffer", ")", ";", "this", ".", "readToEndElement", "(", "eventReader", ",", "event", ")", ";", "}"], "docstring": "Implement to generate CharacterEvents based on a {@link StartElement} match. Allows the\nimplementation to read the contents of the placeholder element from the provided {@link\nXMLEventReader} if it needs additional info.\n\n<p>Default impl simply calls {@link #getCharacterEvents(IPortletWindowId, MatchResult)} then\n{@link #readToEndElement(XMLEventReader, StartElement)}", "docstring_tokens": ["Implement", "to", "generate", "CharacterEvents", "based", "on", "a", "{", "@link", "StartElement", "}", "match", ".", "Allows", "the", "implementation", "to", "read", "the", "contents", "of", "the", "placeholder", "element", "from", "the", "provided", "{", "@link", "XMLEventReader", "}", "if", "it", "needs", "additional", "info", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/character/stream/PortletPlaceholderEventSource.java#L83-L91", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/character/stream/PortletPlaceholderEventSource.java", "func_name": "PortletPlaceholderEventSource.generateCharacterEvents", "original_string": "protected void generateCharacterEvents(\n            IPortletWindowId portletWindowId,\n            StartElement event,\n            Collection<CharacterEvent> eventBuffer)\n            throws XMLStreamException {\n        throw new UnsupportedOperationException();\n    }", "language": "java", "code": "protected void generateCharacterEvents(\n            IPortletWindowId portletWindowId,\n            StartElement event,\n            Collection<CharacterEvent> eventBuffer)\n            throws XMLStreamException {\n        throw new UnsupportedOperationException();\n    }", "code_tokens": ["protected", "void", "generateCharacterEvents", "(", "IPortletWindowId", "portletWindowId", ",", "StartElement", "event", ",", "Collection", "<", "CharacterEvent", ">", "eventBuffer", ")", "throws", "XMLStreamException", "{", "throw", "new", "UnsupportedOperationException", "(", ")", ";", "}"], "docstring": "Implement to generate CharacterEvents based on a {@link StartElement} match. If not\nimplemented throws UnsupportedOperationException", "docstring_tokens": ["Implement", "to", "generate", "CharacterEvents", "based", "on", "a", "{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/character/stream/PortletPlaceholderEventSource.java#L97-L103", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java", "func_name": "PortletAdministrationHelper.createPortletDefinitionForm", "original_string": "public PortletDefinitionForm createPortletDefinitionForm(IPerson person, String portletId) {\n\n        IPortletDefinition def = portletDefinitionRegistry.getPortletDefinition(portletId);\n\n        // create the new form\n        final PortletDefinitionForm form;\n        if (def != null) {\n            // if this is a pre-existing portlet, set the category and permissions\n            form = new PortletDefinitionForm(def);\n            form.setId(def.getPortletDefinitionId().getStringId());\n\n            // create a JsonEntityBean for each current category and add it\n            // to our form bean's category list\n            Set<PortletCategory> categories = portletCategoryRegistry.getParentCategories(def);\n            for (PortletCategory cat : categories) {\n                form.addCategory(new JsonEntityBean(cat));\n            }\n\n            addPrincipalPermissionsToForm(def, form);\n        } else {\n            form = createNewPortletDefinitionForm();\n        }\n\n        /* TODO:  Service-Layer Security Reboot (great need of refactoring with a community-approved plan in place) */\n        // User must have SOME FORM of lifecycle permission over AT LEAST ONE\n        // category in which this portlet resides;  lifecycle permissions are\n        // hierarchical, so we'll test with the weakest.\n        if (!hasLifecyclePermission(person, PortletLifecycleState.CREATED, form.getCategories())) {\n            logger.warn(\n                    \"User '\"\n                            + person.getUserName()\n                            + \"' attempted to edit the following portlet without MANAGE permission:  \"\n                            + def);\n            throw new SecurityException(\"Not Authorized\");\n        }\n\n        return form;\n    }", "language": "java", "code": "public PortletDefinitionForm createPortletDefinitionForm(IPerson person, String portletId) {\n\n        IPortletDefinition def = portletDefinitionRegistry.getPortletDefinition(portletId);\n\n        // create the new form\n        final PortletDefinitionForm form;\n        if (def != null) {\n            // if this is a pre-existing portlet, set the category and permissions\n            form = new PortletDefinitionForm(def);\n            form.setId(def.getPortletDefinitionId().getStringId());\n\n            // create a JsonEntityBean for each current category and add it\n            // to our form bean's category list\n            Set<PortletCategory> categories = portletCategoryRegistry.getParentCategories(def);\n            for (PortletCategory cat : categories) {\n                form.addCategory(new JsonEntityBean(cat));\n            }\n\n            addPrincipalPermissionsToForm(def, form);\n        } else {\n            form = createNewPortletDefinitionForm();\n        }\n\n        /* TODO:  Service-Layer Security Reboot (great need of refactoring with a community-approved plan in place) */\n        // User must have SOME FORM of lifecycle permission over AT LEAST ONE\n        // category in which this portlet resides;  lifecycle permissions are\n        // hierarchical, so we'll test with the weakest.\n        if (!hasLifecyclePermission(person, PortletLifecycleState.CREATED, form.getCategories())) {\n            logger.warn(\n                    \"User '\"\n                            + person.getUserName()\n                            + \"' attempted to edit the following portlet without MANAGE permission:  \"\n                            + def);\n            throw new SecurityException(\"Not Authorized\");\n        }\n\n        return form;\n    }", "code_tokens": ["public", "PortletDefinitionForm", "createPortletDefinitionForm", "(", "IPerson", "person", ",", "String", "portletId", ")", "{", "IPortletDefinition", "def", "=", "portletDefinitionRegistry", ".", "getPortletDefinition", "(", "portletId", ")", ";", "// create the new form", "final", "PortletDefinitionForm", "form", ";", "if", "(", "def", "!=", "null", ")", "{", "// if this is a pre-existing portlet, set the category and permissions", "form", "=", "new", "PortletDefinitionForm", "(", "def", ")", ";", "form", ".", "setId", "(", "def", ".", "getPortletDefinitionId", "(", ")", ".", "getStringId", "(", ")", ")", ";", "// create a JsonEntityBean for each current category and add it", "// to our form bean's category list", "Set", "<", "PortletCategory", ">", "categories", "=", "portletCategoryRegistry", ".", "getParentCategories", "(", "def", ")", ";", "for", "(", "PortletCategory", "cat", ":", "categories", ")", "{", "form", ".", "addCategory", "(", "new", "JsonEntityBean", "(", "cat", ")", ")", ";", "}", "addPrincipalPermissionsToForm", "(", "def", ",", "form", ")", ";", "}", "else", "{", "form", "=", "createNewPortletDefinitionForm", "(", ")", ";", "}", "/* TODO:  Service-Layer Security Reboot (great need of refactoring with a community-approved plan in place) */", "// User must have SOME FORM of lifecycle permission over AT LEAST ONE", "// category in which this portlet resides;  lifecycle permissions are", "// hierarchical, so we'll test with the weakest.", "if", "(", "!", "hasLifecyclePermission", "(", "person", ",", "PortletLifecycleState", ".", "CREATED", ",", "form", ".", "getCategories", "(", ")", ")", ")", "{", "logger", ".", "warn", "(", "\"User '\"", "+", "person", ".", "getUserName", "(", ")", "+", "\"' attempted to edit the following portlet without MANAGE permission:  \"", "+", "def", ")", ";", "throw", "new", "SecurityException", "(", "\"Not Authorized\"", ")", ";", "}", "return", "form", ";", "}"], "docstring": "Construct a new PortletDefinitionForm for the given IPortletDefinition id. If a\nPortletDefinition matching this ID already exists, the form will be pre-populated with the\nPortletDefinition's current configuration. If the PortletDefinition does not yet exist, a new\ndefault form will be created.\n\n@param person user that is required to have related lifecycle permission\n@param portletId identifier for the portlet definition\n@return {@PortletDefinitionForm} with set values based on portlet definition or default\ncategory and principal if no definition is found", "docstring_tokens": ["Construct", "a", "new", "PortletDefinitionForm", "for", "the", "given", "IPortletDefinition", "id", ".", "If", "a", "PortletDefinition", "matching", "this", "ID", "already", "exists", "the", "form", "will", "be", "pre", "-", "populated", "with", "the", "PortletDefinition", "s", "current", "configuration", ".", "If", "the", "PortletDefinition", "does", "not", "yet", "exist", "a", "new", "default", "form", "will", "be", "created", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java#L179-L216", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java", "func_name": "PortletAdministrationHelper.addPrincipalPermissionsToForm", "original_string": "private void addPrincipalPermissionsToForm(IPortletDefinition def, PortletDefinitionForm form) {\n        final String portletTargetId = PermissionHelper.permissionTargetIdForPortletDefinition(def);\n\n        final Set<JsonEntityBean> principalBeans = new HashSet<>();\n        Map<String, IPermissionManager> permManagers = new HashMap<>();\n        for (PortletPermissionsOnForm perm : PortletPermissionsOnForm.values()) {\n            if (!permManagers.containsKey(perm.getOwner())) {\n                permManagers.put(\n                        perm.getOwner(),\n                        authorizationService.newPermissionManager(perm.getOwner()));\n            }\n            final IPermissionManager pm = permManagers.get(perm.getOwner());\n            /* Obtain the principals that have permission for the activity on this portlet */\n            final IAuthorizationPrincipal[] principals =\n                    pm.getAuthorizedPrincipals(perm.getActivity(), portletTargetId);\n\n            for (IAuthorizationPrincipal principal : principals) {\n                JsonEntityBean principalBean;\n\n                // first assume this is a group\n                final IEntityGroup group = GroupService.findGroup(principal.getKey());\n                if (group != null) {\n                    // principal is a group\n                    principalBean = new JsonEntityBean(group, EntityEnum.GROUP);\n                } else {\n                    // not a group, so it must be a person\n                    final IGroupMember member = authorizationService.getGroupMember(principal);\n                    principalBean = new JsonEntityBean(member, EntityEnum.PERSON);\n                    // set the name\n                    final String name = groupListHelper.lookupEntityName(principalBean);\n                    principalBean.setName(name);\n                }\n\n                principalBeans.add(principalBean);\n\n                form.addPermission(principalBean.getTypeAndIdHash() + \"_\" + perm.getActivity());\n            }\n        }\n        form.setPrincipals(principalBeans, false);\n    }", "language": "java", "code": "private void addPrincipalPermissionsToForm(IPortletDefinition def, PortletDefinitionForm form) {\n        final String portletTargetId = PermissionHelper.permissionTargetIdForPortletDefinition(def);\n\n        final Set<JsonEntityBean> principalBeans = new HashSet<>();\n        Map<String, IPermissionManager> permManagers = new HashMap<>();\n        for (PortletPermissionsOnForm perm : PortletPermissionsOnForm.values()) {\n            if (!permManagers.containsKey(perm.getOwner())) {\n                permManagers.put(\n                        perm.getOwner(),\n                        authorizationService.newPermissionManager(perm.getOwner()));\n            }\n            final IPermissionManager pm = permManagers.get(perm.getOwner());\n            /* Obtain the principals that have permission for the activity on this portlet */\n            final IAuthorizationPrincipal[] principals =\n                    pm.getAuthorizedPrincipals(perm.getActivity(), portletTargetId);\n\n            for (IAuthorizationPrincipal principal : principals) {\n                JsonEntityBean principalBean;\n\n                // first assume this is a group\n                final IEntityGroup group = GroupService.findGroup(principal.getKey());\n                if (group != null) {\n                    // principal is a group\n                    principalBean = new JsonEntityBean(group, EntityEnum.GROUP);\n                } else {\n                    // not a group, so it must be a person\n                    final IGroupMember member = authorizationService.getGroupMember(principal);\n                    principalBean = new JsonEntityBean(member, EntityEnum.PERSON);\n                    // set the name\n                    final String name = groupListHelper.lookupEntityName(principalBean);\n                    principalBean.setName(name);\n                }\n\n                principalBeans.add(principalBean);\n\n                form.addPermission(principalBean.getTypeAndIdHash() + \"_\" + perm.getActivity());\n            }\n        }\n        form.setPrincipals(principalBeans, false);\n    }", "code_tokens": ["private", "void", "addPrincipalPermissionsToForm", "(", "IPortletDefinition", "def", ",", "PortletDefinitionForm", "form", ")", "{", "final", "String", "portletTargetId", "=", "PermissionHelper", ".", "permissionTargetIdForPortletDefinition", "(", "def", ")", ";", "final", "Set", "<", "JsonEntityBean", ">", "principalBeans", "=", "new", "HashSet", "<>", "(", ")", ";", "Map", "<", "String", ",", "IPermissionManager", ">", "permManagers", "=", "new", "HashMap", "<>", "(", ")", ";", "for", "(", "PortletPermissionsOnForm", "perm", ":", "PortletPermissionsOnForm", ".", "values", "(", ")", ")", "{", "if", "(", "!", "permManagers", ".", "containsKey", "(", "perm", ".", "getOwner", "(", ")", ")", ")", "{", "permManagers", ".", "put", "(", "perm", ".", "getOwner", "(", ")", ",", "authorizationService", ".", "newPermissionManager", "(", "perm", ".", "getOwner", "(", ")", ")", ")", ";", "}", "final", "IPermissionManager", "pm", "=", "permManagers", ".", "get", "(", "perm", ".", "getOwner", "(", ")", ")", ";", "/* Obtain the principals that have permission for the activity on this portlet */", "final", "IAuthorizationPrincipal", "[", "]", "principals", "=", "pm", ".", "getAuthorizedPrincipals", "(", "perm", ".", "getActivity", "(", ")", ",", "portletTargetId", ")", ";", "for", "(", "IAuthorizationPrincipal", "principal", ":", "principals", ")", "{", "JsonEntityBean", "principalBean", ";", "// first assume this is a group", "final", "IEntityGroup", "group", "=", "GroupService", ".", "findGroup", "(", "principal", ".", "getKey", "(", ")", ")", ";", "if", "(", "group", "!=", "null", ")", "{", "// principal is a group", "principalBean", "=", "new", "JsonEntityBean", "(", "group", ",", "EntityEnum", ".", "GROUP", ")", ";", "}", "else", "{", "// not a group, so it must be a person", "final", "IGroupMember", "member", "=", "authorizationService", ".", "getGroupMember", "(", "principal", ")", ";", "principalBean", "=", "new", "JsonEntityBean", "(", "member", ",", "EntityEnum", ".", "PERSON", ")", ";", "// set the name", "final", "String", "name", "=", "groupListHelper", ".", "lookupEntityName", "(", "principalBean", ")", ";", "principalBean", ".", "setName", "(", "name", ")", ";", "}", "principalBeans", ".", "add", "(", "principalBean", ")", ";", "form", ".", "addPermission", "(", "principalBean", ".", "getTypeAndIdHash", "(", ")", "+", "\"_\"", "+", "perm", ".", "getActivity", "(", ")", ")", ";", "}", "}", "form", ".", "setPrincipals", "(", "principalBeans", ",", "false", ")", ";", "}"], "docstring": "/*\nAdd to the form SUBSCRIBE, BROWSE, and CONFIGURE activity permissions, along with their principals,\nassigned to the portlet.", "docstring_tokens": ["/", "*", "Add", "to", "the", "form", "SUBSCRIBE", "BROWSE", "and", "CONFIGURE", "activity", "permissions", "along", "with", "their", "principals", "assigned", "to", "the", "portlet", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java#L222-L261", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java", "func_name": "PortletAdministrationHelper.createNewPortletDefinitionForm", "original_string": "private PortletDefinitionForm createNewPortletDefinitionForm() {\n        final PortletDefinitionForm form = new PortletDefinitionForm();\n\n        // pre-populate with top-level category\n        final IEntityGroup portletCategoriesGroup =\n                GroupService.getDistinguishedGroup(IPortletDefinition.DISTINGUISHED_GROUP);\n        form.addCategory(\n                new JsonEntityBean(\n                        portletCategoriesGroup,\n                        groupListHelper.getEntityType(portletCategoriesGroup)));\n\n        // pre-populate with top-level group\n        final IEntityGroup everyoneGroup =\n                GroupService.getDistinguishedGroup(IPerson.DISTINGUISHED_GROUP);\n        final JsonEntityBean everyoneBean =\n                new JsonEntityBean(everyoneGroup, groupListHelper.getEntityType(everyoneGroup));\n        form.setPrincipals(Collections.singleton(everyoneBean), true);\n\n        return form;\n    }", "language": "java", "code": "private PortletDefinitionForm createNewPortletDefinitionForm() {\n        final PortletDefinitionForm form = new PortletDefinitionForm();\n\n        // pre-populate with top-level category\n        final IEntityGroup portletCategoriesGroup =\n                GroupService.getDistinguishedGroup(IPortletDefinition.DISTINGUISHED_GROUP);\n        form.addCategory(\n                new JsonEntityBean(\n                        portletCategoriesGroup,\n                        groupListHelper.getEntityType(portletCategoriesGroup)));\n\n        // pre-populate with top-level group\n        final IEntityGroup everyoneGroup =\n                GroupService.getDistinguishedGroup(IPerson.DISTINGUISHED_GROUP);\n        final JsonEntityBean everyoneBean =\n                new JsonEntityBean(everyoneGroup, groupListHelper.getEntityType(everyoneGroup));\n        form.setPrincipals(Collections.singleton(everyoneBean), true);\n\n        return form;\n    }", "code_tokens": ["private", "PortletDefinitionForm", "createNewPortletDefinitionForm", "(", ")", "{", "final", "PortletDefinitionForm", "form", "=", "new", "PortletDefinitionForm", "(", ")", ";", "// pre-populate with top-level category", "final", "IEntityGroup", "portletCategoriesGroup", "=", "GroupService", ".", "getDistinguishedGroup", "(", "IPortletDefinition", ".", "DISTINGUISHED_GROUP", ")", ";", "form", ".", "addCategory", "(", "new", "JsonEntityBean", "(", "portletCategoriesGroup", ",", "groupListHelper", ".", "getEntityType", "(", "portletCategoriesGroup", ")", ")", ")", ";", "// pre-populate with top-level group", "final", "IEntityGroup", "everyoneGroup", "=", "GroupService", ".", "getDistinguishedGroup", "(", "IPerson", ".", "DISTINGUISHED_GROUP", ")", ";", "final", "JsonEntityBean", "everyoneBean", "=", "new", "JsonEntityBean", "(", "everyoneGroup", ",", "groupListHelper", ".", "getEntityType", "(", "everyoneGroup", ")", ")", ";", "form", ".", "setPrincipals", "(", "Collections", ".", "singleton", "(", "everyoneBean", ")", ",", "true", ")", ";", "return", "form", ";", "}"], "docstring": "/*\nCreate a {@code PortletDefinitionForm} and pre-populate it with default categories and principal permissions.", "docstring_tokens": ["/", "*", "Create", "a", "{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java#L266-L285", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java", "func_name": "PortletAdministrationHelper.savePortletRegistration", "original_string": "public PortletDefinitionForm savePortletRegistration(\n            IPerson publisher, PortletDefinitionForm form) throws Exception {\n        logger.trace(\"In savePortletRegistration() - for: {}\", form.getPortletName());\n        /* TODO:  Service-Layer Security Reboot (great need of refactoring with a community-approved plan in place) */\n\n        // User must have the selected lifecycle permission over AT LEAST ONE\n        // category in which this portlet resides.  (This is the same check that\n        // is made when the user enters the lifecycle-selection step in the wizard.)\n        if (!hasLifecyclePermission(publisher, form.getLifecycleState(), form.getCategories())) {\n            logger.warn(\n                    \"User '\"\n                            + publisher.getUserName()\n                            + \"' attempted to save the following portlet without the selected MANAGE permission:  \"\n                            + form);\n            throw new SecurityException(\"Not Authorized\");\n        }\n\n        if (!form.isNew()) {\n            // User must have the previous lifecycle permission\n            // in AT LEAST ONE previous category as well\n            IPortletDefinition def =\n                    this.portletDefinitionRegistry.getPortletDefinition(form.getId());\n            Set<PortletCategory> categories = portletCategoryRegistry.getParentCategories(def);\n            SortedSet<JsonEntityBean> categoryBeans = new TreeSet<>();\n            for (PortletCategory cat : categories) {\n                categoryBeans.add(new JsonEntityBean(cat));\n            }\n            if (!hasLifecyclePermission(publisher, def.getLifecycleState(), categoryBeans)) {\n                logger.warn(\n                        \"User '\"\n                                + publisher.getUserName()\n                                + \"' attempted to save the following portlet without the previous MANAGE permission:  \"\n                                + form);\n                throw new SecurityException(\"Not Authorized\");\n            }\n        }\n\n        if (form.isNew()\n                || portletDefinitionRegistry.getPortletDefinition(form.getId()).getType().getId()\n                        != form.getTypeId()) {\n            // User must have access to the selected CPD if s/he selected it in this interaction\n            final int selectedTypeId = form.getTypeId();\n            final PortletPublishingDefinition cpd =\n                    portletPublishingDefinitionDao.getChannelPublishingDefinition(selectedTypeId);\n            final Map<IPortletType, PortletPublishingDefinition> allowableCpds =\n                    this.getAllowableChannelPublishingDefinitions(publisher);\n            if (!allowableCpds.containsValue(cpd)) {\n                logger.warn(\n                        \"User '\"\n                                + publisher.getUserName()\n                                + \"' attempted to administer the following portlet without the selected \"\n                                + IPermission.PORTLET_MANAGER_SELECT_PORTLET_TYPE\n                                + \" permission:  \"\n                                + form);\n                throw new SecurityException(\"Not Authorized\");\n            }\n        }\n\n        // create the principal array from the form's principal list -- only principals with\n        // permissions\n        final Set<IGroupMember> subscribePrincipalSet = new HashSet<>(form.getPrincipals().size());\n        final Set<IGroupMember> browsePrincipalSet = new HashSet<>(form.getPrincipals().size());\n        final Set<IGroupMember> configurePrincipalSet = new HashSet<>(form.getPrincipals().size());\n        for (JsonEntityBean bean : form.getPrincipals()) {\n            final String subscribePerm =\n                    bean.getTypeAndIdHash() + \"_\" + IPermission.PORTLET_SUBSCRIBER_ACTIVITY;\n            final String browsePerm =\n                    bean.getTypeAndIdHash() + \"_\" + IPermission.PORTLET_BROWSE_ACTIVITY;\n            final String configurePerm =\n                    bean.getTypeAndIdHash() + \"_\" + IPermission.PORTLET_MODE_CONFIG;\n            final EntityEnum entityEnum = bean.getEntityType();\n            final IGroupMember principal =\n                    entityEnum.isGroup()\n                            ? (GroupService.findGroup(bean.getId()))\n                            : (GroupService.getGroupMember(bean.getId(), entityEnum.getClazz()));\n            if (form.getPermissions().contains(subscribePerm)) {\n                logger.info(\n                        \"In savePortletRegistration() - Found a subscribePerm for principal: {}\",\n                        principal);\n                subscribePrincipalSet.add(principal);\n            }\n            if (form.getPermissions().contains(browsePerm)) {\n                logger.info(\n                        \"In savePortletRegistration() - Found a browsePerm for principal: {}\",\n                        principal);\n                browsePrincipalSet.add(principal);\n            }\n            if (form.getPermissions().contains(configurePerm)) {\n                logger.info(\n                        \"In savePortletRegistration() - Found a configurePerm for principal: {}\",\n                        principal);\n                configurePrincipalSet.add(principal);\n            }\n        }\n\n        // create the category list from the form's category bean list\n        List<PortletCategory> categories = new ArrayList<>();\n        for (JsonEntityBean category : form.getCategories()) {\n            String id = category.getId();\n            String iCatID = id.startsWith(\"cat\") ? id.substring(3) : id;\n            categories.add(portletCategoryRegistry.getPortletCategory(iCatID));\n        }\n\n        final IPortletType portletType = portletTypeRegistry.getPortletType(form.getTypeId());\n        if (portletType == null) {\n            throw new IllegalArgumentException(\"No IPortletType exists for ID \" + form.getTypeId());\n        }\n\n        IPortletDefinition portletDef;\n        if (form.getId() == null) {\n            portletDef =\n                    new PortletDefinitionImpl(\n                            portletType,\n                            form.getFname(),\n                            form.getName(),\n                            form.getTitle(),\n                            form.getApplicationId(),\n                            form.getPortletName(),\n                            form.isFramework());\n        } else {\n            portletDef = portletDefinitionRegistry.getPortletDefinition(form.getId());\n            portletDef.setType(portletType);\n            portletDef.setFName(form.getFname());\n            portletDef.setName(form.getName());\n            portletDef.setTitle(form.getTitle());\n            portletDef.getPortletDescriptorKey().setWebAppName(form.getApplicationId());\n            portletDef.getPortletDescriptorKey().setPortletName(form.getPortletName());\n            portletDef.getPortletDescriptorKey().setFrameworkPortlet(form.isFramework());\n        }\n        portletDef.setDescription(form.getDescription());\n        portletDef.setTimeout(form.getTimeout());\n\n        // Make parameters (NB:  these are different from preferences) in the\n        // portletDef reflect the state of the form, in case any have changed.\n        for (String key : form.getParameters().keySet()) {\n            String value = form.getParameters().get(key).getValue();\n            if (!StringUtils.isBlank(value)) {\n                portletDef.addParameter(key, value);\n            }\n        }\n        portletDef.addParameter(\n                IPortletDefinition.EDITABLE_PARAM, Boolean.toString(form.isEditable()));\n        portletDef.addParameter(\n                IPortletDefinition.CONFIGURABLE_PARAM, Boolean.toString(form.isConfigurable()));\n        portletDef.addParameter(\n                IPortletDefinition.HAS_HELP_PARAM, Boolean.toString(form.isHasHelp()));\n        portletDef.addParameter(\n                IPortletDefinition.HAS_ABOUT_PARAM, Boolean.toString(form.isHasAbout()));\n\n        // Now add portlet preferences\n        List<IPortletPreference> preferenceList = new ArrayList<>();\n        for (String key : form.getPortletPreferences().keySet()) {\n            List<String> prefValues = form.getPortletPreferences().get(key).getValue();\n            if (prefValues != null && prefValues.size() > 0) {\n                String[] values = prefValues.toArray(new String[prefValues.size()]);\n                BooleanAttribute readOnly = form.getPortletPreferenceReadOnly().get(key);\n                preferenceList.add(new PortletPreferenceImpl(key, readOnly.getValue(), values));\n            }\n        }\n        portletDef.setPortletPreferences(preferenceList);\n\n        // Lastly update the PortletDefinition's lifecycle state & lifecycle-related metadata\n        updateLifecycleState(form, portletDef, publisher);\n\n        // The final parameter of IGroupMembers is used to set the initial SUBSCRIBE permission set\n        portletPublishingService.savePortletDefinition(\n                portletDef, publisher, categories, new ArrayList<>(subscribePrincipalSet));\n        // updatePermissions(portletDef, subscribePrincipalSet,\n        // IPermission.PORTLET_SUBSCRIBER_ACTIVITY);\n        updatePermissions(\n                portletDef,\n                browsePrincipalSet,\n                IPermission.PORTAL_SUBSCRIBE,\n                IPermission.PORTLET_BROWSE_ACTIVITY);\n        updatePermissions(\n                portletDef,\n                configurePrincipalSet,\n                IPermission.PORTAL_PUBLISH,\n                IPermission.PORTLET_MODE_CONFIG);\n        return this.createPortletDefinitionForm(\n                publisher, portletDef.getPortletDefinitionId().getStringId());\n    }", "language": "java", "code": "public PortletDefinitionForm savePortletRegistration(\n            IPerson publisher, PortletDefinitionForm form) throws Exception {\n        logger.trace(\"In savePortletRegistration() - for: {}\", form.getPortletName());\n        /* TODO:  Service-Layer Security Reboot (great need of refactoring with a community-approved plan in place) */\n\n        // User must have the selected lifecycle permission over AT LEAST ONE\n        // category in which this portlet resides.  (This is the same check that\n        // is made when the user enters the lifecycle-selection step in the wizard.)\n        if (!hasLifecyclePermission(publisher, form.getLifecycleState(), form.getCategories())) {\n            logger.warn(\n                    \"User '\"\n                            + publisher.getUserName()\n                            + \"' attempted to save the following portlet without the selected MANAGE permission:  \"\n                            + form);\n            throw new SecurityException(\"Not Authorized\");\n        }\n\n        if (!form.isNew()) {\n            // User must have the previous lifecycle permission\n            // in AT LEAST ONE previous category as well\n            IPortletDefinition def =\n                    this.portletDefinitionRegistry.getPortletDefinition(form.getId());\n            Set<PortletCategory> categories = portletCategoryRegistry.getParentCategories(def);\n            SortedSet<JsonEntityBean> categoryBeans = new TreeSet<>();\n            for (PortletCategory cat : categories) {\n                categoryBeans.add(new JsonEntityBean(cat));\n            }\n            if (!hasLifecyclePermission(publisher, def.getLifecycleState(), categoryBeans)) {\n                logger.warn(\n                        \"User '\"\n                                + publisher.getUserName()\n                                + \"' attempted to save the following portlet without the previous MANAGE permission:  \"\n                                + form);\n                throw new SecurityException(\"Not Authorized\");\n            }\n        }\n\n        if (form.isNew()\n                || portletDefinitionRegistry.getPortletDefinition(form.getId()).getType().getId()\n                        != form.getTypeId()) {\n            // User must have access to the selected CPD if s/he selected it in this interaction\n            final int selectedTypeId = form.getTypeId();\n            final PortletPublishingDefinition cpd =\n                    portletPublishingDefinitionDao.getChannelPublishingDefinition(selectedTypeId);\n            final Map<IPortletType, PortletPublishingDefinition> allowableCpds =\n                    this.getAllowableChannelPublishingDefinitions(publisher);\n            if (!allowableCpds.containsValue(cpd)) {\n                logger.warn(\n                        \"User '\"\n                                + publisher.getUserName()\n                                + \"' attempted to administer the following portlet without the selected \"\n                                + IPermission.PORTLET_MANAGER_SELECT_PORTLET_TYPE\n                                + \" permission:  \"\n                                + form);\n                throw new SecurityException(\"Not Authorized\");\n            }\n        }\n\n        // create the principal array from the form's principal list -- only principals with\n        // permissions\n        final Set<IGroupMember> subscribePrincipalSet = new HashSet<>(form.getPrincipals().size());\n        final Set<IGroupMember> browsePrincipalSet = new HashSet<>(form.getPrincipals().size());\n        final Set<IGroupMember> configurePrincipalSet = new HashSet<>(form.getPrincipals().size());\n        for (JsonEntityBean bean : form.getPrincipals()) {\n            final String subscribePerm =\n                    bean.getTypeAndIdHash() + \"_\" + IPermission.PORTLET_SUBSCRIBER_ACTIVITY;\n            final String browsePerm =\n                    bean.getTypeAndIdHash() + \"_\" + IPermission.PORTLET_BROWSE_ACTIVITY;\n            final String configurePerm =\n                    bean.getTypeAndIdHash() + \"_\" + IPermission.PORTLET_MODE_CONFIG;\n            final EntityEnum entityEnum = bean.getEntityType();\n            final IGroupMember principal =\n                    entityEnum.isGroup()\n                            ? (GroupService.findGroup(bean.getId()))\n                            : (GroupService.getGroupMember(bean.getId(), entityEnum.getClazz()));\n            if (form.getPermissions().contains(subscribePerm)) {\n                logger.info(\n                        \"In savePortletRegistration() - Found a subscribePerm for principal: {}\",\n                        principal);\n                subscribePrincipalSet.add(principal);\n            }\n            if (form.getPermissions().contains(browsePerm)) {\n                logger.info(\n                        \"In savePortletRegistration() - Found a browsePerm for principal: {}\",\n                        principal);\n                browsePrincipalSet.add(principal);\n            }\n            if (form.getPermissions().contains(configurePerm)) {\n                logger.info(\n                        \"In savePortletRegistration() - Found a configurePerm for principal: {}\",\n                        principal);\n                configurePrincipalSet.add(principal);\n            }\n        }\n\n        // create the category list from the form's category bean list\n        List<PortletCategory> categories = new ArrayList<>();\n        for (JsonEntityBean category : form.getCategories()) {\n            String id = category.getId();\n            String iCatID = id.startsWith(\"cat\") ? id.substring(3) : id;\n            categories.add(portletCategoryRegistry.getPortletCategory(iCatID));\n        }\n\n        final IPortletType portletType = portletTypeRegistry.getPortletType(form.getTypeId());\n        if (portletType == null) {\n            throw new IllegalArgumentException(\"No IPortletType exists for ID \" + form.getTypeId());\n        }\n\n        IPortletDefinition portletDef;\n        if (form.getId() == null) {\n            portletDef =\n                    new PortletDefinitionImpl(\n                            portletType,\n                            form.getFname(),\n                            form.getName(),\n                            form.getTitle(),\n                            form.getApplicationId(),\n                            form.getPortletName(),\n                            form.isFramework());\n        } else {\n            portletDef = portletDefinitionRegistry.getPortletDefinition(form.getId());\n            portletDef.setType(portletType);\n            portletDef.setFName(form.getFname());\n            portletDef.setName(form.getName());\n            portletDef.setTitle(form.getTitle());\n            portletDef.getPortletDescriptorKey().setWebAppName(form.getApplicationId());\n            portletDef.getPortletDescriptorKey().setPortletName(form.getPortletName());\n            portletDef.getPortletDescriptorKey().setFrameworkPortlet(form.isFramework());\n        }\n        portletDef.setDescription(form.getDescription());\n        portletDef.setTimeout(form.getTimeout());\n\n        // Make parameters (NB:  these are different from preferences) in the\n        // portletDef reflect the state of the form, in case any have changed.\n        for (String key : form.getParameters().keySet()) {\n            String value = form.getParameters().get(key).getValue();\n            if (!StringUtils.isBlank(value)) {\n                portletDef.addParameter(key, value);\n            }\n        }\n        portletDef.addParameter(\n                IPortletDefinition.EDITABLE_PARAM, Boolean.toString(form.isEditable()));\n        portletDef.addParameter(\n                IPortletDefinition.CONFIGURABLE_PARAM, Boolean.toString(form.isConfigurable()));\n        portletDef.addParameter(\n                IPortletDefinition.HAS_HELP_PARAM, Boolean.toString(form.isHasHelp()));\n        portletDef.addParameter(\n                IPortletDefinition.HAS_ABOUT_PARAM, Boolean.toString(form.isHasAbout()));\n\n        // Now add portlet preferences\n        List<IPortletPreference> preferenceList = new ArrayList<>();\n        for (String key : form.getPortletPreferences().keySet()) {\n            List<String> prefValues = form.getPortletPreferences().get(key).getValue();\n            if (prefValues != null && prefValues.size() > 0) {\n                String[] values = prefValues.toArray(new String[prefValues.size()]);\n                BooleanAttribute readOnly = form.getPortletPreferenceReadOnly().get(key);\n                preferenceList.add(new PortletPreferenceImpl(key, readOnly.getValue(), values));\n            }\n        }\n        portletDef.setPortletPreferences(preferenceList);\n\n        // Lastly update the PortletDefinition's lifecycle state & lifecycle-related metadata\n        updateLifecycleState(form, portletDef, publisher);\n\n        // The final parameter of IGroupMembers is used to set the initial SUBSCRIBE permission set\n        portletPublishingService.savePortletDefinition(\n                portletDef, publisher, categories, new ArrayList<>(subscribePrincipalSet));\n        // updatePermissions(portletDef, subscribePrincipalSet,\n        // IPermission.PORTLET_SUBSCRIBER_ACTIVITY);\n        updatePermissions(\n                portletDef,\n                browsePrincipalSet,\n                IPermission.PORTAL_SUBSCRIBE,\n                IPermission.PORTLET_BROWSE_ACTIVITY);\n        updatePermissions(\n                portletDef,\n                configurePrincipalSet,\n                IPermission.PORTAL_PUBLISH,\n                IPermission.PORTLET_MODE_CONFIG);\n        return this.createPortletDefinitionForm(\n                publisher, portletDef.getPortletDefinitionId().getStringId());\n    }", "code_tokens": ["public", "PortletDefinitionForm", "savePortletRegistration", "(", "IPerson", "publisher", ",", "PortletDefinitionForm", "form", ")", "throws", "Exception", "{", "logger", ".", "trace", "(", "\"In savePortletRegistration() - for: {}\"", ",", "form", ".", "getPortletName", "(", ")", ")", ";", "/* TODO:  Service-Layer Security Reboot (great need of refactoring with a community-approved plan in place) */", "// User must have the selected lifecycle permission over AT LEAST ONE", "// category in which this portlet resides.  (This is the same check that", "// is made when the user enters the lifecycle-selection step in the wizard.)", "if", "(", "!", "hasLifecyclePermission", "(", "publisher", ",", "form", ".", "getLifecycleState", "(", ")", ",", "form", ".", "getCategories", "(", ")", ")", ")", "{", "logger", ".", "warn", "(", "\"User '\"", "+", "publisher", ".", "getUserName", "(", ")", "+", "\"' attempted to save the following portlet without the selected MANAGE permission:  \"", "+", "form", ")", ";", "throw", "new", "SecurityException", "(", "\"Not Authorized\"", ")", ";", "}", "if", "(", "!", "form", ".", "isNew", "(", ")", ")", "{", "// User must have the previous lifecycle permission", "// in AT LEAST ONE previous category as well", "IPortletDefinition", "def", "=", "this", ".", "portletDefinitionRegistry", ".", "getPortletDefinition", "(", "form", ".", "getId", "(", ")", ")", ";", "Set", "<", "PortletCategory", ">", "categories", "=", "portletCategoryRegistry", ".", "getParentCategories", "(", "def", ")", ";", "SortedSet", "<", "JsonEntityBean", ">", "categoryBeans", "=", "new", "TreeSet", "<>", "(", ")", ";", "for", "(", "PortletCategory", "cat", ":", "categories", ")", "{", "categoryBeans", ".", "add", "(", "new", "JsonEntityBean", "(", "cat", ")", ")", ";", "}", "if", "(", "!", "hasLifecyclePermission", "(", "publisher", ",", "def", ".", "getLifecycleState", "(", ")", ",", "categoryBeans", ")", ")", "{", "logger", ".", "warn", "(", "\"User '\"", "+", "publisher", ".", "getUserName", "(", ")", "+", "\"' attempted to save the following portlet without the previous MANAGE permission:  \"", "+", "form", ")", ";", "throw", "new", "SecurityException", "(", "\"Not Authorized\"", ")", ";", "}", "}", "if", "(", "form", ".", "isNew", "(", ")", "||", "portletDefinitionRegistry", ".", "getPortletDefinition", "(", "form", ".", "getId", "(", ")", ")", ".", "getType", "(", ")", ".", "getId", "(", ")", "!=", "form", ".", "getTypeId", "(", ")", ")", "{", "// User must have access to the selected CPD if s/he selected it in this interaction", "final", "int", "selectedTypeId", "=", "form", ".", "getTypeId", "(", ")", ";", "final", "PortletPublishingDefinition", "cpd", "=", "portletPublishingDefinitionDao", ".", "getChannelPublishingDefinition", "(", "selectedTypeId", ")", ";", "final", "Map", "<", "IPortletType", ",", "PortletPublishingDefinition", ">", "allowableCpds", "=", "this", ".", "getAllowableChannelPublishingDefinitions", "(", "publisher", ")", ";", "if", "(", "!", "allowableCpds", ".", "containsValue", "(", "cpd", ")", ")", "{", "logger", ".", "warn", "(", "\"User '\"", "+", "publisher", ".", "getUserName", "(", ")", "+", "\"' attempted to administer the following portlet without the selected \"", "+", "IPermission", ".", "PORTLET_MANAGER_SELECT_PORTLET_TYPE", "+", "\" permission:  \"", "+", "form", ")", ";", "throw", "new", "SecurityException", "(", "\"Not Authorized\"", ")", ";", "}", "}", "// create the principal array from the form's principal list -- only principals with", "// permissions", "final", "Set", "<", "IGroupMember", ">", "subscribePrincipalSet", "=", "new", "HashSet", "<>", "(", "form", ".", "getPrincipals", "(", ")", ".", "size", "(", ")", ")", ";", "final", "Set", "<", "IGroupMember", ">", "browsePrincipalSet", "=", "new", "HashSet", "<>", "(", "form", ".", "getPrincipals", "(", ")", ".", "size", "(", ")", ")", ";", "final", "Set", "<", "IGroupMember", ">", "configurePrincipalSet", "=", "new", "HashSet", "<>", "(", "form", ".", "getPrincipals", "(", ")", ".", "size", "(", ")", ")", ";", "for", "(", "JsonEntityBean", "bean", ":", "form", ".", "getPrincipals", "(", ")", ")", "{", "final", "String", "subscribePerm", "=", "bean", ".", "getTypeAndIdHash", "(", ")", "+", "\"_\"", "+", "IPermission", ".", "PORTLET_SUBSCRIBER_ACTIVITY", ";", "final", "String", "browsePerm", "=", "bean", ".", "getTypeAndIdHash", "(", ")", "+", "\"_\"", "+", "IPermission", ".", "PORTLET_BROWSE_ACTIVITY", ";", "final", "String", "configurePerm", "=", "bean", ".", "getTypeAndIdHash", "(", ")", "+", "\"_\"", "+", "IPermission", ".", "PORTLET_MODE_CONFIG", ";", "final", "EntityEnum", "entityEnum", "=", "bean", ".", "getEntityType", "(", ")", ";", "final", "IGroupMember", "principal", "=", "entityEnum", ".", "isGroup", "(", ")", "?", "(", "GroupService", ".", "findGroup", "(", "bean", ".", "getId", "(", ")", ")", ")", ":", "(", "GroupService", ".", "getGroupMember", "(", "bean", ".", "getId", "(", ")", ",", "entityEnum", ".", "getClazz", "(", ")", ")", ")", ";", "if", "(", "form", ".", "getPermissions", "(", ")", ".", "contains", "(", "subscribePerm", ")", ")", "{", "logger", ".", "info", "(", "\"In savePortletRegistration() - Found a subscribePerm for principal: {}\"", ",", "principal", ")", ";", "subscribePrincipalSet", ".", "add", "(", "principal", ")", ";", "}", "if", "(", "form", ".", "getPermissions", "(", ")", ".", "contains", "(", "browsePerm", ")", ")", "{", "logger", ".", "info", "(", "\"In savePortletRegistration() - Found a browsePerm for principal: {}\"", ",", "principal", ")", ";", "browsePrincipalSet", ".", "add", "(", "principal", ")", ";", "}", "if", "(", "form", ".", "getPermissions", "(", ")", ".", "contains", "(", "configurePerm", ")", ")", "{", "logger", ".", "info", "(", "\"In savePortletRegistration() - Found a configurePerm for principal: {}\"", ",", "principal", ")", ";", "configurePrincipalSet", ".", "add", "(", "principal", ")", ";", "}", "}", "// create the category list from the form's category bean list", "List", "<", "PortletCategory", ">", "categories", "=", "new", "ArrayList", "<>", "(", ")", ";", "for", "(", "JsonEntityBean", "category", ":", "form", ".", "getCategories", "(", ")", ")", "{", "String", "id", "=", "category", ".", "getId", "(", ")", ";", "String", "iCatID", "=", "id", ".", "startsWith", "(", "\"cat\"", ")", "?", "id", ".", "substring", "(", "3", ")", ":", "id", ";", "categories", ".", "add", "(", "portletCategoryRegistry", ".", "getPortletCategory", "(", "iCatID", ")", ")", ";", "}", "final", "IPortletType", "portletType", "=", "portletTypeRegistry", ".", "getPortletType", "(", "form", ".", "getTypeId", "(", ")", ")", ";", "if", "(", "portletType", "==", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"No IPortletType exists for ID \"", "+", "form", ".", "getTypeId", "(", ")", ")", ";", "}", "IPortletDefinition", "portletDef", ";", "if", "(", "form", ".", "getId", "(", ")", "==", "null", ")", "{", "portletDef", "=", "new", "PortletDefinitionImpl", "(", "portletType", ",", "form", ".", "getFname", "(", ")", ",", "form", ".", "getName", "(", ")", ",", "form", ".", "getTitle", "(", ")", ",", "form", ".", "getApplicationId", "(", ")", ",", "form", ".", "getPortletName", "(", ")", ",", "form", ".", "isFramework", "(", ")", ")", ";", "}", "else", "{", "portletDef", "=", "portletDefinitionRegistry", ".", "getPortletDefinition", "(", "form", ".", "getId", "(", ")", ")", ";", "portletDef", ".", "setType", "(", "portletType", ")", ";", "portletDef", ".", "setFName", "(", "form", ".", "getFname", "(", ")", ")", ";", "portletDef", ".", "setName", "(", "form", ".", "getName", "(", ")", ")", ";", "portletDef", ".", "setTitle", "(", "form", ".", "getTitle", "(", ")", ")", ";", "portletDef", ".", "getPortletDescriptorKey", "(", ")", ".", "setWebAppName", "(", "form", ".", "getApplicationId", "(", ")", ")", ";", "portletDef", ".", "getPortletDescriptorKey", "(", ")", ".", "setPortletName", "(", "form", ".", "getPortletName", "(", ")", ")", ";", "portletDef", ".", "getPortletDescriptorKey", "(", ")", ".", "setFrameworkPortlet", "(", "form", ".", "isFramework", "(", ")", ")", ";", "}", "portletDef", ".", "setDescription", "(", "form", ".", "getDescription", "(", ")", ")", ";", "portletDef", ".", "setTimeout", "(", "form", ".", "getTimeout", "(", ")", ")", ";", "// Make parameters (NB:  these are different from preferences) in the", "// portletDef reflect the state of the form, in case any have changed.", "for", "(", "String", "key", ":", "form", ".", "getParameters", "(", ")", ".", "keySet", "(", ")", ")", "{", "String", "value", "=", "form", ".", "getParameters", "(", ")", ".", "get", "(", "key", ")", ".", "getValue", "(", ")", ";", "if", "(", "!", "StringUtils", ".", "isBlank", "(", "value", ")", ")", "{", "portletDef", ".", "addParameter", "(", "key", ",", "value", ")", ";", "}", "}", "portletDef", ".", "addParameter", "(", "IPortletDefinition", ".", "EDITABLE_PARAM", ",", "Boolean", ".", "toString", "(", "form", ".", "isEditable", "(", ")", ")", ")", ";", "portletDef", ".", "addParameter", "(", "IPortletDefinition", ".", "CONFIGURABLE_PARAM", ",", "Boolean", ".", "toString", "(", "form", ".", "isConfigurable", "(", ")", ")", ")", ";", "portletDef", ".", "addParameter", "(", "IPortletDefinition", ".", "HAS_HELP_PARAM", ",", "Boolean", ".", "toString", "(", "form", ".", "isHasHelp", "(", ")", ")", ")", ";", "portletDef", ".", "addParameter", "(", "IPortletDefinition", ".", "HAS_ABOUT_PARAM", ",", "Boolean", ".", "toString", "(", "form", ".", "isHasAbout", "(", ")", ")", ")", ";", "// Now add portlet preferences", "List", "<", "IPortletPreference", ">", "preferenceList", "=", "new", "ArrayList", "<>", "(", ")", ";", "for", "(", "String", "key", ":", "form", ".", "getPortletPreferences", "(", ")", ".", "keySet", "(", ")", ")", "{", "List", "<", "String", ">", "prefValues", "=", "form", ".", "getPortletPreferences", "(", ")", ".", "get", "(", "key", ")", ".", "getValue", "(", ")", ";", "if", "(", "prefValues", "!=", "null", "&&", "prefValues", ".", "size", "(", ")", ">", "0", ")", "{", "String", "[", "]", "values", "=", "prefValues", ".", "toArray", "(", "new", "String", "[", "prefValues", ".", "size", "(", ")", "]", ")", ";", "BooleanAttribute", "readOnly", "=", "form", ".", "getPortletPreferenceReadOnly", "(", ")", ".", "get", "(", "key", ")", ";", "preferenceList", ".", "add", "(", "new", "PortletPreferenceImpl", "(", "key", ",", "readOnly", ".", "getValue", "(", ")", ",", "values", ")", ")", ";", "}", "}", "portletDef", ".", "setPortletPreferences", "(", "preferenceList", ")", ";", "// Lastly update the PortletDefinition's lifecycle state & lifecycle-related metadata", "updateLifecycleState", "(", "form", ",", "portletDef", ",", "publisher", ")", ";", "// The final parameter of IGroupMembers is used to set the initial SUBSCRIBE permission set", "portletPublishingService", ".", "savePortletDefinition", "(", "portletDef", ",", "publisher", ",", "categories", ",", "new", "ArrayList", "<>", "(", "subscribePrincipalSet", ")", ")", ";", "// updatePermissions(portletDef, subscribePrincipalSet,", "// IPermission.PORTLET_SUBSCRIBER_ACTIVITY);", "updatePermissions", "(", "portletDef", ",", "browsePrincipalSet", ",", "IPermission", ".", "PORTAL_SUBSCRIBE", ",", "IPermission", ".", "PORTLET_BROWSE_ACTIVITY", ")", ";", "updatePermissions", "(", "portletDef", ",", "configurePrincipalSet", ",", "IPermission", ".", "PORTAL_PUBLISH", ",", "IPermission", ".", "PORTLET_MODE_CONFIG", ")", ";", "return", "this", ".", "createPortletDefinitionForm", "(", "publisher", ",", "portletDef", ".", "getPortletDefinitionId", "(", ")", ".", "getStringId", "(", ")", ")", ";", "}"], "docstring": "Persist a new or edited PortletDefinition from a form, replacing existing values.\n\n@param publisher {@code IPerson} that requires permission to save this definition\n@param form form data to persist\n@return new {@code PortletDefinitionForm} for this portlet ID", "docstring_tokens": ["Persist", "a", "new", "or", "edited", "PortletDefinition", "from", "a", "form", "replacing", "existing", "values", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java#L294-L475", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java", "func_name": "PortletAdministrationHelper.updatePermissions", "original_string": "private void updatePermissions(\n            IPortletDefinition def,\n            Set<IGroupMember> newPrincipals,\n            String owner,\n            String activity) {\n        final String portletTargetId = PermissionHelper.permissionTargetIdForPortletDefinition(def);\n\n        final IUpdatingPermissionManager pm =\n                authorizationService.newUpdatingPermissionManager(owner);\n\n        /* Create the new permissions array */\n        final List<IPermission> newPermissions = new ArrayList<>();\n        for (final IGroupMember newPrincipal : newPrincipals) {\n            final IAuthorizationPrincipal authorizationPrincipal =\n                    authorizationService.newPrincipal(newPrincipal);\n            final IPermission permission = pm.newPermission(authorizationPrincipal);\n            permission.setType(IPermission.PERMISSION_TYPE_GRANT);\n            permission.setActivity(activity);\n            permission.setTarget(portletTargetId);\n            newPermissions.add(permission);\n            logger.trace(\"In updatePermissions() - adding a new permission of: {}\", permission);\n        }\n\n        /* Remove former permissions for this portlet / activity */\n        final IPermission[] oldPermissions = pm.getPermissions(activity, portletTargetId);\n        pm.removePermissions(oldPermissions);\n\n        /* Add the new permissions */\n        pm.addPermissions(newPermissions.toArray(new IPermission[newPermissions.size()]));\n    }", "language": "java", "code": "private void updatePermissions(\n            IPortletDefinition def,\n            Set<IGroupMember> newPrincipals,\n            String owner,\n            String activity) {\n        final String portletTargetId = PermissionHelper.permissionTargetIdForPortletDefinition(def);\n\n        final IUpdatingPermissionManager pm =\n                authorizationService.newUpdatingPermissionManager(owner);\n\n        /* Create the new permissions array */\n        final List<IPermission> newPermissions = new ArrayList<>();\n        for (final IGroupMember newPrincipal : newPrincipals) {\n            final IAuthorizationPrincipal authorizationPrincipal =\n                    authorizationService.newPrincipal(newPrincipal);\n            final IPermission permission = pm.newPermission(authorizationPrincipal);\n            permission.setType(IPermission.PERMISSION_TYPE_GRANT);\n            permission.setActivity(activity);\n            permission.setTarget(portletTargetId);\n            newPermissions.add(permission);\n            logger.trace(\"In updatePermissions() - adding a new permission of: {}\", permission);\n        }\n\n        /* Remove former permissions for this portlet / activity */\n        final IPermission[] oldPermissions = pm.getPermissions(activity, portletTargetId);\n        pm.removePermissions(oldPermissions);\n\n        /* Add the new permissions */\n        pm.addPermissions(newPermissions.toArray(new IPermission[newPermissions.size()]));\n    }", "code_tokens": ["private", "void", "updatePermissions", "(", "IPortletDefinition", "def", ",", "Set", "<", "IGroupMember", ">", "newPrincipals", ",", "String", "owner", ",", "String", "activity", ")", "{", "final", "String", "portletTargetId", "=", "PermissionHelper", ".", "permissionTargetIdForPortletDefinition", "(", "def", ")", ";", "final", "IUpdatingPermissionManager", "pm", "=", "authorizationService", ".", "newUpdatingPermissionManager", "(", "owner", ")", ";", "/* Create the new permissions array */", "final", "List", "<", "IPermission", ">", "newPermissions", "=", "new", "ArrayList", "<>", "(", ")", ";", "for", "(", "final", "IGroupMember", "newPrincipal", ":", "newPrincipals", ")", "{", "final", "IAuthorizationPrincipal", "authorizationPrincipal", "=", "authorizationService", ".", "newPrincipal", "(", "newPrincipal", ")", ";", "final", "IPermission", "permission", "=", "pm", ".", "newPermission", "(", "authorizationPrincipal", ")", ";", "permission", ".", "setType", "(", "IPermission", ".", "PERMISSION_TYPE_GRANT", ")", ";", "permission", ".", "setActivity", "(", "activity", ")", ";", "permission", ".", "setTarget", "(", "portletTargetId", ")", ";", "newPermissions", ".", "add", "(", "permission", ")", ";", "logger", ".", "trace", "(", "\"In updatePermissions() - adding a new permission of: {}\"", ",", "permission", ")", ";", "}", "/* Remove former permissions for this portlet / activity */", "final", "IPermission", "[", "]", "oldPermissions", "=", "pm", ".", "getPermissions", "(", "activity", ",", "portletTargetId", ")", ";", "pm", ".", "removePermissions", "(", "oldPermissions", ")", ";", "/* Add the new permissions */", "pm", ".", "addPermissions", "(", "newPermissions", ".", "toArray", "(", "new", "IPermission", "[", "newPermissions", ".", "size", "(", ")", "]", ")", ")", ";", "}"], "docstring": "/*\nUpdate permissions for a given owner, activity, and portlet definition combination. Adds new principals' permissions passed in and removes\nprincipals' permissions if not in the list for the given activity.", "docstring_tokens": ["/", "*", "Update", "permissions", "for", "a", "given", "owner", "activity", "and", "portlet", "definition", "combination", ".", "Adds", "new", "principals", "permissions", "passed", "in", "and", "removes", "principals", "permissions", "if", "not", "in", "the", "list", "for", "the", "given", "activity", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java#L481-L510", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java", "func_name": "PortletAdministrationHelper.removePortletRegistration", "original_string": "public void removePortletRegistration(IPerson person, PortletDefinitionForm form) {\n\n        /* TODO:  Service-Layer Security Reboot (great need of refactoring with a community-approved plan in place) */\n        // Arguably a check here is redundant since -- in the current\n        // portlet-manager webflow -- you can't get to this point in the\n        // conversation with out first obtaining a PortletDefinitionForm;  but\n        // it makes sense to check permissions here as well since the route(s)\n        // to reach this method could evolve in the future.\n\n        // Let's enforce the policy that you may only delete a portlet thet's\n        // currently in a lifecycle state you have permission to MANAGE.\n        // (They're hierarchical.)\n        if (!hasLifecyclePermission(person, form.getLifecycleState(), form.getCategories())) {\n            logger.warn(\n                    \"User '\"\n                            + person.getUserName()\n                            + \"' attempted to remove portlet '\"\n                            + form.getFname()\n                            + \"' without the proper MANAGE permission\");\n            throw new SecurityException(\"Not Authorized\");\n        }\n\n        IPortletDefinition def = portletDefinitionRegistry.getPortletDefinition(form.getId());\n        /*\n         * It's very important to remove portlets via the portletPublishingService\n         * because that API cleans up details like category memberships and permissions.\n         */\n        portletPublishingService.removePortletDefinition(def, person);\n    }", "language": "java", "code": "public void removePortletRegistration(IPerson person, PortletDefinitionForm form) {\n\n        /* TODO:  Service-Layer Security Reboot (great need of refactoring with a community-approved plan in place) */\n        // Arguably a check here is redundant since -- in the current\n        // portlet-manager webflow -- you can't get to this point in the\n        // conversation with out first obtaining a PortletDefinitionForm;  but\n        // it makes sense to check permissions here as well since the route(s)\n        // to reach this method could evolve in the future.\n\n        // Let's enforce the policy that you may only delete a portlet thet's\n        // currently in a lifecycle state you have permission to MANAGE.\n        // (They're hierarchical.)\n        if (!hasLifecyclePermission(person, form.getLifecycleState(), form.getCategories())) {\n            logger.warn(\n                    \"User '\"\n                            + person.getUserName()\n                            + \"' attempted to remove portlet '\"\n                            + form.getFname()\n                            + \"' without the proper MANAGE permission\");\n            throw new SecurityException(\"Not Authorized\");\n        }\n\n        IPortletDefinition def = portletDefinitionRegistry.getPortletDefinition(form.getId());\n        /*\n         * It's very important to remove portlets via the portletPublishingService\n         * because that API cleans up details like category memberships and permissions.\n         */\n        portletPublishingService.removePortletDefinition(def, person);\n    }", "code_tokens": ["public", "void", "removePortletRegistration", "(", "IPerson", "person", ",", "PortletDefinitionForm", "form", ")", "{", "/* TODO:  Service-Layer Security Reboot (great need of refactoring with a community-approved plan in place) */", "// Arguably a check here is redundant since -- in the current", "// portlet-manager webflow -- you can't get to this point in the", "// conversation with out first obtaining a PortletDefinitionForm;  but", "// it makes sense to check permissions here as well since the route(s)", "// to reach this method could evolve in the future.", "// Let's enforce the policy that you may only delete a portlet thet's", "// currently in a lifecycle state you have permission to MANAGE.", "// (They're hierarchical.)", "if", "(", "!", "hasLifecyclePermission", "(", "person", ",", "form", ".", "getLifecycleState", "(", ")", ",", "form", ".", "getCategories", "(", ")", ")", ")", "{", "logger", ".", "warn", "(", "\"User '\"", "+", "person", ".", "getUserName", "(", ")", "+", "\"' attempted to remove portlet '\"", "+", "form", ".", "getFname", "(", ")", "+", "\"' without the proper MANAGE permission\"", ")", ";", "throw", "new", "SecurityException", "(", "\"Not Authorized\"", ")", ";", "}", "IPortletDefinition", "def", "=", "portletDefinitionRegistry", ".", "getPortletDefinition", "(", "form", ".", "getId", "(", ")", ")", ";", "/*\n         * It's very important to remove portlets via the portletPublishingService\n         * because that API cleans up details like category memberships and permissions.\n         */", "portletPublishingService", ".", "removePortletDefinition", "(", "def", ",", "person", ")", ";", "}"], "docstring": "Delete the portlet with the given portlet ID.\n\n@param person the person removing the portlet\n@param form", "docstring_tokens": ["Delete", "the", "portlet", "with", "the", "given", "portlet", "ID", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java#L518-L546", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java", "func_name": "PortletAdministrationHelper.shouldDisplayLayoutLink", "original_string": "public boolean shouldDisplayLayoutLink(\n            IPerson person, PortletDefinitionForm form, String portletId) {\n        if (!form.isNew()) {\n            return false;\n        }\n\n        // only include the \"do layout\" link for published portlets.\n        if (form.getLifecycleState() != PortletLifecycleState.PUBLISHED) {\n            return false;\n        }\n\n        // check that the user can edit at least 1 fragment.\n        Map<String, String> layouts =\n                fragmentAdminHelper.getAuthorizedDlmFragments(person.getUserName());\n        if (layouts == null || layouts.isEmpty()) {\n            return false;\n        }\n\n        // check that the user has subscribe priv.\n        IAuthorizationPrincipal authPrincipal =\n                authorizationService.newPrincipal(\n                        person.getUserName(), EntityEnum.PERSON.getClazz());\n\n        return authPrincipal.canSubscribe(portletId);\n    }", "language": "java", "code": "public boolean shouldDisplayLayoutLink(\n            IPerson person, PortletDefinitionForm form, String portletId) {\n        if (!form.isNew()) {\n            return false;\n        }\n\n        // only include the \"do layout\" link for published portlets.\n        if (form.getLifecycleState() != PortletLifecycleState.PUBLISHED) {\n            return false;\n        }\n\n        // check that the user can edit at least 1 fragment.\n        Map<String, String> layouts =\n                fragmentAdminHelper.getAuthorizedDlmFragments(person.getUserName());\n        if (layouts == null || layouts.isEmpty()) {\n            return false;\n        }\n\n        // check that the user has subscribe priv.\n        IAuthorizationPrincipal authPrincipal =\n                authorizationService.newPrincipal(\n                        person.getUserName(), EntityEnum.PERSON.getClazz());\n\n        return authPrincipal.canSubscribe(portletId);\n    }", "code_tokens": ["public", "boolean", "shouldDisplayLayoutLink", "(", "IPerson", "person", ",", "PortletDefinitionForm", "form", ",", "String", "portletId", ")", "{", "if", "(", "!", "form", ".", "isNew", "(", ")", ")", "{", "return", "false", ";", "}", "// only include the \"do layout\" link for published portlets.", "if", "(", "form", ".", "getLifecycleState", "(", ")", "!=", "PortletLifecycleState", ".", "PUBLISHED", ")", "{", "return", "false", ";", "}", "// check that the user can edit at least 1 fragment.", "Map", "<", "String", ",", "String", ">", "layouts", "=", "fragmentAdminHelper", ".", "getAuthorizedDlmFragments", "(", "person", ".", "getUserName", "(", ")", ")", ";", "if", "(", "layouts", "==", "null", "||", "layouts", ".", "isEmpty", "(", ")", ")", "{", "return", "false", ";", "}", "// check that the user has subscribe priv.", "IAuthorizationPrincipal", "authPrincipal", "=", "authorizationService", ".", "newPrincipal", "(", "person", ".", "getUserName", "(", ")", ",", "EntityEnum", ".", "PERSON", ".", "getClazz", "(", ")", ")", ";", "return", "authPrincipal", ".", "canSubscribe", "(", "portletId", ")", ";", "}"], "docstring": "Check if the link to the Fragment admin portlet should display in the status message.\n\n<p>Checks that the portlet is new, that the portlet has been published and that the user has\nnecessary permissions to go to the fragment admin page.\n\n@param person the person publishing/editing the portlet\n@param form the portlet being editted\n@param portletId the id of the saved portlet\n@return true If all three conditions are met", "docstring_tokens": ["Check", "if", "the", "link", "to", "the", "Fragment", "admin", "portlet", "should", "display", "in", "the", "status", "message", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java#L559-L583", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java", "func_name": "PortletAdministrationHelper.getFragmentAdminURL", "original_string": "public String getFragmentAdminURL(HttpServletRequest request) {\n        IPortalUrlBuilder builder =\n                urlProvider.getPortalUrlBuilderByPortletFName(\n                        request, PORTLET_FNAME_FRAGMENT_ADMIN_PORTLET, UrlType.RENDER);\n        IPortletUrlBuilder portletUrlBuilder = builder.getTargetedPortletUrlBuilder();\n        portletUrlBuilder.setPortletMode(PortletMode.VIEW);\n        portletUrlBuilder.setWindowState(WindowState.MAXIMIZED);\n\n        return builder.getUrlString();\n    }", "language": "java", "code": "public String getFragmentAdminURL(HttpServletRequest request) {\n        IPortalUrlBuilder builder =\n                urlProvider.getPortalUrlBuilderByPortletFName(\n                        request, PORTLET_FNAME_FRAGMENT_ADMIN_PORTLET, UrlType.RENDER);\n        IPortletUrlBuilder portletUrlBuilder = builder.getTargetedPortletUrlBuilder();\n        portletUrlBuilder.setPortletMode(PortletMode.VIEW);\n        portletUrlBuilder.setWindowState(WindowState.MAXIMIZED);\n\n        return builder.getUrlString();\n    }", "code_tokens": ["public", "String", "getFragmentAdminURL", "(", "HttpServletRequest", "request", ")", "{", "IPortalUrlBuilder", "builder", "=", "urlProvider", ".", "getPortalUrlBuilderByPortletFName", "(", "request", ",", "PORTLET_FNAME_FRAGMENT_ADMIN_PORTLET", ",", "UrlType", ".", "RENDER", ")", ";", "IPortletUrlBuilder", "portletUrlBuilder", "=", "builder", ".", "getTargetedPortletUrlBuilder", "(", ")", ";", "portletUrlBuilder", ".", "setPortletMode", "(", "PortletMode", ".", "VIEW", ")", ";", "portletUrlBuilder", ".", "setWindowState", "(", "WindowState", ".", "MAXIMIZED", ")", ";", "return", "builder", ".", "getUrlString", "(", ")", ";", "}"], "docstring": "Get the link to the fragment admin portlet.\n\n@param request the current http request.\n@return the portlet link", "docstring_tokens": ["Get", "the", "link", "to", "the", "fragment", "admin", "portlet", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java#L591-L600", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java", "func_name": "PortletAdministrationHelper.getArbitraryPortletPreferenceNames", "original_string": "public Set<String> getArbitraryPortletPreferenceNames(PortletDefinitionForm form) {\n        // set default values for all portlet parameters\n        PortletPublishingDefinition cpd =\n                this.portletPublishingDefinitionDao.getChannelPublishingDefinition(\n                        form.getTypeId());\n        Set<String> currentPrefs = new HashSet<>();\n        currentPrefs.addAll(form.getPortletPreferences().keySet());\n        for (Step step : cpd.getSteps()) {\n            if (step.getPreferences() != null) {\n                for (Preference pref : step.getPreferences()) {\n                    currentPrefs.remove(pref.getName());\n                }\n            }\n        }\n        return currentPrefs;\n    }", "language": "java", "code": "public Set<String> getArbitraryPortletPreferenceNames(PortletDefinitionForm form) {\n        // set default values for all portlet parameters\n        PortletPublishingDefinition cpd =\n                this.portletPublishingDefinitionDao.getChannelPublishingDefinition(\n                        form.getTypeId());\n        Set<String> currentPrefs = new HashSet<>();\n        currentPrefs.addAll(form.getPortletPreferences().keySet());\n        for (Step step : cpd.getSteps()) {\n            if (step.getPreferences() != null) {\n                for (Preference pref : step.getPreferences()) {\n                    currentPrefs.remove(pref.getName());\n                }\n            }\n        }\n        return currentPrefs;\n    }", "code_tokens": ["public", "Set", "<", "String", ">", "getArbitraryPortletPreferenceNames", "(", "PortletDefinitionForm", "form", ")", "{", "// set default values for all portlet parameters", "PortletPublishingDefinition", "cpd", "=", "this", ".", "portletPublishingDefinitionDao", ".", "getChannelPublishingDefinition", "(", "form", ".", "getTypeId", "(", ")", ")", ";", "Set", "<", "String", ">", "currentPrefs", "=", "new", "HashSet", "<>", "(", ")", ";", "currentPrefs", ".", "addAll", "(", "form", ".", "getPortletPreferences", "(", ")", ".", "keySet", "(", ")", ")", ";", "for", "(", "Step", "step", ":", "cpd", ".", "getSteps", "(", ")", ")", "{", "if", "(", "step", ".", "getPreferences", "(", ")", "!=", "null", ")", "{", "for", "(", "Preference", "pref", ":", "step", ".", "getPreferences", "(", ")", ")", "{", "currentPrefs", ".", "remove", "(", "pref", ".", "getName", "(", ")", ")", ";", "}", "}", "}", "return", "currentPrefs", ";", "}"], "docstring": "Get a list of the key names of the currently-set arbitrary portlet preferences.\n\n@param form\n@return", "docstring_tokens": ["Get", "a", "list", "of", "the", "key", "names", "of", "the", "currently", "-", "set", "arbitrary", "portlet", "preferences", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java#L608-L623", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java", "func_name": "PortletAdministrationHelper.supportsConfigMode", "original_string": "public boolean supportsConfigMode(PortletDefinitionForm form) {\n        final Tuple<String, String> portletDescriptorKeys = this.getPortletDescriptorKeys(form);\n        if (portletDescriptorKeys == null) {\n            logger.trace(\"Unable to determine supportsConfig - portletDescriptorKeys is null.\");\n            return false;\n        }\n        final String portletAppId = portletDescriptorKeys.first;\n        final String portletName = portletDescriptorKeys.second;\n\n        final PortletRegistryService portletRegistryService =\n                this.portalDriverContainerServices.getPortletRegistryService();\n        final PortletDefinition portletDescriptor;\n        try {\n            portletDescriptor = portletRegistryService.getPortlet(portletAppId, portletName);\n        } catch (PortletContainerException e) {\n            this.logger.warn(\n                    \"Unable to determine supportsConfig - Failed to load portlet descriptor for appId='\"\n                            + portletAppId\n                            + \"', portletName='\"\n                            + portletName\n                            + \"'\",\n                    e);\n            return false;\n        }\n\n        if (portletDescriptor == null) {\n            logger.trace(\"Unable to determine supportsConfig - portletDescriptor is null.\");\n            return false;\n        }\n        logger.trace(\n                \"Checking supportsConfig for portlet ID=[{}] and Name=[{}].\",\n                portletAppId,\n                portletName);\n\n        // Iterate over supported portlet modes, this ignores the content types for now\n        final List<? extends Supports> supports = portletDescriptor.getSupports();\n        for (final Supports support : supports) {\n            logger.trace(\"Checking Supports instance:  {}\", support.getMimeType());\n            final List<String> portletModes = support.getPortletModes();\n            for (final String portletMode : portletModes) {\n                logger.trace(\"Checking portletMode {}.\", portletMode);\n                if (IPortletRenderer.CONFIG.equals(PortletUtils.getPortletMode(portletMode))) {\n                    logger.trace(\"Returning supportsConfig is true.\");\n                    return true;\n                }\n            }\n        }\n        logger.trace(\"Returning supportsConfig is false.\");\n        return false;\n    }", "language": "java", "code": "public boolean supportsConfigMode(PortletDefinitionForm form) {\n        final Tuple<String, String> portletDescriptorKeys = this.getPortletDescriptorKeys(form);\n        if (portletDescriptorKeys == null) {\n            logger.trace(\"Unable to determine supportsConfig - portletDescriptorKeys is null.\");\n            return false;\n        }\n        final String portletAppId = portletDescriptorKeys.first;\n        final String portletName = portletDescriptorKeys.second;\n\n        final PortletRegistryService portletRegistryService =\n                this.portalDriverContainerServices.getPortletRegistryService();\n        final PortletDefinition portletDescriptor;\n        try {\n            portletDescriptor = portletRegistryService.getPortlet(portletAppId, portletName);\n        } catch (PortletContainerException e) {\n            this.logger.warn(\n                    \"Unable to determine supportsConfig - Failed to load portlet descriptor for appId='\"\n                            + portletAppId\n                            + \"', portletName='\"\n                            + portletName\n                            + \"'\",\n                    e);\n            return false;\n        }\n\n        if (portletDescriptor == null) {\n            logger.trace(\"Unable to determine supportsConfig - portletDescriptor is null.\");\n            return false;\n        }\n        logger.trace(\n                \"Checking supportsConfig for portlet ID=[{}] and Name=[{}].\",\n                portletAppId,\n                portletName);\n\n        // Iterate over supported portlet modes, this ignores the content types for now\n        final List<? extends Supports> supports = portletDescriptor.getSupports();\n        for (final Supports support : supports) {\n            logger.trace(\"Checking Supports instance:  {}\", support.getMimeType());\n            final List<String> portletModes = support.getPortletModes();\n            for (final String portletMode : portletModes) {\n                logger.trace(\"Checking portletMode {}.\", portletMode);\n                if (IPortletRenderer.CONFIG.equals(PortletUtils.getPortletMode(portletMode))) {\n                    logger.trace(\"Returning supportsConfig is true.\");\n                    return true;\n                }\n            }\n        }\n        logger.trace(\"Returning supportsConfig is false.\");\n        return false;\n    }", "code_tokens": ["public", "boolean", "supportsConfigMode", "(", "PortletDefinitionForm", "form", ")", "{", "final", "Tuple", "<", "String", ",", "String", ">", "portletDescriptorKeys", "=", "this", ".", "getPortletDescriptorKeys", "(", "form", ")", ";", "if", "(", "portletDescriptorKeys", "==", "null", ")", "{", "logger", ".", "trace", "(", "\"Unable to determine supportsConfig - portletDescriptorKeys is null.\"", ")", ";", "return", "false", ";", "}", "final", "String", "portletAppId", "=", "portletDescriptorKeys", ".", "first", ";", "final", "String", "portletName", "=", "portletDescriptorKeys", ".", "second", ";", "final", "PortletRegistryService", "portletRegistryService", "=", "this", ".", "portalDriverContainerServices", ".", "getPortletRegistryService", "(", ")", ";", "final", "PortletDefinition", "portletDescriptor", ";", "try", "{", "portletDescriptor", "=", "portletRegistryService", ".", "getPortlet", "(", "portletAppId", ",", "portletName", ")", ";", "}", "catch", "(", "PortletContainerException", "e", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"Unable to determine supportsConfig - Failed to load portlet descriptor for appId='\"", "+", "portletAppId", "+", "\"', portletName='\"", "+", "portletName", "+", "\"'\"", ",", "e", ")", ";", "return", "false", ";", "}", "if", "(", "portletDescriptor", "==", "null", ")", "{", "logger", ".", "trace", "(", "\"Unable to determine supportsConfig - portletDescriptor is null.\"", ")", ";", "return", "false", ";", "}", "logger", ".", "trace", "(", "\"Checking supportsConfig for portlet ID=[{}] and Name=[{}].\"", ",", "portletAppId", ",", "portletName", ")", ";", "// Iterate over supported portlet modes, this ignores the content types for now", "final", "List", "<", "?", "extends", "Supports", ">", "supports", "=", "portletDescriptor", ".", "getSupports", "(", ")", ";", "for", "(", "final", "Supports", "support", ":", "supports", ")", "{", "logger", ".", "trace", "(", "\"Checking Supports instance:  {}\"", ",", "support", ".", "getMimeType", "(", ")", ")", ";", "final", "List", "<", "String", ">", "portletModes", "=", "support", ".", "getPortletModes", "(", ")", ";", "for", "(", "final", "String", "portletMode", ":", "portletModes", ")", "{", "logger", ".", "trace", "(", "\"Checking portletMode {}.\"", ",", "portletMode", ")", ";", "if", "(", "IPortletRenderer", ".", "CONFIG", ".", "equals", "(", "PortletUtils", ".", "getPortletMode", "(", "portletMode", ")", ")", ")", "{", "logger", ".", "trace", "(", "\"Returning supportsConfig is true.\"", ")", ";", "return", "true", ";", "}", "}", "}", "logger", ".", "trace", "(", "\"Returning supportsConfig is false.\"", ")", ";", "return", "false", ";", "}"], "docstring": "If the portlet is a portlet and if one of the supported portlet modes is {@link\nIPortletRenderer#CONFIG}", "docstring_tokens": ["If", "the", "portlet", "is", "a", "portlet", "and", "if", "one", "of", "the", "supported", "portlet", "modes", "is", "{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java#L629-L678", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java", "func_name": "PortletAdministrationHelper.getPortletApplications", "original_string": "public List<PortletApplicationDefinition> getPortletApplications() {\n        final PortletRegistryService portletRegistryService =\n                portalDriverContainerServices.getPortletRegistryService();\n        final List<PortletApplicationDefinition> contexts = new ArrayList<>();\n\n        for (final Iterator<String> iter =\n                        portletRegistryService.getRegisteredPortletApplicationNames();\n                iter.hasNext(); ) {\n            final String applicationName = iter.next();\n            final PortletApplicationDefinition applicationDefninition;\n            try {\n                applicationDefninition =\n                        portletRegistryService.getPortletApplication(applicationName);\n            } catch (PortletContainerException e) {\n                throw new RuntimeException(\n                        \"Failed to load PortletApplicationDefinition for '\"\n                                + applicationName\n                                + \"'\");\n            }\n\n            final List<? extends PortletDefinition> portlets = applicationDefninition.getPortlets();\n            portlets.sort(\n                    new ComparableExtractingComparator<PortletDefinition, String>(\n                            String.CASE_INSENSITIVE_ORDER) {\n                        @Override\n                        protected String getComparable(PortletDefinition o) {\n                            final List<? extends DisplayName> displayNames = o.getDisplayNames();\n                            if (displayNames != null && displayNames.size() > 0) {\n                                return displayNames.get(0).getDisplayName();\n                            }\n\n                            return o.getPortletName();\n                        }\n                    });\n\n            contexts.add(applicationDefninition);\n        }\n\n        contexts.sort(\n                new ComparableExtractingComparator<PortletApplicationDefinition, String>(\n                        String.CASE_INSENSITIVE_ORDER) {\n                    @Override\n                    protected String getComparable(PortletApplicationDefinition o) {\n                        final String portletContextName = o.getName();\n                        if (portletContextName != null) {\n                            return portletContextName;\n                        }\n\n                        final String applicationName = o.getContextPath();\n                        if (\"/\".equals(applicationName)) {\n                            return \"ROOT\";\n                        }\n\n                        if (applicationName.startsWith(\"/\")) {\n                            return applicationName.substring(1);\n                        }\n\n                        return applicationName;\n                    }\n                });\n        return contexts;\n    }", "language": "java", "code": "public List<PortletApplicationDefinition> getPortletApplications() {\n        final PortletRegistryService portletRegistryService =\n                portalDriverContainerServices.getPortletRegistryService();\n        final List<PortletApplicationDefinition> contexts = new ArrayList<>();\n\n        for (final Iterator<String> iter =\n                        portletRegistryService.getRegisteredPortletApplicationNames();\n                iter.hasNext(); ) {\n            final String applicationName = iter.next();\n            final PortletApplicationDefinition applicationDefninition;\n            try {\n                applicationDefninition =\n                        portletRegistryService.getPortletApplication(applicationName);\n            } catch (PortletContainerException e) {\n                throw new RuntimeException(\n                        \"Failed to load PortletApplicationDefinition for '\"\n                                + applicationName\n                                + \"'\");\n            }\n\n            final List<? extends PortletDefinition> portlets = applicationDefninition.getPortlets();\n            portlets.sort(\n                    new ComparableExtractingComparator<PortletDefinition, String>(\n                            String.CASE_INSENSITIVE_ORDER) {\n                        @Override\n                        protected String getComparable(PortletDefinition o) {\n                            final List<? extends DisplayName> displayNames = o.getDisplayNames();\n                            if (displayNames != null && displayNames.size() > 0) {\n                                return displayNames.get(0).getDisplayName();\n                            }\n\n                            return o.getPortletName();\n                        }\n                    });\n\n            contexts.add(applicationDefninition);\n        }\n\n        contexts.sort(\n                new ComparableExtractingComparator<PortletApplicationDefinition, String>(\n                        String.CASE_INSENSITIVE_ORDER) {\n                    @Override\n                    protected String getComparable(PortletApplicationDefinition o) {\n                        final String portletContextName = o.getName();\n                        if (portletContextName != null) {\n                            return portletContextName;\n                        }\n\n                        final String applicationName = o.getContextPath();\n                        if (\"/\".equals(applicationName)) {\n                            return \"ROOT\";\n                        }\n\n                        if (applicationName.startsWith(\"/\")) {\n                            return applicationName.substring(1);\n                        }\n\n                        return applicationName;\n                    }\n                });\n        return contexts;\n    }", "code_tokens": ["public", "List", "<", "PortletApplicationDefinition", ">", "getPortletApplications", "(", ")", "{", "final", "PortletRegistryService", "portletRegistryService", "=", "portalDriverContainerServices", ".", "getPortletRegistryService", "(", ")", ";", "final", "List", "<", "PortletApplicationDefinition", ">", "contexts", "=", "new", "ArrayList", "<>", "(", ")", ";", "for", "(", "final", "Iterator", "<", "String", ">", "iter", "=", "portletRegistryService", ".", "getRegisteredPortletApplicationNames", "(", ")", ";", "iter", ".", "hasNext", "(", ")", ";", ")", "{", "final", "String", "applicationName", "=", "iter", ".", "next", "(", ")", ";", "final", "PortletApplicationDefinition", "applicationDefninition", ";", "try", "{", "applicationDefninition", "=", "portletRegistryService", ".", "getPortletApplication", "(", "applicationName", ")", ";", "}", "catch", "(", "PortletContainerException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Failed to load PortletApplicationDefinition for '\"", "+", "applicationName", "+", "\"'\"", ")", ";", "}", "final", "List", "<", "?", "extends", "PortletDefinition", ">", "portlets", "=", "applicationDefninition", ".", "getPortlets", "(", ")", ";", "portlets", ".", "sort", "(", "new", "ComparableExtractingComparator", "<", "PortletDefinition", ",", "String", ">", "(", "String", ".", "CASE_INSENSITIVE_ORDER", ")", "{", "@", "Override", "protected", "String", "getComparable", "(", "PortletDefinition", "o", ")", "{", "final", "List", "<", "?", "extends", "DisplayName", ">", "displayNames", "=", "o", ".", "getDisplayNames", "(", ")", ";", "if", "(", "displayNames", "!=", "null", "&&", "displayNames", ".", "size", "(", ")", ">", "0", ")", "{", "return", "displayNames", ".", "get", "(", "0", ")", ".", "getDisplayName", "(", ")", ";", "}", "return", "o", ".", "getPortletName", "(", ")", ";", "}", "}", ")", ";", "contexts", ".", "add", "(", "applicationDefninition", ")", ";", "}", "contexts", ".", "sort", "(", "new", "ComparableExtractingComparator", "<", "PortletApplicationDefinition", ",", "String", ">", "(", "String", ".", "CASE_INSENSITIVE_ORDER", ")", "{", "@", "Override", "protected", "String", "getComparable", "(", "PortletApplicationDefinition", "o", ")", "{", "final", "String", "portletContextName", "=", "o", ".", "getName", "(", ")", ";", "if", "(", "portletContextName", "!=", "null", ")", "{", "return", "portletContextName", ";", "}", "final", "String", "applicationName", "=", "o", ".", "getContextPath", "(", ")", ";", "if", "(", "\"/\"", ".", "equals", "(", "applicationName", ")", ")", "{", "return", "\"ROOT\"", ";", "}", "if", "(", "applicationName", ".", "startsWith", "(", "\"/\"", ")", ")", "{", "return", "applicationName", ".", "substring", "(", "1", ")", ";", "}", "return", "applicationName", ";", "}", "}", ")", ";", "return", "contexts", ";", "}"], "docstring": "Retreive the list of portlet application contexts currently available in this portlet\ncontainer.\n\n@return list of portlet context", "docstring_tokens": ["Retreive", "the", "list", "of", "portlet", "application", "contexts", "currently", "available", "in", "this", "portlet", "container", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java#L830-L891", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java", "func_name": "PortletAdministrationHelper.getPortletDescriptor", "original_string": "public PortletDefinition getPortletDescriptor(PortletDefinitionForm form) {\n        final Tuple<String, String> portletDescriptorKeys = this.getPortletDescriptorKeys(form);\n        if (portletDescriptorKeys == null) {\n            return null;\n        }\n        final String portletAppId = portletDescriptorKeys.first;\n        final String portletName = portletDescriptorKeys.second;\n\n        final PortletRegistryService portletRegistryService =\n                portalDriverContainerServices.getPortletRegistryService();\n        try {\n            return portletRegistryService.getPortlet(portletAppId, portletName);\n        } catch (PortletContainerException e) {\n            e.printStackTrace();\n            return null;\n        }\n    }", "language": "java", "code": "public PortletDefinition getPortletDescriptor(PortletDefinitionForm form) {\n        final Tuple<String, String> portletDescriptorKeys = this.getPortletDescriptorKeys(form);\n        if (portletDescriptorKeys == null) {\n            return null;\n        }\n        final String portletAppId = portletDescriptorKeys.first;\n        final String portletName = portletDescriptorKeys.second;\n\n        final PortletRegistryService portletRegistryService =\n                portalDriverContainerServices.getPortletRegistryService();\n        try {\n            return portletRegistryService.getPortlet(portletAppId, portletName);\n        } catch (PortletContainerException e) {\n            e.printStackTrace();\n            return null;\n        }\n    }", "code_tokens": ["public", "PortletDefinition", "getPortletDescriptor", "(", "PortletDefinitionForm", "form", ")", "{", "final", "Tuple", "<", "String", ",", "String", ">", "portletDescriptorKeys", "=", "this", ".", "getPortletDescriptorKeys", "(", "form", ")", ";", "if", "(", "portletDescriptorKeys", "==", "null", ")", "{", "return", "null", ";", "}", "final", "String", "portletAppId", "=", "portletDescriptorKeys", ".", "first", ";", "final", "String", "portletName", "=", "portletDescriptorKeys", ".", "second", ";", "final", "PortletRegistryService", "portletRegistryService", "=", "portalDriverContainerServices", ".", "getPortletRegistryService", "(", ")", ";", "try", "{", "return", "portletRegistryService", ".", "getPortlet", "(", "portletAppId", ",", "portletName", ")", ";", "}", "catch", "(", "PortletContainerException", "e", ")", "{", "e", ".", "printStackTrace", "(", ")", ";", "return", "null", ";", "}", "}"], "docstring": "Get a portlet descriptor matching the current portlet definition form. If the current form\ndoes not represent a portlet, the application or portlet name fields are blank, or the\nportlet description cannot be retrieved, the method will return <code>null</code>.\n\n@param form\n@return", "docstring_tokens": ["Get", "a", "portlet", "descriptor", "matching", "the", "current", "portlet", "definition", "form", ".", "If", "the", "current", "form", "does", "not", "represent", "a", "portlet", "the", "application", "or", "portlet", "name", "fields", "are", "blank", "or", "the", "portlet", "description", "cannot", "be", "retrieved", "the", "method", "will", "return", "<code", ">", "null<", "/", "code", ">", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java#L901-L917", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java", "func_name": "PortletAdministrationHelper.loadDefaultsFromPortletDefinitionIfNew", "original_string": "public void loadDefaultsFromPortletDefinitionIfNew(PortletDefinitionForm form) {\n\n        if (!form.isNew()) {\n            // Get out;  we only prepopulate new portlets\n            return;\n        }\n\n        // appName/portletName must be set at this point\n        Validate.notBlank(form.getApplicationId(), \"ApplicationId not set\");\n        Validate.notBlank(form.getPortletName(), \"PortletName not set\");\n\n        final PortletRegistryService portletRegistryService =\n                portalDriverContainerServices.getPortletRegistryService();\n        final PortletDefinition portletDef;\n        try {\n            portletDef =\n                    portletRegistryService.getPortlet(\n                            form.getApplicationId(), form.getPortletName());\n        } catch (PortletContainerException e) {\n            this.logger.warn(\n                    \"Failed to load portlet descriptor for appId='\"\n                            + form.getApplicationId()\n                            + \"', portletName='\"\n                            + form.getPortletName()\n                            + \"'\",\n                    e);\n            return;\n        }\n\n        form.setTitle(portletDef.getPortletName());\n        form.setName(portletDef.getPortletName());\n        for (Supports supports : portletDef.getSupports()) {\n            for (String mode : supports.getPortletModes()) {\n                if (\"edit\".equalsIgnoreCase(mode)) {\n                    form.setEditable(true);\n                } else if (\"help\".equalsIgnoreCase(mode)) {\n                    form.setHasHelp(true);\n                } else if (\"config\".equalsIgnoreCase(mode)) {\n                    form.setConfigurable(true);\n                }\n            }\n        }\n    }", "language": "java", "code": "public void loadDefaultsFromPortletDefinitionIfNew(PortletDefinitionForm form) {\n\n        if (!form.isNew()) {\n            // Get out;  we only prepopulate new portlets\n            return;\n        }\n\n        // appName/portletName must be set at this point\n        Validate.notBlank(form.getApplicationId(), \"ApplicationId not set\");\n        Validate.notBlank(form.getPortletName(), \"PortletName not set\");\n\n        final PortletRegistryService portletRegistryService =\n                portalDriverContainerServices.getPortletRegistryService();\n        final PortletDefinition portletDef;\n        try {\n            portletDef =\n                    portletRegistryService.getPortlet(\n                            form.getApplicationId(), form.getPortletName());\n        } catch (PortletContainerException e) {\n            this.logger.warn(\n                    \"Failed to load portlet descriptor for appId='\"\n                            + form.getApplicationId()\n                            + \"', portletName='\"\n                            + form.getPortletName()\n                            + \"'\",\n                    e);\n            return;\n        }\n\n        form.setTitle(portletDef.getPortletName());\n        form.setName(portletDef.getPortletName());\n        for (Supports supports : portletDef.getSupports()) {\n            for (String mode : supports.getPortletModes()) {\n                if (\"edit\".equalsIgnoreCase(mode)) {\n                    form.setEditable(true);\n                } else if (\"help\".equalsIgnoreCase(mode)) {\n                    form.setHasHelp(true);\n                } else if (\"config\".equalsIgnoreCase(mode)) {\n                    form.setConfigurable(true);\n                }\n            }\n        }\n    }", "code_tokens": ["public", "void", "loadDefaultsFromPortletDefinitionIfNew", "(", "PortletDefinitionForm", "form", ")", "{", "if", "(", "!", "form", ".", "isNew", "(", ")", ")", "{", "// Get out;  we only prepopulate new portlets", "return", ";", "}", "// appName/portletName must be set at this point", "Validate", ".", "notBlank", "(", "form", ".", "getApplicationId", "(", ")", ",", "\"ApplicationId not set\"", ")", ";", "Validate", ".", "notBlank", "(", "form", ".", "getPortletName", "(", ")", ",", "\"PortletName not set\"", ")", ";", "final", "PortletRegistryService", "portletRegistryService", "=", "portalDriverContainerServices", ".", "getPortletRegistryService", "(", ")", ";", "final", "PortletDefinition", "portletDef", ";", "try", "{", "portletDef", "=", "portletRegistryService", ".", "getPortlet", "(", "form", ".", "getApplicationId", "(", ")", ",", "form", ".", "getPortletName", "(", ")", ")", ";", "}", "catch", "(", "PortletContainerException", "e", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"Failed to load portlet descriptor for appId='\"", "+", "form", ".", "getApplicationId", "(", ")", "+", "\"', portletName='\"", "+", "form", ".", "getPortletName", "(", ")", "+", "\"'\"", ",", "e", ")", ";", "return", ";", "}", "form", ".", "setTitle", "(", "portletDef", ".", "getPortletName", "(", ")", ")", ";", "form", ".", "setName", "(", "portletDef", ".", "getPortletName", "(", ")", ")", ";", "for", "(", "Supports", "supports", ":", "portletDef", ".", "getSupports", "(", ")", ")", "{", "for", "(", "String", "mode", ":", "supports", ".", "getPortletModes", "(", ")", ")", "{", "if", "(", "\"edit\"", ".", "equalsIgnoreCase", "(", "mode", ")", ")", "{", "form", ".", "setEditable", "(", "true", ")", ";", "}", "else", "if", "(", "\"help\"", ".", "equalsIgnoreCase", "(", "mode", ")", ")", "{", "form", ".", "setHasHelp", "(", "true", ")", ";", "}", "else", "if", "(", "\"config\"", ".", "equalsIgnoreCase", "(", "mode", ")", ")", "{", "form", ".", "setConfigurable", "(", "true", ")", ";", "}", "}", "}", "}"], "docstring": "Pre-populate a new {@link PortletDefinitionForm} with information from the {@link\nPortletDefinition}.\n\n@param form", "docstring_tokens": ["Pre", "-", "populate", "a", "new", "{", "@link", "PortletDefinitionForm", "}", "with", "information", "from", "the", "{", "@link", "PortletDefinition", "}", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java#L925-L967", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java", "func_name": "PortletAdministrationHelper.updateFormForSinglePortletType", "original_string": "public PortletPublishingDefinition updateFormForSinglePortletType(\n            Map<IPortletType, PortletPublishingDefinition> portletDefinitions,\n            PortletDefinitionForm form) {\n        if (portletDefinitions.size() != 1) {\n            return null;\n        }\n        IPortletType portletType = portletDefinitions.keySet().iterator().next();\n        form.setTypeId(portletType.getId());\n        PortletPublishingDefinition cpd =\n                portletPublishingDefinitionDao.getChannelPublishingDefinition(portletType.getId());\n        form.setChannelPublishingDefinition(cpd);\n\n        return cpd;\n    }", "language": "java", "code": "public PortletPublishingDefinition updateFormForSinglePortletType(\n            Map<IPortletType, PortletPublishingDefinition> portletDefinitions,\n            PortletDefinitionForm form) {\n        if (portletDefinitions.size() != 1) {\n            return null;\n        }\n        IPortletType portletType = portletDefinitions.keySet().iterator().next();\n        form.setTypeId(portletType.getId());\n        PortletPublishingDefinition cpd =\n                portletPublishingDefinitionDao.getChannelPublishingDefinition(portletType.getId());\n        form.setChannelPublishingDefinition(cpd);\n\n        return cpd;\n    }", "code_tokens": ["public", "PortletPublishingDefinition", "updateFormForSinglePortletType", "(", "Map", "<", "IPortletType", ",", "PortletPublishingDefinition", ">", "portletDefinitions", ",", "PortletDefinitionForm", "form", ")", "{", "if", "(", "portletDefinitions", ".", "size", "(", ")", "!=", "1", ")", "{", "return", "null", ";", "}", "IPortletType", "portletType", "=", "portletDefinitions", ".", "keySet", "(", ")", ".", "iterator", "(", ")", ".", "next", "(", ")", ";", "form", ".", "setTypeId", "(", "portletType", ".", "getId", "(", ")", ")", ";", "PortletPublishingDefinition", "cpd", "=", "portletPublishingDefinitionDao", ".", "getChannelPublishingDefinition", "(", "portletType", ".", "getId", "(", ")", ")", ";", "form", ".", "setChannelPublishingDefinition", "(", "cpd", ")", ";", "return", "cpd", ";", "}"], "docstring": "updates the editPortlet form with the portletType of the first (and only) portletDefinition\npassed in through the Map of portlet definitions.\n\n@param portletDefinitions\n@param form\n@return PortletPublishingDefinition of the first portlet definition in the list, null if the\nlist is empty or has more than one element.", "docstring_tokens": ["updates", "the", "editPortlet", "form", "with", "the", "portletType", "of", "the", "first", "(", "and", "only", ")", "portletDefinition", "passed", "in", "through", "the", "Map", "of", "portlet", "definitions", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/portletadmin/PortletAdministrationHelper.java#L1109-L1122", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/StringListAttribute.java", "func_name": "StringListAttribute.isBlank", "original_string": "public boolean isBlank() {\n        boolean rslt = true; // default\n        if (value != null) {\n            for (String v : value) {\n                if (StringUtils.isNotBlank(v)) {\n                    rslt = false;\n                    break;\n                }\n            }\n        }\n        return rslt;\n    }", "language": "java", "code": "public boolean isBlank() {\n        boolean rslt = true; // default\n        if (value != null) {\n            for (String v : value) {\n                if (StringUtils.isNotBlank(v)) {\n                    rslt = false;\n                    break;\n                }\n            }\n        }\n        return rslt;\n    }", "code_tokens": ["public", "boolean", "isBlank", "(", ")", "{", "boolean", "rslt", "=", "true", ";", "// default", "if", "(", "value", "!=", "null", ")", "{", "for", "(", "String", "v", ":", "value", ")", "{", "if", "(", "StringUtils", ".", "isNotBlank", "(", "v", ")", ")", "{", "rslt", "=", "false", ";", "break", ";", "}", "}", "}", "return", "rslt", ";", "}"], "docstring": "A {@link StringListAttribute} is considered blank <i>unless</i> it has at least one\nnon-zero-length, non-whitespace entry.\n\n@return", "docstring_tokens": ["A", "{", "@link", "StringListAttribute", "}", "is", "considered", "blank", "<i", ">", "unless<", "/", "i", ">", "it", "has", "at", "least", "one", "non", "-", "zero", "-", "length", "non", "-", "whitespace", "entry", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/StringListAttribute.java#L53-L64", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-xslt/src/main/java/org/apereo/portal/security/xslt/XalanGroupMembershipHelperBean.java", "func_name": "XalanGroupMembershipHelperBean.isChannelDeepMemberOf", "original_string": "@Override\n    public boolean isChannelDeepMemberOf(String fname, String groupKey) {\n        final IEntityGroup distinguishedGroup = GroupService.findGroup(groupKey);\n        if (distinguishedGroup == null) {\n            if (this.logger.isDebugEnabled()) {\n                this.logger.debug(\"No group found for key '\" + groupKey + \"'\");\n            }\n\n            return false;\n        }\n\n        final IPortletDefinition portletDefinition;\n        try {\n            portletDefinition = this.portletDefinitionRegistry.getPortletDefinitionByFname(fname);\n        } catch (Exception e) {\n            this.logger.warn(\n                    \"Caught exception while retrieving portlet definition for fname '\"\n                            + fname\n                            + \"'\",\n                    e);\n            return false;\n        }\n\n        if (portletDefinition == null) {\n            if (this.logger.isDebugEnabled()) {\n                this.logger.debug(\"No portlet found for key '\" + fname + \"'\");\n            }\n\n            return false;\n        }\n\n        final String portletId = portletDefinition.getPortletDefinitionId().getStringId();\n        final IEntity entity = GroupService.getEntity(portletId, IPortletDefinition.class);\n        if (entity == null) {\n            if (this.logger.isDebugEnabled()) {\n                this.logger.debug(\"No portlet found for id '\" + portletId + \"'\");\n            }\n\n            return false;\n        }\n\n        return distinguishedGroup.deepContains(entity);\n    }", "language": "java", "code": "@Override\n    public boolean isChannelDeepMemberOf(String fname, String groupKey) {\n        final IEntityGroup distinguishedGroup = GroupService.findGroup(groupKey);\n        if (distinguishedGroup == null) {\n            if (this.logger.isDebugEnabled()) {\n                this.logger.debug(\"No group found for key '\" + groupKey + \"'\");\n            }\n\n            return false;\n        }\n\n        final IPortletDefinition portletDefinition;\n        try {\n            portletDefinition = this.portletDefinitionRegistry.getPortletDefinitionByFname(fname);\n        } catch (Exception e) {\n            this.logger.warn(\n                    \"Caught exception while retrieving portlet definition for fname '\"\n                            + fname\n                            + \"'\",\n                    e);\n            return false;\n        }\n\n        if (portletDefinition == null) {\n            if (this.logger.isDebugEnabled()) {\n                this.logger.debug(\"No portlet found for key '\" + fname + \"'\");\n            }\n\n            return false;\n        }\n\n        final String portletId = portletDefinition.getPortletDefinitionId().getStringId();\n        final IEntity entity = GroupService.getEntity(portletId, IPortletDefinition.class);\n        if (entity == null) {\n            if (this.logger.isDebugEnabled()) {\n                this.logger.debug(\"No portlet found for id '\" + portletId + \"'\");\n            }\n\n            return false;\n        }\n\n        return distinguishedGroup.deepContains(entity);\n    }", "code_tokens": ["@", "Override", "public", "boolean", "isChannelDeepMemberOf", "(", "String", "fname", ",", "String", "groupKey", ")", "{", "final", "IEntityGroup", "distinguishedGroup", "=", "GroupService", ".", "findGroup", "(", "groupKey", ")", ";", "if", "(", "distinguishedGroup", "==", "null", ")", "{", "if", "(", "this", ".", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "this", ".", "logger", ".", "debug", "(", "\"No group found for key '\"", "+", "groupKey", "+", "\"'\"", ")", ";", "}", "return", "false", ";", "}", "final", "IPortletDefinition", "portletDefinition", ";", "try", "{", "portletDefinition", "=", "this", ".", "portletDefinitionRegistry", ".", "getPortletDefinitionByFname", "(", "fname", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"Caught exception while retrieving portlet definition for fname '\"", "+", "fname", "+", "\"'\"", ",", "e", ")", ";", "return", "false", ";", "}", "if", "(", "portletDefinition", "==", "null", ")", "{", "if", "(", "this", ".", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "this", ".", "logger", ".", "debug", "(", "\"No portlet found for key '\"", "+", "fname", "+", "\"'\"", ")", ";", "}", "return", "false", ";", "}", "final", "String", "portletId", "=", "portletDefinition", ".", "getPortletDefinitionId", "(", ")", ".", "getStringId", "(", ")", ";", "final", "IEntity", "entity", "=", "GroupService", ".", "getEntity", "(", "portletId", ",", "IPortletDefinition", ".", "class", ")", ";", "if", "(", "entity", "==", "null", ")", "{", "if", "(", "this", ".", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "this", ".", "logger", ".", "debug", "(", "\"No portlet found for id '\"", "+", "portletId", "+", "\"'\"", ")", ";", "}", "return", "false", ";", "}", "return", "distinguishedGroup", ".", "deepContains", "(", "entity", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.security.xslt.IXalanGroupMembershipHelper#isChannelDeepMemberOf(java.lang.String, java.lang.String)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-xslt/src/main/java/org/apereo/portal/security/xslt/XalanGroupMembershipHelperBean.java#L46-L88", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-xslt/src/main/java/org/apereo/portal/security/xslt/XalanGroupMembershipHelperBean.java", "func_name": "XalanGroupMembershipHelperBean.isUserDeepMemberOf", "original_string": "@Override\n    public boolean isUserDeepMemberOf(String userName, String groupKey) {\n        final IEntityGroup distinguishedGroup = GroupService.findGroup(groupKey);\n        if (distinguishedGroup == null) {\n            if (this.logger.isDebugEnabled()) {\n                this.logger.debug(\"No group found for key '\" + groupKey + \"'\");\n            }\n\n            return false;\n        }\n\n        final IEntity entity = GroupService.getEntity(userName, IPerson.class);\n        if (entity == null) {\n            if (this.logger.isDebugEnabled()) {\n                this.logger.debug(\"No user found for key '\" + userName + \"'\");\n            }\n\n            return false;\n        }\n\n        return distinguishedGroup.deepContains(entity);\n    }", "language": "java", "code": "@Override\n    public boolean isUserDeepMemberOf(String userName, String groupKey) {\n        final IEntityGroup distinguishedGroup = GroupService.findGroup(groupKey);\n        if (distinguishedGroup == null) {\n            if (this.logger.isDebugEnabled()) {\n                this.logger.debug(\"No group found for key '\" + groupKey + \"'\");\n            }\n\n            return false;\n        }\n\n        final IEntity entity = GroupService.getEntity(userName, IPerson.class);\n        if (entity == null) {\n            if (this.logger.isDebugEnabled()) {\n                this.logger.debug(\"No user found for key '\" + userName + \"'\");\n            }\n\n            return false;\n        }\n\n        return distinguishedGroup.deepContains(entity);\n    }", "code_tokens": ["@", "Override", "public", "boolean", "isUserDeepMemberOf", "(", "String", "userName", ",", "String", "groupKey", ")", "{", "final", "IEntityGroup", "distinguishedGroup", "=", "GroupService", ".", "findGroup", "(", "groupKey", ")", ";", "if", "(", "distinguishedGroup", "==", "null", ")", "{", "if", "(", "this", ".", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "this", ".", "logger", ".", "debug", "(", "\"No group found for key '\"", "+", "groupKey", "+", "\"'\"", ")", ";", "}", "return", "false", ";", "}", "final", "IEntity", "entity", "=", "GroupService", ".", "getEntity", "(", "userName", ",", "IPerson", ".", "class", ")", ";", "if", "(", "entity", "==", "null", ")", "{", "if", "(", "this", ".", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "this", ".", "logger", ".", "debug", "(", "\"No user found for key '\"", "+", "userName", "+", "\"'\"", ")", ";", "}", "return", "false", ";", "}", "return", "distinguishedGroup", ".", "deepContains", "(", "entity", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.security.xslt.IXalanGroupMembershipHelper#isUserDeepMemberOf(java.lang.String, java.lang.String)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-xslt/src/main/java/org/apereo/portal/security/xslt/XalanGroupMembershipHelperBean.java#L93-L114", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-xslt/src/main/java/org/apereo/portal/security/xslt/XalanGroupMembershipHelperBean.java", "func_name": "XalanGroupMembershipHelperBean.isUserDeepMemberOfGroupName", "original_string": "@Override\n    public boolean isUserDeepMemberOfGroupName(String userName, String groupName) {\n        final EntityIdentifier[] results =\n                GroupService.searchForGroups(\n                        groupName, GroupService.SearchMethod.DISCRETE, IPerson.class);\n        if (results == null || results.length == 0) {\n            return false;\n        }\n\n        if (results.length > 1) {\n            this.logger.warn(\n                    results.length\n                            + \" groups were found for '\"\n                            + groupName\n                            + \"'. The first result will be used.\");\n        }\n\n        final IGroupMember group = GroupService.getGroupMember(results[0]);\n\n        final IEntity entity = GroupService.getEntity(userName, IPerson.class);\n        if (entity == null) {\n            if (this.logger.isDebugEnabled()) {\n                this.logger.debug(\"No user found for key '\" + userName + \"'\");\n            }\n\n            return false;\n        }\n\n        return group.asGroup().deepContains(entity);\n    }", "language": "java", "code": "@Override\n    public boolean isUserDeepMemberOfGroupName(String userName, String groupName) {\n        final EntityIdentifier[] results =\n                GroupService.searchForGroups(\n                        groupName, GroupService.SearchMethod.DISCRETE, IPerson.class);\n        if (results == null || results.length == 0) {\n            return false;\n        }\n\n        if (results.length > 1) {\n            this.logger.warn(\n                    results.length\n                            + \" groups were found for '\"\n                            + groupName\n                            + \"'. The first result will be used.\");\n        }\n\n        final IGroupMember group = GroupService.getGroupMember(results[0]);\n\n        final IEntity entity = GroupService.getEntity(userName, IPerson.class);\n        if (entity == null) {\n            if (this.logger.isDebugEnabled()) {\n                this.logger.debug(\"No user found for key '\" + userName + \"'\");\n            }\n\n            return false;\n        }\n\n        return group.asGroup().deepContains(entity);\n    }", "code_tokens": ["@", "Override", "public", "boolean", "isUserDeepMemberOfGroupName", "(", "String", "userName", ",", "String", "groupName", ")", "{", "final", "EntityIdentifier", "[", "]", "results", "=", "GroupService", ".", "searchForGroups", "(", "groupName", ",", "GroupService", ".", "SearchMethod", ".", "DISCRETE", ",", "IPerson", ".", "class", ")", ";", "if", "(", "results", "==", "null", "||", "results", ".", "length", "==", "0", ")", "{", "return", "false", ";", "}", "if", "(", "results", ".", "length", ">", "1", ")", "{", "this", ".", "logger", ".", "warn", "(", "results", ".", "length", "+", "\" groups were found for '\"", "+", "groupName", "+", "\"'. The first result will be used.\"", ")", ";", "}", "final", "IGroupMember", "group", "=", "GroupService", ".", "getGroupMember", "(", "results", "[", "0", "]", ")", ";", "final", "IEntity", "entity", "=", "GroupService", ".", "getEntity", "(", "userName", ",", "IPerson", ".", "class", ")", ";", "if", "(", "entity", "==", "null", ")", "{", "if", "(", "this", ".", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "this", ".", "logger", ".", "debug", "(", "\"No user found for key '\"", "+", "userName", "+", "\"'\"", ")", ";", "}", "return", "false", ";", "}", "return", "group", ".", "asGroup", "(", ")", ".", "deepContains", "(", "entity", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.security.xslt.IXalanGroupMembershipHelper#isUserDeepMemberOfGroupName(java.lang.String, java.lang.String)\n\ngroupName is case sensitive.", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")", "@see", "org", ".", "apereo", ".", "portal", ".", "security", ".", "xslt", ".", "IXalanGroupMembershipHelper#isUserDeepMemberOfGroupName", "(", "java", ".", "lang", ".", "String", "java", ".", "lang", ".", "String", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-xslt/src/main/java/org/apereo/portal/security/xslt/XalanGroupMembershipHelperBean.java#L121-L150", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-url/src/main/java/org/apereo/portal/url/PortalHttpServletRequestWrapper.java", "func_name": "PortalHttpServletRequestWrapper.isUserInRole", "original_string": "@Override\n    public boolean isUserInRole(String role) {\n        if (super.getSession(false) == null) {\n            return super.isUserInRole(role);\n        }\n\n        // Check the wrapped request first\n        final boolean isUserInRole = super.isUserInRole(role);\n        if (isUserInRole) {\n            return true;\n        }\n\n        // Find the group for the role, if not found return false\n        IEntityGroup groupForRole = GroupService.findGroup(role);\n        if (groupForRole == null) {\n            final EntityIdentifier[] results =\n                    GroupService.searchForGroups(\n                            role, GroupService.SearchMethod.DISCRETE, IPerson.class);\n            if (results == null || results.length == 0) {\n                return false;\n            }\n\n            if (results.length > 1) {\n                this.logger.warn(\n                        results.length\n                                + \" groups were found for role '\"\n                                + role\n                                + \"'. The first result will be used.\");\n            }\n\n            IGroupMember member = GroupService.getGroupMember(results[0]);\n            if (member == null || !member.isGroup()) {\n                return false;\n            }\n            groupForRole = member.asGroup();\n        }\n\n        // Load the group information about the current user\n        final IUserInstance userInstance =\n                this.userInstanceManager.getUserInstance(this.getWrappedRequest());\n        final IPerson person = userInstance.getPerson();\n        final EntityIdentifier personEntityId = person.getEntityIdentifier();\n        final IGroupMember personGroupMember = GroupService.getGroupMember(personEntityId);\n\n        final boolean rslt = personGroupMember.isDeepMemberOf(groupForRole);\n        logger.trace(\n                \"Answering {} for isUserInRole where user='{}', role='{}', and groupForRole='{}'\",\n                rslt,\n                person.getUserName(),\n                role,\n                groupForRole.getName());\n        return rslt;\n    }", "language": "java", "code": "@Override\n    public boolean isUserInRole(String role) {\n        if (super.getSession(false) == null) {\n            return super.isUserInRole(role);\n        }\n\n        // Check the wrapped request first\n        final boolean isUserInRole = super.isUserInRole(role);\n        if (isUserInRole) {\n            return true;\n        }\n\n        // Find the group for the role, if not found return false\n        IEntityGroup groupForRole = GroupService.findGroup(role);\n        if (groupForRole == null) {\n            final EntityIdentifier[] results =\n                    GroupService.searchForGroups(\n                            role, GroupService.SearchMethod.DISCRETE, IPerson.class);\n            if (results == null || results.length == 0) {\n                return false;\n            }\n\n            if (results.length > 1) {\n                this.logger.warn(\n                        results.length\n                                + \" groups were found for role '\"\n                                + role\n                                + \"'. The first result will be used.\");\n            }\n\n            IGroupMember member = GroupService.getGroupMember(results[0]);\n            if (member == null || !member.isGroup()) {\n                return false;\n            }\n            groupForRole = member.asGroup();\n        }\n\n        // Load the group information about the current user\n        final IUserInstance userInstance =\n                this.userInstanceManager.getUserInstance(this.getWrappedRequest());\n        final IPerson person = userInstance.getPerson();\n        final EntityIdentifier personEntityId = person.getEntityIdentifier();\n        final IGroupMember personGroupMember = GroupService.getGroupMember(personEntityId);\n\n        final boolean rslt = personGroupMember.isDeepMemberOf(groupForRole);\n        logger.trace(\n                \"Answering {} for isUserInRole where user='{}', role='{}', and groupForRole='{}'\",\n                rslt,\n                person.getUserName(),\n                role,\n                groupForRole.getName());\n        return rslt;\n    }", "code_tokens": ["@", "Override", "public", "boolean", "isUserInRole", "(", "String", "role", ")", "{", "if", "(", "super", ".", "getSession", "(", "false", ")", "==", "null", ")", "{", "return", "super", ".", "isUserInRole", "(", "role", ")", ";", "}", "// Check the wrapped request first", "final", "boolean", "isUserInRole", "=", "super", ".", "isUserInRole", "(", "role", ")", ";", "if", "(", "isUserInRole", ")", "{", "return", "true", ";", "}", "// Find the group for the role, if not found return false", "IEntityGroup", "groupForRole", "=", "GroupService", ".", "findGroup", "(", "role", ")", ";", "if", "(", "groupForRole", "==", "null", ")", "{", "final", "EntityIdentifier", "[", "]", "results", "=", "GroupService", ".", "searchForGroups", "(", "role", ",", "GroupService", ".", "SearchMethod", ".", "DISCRETE", ",", "IPerson", ".", "class", ")", ";", "if", "(", "results", "==", "null", "||", "results", ".", "length", "==", "0", ")", "{", "return", "false", ";", "}", "if", "(", "results", ".", "length", ">", "1", ")", "{", "this", ".", "logger", ".", "warn", "(", "results", ".", "length", "+", "\" groups were found for role '\"", "+", "role", "+", "\"'. The first result will be used.\"", ")", ";", "}", "IGroupMember", "member", "=", "GroupService", ".", "getGroupMember", "(", "results", "[", "0", "]", ")", ";", "if", "(", "member", "==", "null", "||", "!", "member", ".", "isGroup", "(", ")", ")", "{", "return", "false", ";", "}", "groupForRole", "=", "member", ".", "asGroup", "(", ")", ";", "}", "// Load the group information about the current user", "final", "IUserInstance", "userInstance", "=", "this", ".", "userInstanceManager", ".", "getUserInstance", "(", "this", ".", "getWrappedRequest", "(", ")", ")", ";", "final", "IPerson", "person", "=", "userInstance", ".", "getPerson", "(", ")", ";", "final", "EntityIdentifier", "personEntityId", "=", "person", ".", "getEntityIdentifier", "(", ")", ";", "final", "IGroupMember", "personGroupMember", "=", "GroupService", ".", "getGroupMember", "(", "personEntityId", ")", ";", "final", "boolean", "rslt", "=", "personGroupMember", ".", "isDeepMemberOf", "(", "groupForRole", ")", ";", "logger", ".", "trace", "(", "\"Answering {} for isUserInRole where user='{}', role='{}', and groupForRole='{}'\"", ",", "rslt", ",", "person", ".", "getUserName", "(", ")", ",", "role", ",", "groupForRole", ".", "getName", "(", ")", ")", ";", "return", "rslt", ";", "}"], "docstring": "Determines whether or not the user is in the given role. The wrapped request is consulted\nfirst then the {@link GroupService} is used to determine if a group exists for the specified\nrole and if the user is a member of it.\n\n<p>Role is case sensitive.\n\n@see\norg.apereo.portal.utils.web.AbstractHttpServletRequestWrapper#isUserInRole(java.lang.String)", "docstring_tokens": ["Determines", "whether", "or", "not", "the", "user", "is", "in", "the", "given", "role", ".", "The", "wrapped", "request", "is", "consulted", "first", "then", "the", "{", "@link", "GroupService", "}", "is", "used", "to", "determine", "if", "a", "group", "exists", "for", "the", "specified", "role", "and", "if", "the", "user", "is", "a", "member", "of", "it", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-url/src/main/java/org/apereo/portal/url/PortalHttpServletRequestWrapper.java#L207-L259", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-url/src/main/java/org/apereo/portal/url/PortalHttpServletRequestWrapper.java", "func_name": "PortalHttpServletRequestWrapper.getLocale", "original_string": "@Override\n    public Locale getLocale() {\n        if (super.getSession(false) == null) {\n            return super.getLocale();\n        }\n\n        final IUserInstance userInstance =\n                this.userInstanceManager.getUserInstance(this.getWrappedRequest());\n        final LocaleManager localeManager = userInstance.getLocaleManager();\n        final List<Locale> locales = localeManager.getLocales();\n        return locales.get(0);\n    }", "language": "java", "code": "@Override\n    public Locale getLocale() {\n        if (super.getSession(false) == null) {\n            return super.getLocale();\n        }\n\n        final IUserInstance userInstance =\n                this.userInstanceManager.getUserInstance(this.getWrappedRequest());\n        final LocaleManager localeManager = userInstance.getLocaleManager();\n        final List<Locale> locales = localeManager.getLocales();\n        return locales.get(0);\n    }", "code_tokens": ["@", "Override", "public", "Locale", "getLocale", "(", ")", "{", "if", "(", "super", ".", "getSession", "(", "false", ")", "==", "null", ")", "{", "return", "super", ".", "getLocale", "(", ")", ";", "}", "final", "IUserInstance", "userInstance", "=", "this", ".", "userInstanceManager", ".", "getUserInstance", "(", "this", ".", "getWrappedRequest", "(", ")", ")", ";", "final", "LocaleManager", "localeManager", "=", "userInstance", ".", "getLocaleManager", "(", ")", ";", "final", "List", "<", "Locale", ">", "locales", "=", "localeManager", ".", "getLocales", "(", ")", ";", "return", "locales", ".", "get", "(", "0", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.url.AbstractHttpServletRequestWrapper#getLocale()", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-url/src/main/java/org/apereo/portal/url/PortalHttpServletRequestWrapper.java#L264-L275", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-url/src/main/java/org/apereo/portal/url/PortalHttpServletRequestWrapper.java", "func_name": "PortalHttpServletRequestWrapper.getLocales", "original_string": "@Override\n    public Enumeration<Locale> getLocales() {\n        if (super.getSession(false) == null) {\n            return super.getLocales();\n        }\n\n        final IUserInstance userInstance =\n                this.userInstanceManager.getUserInstance(this.getWrappedRequest());\n        final LocaleManager localeManager = userInstance.getLocaleManager();\n        final List<Locale> locales = localeManager.getLocales();\n        return Collections.enumeration(locales);\n    }", "language": "java", "code": "@Override\n    public Enumeration<Locale> getLocales() {\n        if (super.getSession(false) == null) {\n            return super.getLocales();\n        }\n\n        final IUserInstance userInstance =\n                this.userInstanceManager.getUserInstance(this.getWrappedRequest());\n        final LocaleManager localeManager = userInstance.getLocaleManager();\n        final List<Locale> locales = localeManager.getLocales();\n        return Collections.enumeration(locales);\n    }", "code_tokens": ["@", "Override", "public", "Enumeration", "<", "Locale", ">", "getLocales", "(", ")", "{", "if", "(", "super", ".", "getSession", "(", "false", ")", "==", "null", ")", "{", "return", "super", ".", "getLocales", "(", ")", ";", "}", "final", "IUserInstance", "userInstance", "=", "this", ".", "userInstanceManager", ".", "getUserInstance", "(", "this", ".", "getWrappedRequest", "(", ")", ")", ";", "final", "LocaleManager", "localeManager", "=", "userInstance", ".", "getLocaleManager", "(", ")", ";", "final", "List", "<", "Locale", ">", "locales", "=", "localeManager", ".", "getLocales", "(", ")", ";", "return", "Collections", ".", "enumeration", "(", "locales", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.url.AbstractHttpServletRequestWrapper#getLocales()", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-url/src/main/java/org/apereo/portal/url/PortalHttpServletRequestWrapper.java#L280-L291", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/providers/GroupMembershipEvaluator.java", "func_name": "GroupMembershipEvaluator.getGroupKey", "original_string": "private String getGroupKey() {\n        EntityIdentifier[] groups = null;\n        try {\n            groups =\n                    GroupService.searchForGroups(\n                            groupName, IGroupConstants.SearchMethod.DISCRETE, IPerson.class);\n        } catch (GroupsException e1) {\n            throw new RuntimeException(\n                    \"An exception occurred searching for \" + \"the group \" + groupName + \".\", e1);\n        }\n        if (groups == null || groups.length == 0)\n            throw new RuntimeException(\n                    \"Group with name '\"\n                            + groupName\n                            + \"' not found for \"\n                            + this.getClass().getName()\n                            + \". All evaluations will return false.\");\n\n        return groups[0].getKey();\n    }", "language": "java", "code": "private String getGroupKey() {\n        EntityIdentifier[] groups = null;\n        try {\n            groups =\n                    GroupService.searchForGroups(\n                            groupName, IGroupConstants.SearchMethod.DISCRETE, IPerson.class);\n        } catch (GroupsException e1) {\n            throw new RuntimeException(\n                    \"An exception occurred searching for \" + \"the group \" + groupName + \".\", e1);\n        }\n        if (groups == null || groups.length == 0)\n            throw new RuntimeException(\n                    \"Group with name '\"\n                            + groupName\n                            + \"' not found for \"\n                            + this.getClass().getName()\n                            + \". All evaluations will return false.\");\n\n        return groups[0].getKey();\n    }", "code_tokens": ["private", "String", "getGroupKey", "(", ")", "{", "EntityIdentifier", "[", "]", "groups", "=", "null", ";", "try", "{", "groups", "=", "GroupService", ".", "searchForGroups", "(", "groupName", ",", "IGroupConstants", ".", "SearchMethod", ".", "DISCRETE", ",", "IPerson", ".", "class", ")", ";", "}", "catch", "(", "GroupsException", "e1", ")", "{", "throw", "new", "RuntimeException", "(", "\"An exception occurred searching for \"", "+", "\"the group \"", "+", "groupName", "+", "\".\"", ",", "e1", ")", ";", "}", "if", "(", "groups", "==", "null", "||", "groups", ".", "length", "==", "0", ")", "throw", "new", "RuntimeException", "(", "\"Group with name '\"", "+", "groupName", "+", "\"' not found for \"", "+", "this", ".", "getClass", "(", ")", ".", "getName", "(", ")", "+", "\". All evaluations will return false.\"", ")", ";", "return", "groups", "[", "0", "]", ".", "getKey", "(", ")", ";", "}"], "docstring": "Internal search, thus case sensitive.", "docstring_tokens": ["Internal", "search", "thus", "case", "sensitive", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/providers/GroupMembershipEvaluator.java#L80-L99", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-authn/src/main/java/org/apereo/portal/security/provider/cas/CasAssertionSecurityContext.java", "func_name": "CasAssertionSecurityContext.copyAssertionAttributesToUserAttributes", "original_string": "private void copyAssertionAttributesToUserAttributes(Assertion assertion) {\n        if (!copyAssertionAttributesToUserAttributes) {\n            return;\n        }\n\n        // skip this if there are no attributes or if the attribute set is empty.\n        if (assertion.getPrincipal().getAttributes() == null\n                || assertion.getPrincipal().getAttributes().isEmpty()) {\n            return;\n        }\n\n        Map<String, List<Object>> attributes = new HashMap<>();\n        // loop over the set of person attributes from CAS...\n        for (Map.Entry<String, Object> attrEntry :\n                assertion.getPrincipal().getAttributes().entrySet()) {\n            log.debug(\n                    \"Adding attribute '{}' from Assertion with value '{}'; runtime type of value is {}\",\n                    attrEntry.getKey(),\n                    attrEntry.getValue(),\n                    attrEntry.getValue().getClass().getName());\n\n            // Check for credential\n            if (decryptCredentialToPassword\n                    && key != null\n                    && cipher != null\n                    && attrEntry.getKey().equals(CREDENTIAL_KEY)) {\n                try {\n                    final String encPwd =\n                            (String)\n                                    (attrEntry.getValue() instanceof List\n                                            ? ((List) attrEntry.getValue()).get(0)\n                                            : attrEntry.getValue());\n                    byte[] cred64 = DatatypeConverter.parseBase64Binary(encPwd);\n                    cipher.init(Cipher.DECRYPT_MODE, key);\n                    final byte[] cipherData = cipher.doFinal(cred64);\n                    final Object pwd = new String(cipherData, UTF_8);\n                    attributes.put(PASSWORD_KEY, Collections.singletonList(pwd));\n                } catch (Exception e) {\n                    log.warn(\"Cannot decipher credential\", e);\n                }\n            }\n\n            // convert each attribute to a list, if necessary...\n            List<Object> valueList;\n            if (attrEntry.getValue() instanceof List) {\n                valueList = (List<Object>) attrEntry.getValue();\n            } else {\n                valueList = Collections.singletonList(attrEntry.getValue());\n            }\n\n            // add the attribute...\n            attributes.put(attrEntry.getKey(), valueList);\n        }\n\n        // get the attribute descriptor from Spring...\n        IAdditionalDescriptors additionalDescriptors =\n                (IAdditionalDescriptors)\n                        applicationContext.getBean(SESSION_ADDITIONAL_DESCRIPTORS_BEAN);\n\n        // add the new properties...\n        additionalDescriptors.addAttributes(attributes);\n    }", "language": "java", "code": "private void copyAssertionAttributesToUserAttributes(Assertion assertion) {\n        if (!copyAssertionAttributesToUserAttributes) {\n            return;\n        }\n\n        // skip this if there are no attributes or if the attribute set is empty.\n        if (assertion.getPrincipal().getAttributes() == null\n                || assertion.getPrincipal().getAttributes().isEmpty()) {\n            return;\n        }\n\n        Map<String, List<Object>> attributes = new HashMap<>();\n        // loop over the set of person attributes from CAS...\n        for (Map.Entry<String, Object> attrEntry :\n                assertion.getPrincipal().getAttributes().entrySet()) {\n            log.debug(\n                    \"Adding attribute '{}' from Assertion with value '{}'; runtime type of value is {}\",\n                    attrEntry.getKey(),\n                    attrEntry.getValue(),\n                    attrEntry.getValue().getClass().getName());\n\n            // Check for credential\n            if (decryptCredentialToPassword\n                    && key != null\n                    && cipher != null\n                    && attrEntry.getKey().equals(CREDENTIAL_KEY)) {\n                try {\n                    final String encPwd =\n                            (String)\n                                    (attrEntry.getValue() instanceof List\n                                            ? ((List) attrEntry.getValue()).get(0)\n                                            : attrEntry.getValue());\n                    byte[] cred64 = DatatypeConverter.parseBase64Binary(encPwd);\n                    cipher.init(Cipher.DECRYPT_MODE, key);\n                    final byte[] cipherData = cipher.doFinal(cred64);\n                    final Object pwd = new String(cipherData, UTF_8);\n                    attributes.put(PASSWORD_KEY, Collections.singletonList(pwd));\n                } catch (Exception e) {\n                    log.warn(\"Cannot decipher credential\", e);\n                }\n            }\n\n            // convert each attribute to a list, if necessary...\n            List<Object> valueList;\n            if (attrEntry.getValue() instanceof List) {\n                valueList = (List<Object>) attrEntry.getValue();\n            } else {\n                valueList = Collections.singletonList(attrEntry.getValue());\n            }\n\n            // add the attribute...\n            attributes.put(attrEntry.getKey(), valueList);\n        }\n\n        // get the attribute descriptor from Spring...\n        IAdditionalDescriptors additionalDescriptors =\n                (IAdditionalDescriptors)\n                        applicationContext.getBean(SESSION_ADDITIONAL_DESCRIPTORS_BEAN);\n\n        // add the new properties...\n        additionalDescriptors.addAttributes(attributes);\n    }", "code_tokens": ["private", "void", "copyAssertionAttributesToUserAttributes", "(", "Assertion", "assertion", ")", "{", "if", "(", "!", "copyAssertionAttributesToUserAttributes", ")", "{", "return", ";", "}", "// skip this if there are no attributes or if the attribute set is empty.", "if", "(", "assertion", ".", "getPrincipal", "(", ")", ".", "getAttributes", "(", ")", "==", "null", "||", "assertion", ".", "getPrincipal", "(", ")", ".", "getAttributes", "(", ")", ".", "isEmpty", "(", ")", ")", "{", "return", ";", "}", "Map", "<", "String", ",", "List", "<", "Object", ">", ">", "attributes", "=", "new", "HashMap", "<>", "(", ")", ";", "// loop over the set of person attributes from CAS...", "for", "(", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "attrEntry", ":", "assertion", ".", "getPrincipal", "(", ")", ".", "getAttributes", "(", ")", ".", "entrySet", "(", ")", ")", "{", "log", ".", "debug", "(", "\"Adding attribute '{}' from Assertion with value '{}'; runtime type of value is {}\"", ",", "attrEntry", ".", "getKey", "(", ")", ",", "attrEntry", ".", "getValue", "(", ")", ",", "attrEntry", ".", "getValue", "(", ")", ".", "getClass", "(", ")", ".", "getName", "(", ")", ")", ";", "// Check for credential", "if", "(", "decryptCredentialToPassword", "&&", "key", "!=", "null", "&&", "cipher", "!=", "null", "&&", "attrEntry", ".", "getKey", "(", ")", ".", "equals", "(", "CREDENTIAL_KEY", ")", ")", "{", "try", "{", "final", "String", "encPwd", "=", "(", "String", ")", "(", "attrEntry", ".", "getValue", "(", ")", "instanceof", "List", "?", "(", "(", "List", ")", "attrEntry", ".", "getValue", "(", ")", ")", ".", "get", "(", "0", ")", ":", "attrEntry", ".", "getValue", "(", ")", ")", ";", "byte", "[", "]", "cred64", "=", "DatatypeConverter", ".", "parseBase64Binary", "(", "encPwd", ")", ";", "cipher", ".", "init", "(", "Cipher", ".", "DECRYPT_MODE", ",", "key", ")", ";", "final", "byte", "[", "]", "cipherData", "=", "cipher", ".", "doFinal", "(", "cred64", ")", ";", "final", "Object", "pwd", "=", "new", "String", "(", "cipherData", ",", "UTF_8", ")", ";", "attributes", ".", "put", "(", "PASSWORD_KEY", ",", "Collections", ".", "singletonList", "(", "pwd", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "log", ".", "warn", "(", "\"Cannot decipher credential\"", ",", "e", ")", ";", "}", "}", "// convert each attribute to a list, if necessary...", "List", "<", "Object", ">", "valueList", ";", "if", "(", "attrEntry", ".", "getValue", "(", ")", "instanceof", "List", ")", "{", "valueList", "=", "(", "List", "<", "Object", ">", ")", "attrEntry", ".", "getValue", "(", ")", ";", "}", "else", "{", "valueList", "=", "Collections", ".", "singletonList", "(", "attrEntry", ".", "getValue", "(", ")", ")", ";", "}", "// add the attribute...", "attributes", ".", "put", "(", "attrEntry", ".", "getKey", "(", ")", ",", "valueList", ")", ";", "}", "// get the attribute descriptor from Spring...", "IAdditionalDescriptors", "additionalDescriptors", "=", "(", "IAdditionalDescriptors", ")", "applicationContext", ".", "getBean", "(", "SESSION_ADDITIONAL_DESCRIPTORS_BEAN", ")", ";", "// add the new properties...", "additionalDescriptors", ".", "addAttributes", "(", "attributes", ")", ";", "}"], "docstring": "If enabled, convert CAS assertion person attributes into uPortal user attributes.\n\n@param assertion the Assertion that was retrieved from the ThreadLocal. CANNOT be NULL.", "docstring_tokens": ["If", "enabled", "convert", "CAS", "assertion", "person", "attributes", "into", "uPortal", "user", "attributes", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-authn/src/main/java/org/apereo/portal/security/provider/cas/CasAssertionSecurityContext.java#L219-L280", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/cache/CacheManagementHelper.java", "func_name": "CacheManagementHelper.clearCache", "original_string": "public void clearCache(String cacheName) {\n        Cache cache = this.cacheManager.getCache(cacheName);\n        if (null != cache && Status.STATUS_ALIVE.equals(cache.getStatus())) {\n            cache.removeAll();\n            logger.warn(\"finished removeAll for cache: \" + cacheName);\n        }\n    }", "language": "java", "code": "public void clearCache(String cacheName) {\n        Cache cache = this.cacheManager.getCache(cacheName);\n        if (null != cache && Status.STATUS_ALIVE.equals(cache.getStatus())) {\n            cache.removeAll();\n            logger.warn(\"finished removeAll for cache: \" + cacheName);\n        }\n    }", "code_tokens": ["public", "void", "clearCache", "(", "String", "cacheName", ")", "{", "Cache", "cache", "=", "this", ".", "cacheManager", ".", "getCache", "(", "cacheName", ")", ";", "if", "(", "null", "!=", "cache", "&&", "Status", ".", "STATUS_ALIVE", ".", "equals", "(", "cache", ".", "getStatus", "(", ")", ")", ")", "{", "cache", ".", "removeAll", "(", ")", ";", "logger", ".", "warn", "(", "\"finished removeAll for cache: \"", "+", "cacheName", ")", ";", "}", "}"], "docstring": "Call {@link Cache#removeAll()} on the specified cache, if it exists and is alive.\n\n@see Status#STATUS_ALIVE\n@see Cache#getStatus()\n@param cacheName", "docstring_tokens": ["Call", "{", "@link", "Cache#removeAll", "()", "}", "on", "the", "specified", "cache", "if", "it", "exists", "and", "is", "alive", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/cache/CacheManagementHelper.java#L108-L114", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/cache/CacheManagementHelper.java", "func_name": "CacheManagementHelper.clearAllCaches", "original_string": "public void clearAllCaches() {\n        logger.warn(\"beginning request to clear all caches\");\n        for (final String cacheName : this.cacheManager.getCacheNames()) {\n            clearCache(cacheName);\n        }\n        logger.warn(\"completed request to clear all caches\");\n    }", "language": "java", "code": "public void clearAllCaches() {\n        logger.warn(\"beginning request to clear all caches\");\n        for (final String cacheName : this.cacheManager.getCacheNames()) {\n            clearCache(cacheName);\n        }\n        logger.warn(\"completed request to clear all caches\");\n    }", "code_tokens": ["public", "void", "clearAllCaches", "(", ")", "{", "logger", ".", "warn", "(", "\"beginning request to clear all caches\"", ")", ";", "for", "(", "final", "String", "cacheName", ":", "this", ".", "cacheManager", ".", "getCacheNames", "(", ")", ")", "{", "clearCache", "(", "cacheName", ")", ";", "}", "logger", ".", "warn", "(", "\"completed request to clear all caches\"", ")", ";", "}"], "docstring": "Call {@link #clearCache(String)} on ALL caches.", "docstring_tokens": ["Call", "{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/cache/CacheManagementHelper.java#L117-L123", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-core/src/main/java/org/apereo/portal/services/EntityCachingService.java", "func_name": "EntityCachingService.get", "original_string": "@Override\n    public IBasicEntity get(Class<? extends IBasicEntity> type, String key)\n            throws CachingException {\n        return EntityCachingServiceLocator.getEntityCachingService().get(type, key);\n    }", "language": "java", "code": "@Override\n    public IBasicEntity get(Class<? extends IBasicEntity> type, String key)\n            throws CachingException {\n        return EntityCachingServiceLocator.getEntityCachingService().get(type, key);\n    }", "code_tokens": ["@", "Override", "public", "IBasicEntity", "get", "(", "Class", "<", "?", "extends", "IBasicEntity", ">", "type", ",", "String", "key", ")", "throws", "CachingException", "{", "return", "EntityCachingServiceLocator", ".", "getEntityCachingService", "(", ")", ".", "get", "(", "type", ",", "key", ")", ";", "}"], "docstring": "Returns the cached entity identified by type and key.\n\n@param type Class\n@param key String\n@return IBasicEntity entity\n@exception org.apereo.portal.concurrency.CachingException", "docstring_tokens": ["Returns", "the", "cached", "entity", "identified", "by", "type", "and", "key", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-core/src/main/java/org/apereo/portal/services/EntityCachingService.java#L103-L107", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-core/src/main/java/org/apereo/portal/services/EntityCachingService.java", "func_name": "EntityCachingService.get", "original_string": "public IBasicEntity get(EntityIdentifier entityID) throws CachingException {\n        return EntityCachingServiceLocator.getEntityCachingService()\n                .get(entityID.getType(), entityID.getKey());\n    }", "language": "java", "code": "public IBasicEntity get(EntityIdentifier entityID) throws CachingException {\n        return EntityCachingServiceLocator.getEntityCachingService()\n                .get(entityID.getType(), entityID.getKey());\n    }", "code_tokens": ["public", "IBasicEntity", "get", "(", "EntityIdentifier", "entityID", ")", "throws", "CachingException", "{", "return", "EntityCachingServiceLocator", ".", "getEntityCachingService", "(", ")", ".", "get", "(", "entityID", ".", "getType", "(", ")", ",", "entityID", ".", "getKey", "(", ")", ")", ";", "}"], "docstring": "Returns the cached entity referred to by entityID.\n\n@param entityID entity identifier\n@return IBasicEntity entity\n@exception org.apereo.portal.concurrency.CachingException", "docstring_tokens": ["Returns", "the", "cached", "entity", "referred", "to", "by", "entityID", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-core/src/main/java/org/apereo/portal/services/EntityCachingService.java#L116-L119", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-core/src/main/java/org/apereo/portal/services/EntityCachingService.java", "func_name": "EntityCachingService.remove", "original_string": "@Override\n    public void remove(Class<? extends IBasicEntity> type, String key) throws CachingException {\n        EntityCachingServiceLocator.getEntityCachingService().remove(type, key);\n    }", "language": "java", "code": "@Override\n    public void remove(Class<? extends IBasicEntity> type, String key) throws CachingException {\n        EntityCachingServiceLocator.getEntityCachingService().remove(type, key);\n    }", "code_tokens": ["@", "Override", "public", "void", "remove", "(", "Class", "<", "?", "extends", "IBasicEntity", ">", "type", ",", "String", "key", ")", "throws", "CachingException", "{", "EntityCachingServiceLocator", ".", "getEntityCachingService", "(", ")", ".", "remove", "(", "type", ",", "key", ")", ";", "}"], "docstring": "Removes the entity identified by type and key from the cache and notifies peer caches.\n\n@param type Class\n@param key String\n@exception org.apereo.portal.concurrency.CachingException", "docstring_tokens": ["Removes", "the", "entity", "identified", "by", "type", "and", "key", "from", "the", "cache", "and", "notifies", "peer", "caches", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-core/src/main/java/org/apereo/portal/services/EntityCachingService.java#L128-L131", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-web/src/main/java/org/apereo/portal/portlets/error/PortletErrorController.java", "func_name": "PortletErrorController.renderError", "original_string": "@RequestMapping(\"VIEW\")\n    public String renderError(RenderRequest request, RenderResponse response, ModelMap model)\n            throws Exception {\n\n        HttpServletRequest httpRequest = this.portalRequestUtils.getPortletHttpRequest(request);\n        IPortletWindowId currentFailedPortletWindowId =\n                (IPortletWindowId)\n                        request.getAttribute(REQUEST_ATTRIBUTE__CURRENT_FAILED_PORTLET_WINDOW_ID);\n        model.addAttribute(\"portletWindowId\", currentFailedPortletWindowId);\n        Exception cause =\n                (Exception) request.getAttribute(REQUEST_ATTRIBUTE__CURRENT_EXCEPTION_CAUSE);\n        model.addAttribute(\"exception\", cause);\n        final String rootCauseMessage = ExceptionUtils.getRootCauseMessage(cause);\n        model.addAttribute(\"rootCauseMessage\", rootCauseMessage);\n\n        // Maintenance Mode?\n        if (cause != null && cause instanceof MaintenanceModeException) {\n            return \"/jsp/PortletError/maintenance\";\n        }\n\n        IUserInstance userInstance = this.userInstanceManager.getUserInstance(httpRequest);\n        if (hasAdminPrivileges(userInstance)) {\n            IPortletWindow window =\n                    this.portletWindowRegistry.getPortletWindow(\n                            httpRequest, currentFailedPortletWindowId);\n            window.setRenderParameters(new ParameterMap());\n            IPortalUrlBuilder adminRetryUrl =\n                    this.portalUrlProvider.getPortalUrlBuilderByPortletWindow(\n                            httpRequest, currentFailedPortletWindowId, UrlType.RENDER);\n            model.addAttribute(\"adminRetryUrl\", adminRetryUrl.getUrlString());\n\n            final IPortletWindow portletWindow =\n                    portletWindowRegistry.getPortletWindow(\n                            httpRequest, currentFailedPortletWindowId);\n            final IPortletEntity parentPortletEntity = portletWindow.getPortletEntity();\n            final IPortletDefinition parentPortletDefinition =\n                    parentPortletEntity.getPortletDefinition();\n            model.addAttribute(\"channelDefinition\", parentPortletDefinition);\n\n            StringWriter stackTraceWriter = new StringWriter();\n            cause.printStackTrace(new PrintWriter(stackTraceWriter));\n\n            model.addAttribute(\"stackTrace\", stackTraceWriter.toString());\n\n            return \"/jsp/PortletError/detailed\";\n        }\n        // no admin privileges, return generic view\n        return \"/jsp/PortletError/generic\";\n    }", "language": "java", "code": "@RequestMapping(\"VIEW\")\n    public String renderError(RenderRequest request, RenderResponse response, ModelMap model)\n            throws Exception {\n\n        HttpServletRequest httpRequest = this.portalRequestUtils.getPortletHttpRequest(request);\n        IPortletWindowId currentFailedPortletWindowId =\n                (IPortletWindowId)\n                        request.getAttribute(REQUEST_ATTRIBUTE__CURRENT_FAILED_PORTLET_WINDOW_ID);\n        model.addAttribute(\"portletWindowId\", currentFailedPortletWindowId);\n        Exception cause =\n                (Exception) request.getAttribute(REQUEST_ATTRIBUTE__CURRENT_EXCEPTION_CAUSE);\n        model.addAttribute(\"exception\", cause);\n        final String rootCauseMessage = ExceptionUtils.getRootCauseMessage(cause);\n        model.addAttribute(\"rootCauseMessage\", rootCauseMessage);\n\n        // Maintenance Mode?\n        if (cause != null && cause instanceof MaintenanceModeException) {\n            return \"/jsp/PortletError/maintenance\";\n        }\n\n        IUserInstance userInstance = this.userInstanceManager.getUserInstance(httpRequest);\n        if (hasAdminPrivileges(userInstance)) {\n            IPortletWindow window =\n                    this.portletWindowRegistry.getPortletWindow(\n                            httpRequest, currentFailedPortletWindowId);\n            window.setRenderParameters(new ParameterMap());\n            IPortalUrlBuilder adminRetryUrl =\n                    this.portalUrlProvider.getPortalUrlBuilderByPortletWindow(\n                            httpRequest, currentFailedPortletWindowId, UrlType.RENDER);\n            model.addAttribute(\"adminRetryUrl\", adminRetryUrl.getUrlString());\n\n            final IPortletWindow portletWindow =\n                    portletWindowRegistry.getPortletWindow(\n                            httpRequest, currentFailedPortletWindowId);\n            final IPortletEntity parentPortletEntity = portletWindow.getPortletEntity();\n            final IPortletDefinition parentPortletDefinition =\n                    parentPortletEntity.getPortletDefinition();\n            model.addAttribute(\"channelDefinition\", parentPortletDefinition);\n\n            StringWriter stackTraceWriter = new StringWriter();\n            cause.printStackTrace(new PrintWriter(stackTraceWriter));\n\n            model.addAttribute(\"stackTrace\", stackTraceWriter.toString());\n\n            return \"/jsp/PortletError/detailed\";\n        }\n        // no admin privileges, return generic view\n        return \"/jsp/PortletError/generic\";\n    }", "code_tokens": ["@", "RequestMapping", "(", "\"VIEW\"", ")", "public", "String", "renderError", "(", "RenderRequest", "request", ",", "RenderResponse", "response", ",", "ModelMap", "model", ")", "throws", "Exception", "{", "HttpServletRequest", "httpRequest", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "request", ")", ";", "IPortletWindowId", "currentFailedPortletWindowId", "=", "(", "IPortletWindowId", ")", "request", ".", "getAttribute", "(", "REQUEST_ATTRIBUTE__CURRENT_FAILED_PORTLET_WINDOW_ID", ")", ";", "model", ".", "addAttribute", "(", "\"portletWindowId\"", ",", "currentFailedPortletWindowId", ")", ";", "Exception", "cause", "=", "(", "Exception", ")", "request", ".", "getAttribute", "(", "REQUEST_ATTRIBUTE__CURRENT_EXCEPTION_CAUSE", ")", ";", "model", ".", "addAttribute", "(", "\"exception\"", ",", "cause", ")", ";", "final", "String", "rootCauseMessage", "=", "ExceptionUtils", ".", "getRootCauseMessage", "(", "cause", ")", ";", "model", ".", "addAttribute", "(", "\"rootCauseMessage\"", ",", "rootCauseMessage", ")", ";", "// Maintenance Mode?", "if", "(", "cause", "!=", "null", "&&", "cause", "instanceof", "MaintenanceModeException", ")", "{", "return", "\"/jsp/PortletError/maintenance\"", ";", "}", "IUserInstance", "userInstance", "=", "this", ".", "userInstanceManager", ".", "getUserInstance", "(", "httpRequest", ")", ";", "if", "(", "hasAdminPrivileges", "(", "userInstance", ")", ")", "{", "IPortletWindow", "window", "=", "this", ".", "portletWindowRegistry", ".", "getPortletWindow", "(", "httpRequest", ",", "currentFailedPortletWindowId", ")", ";", "window", ".", "setRenderParameters", "(", "new", "ParameterMap", "(", ")", ")", ";", "IPortalUrlBuilder", "adminRetryUrl", "=", "this", ".", "portalUrlProvider", ".", "getPortalUrlBuilderByPortletWindow", "(", "httpRequest", ",", "currentFailedPortletWindowId", ",", "UrlType", ".", "RENDER", ")", ";", "model", ".", "addAttribute", "(", "\"adminRetryUrl\"", ",", "adminRetryUrl", ".", "getUrlString", "(", ")", ")", ";", "final", "IPortletWindow", "portletWindow", "=", "portletWindowRegistry", ".", "getPortletWindow", "(", "httpRequest", ",", "currentFailedPortletWindowId", ")", ";", "final", "IPortletEntity", "parentPortletEntity", "=", "portletWindow", ".", "getPortletEntity", "(", ")", ";", "final", "IPortletDefinition", "parentPortletDefinition", "=", "parentPortletEntity", ".", "getPortletDefinition", "(", ")", ";", "model", ".", "addAttribute", "(", "\"channelDefinition\"", ",", "parentPortletDefinition", ")", ";", "StringWriter", "stackTraceWriter", "=", "new", "StringWriter", "(", ")", ";", "cause", ".", "printStackTrace", "(", "new", "PrintWriter", "(", "stackTraceWriter", ")", ")", ";", "model", ".", "addAttribute", "(", "\"stackTrace\"", ",", "stackTraceWriter", ".", "toString", "(", ")", ")", ";", "return", "\"/jsp/PortletError/detailed\"", ";", "}", "// no admin privileges, return generic view", "return", "\"/jsp/PortletError/generic\"", ";", "}"], "docstring": "Render the error portlet view.\n\n@param request\n@param response\n@param model\n@return the name of the view to display\n@throws Exception", "docstring_tokens": ["Render", "the", "error", "portlet", "view", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-web/src/main/java/org/apereo/portal/portlets/error/PortletErrorController.java#L101-L149", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-authn/src/main/java/org/apereo/portal/security/provider/SimpleLdapSecurityContext.java", "func_name": "SimpleLdapSecurityContext.authenticate", "original_string": "@Override\n    public synchronized void authenticate() throws PortalSecurityException {\n        this.isauth = false;\n        ILdapServer ldapConn;\n\n        ldapConn = LdapServices.getDefaultLdapServer();\n\n        String creds = new String(this.myOpaqueCredentials.credentialstring);\n        if (this.myPrincipal.UID != null\n                && !this.myPrincipal.UID.trim().equals(\"\")\n                && this.myOpaqueCredentials.credentialstring != null\n                && !creds.trim().equals(\"\")) {\n            DirContext conn = null;\n            NamingEnumeration results = null;\n            StringBuffer user = new StringBuffer(\"(\");\n            String first_name = null;\n            String last_name = null;\n\n            user.append(ldapConn.getUidAttribute()).append(\"=\");\n            user.append(this.myPrincipal.UID).append(\")\");\n            log.debug(\"SimpleLdapSecurityContext: Looking for {}\", user.toString());\n\n            try {\n                conn = ldapConn.getConnection();\n\n                // set up search controls\n                SearchControls searchCtls = new SearchControls();\n                searchCtls.setReturningAttributes(attributes);\n                searchCtls.setSearchScope(SearchControls.SUBTREE_SCOPE);\n\n                // do lookup\n                if (conn != null) {\n                    try {\n                        results = conn.search(ldapConn.getBaseDN(), user.toString(), searchCtls);\n                        if (results != null) {\n                            if (!results.hasMore()) {\n                                log.error(\n                                        \"SimpleLdapSecurityContext: user not found: {}\",\n                                        this.myPrincipal.UID);\n                            }\n                            while (results != null && results.hasMore()) {\n                                SearchResult entry = (SearchResult) results.next();\n                                StringBuffer dnBuffer = new StringBuffer();\n                                dnBuffer.append(entry.getName()).append(\", \");\n                                dnBuffer.append(ldapConn.getBaseDN());\n                                Attributes attrs = entry.getAttributes();\n                                first_name = getAttributeValue(attrs, ATTR_FIRSTNAME);\n                                last_name = getAttributeValue(attrs, ATTR_LASTNAME);\n                                // re-bind as user\n                                conn.removeFromEnvironment(javax.naming.Context.SECURITY_PRINCIPAL);\n                                conn.removeFromEnvironment(\n                                        javax.naming.Context.SECURITY_CREDENTIALS);\n                                conn.addToEnvironment(\n                                        javax.naming.Context.SECURITY_PRINCIPAL,\n                                        dnBuffer.toString());\n                                conn.addToEnvironment(\n                                        javax.naming.Context.SECURITY_CREDENTIALS,\n                                        this.myOpaqueCredentials.credentialstring);\n                                searchCtls = new SearchControls();\n                                searchCtls.setReturningAttributes(new String[0]);\n                                searchCtls.setSearchScope(SearchControls.OBJECT_SCOPE);\n\n                                String attrSearch = \"(\" + ldapConn.getUidAttribute() + \"=*)\";\n                                log.debug(\n                                        \"SimpleLdapSecurityContext: Looking in {} for {}\",\n                                        dnBuffer.toString(),\n                                        attrSearch);\n                                conn.search(dnBuffer.toString(), attrSearch, searchCtls);\n\n                                this.isauth = true;\n                                this.myPrincipal.FullName = first_name + \" \" + last_name;\n                                log.debug(\n                                        \"SimpleLdapSecurityContext: User {} ({}) is authenticated\",\n                                        this.myPrincipal.UID,\n                                        this.myPrincipal.FullName);\n\n                                // Since LDAP is case-insensitive with respect to uid, force\n                                // user name to lower case for use by the portal\n                                this.myPrincipal.UID = this.myPrincipal.UID.toLowerCase();\n                            } // while (results != null && results.hasMore())\n                        } else {\n                            log.error(\n                                    \"SimpleLdapSecurityContext: No such user: {}\",\n                                    this.myPrincipal.UID);\n                        }\n                    } catch (AuthenticationException ae) {\n                        log.info(\n                                \"SimpleLdapSecurityContext: Password invalid for user: \"\n                                        + this.myPrincipal.UID);\n                    } catch (Exception e) {\n                        log.error(\n                                \"SimpleLdapSecurityContext: LDAP Error with user: \"\n                                        + this.myPrincipal.UID\n                                        + \"; \",\n                                e);\n                        throw new PortalSecurityException(\n                                \"SimpleLdapSecurityContext: LDAP Error\"\n                                        + e\n                                        + \" with user: \"\n                                        + this.myPrincipal.UID);\n                    } finally {\n                        ldapConn.releaseConnection(conn);\n                    }\n                } else {\n                    log.error(\"LDAP Server Connection unavailable\");\n                }\n            } catch (final NamingException ne) {\n                log.error(\"Error getting connection to LDAP server.\", ne);\n            }\n        } else {\n            // If the principal and/or credential are missing, the context authentication\n            // simply fails. It should not be construed that this is an error. It happens for guest\n            // access.\n            log.info(\"Principal or OpaqueCredentials not initialized prior to authenticate\");\n        }\n        // Ok...we are now ready to authenticate all of our subcontexts.\n        super.authenticate();\n        return;\n    }", "language": "java", "code": "@Override\n    public synchronized void authenticate() throws PortalSecurityException {\n        this.isauth = false;\n        ILdapServer ldapConn;\n\n        ldapConn = LdapServices.getDefaultLdapServer();\n\n        String creds = new String(this.myOpaqueCredentials.credentialstring);\n        if (this.myPrincipal.UID != null\n                && !this.myPrincipal.UID.trim().equals(\"\")\n                && this.myOpaqueCredentials.credentialstring != null\n                && !creds.trim().equals(\"\")) {\n            DirContext conn = null;\n            NamingEnumeration results = null;\n            StringBuffer user = new StringBuffer(\"(\");\n            String first_name = null;\n            String last_name = null;\n\n            user.append(ldapConn.getUidAttribute()).append(\"=\");\n            user.append(this.myPrincipal.UID).append(\")\");\n            log.debug(\"SimpleLdapSecurityContext: Looking for {}\", user.toString());\n\n            try {\n                conn = ldapConn.getConnection();\n\n                // set up search controls\n                SearchControls searchCtls = new SearchControls();\n                searchCtls.setReturningAttributes(attributes);\n                searchCtls.setSearchScope(SearchControls.SUBTREE_SCOPE);\n\n                // do lookup\n                if (conn != null) {\n                    try {\n                        results = conn.search(ldapConn.getBaseDN(), user.toString(), searchCtls);\n                        if (results != null) {\n                            if (!results.hasMore()) {\n                                log.error(\n                                        \"SimpleLdapSecurityContext: user not found: {}\",\n                                        this.myPrincipal.UID);\n                            }\n                            while (results != null && results.hasMore()) {\n                                SearchResult entry = (SearchResult) results.next();\n                                StringBuffer dnBuffer = new StringBuffer();\n                                dnBuffer.append(entry.getName()).append(\", \");\n                                dnBuffer.append(ldapConn.getBaseDN());\n                                Attributes attrs = entry.getAttributes();\n                                first_name = getAttributeValue(attrs, ATTR_FIRSTNAME);\n                                last_name = getAttributeValue(attrs, ATTR_LASTNAME);\n                                // re-bind as user\n                                conn.removeFromEnvironment(javax.naming.Context.SECURITY_PRINCIPAL);\n                                conn.removeFromEnvironment(\n                                        javax.naming.Context.SECURITY_CREDENTIALS);\n                                conn.addToEnvironment(\n                                        javax.naming.Context.SECURITY_PRINCIPAL,\n                                        dnBuffer.toString());\n                                conn.addToEnvironment(\n                                        javax.naming.Context.SECURITY_CREDENTIALS,\n                                        this.myOpaqueCredentials.credentialstring);\n                                searchCtls = new SearchControls();\n                                searchCtls.setReturningAttributes(new String[0]);\n                                searchCtls.setSearchScope(SearchControls.OBJECT_SCOPE);\n\n                                String attrSearch = \"(\" + ldapConn.getUidAttribute() + \"=*)\";\n                                log.debug(\n                                        \"SimpleLdapSecurityContext: Looking in {} for {}\",\n                                        dnBuffer.toString(),\n                                        attrSearch);\n                                conn.search(dnBuffer.toString(), attrSearch, searchCtls);\n\n                                this.isauth = true;\n                                this.myPrincipal.FullName = first_name + \" \" + last_name;\n                                log.debug(\n                                        \"SimpleLdapSecurityContext: User {} ({}) is authenticated\",\n                                        this.myPrincipal.UID,\n                                        this.myPrincipal.FullName);\n\n                                // Since LDAP is case-insensitive with respect to uid, force\n                                // user name to lower case for use by the portal\n                                this.myPrincipal.UID = this.myPrincipal.UID.toLowerCase();\n                            } // while (results != null && results.hasMore())\n                        } else {\n                            log.error(\n                                    \"SimpleLdapSecurityContext: No such user: {}\",\n                                    this.myPrincipal.UID);\n                        }\n                    } catch (AuthenticationException ae) {\n                        log.info(\n                                \"SimpleLdapSecurityContext: Password invalid for user: \"\n                                        + this.myPrincipal.UID);\n                    } catch (Exception e) {\n                        log.error(\n                                \"SimpleLdapSecurityContext: LDAP Error with user: \"\n                                        + this.myPrincipal.UID\n                                        + \"; \",\n                                e);\n                        throw new PortalSecurityException(\n                                \"SimpleLdapSecurityContext: LDAP Error\"\n                                        + e\n                                        + \" with user: \"\n                                        + this.myPrincipal.UID);\n                    } finally {\n                        ldapConn.releaseConnection(conn);\n                    }\n                } else {\n                    log.error(\"LDAP Server Connection unavailable\");\n                }\n            } catch (final NamingException ne) {\n                log.error(\"Error getting connection to LDAP server.\", ne);\n            }\n        } else {\n            // If the principal and/or credential are missing, the context authentication\n            // simply fails. It should not be construed that this is an error. It happens for guest\n            // access.\n            log.info(\"Principal or OpaqueCredentials not initialized prior to authenticate\");\n        }\n        // Ok...we are now ready to authenticate all of our subcontexts.\n        super.authenticate();\n        return;\n    }", "code_tokens": ["@", "Override", "public", "synchronized", "void", "authenticate", "(", ")", "throws", "PortalSecurityException", "{", "this", ".", "isauth", "=", "false", ";", "ILdapServer", "ldapConn", ";", "ldapConn", "=", "LdapServices", ".", "getDefaultLdapServer", "(", ")", ";", "String", "creds", "=", "new", "String", "(", "this", ".", "myOpaqueCredentials", ".", "credentialstring", ")", ";", "if", "(", "this", ".", "myPrincipal", ".", "UID", "!=", "null", "&&", "!", "this", ".", "myPrincipal", ".", "UID", ".", "trim", "(", ")", ".", "equals", "(", "\"\"", ")", "&&", "this", ".", "myOpaqueCredentials", ".", "credentialstring", "!=", "null", "&&", "!", "creds", ".", "trim", "(", ")", ".", "equals", "(", "\"\"", ")", ")", "{", "DirContext", "conn", "=", "null", ";", "NamingEnumeration", "results", "=", "null", ";", "StringBuffer", "user", "=", "new", "StringBuffer", "(", "\"(\"", ")", ";", "String", "first_name", "=", "null", ";", "String", "last_name", "=", "null", ";", "user", ".", "append", "(", "ldapConn", ".", "getUidAttribute", "(", ")", ")", ".", "append", "(", "\"=\"", ")", ";", "user", ".", "append", "(", "this", ".", "myPrincipal", ".", "UID", ")", ".", "append", "(", "\")\"", ")", ";", "log", ".", "debug", "(", "\"SimpleLdapSecurityContext: Looking for {}\"", ",", "user", ".", "toString", "(", ")", ")", ";", "try", "{", "conn", "=", "ldapConn", ".", "getConnection", "(", ")", ";", "// set up search controls", "SearchControls", "searchCtls", "=", "new", "SearchControls", "(", ")", ";", "searchCtls", ".", "setReturningAttributes", "(", "attributes", ")", ";", "searchCtls", ".", "setSearchScope", "(", "SearchControls", ".", "SUBTREE_SCOPE", ")", ";", "// do lookup", "if", "(", "conn", "!=", "null", ")", "{", "try", "{", "results", "=", "conn", ".", "search", "(", "ldapConn", ".", "getBaseDN", "(", ")", ",", "user", ".", "toString", "(", ")", ",", "searchCtls", ")", ";", "if", "(", "results", "!=", "null", ")", "{", "if", "(", "!", "results", ".", "hasMore", "(", ")", ")", "{", "log", ".", "error", "(", "\"SimpleLdapSecurityContext: user not found: {}\"", ",", "this", ".", "myPrincipal", ".", "UID", ")", ";", "}", "while", "(", "results", "!=", "null", "&&", "results", ".", "hasMore", "(", ")", ")", "{", "SearchResult", "entry", "=", "(", "SearchResult", ")", "results", ".", "next", "(", ")", ";", "StringBuffer", "dnBuffer", "=", "new", "StringBuffer", "(", ")", ";", "dnBuffer", ".", "append", "(", "entry", ".", "getName", "(", ")", ")", ".", "append", "(", "\", \"", ")", ";", "dnBuffer", ".", "append", "(", "ldapConn", ".", "getBaseDN", "(", ")", ")", ";", "Attributes", "attrs", "=", "entry", ".", "getAttributes", "(", ")", ";", "first_name", "=", "getAttributeValue", "(", "attrs", ",", "ATTR_FIRSTNAME", ")", ";", "last_name", "=", "getAttributeValue", "(", "attrs", ",", "ATTR_LASTNAME", ")", ";", "// re-bind as user", "conn", ".", "removeFromEnvironment", "(", "javax", ".", "naming", ".", "Context", ".", "SECURITY_PRINCIPAL", ")", ";", "conn", ".", "removeFromEnvironment", "(", "javax", ".", "naming", ".", "Context", ".", "SECURITY_CREDENTIALS", ")", ";", "conn", ".", "addToEnvironment", "(", "javax", ".", "naming", ".", "Context", ".", "SECURITY_PRINCIPAL", ",", "dnBuffer", ".", "toString", "(", ")", ")", ";", "conn", ".", "addToEnvironment", "(", "javax", ".", "naming", ".", "Context", ".", "SECURITY_CREDENTIALS", ",", "this", ".", "myOpaqueCredentials", ".", "credentialstring", ")", ";", "searchCtls", "=", "new", "SearchControls", "(", ")", ";", "searchCtls", ".", "setReturningAttributes", "(", "new", "String", "[", "0", "]", ")", ";", "searchCtls", ".", "setSearchScope", "(", "SearchControls", ".", "OBJECT_SCOPE", ")", ";", "String", "attrSearch", "=", "\"(\"", "+", "ldapConn", ".", "getUidAttribute", "(", ")", "+", "\"=*)\"", ";", "log", ".", "debug", "(", "\"SimpleLdapSecurityContext: Looking in {} for {}\"", ",", "dnBuffer", ".", "toString", "(", ")", ",", "attrSearch", ")", ";", "conn", ".", "search", "(", "dnBuffer", ".", "toString", "(", ")", ",", "attrSearch", ",", "searchCtls", ")", ";", "this", ".", "isauth", "=", "true", ";", "this", ".", "myPrincipal", ".", "FullName", "=", "first_name", "+", "\" \"", "+", "last_name", ";", "log", ".", "debug", "(", "\"SimpleLdapSecurityContext: User {} ({}) is authenticated\"", ",", "this", ".", "myPrincipal", ".", "UID", ",", "this", ".", "myPrincipal", ".", "FullName", ")", ";", "// Since LDAP is case-insensitive with respect to uid, force", "// user name to lower case for use by the portal", "this", ".", "myPrincipal", ".", "UID", "=", "this", ".", "myPrincipal", ".", "UID", ".", "toLowerCase", "(", ")", ";", "}", "// while (results != null && results.hasMore())", "}", "else", "{", "log", ".", "error", "(", "\"SimpleLdapSecurityContext: No such user: {}\"", ",", "this", ".", "myPrincipal", ".", "UID", ")", ";", "}", "}", "catch", "(", "AuthenticationException", "ae", ")", "{", "log", ".", "info", "(", "\"SimpleLdapSecurityContext: Password invalid for user: \"", "+", "this", ".", "myPrincipal", ".", "UID", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "log", ".", "error", "(", "\"SimpleLdapSecurityContext: LDAP Error with user: \"", "+", "this", ".", "myPrincipal", ".", "UID", "+", "\"; \"", ",", "e", ")", ";", "throw", "new", "PortalSecurityException", "(", "\"SimpleLdapSecurityContext: LDAP Error\"", "+", "e", "+", "\" with user: \"", "+", "this", ".", "myPrincipal", ".", "UID", ")", ";", "}", "finally", "{", "ldapConn", ".", "releaseConnection", "(", "conn", ")", ";", "}", "}", "else", "{", "log", ".", "error", "(", "\"LDAP Server Connection unavailable\"", ")", ";", "}", "}", "catch", "(", "final", "NamingException", "ne", ")", "{", "log", ".", "error", "(", "\"Error getting connection to LDAP server.\"", ",", "ne", ")", ";", "}", "}", "else", "{", "// If the principal and/or credential are missing, the context authentication", "// simply fails. It should not be construed that this is an error. It happens for guest", "// access.", "log", ".", "info", "(", "\"Principal or OpaqueCredentials not initialized prior to authenticate\"", ")", ";", "}", "// Ok...we are now ready to authenticate all of our subcontexts.", "super", ".", "authenticate", "(", ")", ";", "return", ";", "}"], "docstring": "Authenticates the user.", "docstring_tokens": ["Authenticates", "the", "user", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-authn/src/main/java/org/apereo/portal/security/provider/SimpleLdapSecurityContext.java#L73-L191", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-authn/src/main/java/org/apereo/portal/security/provider/SimpleLdapSecurityContext.java", "func_name": "SimpleLdapSecurityContext.getAttributeValue", "original_string": "private String getAttributeValue(Attributes attrs, int attribute) throws NamingException {\n        NamingEnumeration values = null;\n        String aValue = \"\";\n        if (!isAttribute(attribute)) return aValue;\n        Attribute attrib = attrs.get(attributes[attribute]);\n        if (attrib != null) {\n            for (values = attrib.getAll(); values.hasMoreElements(); ) {\n                aValue = (String) values.nextElement();\n                break; // take only the first attribute value\n            }\n        }\n        return aValue;\n    }", "language": "java", "code": "private String getAttributeValue(Attributes attrs, int attribute) throws NamingException {\n        NamingEnumeration values = null;\n        String aValue = \"\";\n        if (!isAttribute(attribute)) return aValue;\n        Attribute attrib = attrs.get(attributes[attribute]);\n        if (attrib != null) {\n            for (values = attrib.getAll(); values.hasMoreElements(); ) {\n                aValue = (String) values.nextElement();\n                break; // take only the first attribute value\n            }\n        }\n        return aValue;\n    }", "code_tokens": ["private", "String", "getAttributeValue", "(", "Attributes", "attrs", ",", "int", "attribute", ")", "throws", "NamingException", "{", "NamingEnumeration", "values", "=", "null", ";", "String", "aValue", "=", "\"\"", ";", "if", "(", "!", "isAttribute", "(", "attribute", ")", ")", "return", "aValue", ";", "Attribute", "attrib", "=", "attrs", ".", "get", "(", "attributes", "[", "attribute", "]", ")", ";", "if", "(", "attrib", "!=", "null", ")", "{", "for", "(", "values", "=", "attrib", ".", "getAll", "(", ")", ";", "values", ".", "hasMoreElements", "(", ")", ";", ")", "{", "aValue", "=", "(", "String", ")", "values", ".", "nextElement", "(", ")", ";", "break", ";", "// take only the first attribute value", "}", "}", "return", "aValue", ";", "}"], "docstring": "Return a single value of an attribute from possibly multiple values, grossly ignoring\nanything else. If there are no values, then return an empty string.\n\n@param attrs LDAP query results\n@param attribute LDAP attribute we are interested in\n@return a single value of the attribute", "docstring_tokens": ["Return", "a", "single", "value", "of", "an", "attribute", "from", "possibly", "multiple", "values", "grossly", "ignoring", "anything", "else", ".", "If", "there", "are", "no", "values", "then", "return", "an", "empty", "string", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-authn/src/main/java/org/apereo/portal/security/provider/SimpleLdapSecurityContext.java#L203-L215", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/UserLayoutManagerFactory.java", "func_name": "UserLayoutManagerFactory.getUserLayoutManager", "original_string": "public IUserLayoutManager getUserLayoutManager(IPerson person, IUserProfile profile)\n            throws PortalException {\n        final IUserLayoutManager userLayoutManager =\n                (IUserLayoutManager)\n                        this.beanFactory.getBean(\n                                USER_LAYOUT_MANAGER_PROTOTYPE_BEAN_NAME, person, profile);\n\n        if (person.isGuest()) {\n            return new ImmutableTransientUserLayoutManagerWrapper(userLayoutManager);\n        }\n        return new TransientUserLayoutManagerWrapper(userLayoutManager);\n    }", "language": "java", "code": "public IUserLayoutManager getUserLayoutManager(IPerson person, IUserProfile profile)\n            throws PortalException {\n        final IUserLayoutManager userLayoutManager =\n                (IUserLayoutManager)\n                        this.beanFactory.getBean(\n                                USER_LAYOUT_MANAGER_PROTOTYPE_BEAN_NAME, person, profile);\n\n        if (person.isGuest()) {\n            return new ImmutableTransientUserLayoutManagerWrapper(userLayoutManager);\n        }\n        return new TransientUserLayoutManagerWrapper(userLayoutManager);\n    }", "code_tokens": ["public", "IUserLayoutManager", "getUserLayoutManager", "(", "IPerson", "person", ",", "IUserProfile", "profile", ")", "throws", "PortalException", "{", "final", "IUserLayoutManager", "userLayoutManager", "=", "(", "IUserLayoutManager", ")", "this", ".", "beanFactory", ".", "getBean", "(", "USER_LAYOUT_MANAGER_PROTOTYPE_BEAN_NAME", ",", "person", ",", "profile", ")", ";", "if", "(", "person", ".", "isGuest", "(", ")", ")", "{", "return", "new", "ImmutableTransientUserLayoutManagerWrapper", "(", "userLayoutManager", ")", ";", "}", "return", "new", "TransientUserLayoutManagerWrapper", "(", "userLayoutManager", ")", ";", "}"], "docstring": "Obtain a regular user layout manager implementation (which allows transient layout\nalterations). The specific layout type depends on whether the user is a guest user.\n\n@return an <code>IUserLayoutManager</code> value", "docstring_tokens": ["Obtain", "a", "regular", "user", "layout", "manager", "implementation", "(", "which", "allows", "transient", "layout", "alterations", ")", ".", "The", "specific", "layout", "type", "depends", "on", "whether", "the", "user", "is", "a", "guest", "user", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/UserLayoutManagerFactory.java#L44-L55", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/simple/RDBMUserLayoutStore.java", "func_name": "RDBMUserLayoutStore.addUserProfile", "original_string": "@Override\n    public UserProfile addUserProfile(final IPerson person, final IUserProfile profile) {\n        final int userId = person.getID();\n        final int layoutId = getLayoutId(person, profile);\n        // generate an id for this profile\n\n        return jdbcOperations.execute(\n                (ConnectionCallback<UserProfile>)\n                        con -> {\n                            String sQuery;\n                            PreparedStatement pstmt =\n                                    con.prepareStatement(\n                                            \"INSERT INTO UP_USER_PROFILE \"\n                                                    + \"(USER_ID, PROFILE_ID, PROFILE_FNAME, PROFILE_NAME, STRUCTURE_SS_ID, THEME_SS_ID,\"\n                                                    + \"DESCRIPTION, LAYOUT_ID) VALUES (?,?,?,?,?,?,?,?)\");\n                            int profileId = getNextKey();\n                            pstmt.setInt(1, userId);\n                            pstmt.setInt(2, profileId);\n                            pstmt.setString(3, profile.getProfileFname());\n                            pstmt.setString(4, profile.getProfileName());\n                            pstmt.setInt(5, profile.getStructureStylesheetId());\n                            pstmt.setInt(6, profile.getThemeStylesheetId());\n                            pstmt.setString(7, profile.getProfileDescription());\n                            pstmt.setInt(8, layoutId);\n                            sQuery =\n                                    \"INSERT INTO UP_USER_PROFILE (USER_ID, PROFILE_ID, PROFILE_FNAME, PROFILE_NAME, STRUCTURE_SS_ID, THEME_SS_ID, DESCRIPTION, LAYOUT_ID) VALUES (\"\n                                            + userId\n                                            + \",'\"\n                                            + profileId\n                                            + \",'\"\n                                            + profile.getProfileFname()\n                                            + \"','\"\n                                            + profile.getProfileName()\n                                            + \"',\"\n                                            + profile.getStructureStylesheetId()\n                                            + \",\"\n                                            + profile.getThemeStylesheetId()\n                                            + \",'\"\n                                            + profile.getProfileDescription()\n                                            + \"', \"\n                                            + profile.getLayoutId()\n                                            + \")\";\n                            logger.debug(\"addUserProfile(): {}\", sQuery);\n                            try {\n                                pstmt.executeUpdate();\n\n                                UserProfile newProfile = new UserProfile();\n                                newProfile.setProfileId(profileId);\n                                newProfile.setLayoutId(layoutId);\n                                newProfile.setLocaleManager(profile.getLocaleManager());\n                                newProfile.setProfileDescription(profile.getProfileDescription());\n                                newProfile.setProfileFname(profile.getProfileFname());\n                                newProfile.setProfileName(profile.getProfileName());\n                                newProfile.setStructureStylesheetId(\n                                        profile.getStructureStylesheetId());\n                                newProfile.setSystemProfile(false);\n                                newProfile.setThemeStylesheetId(profile.getThemeStylesheetId());\n\n                                return newProfile;\n\n                            } finally {\n                                pstmt.close();\n                            }\n                        });\n    }", "language": "java", "code": "@Override\n    public UserProfile addUserProfile(final IPerson person, final IUserProfile profile) {\n        final int userId = person.getID();\n        final int layoutId = getLayoutId(person, profile);\n        // generate an id for this profile\n\n        return jdbcOperations.execute(\n                (ConnectionCallback<UserProfile>)\n                        con -> {\n                            String sQuery;\n                            PreparedStatement pstmt =\n                                    con.prepareStatement(\n                                            \"INSERT INTO UP_USER_PROFILE \"\n                                                    + \"(USER_ID, PROFILE_ID, PROFILE_FNAME, PROFILE_NAME, STRUCTURE_SS_ID, THEME_SS_ID,\"\n                                                    + \"DESCRIPTION, LAYOUT_ID) VALUES (?,?,?,?,?,?,?,?)\");\n                            int profileId = getNextKey();\n                            pstmt.setInt(1, userId);\n                            pstmt.setInt(2, profileId);\n                            pstmt.setString(3, profile.getProfileFname());\n                            pstmt.setString(4, profile.getProfileName());\n                            pstmt.setInt(5, profile.getStructureStylesheetId());\n                            pstmt.setInt(6, profile.getThemeStylesheetId());\n                            pstmt.setString(7, profile.getProfileDescription());\n                            pstmt.setInt(8, layoutId);\n                            sQuery =\n                                    \"INSERT INTO UP_USER_PROFILE (USER_ID, PROFILE_ID, PROFILE_FNAME, PROFILE_NAME, STRUCTURE_SS_ID, THEME_SS_ID, DESCRIPTION, LAYOUT_ID) VALUES (\"\n                                            + userId\n                                            + \",'\"\n                                            + profileId\n                                            + \",'\"\n                                            + profile.getProfileFname()\n                                            + \"','\"\n                                            + profile.getProfileName()\n                                            + \"',\"\n                                            + profile.getStructureStylesheetId()\n                                            + \",\"\n                                            + profile.getThemeStylesheetId()\n                                            + \",'\"\n                                            + profile.getProfileDescription()\n                                            + \"', \"\n                                            + profile.getLayoutId()\n                                            + \")\";\n                            logger.debug(\"addUserProfile(): {}\", sQuery);\n                            try {\n                                pstmt.executeUpdate();\n\n                                UserProfile newProfile = new UserProfile();\n                                newProfile.setProfileId(profileId);\n                                newProfile.setLayoutId(layoutId);\n                                newProfile.setLocaleManager(profile.getLocaleManager());\n                                newProfile.setProfileDescription(profile.getProfileDescription());\n                                newProfile.setProfileFname(profile.getProfileFname());\n                                newProfile.setProfileName(profile.getProfileName());\n                                newProfile.setStructureStylesheetId(\n                                        profile.getStructureStylesheetId());\n                                newProfile.setSystemProfile(false);\n                                newProfile.setThemeStylesheetId(profile.getThemeStylesheetId());\n\n                                return newProfile;\n\n                            } finally {\n                                pstmt.close();\n                            }\n                        });\n    }", "code_tokens": ["@", "Override", "public", "UserProfile", "addUserProfile", "(", "final", "IPerson", "person", ",", "final", "IUserProfile", "profile", ")", "{", "final", "int", "userId", "=", "person", ".", "getID", "(", ")", ";", "final", "int", "layoutId", "=", "getLayoutId", "(", "person", ",", "profile", ")", ";", "// generate an id for this profile", "return", "jdbcOperations", ".", "execute", "(", "(", "ConnectionCallback", "<", "UserProfile", ">", ")", "con", "->", "{", "String", "sQuery", ";", "PreparedStatement", "pstmt", "=", "con", ".", "prepareStatement", "(", "\"INSERT INTO UP_USER_PROFILE \"", "+", "\"(USER_ID, PROFILE_ID, PROFILE_FNAME, PROFILE_NAME, STRUCTURE_SS_ID, THEME_SS_ID,\"", "+", "\"DESCRIPTION, LAYOUT_ID) VALUES (?,?,?,?,?,?,?,?)\"", ")", ";", "int", "profileId", "=", "getNextKey", "(", ")", ";", "pstmt", ".", "setInt", "(", "1", ",", "userId", ")", ";", "pstmt", ".", "setInt", "(", "2", ",", "profileId", ")", ";", "pstmt", ".", "setString", "(", "3", ",", "profile", ".", "getProfileFname", "(", ")", ")", ";", "pstmt", ".", "setString", "(", "4", ",", "profile", ".", "getProfileName", "(", ")", ")", ";", "pstmt", ".", "setInt", "(", "5", ",", "profile", ".", "getStructureStylesheetId", "(", ")", ")", ";", "pstmt", ".", "setInt", "(", "6", ",", "profile", ".", "getThemeStylesheetId", "(", ")", ")", ";", "pstmt", ".", "setString", "(", "7", ",", "profile", ".", "getProfileDescription", "(", ")", ")", ";", "pstmt", ".", "setInt", "(", "8", ",", "layoutId", ")", ";", "sQuery", "=", "\"INSERT INTO UP_USER_PROFILE (USER_ID, PROFILE_ID, PROFILE_FNAME, PROFILE_NAME, STRUCTURE_SS_ID, THEME_SS_ID, DESCRIPTION, LAYOUT_ID) VALUES (\"", "+", "userId", "+", "\",'\"", "+", "profileId", "+", "\",'\"", "+", "profile", ".", "getProfileFname", "(", ")", "+", "\"','\"", "+", "profile", ".", "getProfileName", "(", ")", "+", "\"',\"", "+", "profile", ".", "getStructureStylesheetId", "(", ")", "+", "\",\"", "+", "profile", ".", "getThemeStylesheetId", "(", ")", "+", "\",'\"", "+", "profile", ".", "getProfileDescription", "(", ")", "+", "\"', \"", "+", "profile", ".", "getLayoutId", "(", ")", "+", "\")\"", ";", "logger", ".", "debug", "(", "\"addUserProfile(): {}\"", ",", "sQuery", ")", ";", "try", "{", "pstmt", ".", "executeUpdate", "(", ")", ";", "UserProfile", "newProfile", "=", "new", "UserProfile", "(", ")", ";", "newProfile", ".", "setProfileId", "(", "profileId", ")", ";", "newProfile", ".", "setLayoutId", "(", "layoutId", ")", ";", "newProfile", ".", "setLocaleManager", "(", "profile", ".", "getLocaleManager", "(", ")", ")", ";", "newProfile", ".", "setProfileDescription", "(", "profile", ".", "getProfileDescription", "(", ")", ")", ";", "newProfile", ".", "setProfileFname", "(", "profile", ".", "getProfileFname", "(", ")", ")", ";", "newProfile", ".", "setProfileName", "(", "profile", ".", "getProfileName", "(", ")", ")", ";", "newProfile", ".", "setStructureStylesheetId", "(", "profile", ".", "getStructureStylesheetId", "(", ")", ")", ";", "newProfile", ".", "setSystemProfile", "(", "false", ")", ";", "newProfile", ".", "setThemeStylesheetId", "(", "profile", ".", "getThemeStylesheetId", "(", ")", ")", ";", "return", "newProfile", ";", "}", "finally", "{", "pstmt", ".", "close", "(", ")", ";", "}", "}", ")", ";", "}"], "docstring": "Add a user profile", "docstring_tokens": ["Add", "a", "user", "profile"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/simple/RDBMUserLayoutStore.java#L208-L272", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/simple/RDBMUserLayoutStore.java", "func_name": "RDBMUserLayoutStore.getLayoutId", "original_string": "private int getLayoutId(final IPerson person, final IUserProfile profile) {\n        final Hashtable<Integer, UserProfile> profiles = getUserProfileList(person);\n        int layoutId = profile.getLayoutId();\n        Set<Integer> layoutIds = getAllNonZeroLayoutIdsFromProfiles(profiles.values());\n        if (!layoutIds.isEmpty()) {\n            layoutId = layoutIds.iterator().next();\n        }\n        if (layoutIds.size() > 1) {\n            // log that only one non-zero layout id assumption has been broken\n            logger.error(UNSUPPORTED_MULTIPLE_LAYOUTS_FOUND, person.getID());\n        }\n        return layoutId;\n    }", "language": "java", "code": "private int getLayoutId(final IPerson person, final IUserProfile profile) {\n        final Hashtable<Integer, UserProfile> profiles = getUserProfileList(person);\n        int layoutId = profile.getLayoutId();\n        Set<Integer> layoutIds = getAllNonZeroLayoutIdsFromProfiles(profiles.values());\n        if (!layoutIds.isEmpty()) {\n            layoutId = layoutIds.iterator().next();\n        }\n        if (layoutIds.size() > 1) {\n            // log that only one non-zero layout id assumption has been broken\n            logger.error(UNSUPPORTED_MULTIPLE_LAYOUTS_FOUND, person.getID());\n        }\n        return layoutId;\n    }", "code_tokens": ["private", "int", "getLayoutId", "(", "final", "IPerson", "person", ",", "final", "IUserProfile", "profile", ")", "{", "final", "Hashtable", "<", "Integer", ",", "UserProfile", ">", "profiles", "=", "getUserProfileList", "(", "person", ")", ";", "int", "layoutId", "=", "profile", ".", "getLayoutId", "(", ")", ";", "Set", "<", "Integer", ">", "layoutIds", "=", "getAllNonZeroLayoutIdsFromProfiles", "(", "profiles", ".", "values", "(", ")", ")", ";", "if", "(", "!", "layoutIds", ".", "isEmpty", "(", ")", ")", "{", "layoutId", "=", "layoutIds", ".", "iterator", "(", ")", ".", "next", "(", ")", ";", "}", "if", "(", "layoutIds", ".", "size", "(", ")", ">", "1", ")", "{", "// log that only one non-zero layout id assumption has been broken", "logger", ".", "error", "(", "UNSUPPORTED_MULTIPLE_LAYOUTS_FOUND", ",", "person", ".", "getID", "(", ")", ")", ";", "}", "return", "layoutId", ";", "}"], "docstring": "/*\nThe code currently only supports one instantiated/saved layout for a user's set\nof profiles.  If the layout hasn't been instantiated/saved for a user the layout id\nwill be zero for all the profiles and if it has been saved it will be one.\nWhen more than one layout becomes supported, this logic will need to be reworked to\nsupport multiple layouts.  It currently just checks if the layout for the user has\nbeen instantiated/saved and sets the new profile to the saved layout id (currently hardcoded\nelsewhere to always be one)", "docstring_tokens": ["/", "*", "The", "code", "currently", "only", "supports", "one", "instantiated", "/", "saved", "layout", "for", "a", "user", "s", "set", "of", "profiles", ".", "If", "the", "layout", "hasn", "t", "been", "instantiated", "/", "saved", "for", "a", "user", "the", "layout", "id", "will", "be", "zero", "for", "all", "the", "profiles", "and", "if", "it", "has", "been", "saved", "it", "will", "be", "one", ".", "When", "more", "than", "one", "layout", "becomes", "supported", "this", "logic", "will", "need", "to", "be", "reworked", "to", "support", "multiple", "layouts", ".", "It", "currently", "just", "checks", "if", "the", "layout", "for", "the", "user", "has", "been", "instantiated", "/", "saved", "and", "sets", "the", "new", "profile", "to", "the", "saved", "layout", "id", "(", "currently", "hardcoded", "elsewhere", "to", "always", "be", "one", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/simple/RDBMUserLayoutStore.java#L283-L295", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/simple/RDBMUserLayoutStore.java", "func_name": "RDBMUserLayoutStore.createLayout", "original_string": "private void createLayout(HashMap layoutStructure, Document doc, Element root, int structId) {\n        while (structId != 0) {\n            LayoutStructure ls = (LayoutStructure) layoutStructure.get(structId);\n            // replaced with call to method in containing class to allow overriding\n            // by subclasses of RDBMUserLayoutStore.\n            // Element structure = ls.getStructureDocument(doc);\n            Element structure = getStructure(doc, ls);\n            root.appendChild(structure);\n\n            String id = structure.getAttribute(\"ID\");\n            if (id != null && !id.equals(\"\")) {\n                structure.setIdAttribute(\"ID\", true);\n            }\n\n            createLayout(layoutStructure, doc, structure, ls.getChildId());\n            structId = ls.getNextId();\n        }\n    }", "language": "java", "code": "private void createLayout(HashMap layoutStructure, Document doc, Element root, int structId) {\n        while (structId != 0) {\n            LayoutStructure ls = (LayoutStructure) layoutStructure.get(structId);\n            // replaced with call to method in containing class to allow overriding\n            // by subclasses of RDBMUserLayoutStore.\n            // Element structure = ls.getStructureDocument(doc);\n            Element structure = getStructure(doc, ls);\n            root.appendChild(structure);\n\n            String id = structure.getAttribute(\"ID\");\n            if (id != null && !id.equals(\"\")) {\n                structure.setIdAttribute(\"ID\", true);\n            }\n\n            createLayout(layoutStructure, doc, structure, ls.getChildId());\n            structId = ls.getNextId();\n        }\n    }", "code_tokens": ["private", "void", "createLayout", "(", "HashMap", "layoutStructure", ",", "Document", "doc", ",", "Element", "root", ",", "int", "structId", ")", "{", "while", "(", "structId", "!=", "0", ")", "{", "LayoutStructure", "ls", "=", "(", "LayoutStructure", ")", "layoutStructure", ".", "get", "(", "structId", ")", ";", "// replaced with call to method in containing class to allow overriding", "// by subclasses of RDBMUserLayoutStore.", "// Element structure = ls.getStructureDocument(doc);", "Element", "structure", "=", "getStructure", "(", "doc", ",", "ls", ")", ";", "root", ".", "appendChild", "(", "structure", ")", ";", "String", "id", "=", "structure", ".", "getAttribute", "(", "\"ID\"", ")", ";", "if", "(", "id", "!=", "null", "&&", "!", "id", ".", "equals", "(", "\"\"", ")", ")", "{", "structure", ".", "setIdAttribute", "(", "\"ID\"", ",", "true", ")", ";", "}", "createLayout", "(", "layoutStructure", ",", "doc", ",", "structure", ",", "ls", ".", "getChildId", "(", ")", ")", ";", "structId", "=", "ls", ".", "getNextId", "(", ")", ";", "}", "}"], "docstring": "Create a layout", "docstring_tokens": ["Create", "a", "layout"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/simple/RDBMUserLayoutStore.java#L314-L331", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/simple/RDBMUserLayoutStore.java", "func_name": "RDBMUserLayoutStore.getNextStructId", "original_string": "protected String getNextStructId(final IPerson person, final String prefix) {\n        final int userId = person.getID();\n        return nextStructTransactionOperations.execute(\n                status ->\n                        jdbcOperations.execute(\n                                new ConnectionCallback<String>() {\n                                    @Override\n                                    public String doInConnection(Connection con)\n                                            throws SQLException, DataAccessException {\n\n                                        try (Statement stmt = con.createStatement()) {\n                                            String sQuery =\n                                                    \"SELECT NEXT_STRUCT_ID FROM UP_USER WHERE USER_ID=\"\n                                                            + userId;\n                                            logger.debug(\"getNextStructId(): {}\", sQuery);\n                                            int currentStructId;\n                                            try (ResultSet rs = stmt.executeQuery(sQuery)) {\n                                                if (rs.next()) {\n                                                    currentStructId = rs.getInt(1);\n                                                } else {\n                                                    throw new SQLException(\n                                                            \"no rows returned for query [\"\n                                                                    + sQuery\n                                                                    + \"]\");\n                                                }\n                                            }\n                                            int nextStructId = currentStructId + 1;\n                                            String sUpdate =\n                                                    \"UPDATE UP_USER SET NEXT_STRUCT_ID=\"\n                                                            + nextStructId\n                                                            + \" WHERE USER_ID=\"\n                                                            + userId\n                                                            + \" AND NEXT_STRUCT_ID=\"\n                                                            + currentStructId;\n                                            logger.debug(\"getNextStructId(): {}\", sUpdate);\n                                            stmt.executeUpdate(sUpdate);\n                                            return prefix + nextStructId;\n                                        }\n                                    }\n                                }));\n    }", "language": "java", "code": "protected String getNextStructId(final IPerson person, final String prefix) {\n        final int userId = person.getID();\n        return nextStructTransactionOperations.execute(\n                status ->\n                        jdbcOperations.execute(\n                                new ConnectionCallback<String>() {\n                                    @Override\n                                    public String doInConnection(Connection con)\n                                            throws SQLException, DataAccessException {\n\n                                        try (Statement stmt = con.createStatement()) {\n                                            String sQuery =\n                                                    \"SELECT NEXT_STRUCT_ID FROM UP_USER WHERE USER_ID=\"\n                                                            + userId;\n                                            logger.debug(\"getNextStructId(): {}\", sQuery);\n                                            int currentStructId;\n                                            try (ResultSet rs = stmt.executeQuery(sQuery)) {\n                                                if (rs.next()) {\n                                                    currentStructId = rs.getInt(1);\n                                                } else {\n                                                    throw new SQLException(\n                                                            \"no rows returned for query [\"\n                                                                    + sQuery\n                                                                    + \"]\");\n                                                }\n                                            }\n                                            int nextStructId = currentStructId + 1;\n                                            String sUpdate =\n                                                    \"UPDATE UP_USER SET NEXT_STRUCT_ID=\"\n                                                            + nextStructId\n                                                            + \" WHERE USER_ID=\"\n                                                            + userId\n                                                            + \" AND NEXT_STRUCT_ID=\"\n                                                            + currentStructId;\n                                            logger.debug(\"getNextStructId(): {}\", sUpdate);\n                                            stmt.executeUpdate(sUpdate);\n                                            return prefix + nextStructId;\n                                        }\n                                    }\n                                }));\n    }", "code_tokens": ["protected", "String", "getNextStructId", "(", "final", "IPerson", "person", ",", "final", "String", "prefix", ")", "{", "final", "int", "userId", "=", "person", ".", "getID", "(", ")", ";", "return", "nextStructTransactionOperations", ".", "execute", "(", "status", "->", "jdbcOperations", ".", "execute", "(", "new", "ConnectionCallback", "<", "String", ">", "(", ")", "{", "@", "Override", "public", "String", "doInConnection", "(", "Connection", "con", ")", "throws", "SQLException", ",", "DataAccessException", "{", "try", "(", "Statement", "stmt", "=", "con", ".", "createStatement", "(", ")", ")", "{", "String", "sQuery", "=", "\"SELECT NEXT_STRUCT_ID FROM UP_USER WHERE USER_ID=\"", "+", "userId", ";", "logger", ".", "debug", "(", "\"getNextStructId(): {}\"", ",", "sQuery", ")", ";", "int", "currentStructId", ";", "try", "(", "ResultSet", "rs", "=", "stmt", ".", "executeQuery", "(", "sQuery", ")", ")", "{", "if", "(", "rs", ".", "next", "(", ")", ")", "{", "currentStructId", "=", "rs", ".", "getInt", "(", "1", ")", ";", "}", "else", "{", "throw", "new", "SQLException", "(", "\"no rows returned for query [\"", "+", "sQuery", "+", "\"]\"", ")", ";", "}", "}", "int", "nextStructId", "=", "currentStructId", "+", "1", ";", "String", "sUpdate", "=", "\"UPDATE UP_USER SET NEXT_STRUCT_ID=\"", "+", "nextStructId", "+", "\" WHERE USER_ID=\"", "+", "userId", "+", "\" AND NEXT_STRUCT_ID=\"", "+", "currentStructId", ";", "logger", ".", "debug", "(", "\"getNextStructId(): {}\"", ",", "sUpdate", ")", ";", "stmt", ".", "executeUpdate", "(", "sUpdate", ")", ";", "return", "prefix", "+", "nextStructId", ";", "}", "}", "}", ")", ")", ";", "}"], "docstring": "Return the next available structure id for a user\n\n@return next free structure ID", "docstring_tokens": ["Return", "the", "next", "available", "structure", "id", "for", "a", "user"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/simple/RDBMUserLayoutStore.java#L367-L407", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/simple/RDBMUserLayoutStore.java", "func_name": "RDBMUserLayoutStore.setProfileImportExportCache", "original_string": "@Override\n    public void setProfileImportExportCache(\n            Cache<Tuple<String, String>, UserProfile> profileCache) {\n        if (profileCache == null) {\n            profileCacheHolder.remove();\n        } else {\n            profileCacheHolder.set(profileCache);\n        }\n    }", "language": "java", "code": "@Override\n    public void setProfileImportExportCache(\n            Cache<Tuple<String, String>, UserProfile> profileCache) {\n        if (profileCache == null) {\n            profileCacheHolder.remove();\n        } else {\n            profileCacheHolder.set(profileCache);\n        }\n    }", "code_tokens": ["@", "Override", "public", "void", "setProfileImportExportCache", "(", "Cache", "<", "Tuple", "<", "String", ",", "String", ">", ",", "UserProfile", ">", "profileCache", ")", "{", "if", "(", "profileCache", "==", "null", ")", "{", "profileCacheHolder", ".", "remove", "(", ")", ";", "}", "else", "{", "profileCacheHolder", ".", "set", "(", "profileCache", ")", ";", "}", "}"], "docstring": "Cache used during import/export operations", "docstring_tokens": ["Cache", "used", "during", "import", "/", "export", "operations"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/simple/RDBMUserLayoutStore.java#L885-L893", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/simple/RDBMUserLayoutStore.java", "func_name": "RDBMUserLayoutStore.setUserLayout", "original_string": "@Override\n    public void setUserLayout(\n            final IPerson person,\n            final IUserProfile profile,\n            final Document layoutXML,\n            final boolean channelsAdded) {\n        final long startTime = System.currentTimeMillis();\n        final int userId = person.getID();\n        final int profileId = profile.getProfileId();\n\n        // don't try to save null layouts.\n        if (layoutXML == null) {\n            logger.error(\n                    \"Invalid attempt to save NULL user layout for user \"\n                            + person.getUserName()\n                            + \". Skipping!\");\n            return;\n        }\n\n        transactionOperations.execute(\n                status ->\n                        jdbcOperations.execute(\n                                (ConnectionCallback<Object>)\n                                        con -> {\n                                            int layoutId;\n                                            ResultSet rs;\n\n                                            // Eventually we want to be able to just get layoutId\n                                            // from\n                                            // the\n                                            // profile, but because of the template user layouts we\n                                            // have\n                                            // to do this for now ...\n                                            layoutId = getLayoutID(userId, profileId);\n\n                                            boolean firstLayout = false;\n                                            if (layoutId == 0) {\n                                                // First personal layout for this user/profile\n                                                layoutId = 1;\n                                                firstLayout = true;\n                                            }\n\n                                            String sql =\n                                                    \"DELETE FROM UP_LAYOUT_PARAM WHERE USER_ID=? AND LAYOUT_ID=?\";\n                                            PreparedStatement pstmt = con.prepareStatement(sql);\n                                            try {\n                                                pstmt.clearParameters();\n                                                pstmt.setInt(1, userId);\n                                                pstmt.setInt(2, layoutId);\n                                                logger.debug(sql);\n                                                pstmt.executeUpdate();\n                                            } finally {\n                                                pstmt.close();\n                                            }\n\n                                            sql =\n                                                    \"DELETE FROM UP_LAYOUT_STRUCT WHERE USER_ID=? AND LAYOUT_ID=?\";\n                                            pstmt = con.prepareStatement(sql);\n                                            try {\n                                                pstmt.clearParameters();\n                                                pstmt.setInt(1, userId);\n                                                pstmt.setInt(2, layoutId);\n                                                logger.debug(sql);\n                                                pstmt.executeUpdate();\n                                            } finally {\n                                                pstmt.close();\n                                            }\n\n                                            int firstStructId;\n                                            try (PreparedStatement structStmt =\n                                                            con.prepareStatement(\n                                                                    \"INSERT INTO UP_LAYOUT_STRUCT \"\n                                                                            + \"(USER_ID, LAYOUT_ID, STRUCT_ID, NEXT_STRUCT_ID, CHLD_STRUCT_ID,EXTERNAL_ID,CHAN_ID,NAME,TYPE,HIDDEN,IMMUTABLE,UNREMOVABLE) \"\n                                                                            + \"VALUES (\"\n                                                                            + userId\n                                                                            + \",\"\n                                                                            + layoutId\n                                                                            + \",?,?,?,?,?,?,?,?,?,?)\");\n                                                    PreparedStatement parmStmt =\n                                                            con.prepareStatement(\n                                                                    \"INSERT INTO UP_LAYOUT_PARAM \"\n                                                                            + \"(USER_ID, LAYOUT_ID, STRUCT_ID, STRUCT_PARM_NM, STRUCT_PARM_VAL) \"\n                                                                            + \"VALUES (\"\n                                                                            + userId\n                                                                            + \",\"\n                                                                            + layoutId\n                                                                            + \",?,?,?)\")) {\n                                                firstStructId =\n                                                        saveStructure(\n                                                                layoutXML\n                                                                        .getFirstChild()\n                                                                        .getFirstChild(),\n                                                                structStmt,\n                                                                parmStmt);\n                                            }\n\n                                            // Check to see if the user has a matching layout\n                                            sql =\n                                                    \"SELECT * FROM UP_USER_LAYOUT WHERE USER_ID=? AND LAYOUT_ID=?\";\n                                            pstmt = con.prepareStatement(sql);\n                                            try {\n                                                pstmt.clearParameters();\n                                                pstmt.setInt(1, userId);\n                                                pstmt.setInt(2, layoutId);\n                                                logger.debug(sql);\n                                                rs = pstmt.executeQuery();\n\n                                                try {\n                                                    if (!rs.next()) {\n                                                        /*\n                                                         * In ancient times, uPortal had a notion of\n                                                         * a \"template user,\" and here we used to\n                                                         * set up profiles based on the emplate\n                                                         * user.  Now we use the 'system' user.\n                                                         */\n                                                        final int defaultUserId =\n                                                                getSystemUser().getID();\n\n                                                        // Add to UP_USER_LAYOUT\n                                                        sql =\n                                                                \"SELECT USER_ID,LAYOUT_ID,LAYOUT_TITLE,INIT_STRUCT_ID FROM UP_USER_LAYOUT WHERE USER_ID=?\";\n                                                        try (PreparedStatement pstmt2 =\n                                                                con.prepareStatement(sql)) {\n                                                            pstmt2.clearParameters();\n                                                            pstmt2.setInt(1, defaultUserId);\n                                                            logger.debug(sql);\n                                                            try (ResultSet rs2 =\n                                                                    pstmt2.executeQuery()) {\n                                                                if (rs2.next()) {\n                                                                    // There is a row for this\n                                                                    // user's\n                                                                    // template user...\n                                                                    sql =\n                                                                            \"INSERT INTO UP_USER_LAYOUT (USER_ID, LAYOUT_ID, LAYOUT_TITLE, INIT_STRUCT_ID) VALUES (?,?,?,?)\";\n                                                                    try (PreparedStatement pstmt3 =\n                                                                            con.prepareStatement(\n                                                                                    sql)) {\n                                                                        pstmt3.clearParameters();\n                                                                        pstmt3.setInt(1, userId);\n                                                                        pstmt3.setInt(\n                                                                                2,\n                                                                                rs2.getInt(\n                                                                                        \"LAYOUT_ID\"));\n                                                                        pstmt3.setString(\n                                                                                3,\n                                                                                rs2.getString(\n                                                                                        \"LAYOUT_TITLE\"));\n                                                                        pstmt3.setInt(\n                                                                                4,\n                                                                                rs2.getInt(\n                                                                                        \"INIT_STRUCT_ID\"));\n                                                                        logger.debug(sql);\n                                                                        pstmt3.executeUpdate();\n                                                                    }\n                                                                } else {\n                                                                    // We can't rely on the template\n                                                                    // user, but we still need a\n                                                                    // row...\n                                                                    sql =\n                                                                            \"INSERT INTO UP_USER_LAYOUT (USER_ID, LAYOUT_ID, LAYOUT_TITLE, INIT_STRUCT_ID) VALUES (?,?,?,?)\";\n                                                                    try (PreparedStatement pstmt3 =\n                                                                            con.prepareStatement(\n                                                                                    sql)) {\n                                                                        pstmt3.clearParameters();\n                                                                        pstmt3.setInt(1, userId);\n                                                                        pstmt3.setInt(2, layoutId);\n                                                                        pstmt3.setString(\n                                                                                3,\n                                                                                \"default layout\");\n                                                                        pstmt3.setInt(4, 1);\n                                                                        logger.debug(sql);\n                                                                        pstmt3.executeUpdate();\n                                                                    }\n                                                                }\n                                                            }\n                                                        }\n                                                    }\n                                                } finally {\n                                                    rs.close();\n                                                }\n                                            } finally {\n                                                pstmt.close();\n                                            }\n\n                                            // Update the users layout with the correct inital\n                                            // structure\n                                            // ID\n                                            sql =\n                                                    \"UPDATE UP_USER_LAYOUT SET INIT_STRUCT_ID=? WHERE USER_ID=? AND LAYOUT_ID=?\";\n                                            pstmt = con.prepareStatement(sql);\n                                            try {\n                                                pstmt.clearParameters();\n                                                pstmt.setInt(1, firstStructId);\n                                                pstmt.setInt(2, userId);\n                                                pstmt.setInt(3, layoutId);\n                                                logger.debug(sql);\n                                                pstmt.executeUpdate();\n                                            } finally {\n                                                pstmt.close();\n                                            }\n\n                                            // Update the last time the user saw the list of\n                                            // available\n                                            // channels\n                                            if (channelsAdded) {\n                                                sql =\n                                                        \"UPDATE UP_USER SET LST_CHAN_UPDT_DT=? WHERE USER_ID=?\";\n                                                pstmt = con.prepareStatement(sql);\n                                                try {\n                                                    pstmt.clearParameters();\n                                                    pstmt.setDate(\n                                                            1,\n                                                            new Date(System.currentTimeMillis()));\n                                                    pstmt.setInt(2, userId);\n                                                    logger.debug(sql);\n                                                    pstmt.executeUpdate();\n                                                } finally {\n                                                    pstmt.close();\n                                                }\n                                            }\n\n                                            if (firstLayout) {\n                                                sql =\n                                                        \"UPDATE UP_USER_PROFILE SET LAYOUT_ID=1 WHERE USER_ID=? AND PROFILE_ID=?\";\n                                                pstmt = con.prepareStatement(sql);\n                                                try {\n                                                    pstmt.clearParameters();\n                                                    pstmt.setInt(1, userId);\n                                                    pstmt.setInt(2, profileId);\n                                                    logger.debug(sql);\n                                                    pstmt.executeUpdate();\n                                                } finally {\n                                                    pstmt.close();\n                                                }\n                                            }\n\n                                            return null;\n                                        }));\n        if (logger.isDebugEnabled()) {\n            long stopTime = System.currentTimeMillis();\n            long timeTook = stopTime - startTime;\n            logger.debug(\n                    \"setUserLayout(): Layout document for user {} took {} milliseconds to save\",\n                    userId,\n                    timeTook);\n        }\n    }", "language": "java", "code": "@Override\n    public void setUserLayout(\n            final IPerson person,\n            final IUserProfile profile,\n            final Document layoutXML,\n            final boolean channelsAdded) {\n        final long startTime = System.currentTimeMillis();\n        final int userId = person.getID();\n        final int profileId = profile.getProfileId();\n\n        // don't try to save null layouts.\n        if (layoutXML == null) {\n            logger.error(\n                    \"Invalid attempt to save NULL user layout for user \"\n                            + person.getUserName()\n                            + \". Skipping!\");\n            return;\n        }\n\n        transactionOperations.execute(\n                status ->\n                        jdbcOperations.execute(\n                                (ConnectionCallback<Object>)\n                                        con -> {\n                                            int layoutId;\n                                            ResultSet rs;\n\n                                            // Eventually we want to be able to just get layoutId\n                                            // from\n                                            // the\n                                            // profile, but because of the template user layouts we\n                                            // have\n                                            // to do this for now ...\n                                            layoutId = getLayoutID(userId, profileId);\n\n                                            boolean firstLayout = false;\n                                            if (layoutId == 0) {\n                                                // First personal layout for this user/profile\n                                                layoutId = 1;\n                                                firstLayout = true;\n                                            }\n\n                                            String sql =\n                                                    \"DELETE FROM UP_LAYOUT_PARAM WHERE USER_ID=? AND LAYOUT_ID=?\";\n                                            PreparedStatement pstmt = con.prepareStatement(sql);\n                                            try {\n                                                pstmt.clearParameters();\n                                                pstmt.setInt(1, userId);\n                                                pstmt.setInt(2, layoutId);\n                                                logger.debug(sql);\n                                                pstmt.executeUpdate();\n                                            } finally {\n                                                pstmt.close();\n                                            }\n\n                                            sql =\n                                                    \"DELETE FROM UP_LAYOUT_STRUCT WHERE USER_ID=? AND LAYOUT_ID=?\";\n                                            pstmt = con.prepareStatement(sql);\n                                            try {\n                                                pstmt.clearParameters();\n                                                pstmt.setInt(1, userId);\n                                                pstmt.setInt(2, layoutId);\n                                                logger.debug(sql);\n                                                pstmt.executeUpdate();\n                                            } finally {\n                                                pstmt.close();\n                                            }\n\n                                            int firstStructId;\n                                            try (PreparedStatement structStmt =\n                                                            con.prepareStatement(\n                                                                    \"INSERT INTO UP_LAYOUT_STRUCT \"\n                                                                            + \"(USER_ID, LAYOUT_ID, STRUCT_ID, NEXT_STRUCT_ID, CHLD_STRUCT_ID,EXTERNAL_ID,CHAN_ID,NAME,TYPE,HIDDEN,IMMUTABLE,UNREMOVABLE) \"\n                                                                            + \"VALUES (\"\n                                                                            + userId\n                                                                            + \",\"\n                                                                            + layoutId\n                                                                            + \",?,?,?,?,?,?,?,?,?,?)\");\n                                                    PreparedStatement parmStmt =\n                                                            con.prepareStatement(\n                                                                    \"INSERT INTO UP_LAYOUT_PARAM \"\n                                                                            + \"(USER_ID, LAYOUT_ID, STRUCT_ID, STRUCT_PARM_NM, STRUCT_PARM_VAL) \"\n                                                                            + \"VALUES (\"\n                                                                            + userId\n                                                                            + \",\"\n                                                                            + layoutId\n                                                                            + \",?,?,?)\")) {\n                                                firstStructId =\n                                                        saveStructure(\n                                                                layoutXML\n                                                                        .getFirstChild()\n                                                                        .getFirstChild(),\n                                                                structStmt,\n                                                                parmStmt);\n                                            }\n\n                                            // Check to see if the user has a matching layout\n                                            sql =\n                                                    \"SELECT * FROM UP_USER_LAYOUT WHERE USER_ID=? AND LAYOUT_ID=?\";\n                                            pstmt = con.prepareStatement(sql);\n                                            try {\n                                                pstmt.clearParameters();\n                                                pstmt.setInt(1, userId);\n                                                pstmt.setInt(2, layoutId);\n                                                logger.debug(sql);\n                                                rs = pstmt.executeQuery();\n\n                                                try {\n                                                    if (!rs.next()) {\n                                                        /*\n                                                         * In ancient times, uPortal had a notion of\n                                                         * a \"template user,\" and here we used to\n                                                         * set up profiles based on the emplate\n                                                         * user.  Now we use the 'system' user.\n                                                         */\n                                                        final int defaultUserId =\n                                                                getSystemUser().getID();\n\n                                                        // Add to UP_USER_LAYOUT\n                                                        sql =\n                                                                \"SELECT USER_ID,LAYOUT_ID,LAYOUT_TITLE,INIT_STRUCT_ID FROM UP_USER_LAYOUT WHERE USER_ID=?\";\n                                                        try (PreparedStatement pstmt2 =\n                                                                con.prepareStatement(sql)) {\n                                                            pstmt2.clearParameters();\n                                                            pstmt2.setInt(1, defaultUserId);\n                                                            logger.debug(sql);\n                                                            try (ResultSet rs2 =\n                                                                    pstmt2.executeQuery()) {\n                                                                if (rs2.next()) {\n                                                                    // There is a row for this\n                                                                    // user's\n                                                                    // template user...\n                                                                    sql =\n                                                                            \"INSERT INTO UP_USER_LAYOUT (USER_ID, LAYOUT_ID, LAYOUT_TITLE, INIT_STRUCT_ID) VALUES (?,?,?,?)\";\n                                                                    try (PreparedStatement pstmt3 =\n                                                                            con.prepareStatement(\n                                                                                    sql)) {\n                                                                        pstmt3.clearParameters();\n                                                                        pstmt3.setInt(1, userId);\n                                                                        pstmt3.setInt(\n                                                                                2,\n                                                                                rs2.getInt(\n                                                                                        \"LAYOUT_ID\"));\n                                                                        pstmt3.setString(\n                                                                                3,\n                                                                                rs2.getString(\n                                                                                        \"LAYOUT_TITLE\"));\n                                                                        pstmt3.setInt(\n                                                                                4,\n                                                                                rs2.getInt(\n                                                                                        \"INIT_STRUCT_ID\"));\n                                                                        logger.debug(sql);\n                                                                        pstmt3.executeUpdate();\n                                                                    }\n                                                                } else {\n                                                                    // We can't rely on the template\n                                                                    // user, but we still need a\n                                                                    // row...\n                                                                    sql =\n                                                                            \"INSERT INTO UP_USER_LAYOUT (USER_ID, LAYOUT_ID, LAYOUT_TITLE, INIT_STRUCT_ID) VALUES (?,?,?,?)\";\n                                                                    try (PreparedStatement pstmt3 =\n                                                                            con.prepareStatement(\n                                                                                    sql)) {\n                                                                        pstmt3.clearParameters();\n                                                                        pstmt3.setInt(1, userId);\n                                                                        pstmt3.setInt(2, layoutId);\n                                                                        pstmt3.setString(\n                                                                                3,\n                                                                                \"default layout\");\n                                                                        pstmt3.setInt(4, 1);\n                                                                        logger.debug(sql);\n                                                                        pstmt3.executeUpdate();\n                                                                    }\n                                                                }\n                                                            }\n                                                        }\n                                                    }\n                                                } finally {\n                                                    rs.close();\n                                                }\n                                            } finally {\n                                                pstmt.close();\n                                            }\n\n                                            // Update the users layout with the correct inital\n                                            // structure\n                                            // ID\n                                            sql =\n                                                    \"UPDATE UP_USER_LAYOUT SET INIT_STRUCT_ID=? WHERE USER_ID=? AND LAYOUT_ID=?\";\n                                            pstmt = con.prepareStatement(sql);\n                                            try {\n                                                pstmt.clearParameters();\n                                                pstmt.setInt(1, firstStructId);\n                                                pstmt.setInt(2, userId);\n                                                pstmt.setInt(3, layoutId);\n                                                logger.debug(sql);\n                                                pstmt.executeUpdate();\n                                            } finally {\n                                                pstmt.close();\n                                            }\n\n                                            // Update the last time the user saw the list of\n                                            // available\n                                            // channels\n                                            if (channelsAdded) {\n                                                sql =\n                                                        \"UPDATE UP_USER SET LST_CHAN_UPDT_DT=? WHERE USER_ID=?\";\n                                                pstmt = con.prepareStatement(sql);\n                                                try {\n                                                    pstmt.clearParameters();\n                                                    pstmt.setDate(\n                                                            1,\n                                                            new Date(System.currentTimeMillis()));\n                                                    pstmt.setInt(2, userId);\n                                                    logger.debug(sql);\n                                                    pstmt.executeUpdate();\n                                                } finally {\n                                                    pstmt.close();\n                                                }\n                                            }\n\n                                            if (firstLayout) {\n                                                sql =\n                                                        \"UPDATE UP_USER_PROFILE SET LAYOUT_ID=1 WHERE USER_ID=? AND PROFILE_ID=?\";\n                                                pstmt = con.prepareStatement(sql);\n                                                try {\n                                                    pstmt.clearParameters();\n                                                    pstmt.setInt(1, userId);\n                                                    pstmt.setInt(2, profileId);\n                                                    logger.debug(sql);\n                                                    pstmt.executeUpdate();\n                                                } finally {\n                                                    pstmt.close();\n                                                }\n                                            }\n\n                                            return null;\n                                        }));\n        if (logger.isDebugEnabled()) {\n            long stopTime = System.currentTimeMillis();\n            long timeTook = stopTime - startTime;\n            logger.debug(\n                    \"setUserLayout(): Layout document for user {} took {} milliseconds to save\",\n                    userId,\n                    timeTook);\n        }\n    }", "code_tokens": ["@", "Override", "public", "void", "setUserLayout", "(", "final", "IPerson", "person", ",", "final", "IUserProfile", "profile", ",", "final", "Document", "layoutXML", ",", "final", "boolean", "channelsAdded", ")", "{", "final", "long", "startTime", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "final", "int", "userId", "=", "person", ".", "getID", "(", ")", ";", "final", "int", "profileId", "=", "profile", ".", "getProfileId", "(", ")", ";", "// don't try to save null layouts.", "if", "(", "layoutXML", "==", "null", ")", "{", "logger", ".", "error", "(", "\"Invalid attempt to save NULL user layout for user \"", "+", "person", ".", "getUserName", "(", ")", "+", "\". Skipping!\"", ")", ";", "return", ";", "}", "transactionOperations", ".", "execute", "(", "status", "->", "jdbcOperations", ".", "execute", "(", "(", "ConnectionCallback", "<", "Object", ">", ")", "con", "->", "{", "int", "layoutId", ";", "ResultSet", "rs", ";", "// Eventually we want to be able to just get layoutId", "// from", "// the", "// profile, but because of the template user layouts we", "// have", "// to do this for now ...", "layoutId", "=", "getLayoutID", "(", "userId", ",", "profileId", ")", ";", "boolean", "firstLayout", "=", "false", ";", "if", "(", "layoutId", "==", "0", ")", "{", "// First personal layout for this user/profile", "layoutId", "=", "1", ";", "firstLayout", "=", "true", ";", "}", "String", "sql", "=", "\"DELETE FROM UP_LAYOUT_PARAM WHERE USER_ID=? AND LAYOUT_ID=?\"", ";", "PreparedStatement", "pstmt", "=", "con", ".", "prepareStatement", "(", "sql", ")", ";", "try", "{", "pstmt", ".", "clearParameters", "(", ")", ";", "pstmt", ".", "setInt", "(", "1", ",", "userId", ")", ";", "pstmt", ".", "setInt", "(", "2", ",", "layoutId", ")", ";", "logger", ".", "debug", "(", "sql", ")", ";", "pstmt", ".", "executeUpdate", "(", ")", ";", "}", "finally", "{", "pstmt", ".", "close", "(", ")", ";", "}", "sql", "=", "\"DELETE FROM UP_LAYOUT_STRUCT WHERE USER_ID=? AND LAYOUT_ID=?\"", ";", "pstmt", "=", "con", ".", "prepareStatement", "(", "sql", ")", ";", "try", "{", "pstmt", ".", "clearParameters", "(", ")", ";", "pstmt", ".", "setInt", "(", "1", ",", "userId", ")", ";", "pstmt", ".", "setInt", "(", "2", ",", "layoutId", ")", ";", "logger", ".", "debug", "(", "sql", ")", ";", "pstmt", ".", "executeUpdate", "(", ")", ";", "}", "finally", "{", "pstmt", ".", "close", "(", ")", ";", "}", "int", "firstStructId", ";", "try", "(", "PreparedStatement", "structStmt", "=", "con", ".", "prepareStatement", "(", "\"INSERT INTO UP_LAYOUT_STRUCT \"", "+", "\"(USER_ID, LAYOUT_ID, STRUCT_ID, NEXT_STRUCT_ID, CHLD_STRUCT_ID,EXTERNAL_ID,CHAN_ID,NAME,TYPE,HIDDEN,IMMUTABLE,UNREMOVABLE) \"", "+", "\"VALUES (\"", "+", "userId", "+", "\",\"", "+", "layoutId", "+", "\",?,?,?,?,?,?,?,?,?,?)\"", ")", ";", "PreparedStatement", "parmStmt", "=", "con", ".", "prepareStatement", "(", "\"INSERT INTO UP_LAYOUT_PARAM \"", "+", "\"(USER_ID, LAYOUT_ID, STRUCT_ID, STRUCT_PARM_NM, STRUCT_PARM_VAL) \"", "+", "\"VALUES (\"", "+", "userId", "+", "\",\"", "+", "layoutId", "+", "\",?,?,?)\"", ")", ")", "{", "firstStructId", "=", "saveStructure", "(", "layoutXML", ".", "getFirstChild", "(", ")", ".", "getFirstChild", "(", ")", ",", "structStmt", ",", "parmStmt", ")", ";", "}", "// Check to see if the user has a matching layout", "sql", "=", "\"SELECT * FROM UP_USER_LAYOUT WHERE USER_ID=? AND LAYOUT_ID=?\"", ";", "pstmt", "=", "con", ".", "prepareStatement", "(", "sql", ")", ";", "try", "{", "pstmt", ".", "clearParameters", "(", ")", ";", "pstmt", ".", "setInt", "(", "1", ",", "userId", ")", ";", "pstmt", ".", "setInt", "(", "2", ",", "layoutId", ")", ";", "logger", ".", "debug", "(", "sql", ")", ";", "rs", "=", "pstmt", ".", "executeQuery", "(", ")", ";", "try", "{", "if", "(", "!", "rs", ".", "next", "(", ")", ")", "{", "/*\n                                                         * In ancient times, uPortal had a notion of\n                                                         * a \"template user,\" and here we used to\n                                                         * set up profiles based on the emplate\n                                                         * user.  Now we use the 'system' user.\n                                                         */", "final", "int", "defaultUserId", "=", "getSystemUser", "(", ")", ".", "getID", "(", ")", ";", "// Add to UP_USER_LAYOUT", "sql", "=", "\"SELECT USER_ID,LAYOUT_ID,LAYOUT_TITLE,INIT_STRUCT_ID FROM UP_USER_LAYOUT WHERE USER_ID=?\"", ";", "try", "(", "PreparedStatement", "pstmt2", "=", "con", ".", "prepareStatement", "(", "sql", ")", ")", "{", "pstmt2", ".", "clearParameters", "(", ")", ";", "pstmt2", ".", "setInt", "(", "1", ",", "defaultUserId", ")", ";", "logger", ".", "debug", "(", "sql", ")", ";", "try", "(", "ResultSet", "rs2", "=", "pstmt2", ".", "executeQuery", "(", ")", ")", "{", "if", "(", "rs2", ".", "next", "(", ")", ")", "{", "// There is a row for this", "// user's", "// template user...", "sql", "=", "\"INSERT INTO UP_USER_LAYOUT (USER_ID, LAYOUT_ID, LAYOUT_TITLE, INIT_STRUCT_ID) VALUES (?,?,?,?)\"", ";", "try", "(", "PreparedStatement", "pstmt3", "=", "con", ".", "prepareStatement", "(", "sql", ")", ")", "{", "pstmt3", ".", "clearParameters", "(", ")", ";", "pstmt3", ".", "setInt", "(", "1", ",", "userId", ")", ";", "pstmt3", ".", "setInt", "(", "2", ",", "rs2", ".", "getInt", "(", "\"LAYOUT_ID\"", ")", ")", ";", "pstmt3", ".", "setString", "(", "3", ",", "rs2", ".", "getString", "(", "\"LAYOUT_TITLE\"", ")", ")", ";", "pstmt3", ".", "setInt", "(", "4", ",", "rs2", ".", "getInt", "(", "\"INIT_STRUCT_ID\"", ")", ")", ";", "logger", ".", "debug", "(", "sql", ")", ";", "pstmt3", ".", "executeUpdate", "(", ")", ";", "}", "}", "else", "{", "// We can't rely on the template", "// user, but we still need a", "// row...", "sql", "=", "\"INSERT INTO UP_USER_LAYOUT (USER_ID, LAYOUT_ID, LAYOUT_TITLE, INIT_STRUCT_ID) VALUES (?,?,?,?)\"", ";", "try", "(", "PreparedStatement", "pstmt3", "=", "con", ".", "prepareStatement", "(", "sql", ")", ")", "{", "pstmt3", ".", "clearParameters", "(", ")", ";", "pstmt3", ".", "setInt", "(", "1", ",", "userId", ")", ";", "pstmt3", ".", "setInt", "(", "2", ",", "layoutId", ")", ";", "pstmt3", ".", "setString", "(", "3", ",", "\"default layout\"", ")", ";", "pstmt3", ".", "setInt", "(", "4", ",", "1", ")", ";", "logger", ".", "debug", "(", "sql", ")", ";", "pstmt3", ".", "executeUpdate", "(", ")", ";", "}", "}", "}", "}", "}", "}", "finally", "{", "rs", ".", "close", "(", ")", ";", "}", "}", "finally", "{", "pstmt", ".", "close", "(", ")", ";", "}", "// Update the users layout with the correct inital", "// structure", "// ID", "sql", "=", "\"UPDATE UP_USER_LAYOUT SET INIT_STRUCT_ID=? WHERE USER_ID=? AND LAYOUT_ID=?\"", ";", "pstmt", "=", "con", ".", "prepareStatement", "(", "sql", ")", ";", "try", "{", "pstmt", ".", "clearParameters", "(", ")", ";", "pstmt", ".", "setInt", "(", "1", ",", "firstStructId", ")", ";", "pstmt", ".", "setInt", "(", "2", ",", "userId", ")", ";", "pstmt", ".", "setInt", "(", "3", ",", "layoutId", ")", ";", "logger", ".", "debug", "(", "sql", ")", ";", "pstmt", ".", "executeUpdate", "(", ")", ";", "}", "finally", "{", "pstmt", ".", "close", "(", ")", ";", "}", "// Update the last time the user saw the list of", "// available", "// channels", "if", "(", "channelsAdded", ")", "{", "sql", "=", "\"UPDATE UP_USER SET LST_CHAN_UPDT_DT=? WHERE USER_ID=?\"", ";", "pstmt", "=", "con", ".", "prepareStatement", "(", "sql", ")", ";", "try", "{", "pstmt", ".", "clearParameters", "(", ")", ";", "pstmt", ".", "setDate", "(", "1", ",", "new", "Date", "(", "System", ".", "currentTimeMillis", "(", ")", ")", ")", ";", "pstmt", ".", "setInt", "(", "2", ",", "userId", ")", ";", "logger", ".", "debug", "(", "sql", ")", ";", "pstmt", ".", "executeUpdate", "(", ")", ";", "}", "finally", "{", "pstmt", ".", "close", "(", ")", ";", "}", "}", "if", "(", "firstLayout", ")", "{", "sql", "=", "\"UPDATE UP_USER_PROFILE SET LAYOUT_ID=1 WHERE USER_ID=? AND PROFILE_ID=?\"", ";", "pstmt", "=", "con", ".", "prepareStatement", "(", "sql", ")", ";", "try", "{", "pstmt", ".", "clearParameters", "(", ")", ";", "pstmt", ".", "setInt", "(", "1", ",", "userId", ")", ";", "pstmt", ".", "setInt", "(", "2", ",", "profileId", ")", ";", "logger", ".", "debug", "(", "sql", ")", ";", "pstmt", ".", "executeUpdate", "(", ")", ";", "}", "finally", "{", "pstmt", ".", "close", "(", ")", ";", "}", "}", "return", "null", ";", "}", ")", ")", ";", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "long", "stopTime", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "long", "timeTook", "=", "stopTime", "-", "startTime", ";", "logger", ".", "debug", "(", "\"setUserLayout(): Layout document for user {} took {} milliseconds to save\"", ",", "userId", ",", "timeTook", ")", ";", "}", "}"], "docstring": "Save the user layout.", "docstring_tokens": ["Save", "the", "user", "layout", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/simple/RDBMUserLayoutStore.java#L1093-L1339", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/simple/RDBMUserLayoutStore.java", "func_name": "RDBMUserLayoutStore.getLayoutID", "original_string": "private int getLayoutID(final int userId, final int profileId) {\n        return jdbcOperations.execute(\n                (ConnectionCallback<Integer>)\n                        con -> {\n                            String query =\n                                    \"SELECT LAYOUT_ID \"\n                                            + \"FROM UP_USER_PROFILE \"\n                                            + \"WHERE USER_ID=? AND PROFILE_ID=?\";\n\n                            int layoutId = 0;\n                            PreparedStatement pstmt = con.prepareStatement(query);\n\n                            logger.debug(\n                                    \"getLayoutID(userId={}, profileId={} ): {}\",\n                                    userId,\n                                    profileId,\n                                    query);\n\n                            pstmt.setInt(1, userId);\n                            pstmt.setInt(2, profileId);\n                            try {\n                                ResultSet rs = pstmt.executeQuery();\n                                if (rs.next()) {\n                                    layoutId = rs.getInt(1);\n\n                                    if (rs.wasNull()) {\n                                        layoutId = 0;\n                                    }\n                                }\n                            } finally {\n                                pstmt.close();\n                            }\n                            return layoutId;\n                        });\n    }", "language": "java", "code": "private int getLayoutID(final int userId, final int profileId) {\n        return jdbcOperations.execute(\n                (ConnectionCallback<Integer>)\n                        con -> {\n                            String query =\n                                    \"SELECT LAYOUT_ID \"\n                                            + \"FROM UP_USER_PROFILE \"\n                                            + \"WHERE USER_ID=? AND PROFILE_ID=?\";\n\n                            int layoutId = 0;\n                            PreparedStatement pstmt = con.prepareStatement(query);\n\n                            logger.debug(\n                                    \"getLayoutID(userId={}, profileId={} ): {}\",\n                                    userId,\n                                    profileId,\n                                    query);\n\n                            pstmt.setInt(1, userId);\n                            pstmt.setInt(2, profileId);\n                            try {\n                                ResultSet rs = pstmt.executeQuery();\n                                if (rs.next()) {\n                                    layoutId = rs.getInt(1);\n\n                                    if (rs.wasNull()) {\n                                        layoutId = 0;\n                                    }\n                                }\n                            } finally {\n                                pstmt.close();\n                            }\n                            return layoutId;\n                        });\n    }", "code_tokens": ["private", "int", "getLayoutID", "(", "final", "int", "userId", ",", "final", "int", "profileId", ")", "{", "return", "jdbcOperations", ".", "execute", "(", "(", "ConnectionCallback", "<", "Integer", ">", ")", "con", "->", "{", "String", "query", "=", "\"SELECT LAYOUT_ID \"", "+", "\"FROM UP_USER_PROFILE \"", "+", "\"WHERE USER_ID=? AND PROFILE_ID=?\"", ";", "int", "layoutId", "=", "0", ";", "PreparedStatement", "pstmt", "=", "con", ".", "prepareStatement", "(", "query", ")", ";", "logger", ".", "debug", "(", "\"getLayoutID(userId={}, profileId={} ): {}\"", ",", "userId", ",", "profileId", ",", "query", ")", ";", "pstmt", ".", "setInt", "(", "1", ",", "userId", ")", ";", "pstmt", ".", "setInt", "(", "2", ",", "profileId", ")", ";", "try", "{", "ResultSet", "rs", "=", "pstmt", ".", "executeQuery", "(", ")", ";", "if", "(", "rs", ".", "next", "(", ")", ")", "{", "layoutId", "=", "rs", ".", "getInt", "(", "1", ")", ";", "if", "(", "rs", ".", "wasNull", "(", ")", ")", "{", "layoutId", "=", "0", ";", "}", "}", "}", "finally", "{", "pstmt", ".", "close", "(", ")", ";", "}", "return", "layoutId", ";", "}", ")", ";", "}"], "docstring": "Returns the current layout ID for the user and profile. If the profile doesn't exist or the\nlayout_id field is null 0 is returned.\n\n@param userId The userId for the profile\n@param profileId The profileId for the profile\n@return The layout_id field or 0 if it does not exist or is null", "docstring_tokens": ["Returns", "the", "current", "layout", "ID", "for", "the", "user", "and", "profile", ".", "If", "the", "profile", "doesn", "t", "exist", "or", "the", "layout_id", "field", "is", "null", "0", "is", "returned", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/simple/RDBMUserLayoutStore.java#L1491-L1525", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceLoader.java", "func_name": "ResourceLoader.getResourceAsURL", "original_string": "public static URL getResourceAsURL(Class<?> requestingClass, String resource)\n            throws ResourceMissingException {\n        final Tuple<Class<?>, String> cacheKey =\n                new Tuple<Class<?>, String>(requestingClass, resource);\n\n        // Look for a cached URL\n        final Map<Tuple<Class<?>, String>, URL> resourceUrlCache = ResourceLoader.resourceUrlCache;\n        URL resourceURL = resourceUrlCache != null ? resourceUrlCache.get(cacheKey) : null;\n        if (resourceURL != null) {\n            return resourceURL;\n        }\n\n        // Look for a failed lookup\n        final Map<Tuple<Class<?>, String>, ResourceMissingException> resourceUrlNotFoundCache =\n                ResourceLoader.resourceUrlNotFoundCache;\n        ResourceMissingException exception =\n                resourceUrlNotFoundCache != null ? resourceUrlNotFoundCache.get(cacheKey) : null;\n        if (exception != null) {\n            throw new ResourceMissingException(exception);\n        }\n\n        try {\n            resourceURL = new URL(resource);\n        } catch (MalformedURLException murle) {\n            // URL is invalid, now try to load from classpath\n            resourceURL = requestingClass.getResource(resource);\n\n            if (resourceURL == null) {\n                String resourceRelativeToClasspath = null;\n                if (resource.startsWith(\"/\")) resourceRelativeToClasspath = resource;\n                else\n                    resourceRelativeToClasspath =\n                            '/'\n                                    + requestingClass.getPackage().getName().replace('.', '/')\n                                    + '/'\n                                    + resource;\n                exception =\n                        new ResourceMissingException(\n                                resource,\n                                resourceRelativeToClasspath,\n                                \"Resource not found in classpath: \" + resourceRelativeToClasspath);\n                if (resourceUrlNotFoundCache != null) {\n                    resourceUrlNotFoundCache.put(cacheKey, exception);\n                }\n                throw new ResourceMissingException(exception);\n            }\n        }\n\n        if (resourceUrlCache != null) {\n            resourceUrlCache.put(cacheKey, resourceURL);\n        }\n        return resourceURL;\n    }", "language": "java", "code": "public static URL getResourceAsURL(Class<?> requestingClass, String resource)\n            throws ResourceMissingException {\n        final Tuple<Class<?>, String> cacheKey =\n                new Tuple<Class<?>, String>(requestingClass, resource);\n\n        // Look for a cached URL\n        final Map<Tuple<Class<?>, String>, URL> resourceUrlCache = ResourceLoader.resourceUrlCache;\n        URL resourceURL = resourceUrlCache != null ? resourceUrlCache.get(cacheKey) : null;\n        if (resourceURL != null) {\n            return resourceURL;\n        }\n\n        // Look for a failed lookup\n        final Map<Tuple<Class<?>, String>, ResourceMissingException> resourceUrlNotFoundCache =\n                ResourceLoader.resourceUrlNotFoundCache;\n        ResourceMissingException exception =\n                resourceUrlNotFoundCache != null ? resourceUrlNotFoundCache.get(cacheKey) : null;\n        if (exception != null) {\n            throw new ResourceMissingException(exception);\n        }\n\n        try {\n            resourceURL = new URL(resource);\n        } catch (MalformedURLException murle) {\n            // URL is invalid, now try to load from classpath\n            resourceURL = requestingClass.getResource(resource);\n\n            if (resourceURL == null) {\n                String resourceRelativeToClasspath = null;\n                if (resource.startsWith(\"/\")) resourceRelativeToClasspath = resource;\n                else\n                    resourceRelativeToClasspath =\n                            '/'\n                                    + requestingClass.getPackage().getName().replace('.', '/')\n                                    + '/'\n                                    + resource;\n                exception =\n                        new ResourceMissingException(\n                                resource,\n                                resourceRelativeToClasspath,\n                                \"Resource not found in classpath: \" + resourceRelativeToClasspath);\n                if (resourceUrlNotFoundCache != null) {\n                    resourceUrlNotFoundCache.put(cacheKey, exception);\n                }\n                throw new ResourceMissingException(exception);\n            }\n        }\n\n        if (resourceUrlCache != null) {\n            resourceUrlCache.put(cacheKey, resourceURL);\n        }\n        return resourceURL;\n    }", "code_tokens": ["public", "static", "URL", "getResourceAsURL", "(", "Class", "<", "?", ">", "requestingClass", ",", "String", "resource", ")", "throws", "ResourceMissingException", "{", "final", "Tuple", "<", "Class", "<", "?", ">", ",", "String", ">", "cacheKey", "=", "new", "Tuple", "<", "Class", "<", "?", ">", ",", "String", ">", "(", "requestingClass", ",", "resource", ")", ";", "// Look for a cached URL", "final", "Map", "<", "Tuple", "<", "Class", "<", "?", ">", ",", "String", ">", ",", "URL", ">", "resourceUrlCache", "=", "ResourceLoader", ".", "resourceUrlCache", ";", "URL", "resourceURL", "=", "resourceUrlCache", "!=", "null", "?", "resourceUrlCache", ".", "get", "(", "cacheKey", ")", ":", "null", ";", "if", "(", "resourceURL", "!=", "null", ")", "{", "return", "resourceURL", ";", "}", "// Look for a failed lookup", "final", "Map", "<", "Tuple", "<", "Class", "<", "?", ">", ",", "String", ">", ",", "ResourceMissingException", ">", "resourceUrlNotFoundCache", "=", "ResourceLoader", ".", "resourceUrlNotFoundCache", ";", "ResourceMissingException", "exception", "=", "resourceUrlNotFoundCache", "!=", "null", "?", "resourceUrlNotFoundCache", ".", "get", "(", "cacheKey", ")", ":", "null", ";", "if", "(", "exception", "!=", "null", ")", "{", "throw", "new", "ResourceMissingException", "(", "exception", ")", ";", "}", "try", "{", "resourceURL", "=", "new", "URL", "(", "resource", ")", ";", "}", "catch", "(", "MalformedURLException", "murle", ")", "{", "// URL is invalid, now try to load from classpath", "resourceURL", "=", "requestingClass", ".", "getResource", "(", "resource", ")", ";", "if", "(", "resourceURL", "==", "null", ")", "{", "String", "resourceRelativeToClasspath", "=", "null", ";", "if", "(", "resource", ".", "startsWith", "(", "\"/\"", ")", ")", "resourceRelativeToClasspath", "=", "resource", ";", "else", "resourceRelativeToClasspath", "=", "'", "'", "+", "requestingClass", ".", "getPackage", "(", ")", ".", "getName", "(", ")", ".", "replace", "(", "'", "'", ",", "'", "'", ")", "+", "'", "'", "+", "resource", ";", "exception", "=", "new", "ResourceMissingException", "(", "resource", ",", "resourceRelativeToClasspath", ",", "\"Resource not found in classpath: \"", "+", "resourceRelativeToClasspath", ")", ";", "if", "(", "resourceUrlNotFoundCache", "!=", "null", ")", "{", "resourceUrlNotFoundCache", ".", "put", "(", "cacheKey", ",", "exception", ")", ";", "}", "throw", "new", "ResourceMissingException", "(", "exception", ")", ";", "}", "}", "if", "(", "resourceUrlCache", "!=", "null", ")", "{", "resourceUrlCache", ".", "put", "(", "cacheKey", ",", "resourceURL", ")", ";", "}", "return", "resourceURL", ";", "}"], "docstring": "Finds a resource with a given name. This is a convenience method for accessing a resource\nfrom a channel or from the uPortal framework. If a well-formed URL is passed in, this method\nwill use that URL unchanged to find the resource. If the URL is not well-formed, this method\nwill look for the desired resource relative to the classpath. If the resource name starts\nwith \"/\", it is unchanged. Otherwise, the package name of the requesting class is prepended\nto the resource name.\n\n@param requestingClass the java.lang.Class object of the class that is attempting to load the\nresource\n@param resource a String describing the full or partial URL of the resource to load\n@return a URL identifying the requested resource\n@throws ResourceMissingException", "docstring_tokens": ["Finds", "a", "resource", "with", "a", "given", "name", ".", "This", "is", "a", "convenience", "method", "for", "accessing", "a", "resource", "from", "a", "channel", "or", "from", "the", "uPortal", "framework", ".", "If", "a", "well", "-", "formed", "URL", "is", "passed", "in", "this", "method", "will", "use", "that", "URL", "unchanged", "to", "find", "the", "resource", ".", "If", "the", "URL", "is", "not", "well", "-", "formed", "this", "method", "will", "look", "for", "the", "desired", "resource", "relative", "to", "the", "classpath", ".", "If", "the", "resource", "name", "starts", "with", "/", "it", "is", "unchanged", ".", "Otherwise", "the", "package", "name", "of", "the", "requesting", "class", "is", "prepended", "to", "the", "resource", "name", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceLoader.java#L117-L169", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceLoader.java", "func_name": "ResourceLoader.getResourceAsURLString", "original_string": "public static String getResourceAsURLString(Class<?> requestingClass, String resource)\n            throws ResourceMissingException {\n        return getResourceAsURL(requestingClass, resource).toString();\n    }", "language": "java", "code": "public static String getResourceAsURLString(Class<?> requestingClass, String resource)\n            throws ResourceMissingException {\n        return getResourceAsURL(requestingClass, resource).toString();\n    }", "code_tokens": ["public", "static", "String", "getResourceAsURLString", "(", "Class", "<", "?", ">", "requestingClass", ",", "String", "resource", ")", "throws", "ResourceMissingException", "{", "return", "getResourceAsURL", "(", "requestingClass", ",", "resource", ")", ".", "toString", "(", ")", ";", "}"], "docstring": "Returns the requested resource as a URL string.\n\n@param requestingClass the java.lang.Class object of the class that is attempting to load the\nresource\n@param resource a String describing the full or partial URL of the resource to load\n@return the requested resource as a URL string\n@throws ResourceMissingException", "docstring_tokens": ["Returns", "the", "requested", "resource", "as", "a", "URL", "string", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceLoader.java#L180-L183", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceLoader.java", "func_name": "ResourceLoader.getResourceAsStream", "original_string": "public static InputStream getResourceAsStream(Class<?> requestingClass, String resource)\n            throws ResourceMissingException, IOException {\n        return getResourceAsURL(requestingClass, resource).openStream();\n    }", "language": "java", "code": "public static InputStream getResourceAsStream(Class<?> requestingClass, String resource)\n            throws ResourceMissingException, IOException {\n        return getResourceAsURL(requestingClass, resource).openStream();\n    }", "code_tokens": ["public", "static", "InputStream", "getResourceAsStream", "(", "Class", "<", "?", ">", "requestingClass", ",", "String", "resource", ")", "throws", "ResourceMissingException", ",", "IOException", "{", "return", "getResourceAsURL", "(", "requestingClass", ",", "resource", ")", ".", "openStream", "(", ")", ";", "}"], "docstring": "Returns the requested resource as a stream.\n\n@param requestingClass the java.lang.Class object of the class that is attempting to load the\nresource\n@param resource a String describing the full or partial URL of the resource to load\n@return the requested resource as a stream\n@throws ResourceMissingException\n@throws java.io.IOException", "docstring_tokens": ["Returns", "the", "requested", "resource", "as", "a", "stream", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceLoader.java#L212-L215", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceLoader.java", "func_name": "ResourceLoader.getResourceAsSAXInputSource", "original_string": "public static InputSource getResourceAsSAXInputSource(Class<?> requestingClass, String resource)\n            throws ResourceMissingException, IOException {\n        URL url = getResourceAsURL(requestingClass, resource);\n        InputSource source = new InputSource(url.openStream());\n        source.setPublicId(url.toExternalForm());\n        return source;\n    }", "language": "java", "code": "public static InputSource getResourceAsSAXInputSource(Class<?> requestingClass, String resource)\n            throws ResourceMissingException, IOException {\n        URL url = getResourceAsURL(requestingClass, resource);\n        InputSource source = new InputSource(url.openStream());\n        source.setPublicId(url.toExternalForm());\n        return source;\n    }", "code_tokens": ["public", "static", "InputSource", "getResourceAsSAXInputSource", "(", "Class", "<", "?", ">", "requestingClass", ",", "String", "resource", ")", "throws", "ResourceMissingException", ",", "IOException", "{", "URL", "url", "=", "getResourceAsURL", "(", "requestingClass", ",", "resource", ")", ";", "InputSource", "source", "=", "new", "InputSource", "(", "url", ".", "openStream", "(", ")", ")", ";", "source", ".", "setPublicId", "(", "url", ".", "toExternalForm", "(", ")", ")", ";", "return", "source", ";", "}"], "docstring": "Returns the requested resource as a SAX input source.\n\n@param requestingClass the java.lang.Class object of the class that is attempting to load the\nresource\n@param resource a String describing the full or partial URL of the resource to load\n@return the requested resource as a SAX input source\n@throws ResourceMissingException\n@throws java.io.IOException", "docstring_tokens": ["Returns", "the", "requested", "resource", "as", "a", "SAX", "input", "source", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceLoader.java#L227-L233", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceLoader.java", "func_name": "ResourceLoader.getResourceAsDocument", "original_string": "public static Document getResourceAsDocument(\n            Class<?> requestingClass, String resource, boolean validate)\n            throws ResourceMissingException, IOException, ParserConfigurationException,\n                    SAXException {\n        Document document = null;\n        InputStream inputStream = null;\n\n        try {\n\n            DocumentBuilderFactory factoryToUse = null;\n\n            if (validate) {\n                factoryToUse = ResourceLoader.validatingDocumentBuilderFactory;\n            } else {\n                factoryToUse = ResourceLoader.nonValidatingDocumentBuilderFactory;\n            }\n            inputStream = getResourceAsStream(requestingClass, resource);\n            DocumentBuilder db = factoryToUse.newDocumentBuilder();\n\n            db.setEntityResolver(new DTDResolver());\n            db.setErrorHandler(\n                    new SAXErrorHandler(\"ResourceLoader.getResourceAsDocument(\" + resource + \")\"));\n            document = db.parse(inputStream);\n        } finally {\n            if (inputStream != null) inputStream.close();\n        }\n        return document;\n    }", "language": "java", "code": "public static Document getResourceAsDocument(\n            Class<?> requestingClass, String resource, boolean validate)\n            throws ResourceMissingException, IOException, ParserConfigurationException,\n                    SAXException {\n        Document document = null;\n        InputStream inputStream = null;\n\n        try {\n\n            DocumentBuilderFactory factoryToUse = null;\n\n            if (validate) {\n                factoryToUse = ResourceLoader.validatingDocumentBuilderFactory;\n            } else {\n                factoryToUse = ResourceLoader.nonValidatingDocumentBuilderFactory;\n            }\n            inputStream = getResourceAsStream(requestingClass, resource);\n            DocumentBuilder db = factoryToUse.newDocumentBuilder();\n\n            db.setEntityResolver(new DTDResolver());\n            db.setErrorHandler(\n                    new SAXErrorHandler(\"ResourceLoader.getResourceAsDocument(\" + resource + \")\"));\n            document = db.parse(inputStream);\n        } finally {\n            if (inputStream != null) inputStream.close();\n        }\n        return document;\n    }", "code_tokens": ["public", "static", "Document", "getResourceAsDocument", "(", "Class", "<", "?", ">", "requestingClass", ",", "String", "resource", ",", "boolean", "validate", ")", "throws", "ResourceMissingException", ",", "IOException", ",", "ParserConfigurationException", ",", "SAXException", "{", "Document", "document", "=", "null", ";", "InputStream", "inputStream", "=", "null", ";", "try", "{", "DocumentBuilderFactory", "factoryToUse", "=", "null", ";", "if", "(", "validate", ")", "{", "factoryToUse", "=", "ResourceLoader", ".", "validatingDocumentBuilderFactory", ";", "}", "else", "{", "factoryToUse", "=", "ResourceLoader", ".", "nonValidatingDocumentBuilderFactory", ";", "}", "inputStream", "=", "getResourceAsStream", "(", "requestingClass", ",", "resource", ")", ";", "DocumentBuilder", "db", "=", "factoryToUse", ".", "newDocumentBuilder", "(", ")", ";", "db", ".", "setEntityResolver", "(", "new", "DTDResolver", "(", ")", ")", ";", "db", ".", "setErrorHandler", "(", "new", "SAXErrorHandler", "(", "\"ResourceLoader.getResourceAsDocument(\"", "+", "resource", "+", "\")\"", ")", ")", ";", "document", "=", "db", ".", "parse", "(", "inputStream", ")", ";", "}", "finally", "{", "if", "(", "inputStream", "!=", "null", ")", "inputStream", ".", "close", "(", ")", ";", "}", "return", "document", ";", "}"], "docstring": "Get the contents of a URL as an XML Document\n\n@param requestingClass the java.lang.Class object of the class that is attempting to load the\nresource\n@param resource a String describing the full or partial URL of the resource whose contents to\nload\n@param validate boolean. True if the document builder factory should validate, false\notherwise.\n@return the actual contents of the resource as an XML Document\n@throws ResourceMissingException\n@throws java.io.IOException\n@throws javax.xml.parsers.ParserConfigurationException\n@throws org.xml.sax.SAXException", "docstring_tokens": ["Get", "the", "contents", "of", "a", "URL", "as", "an", "XML", "Document"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceLoader.java#L250-L277", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceLoader.java", "func_name": "ResourceLoader.getResourceAsDocument", "original_string": "public static Document getResourceAsDocument(Class<?> requestingClass, String resource)\n            throws ResourceMissingException, IOException, ParserConfigurationException,\n                    SAXException {\n\n        // Default is non-validating...\n        return getResourceAsDocument(requestingClass, resource, false);\n    }", "language": "java", "code": "public static Document getResourceAsDocument(Class<?> requestingClass, String resource)\n            throws ResourceMissingException, IOException, ParserConfigurationException,\n                    SAXException {\n\n        // Default is non-validating...\n        return getResourceAsDocument(requestingClass, resource, false);\n    }", "code_tokens": ["public", "static", "Document", "getResourceAsDocument", "(", "Class", "<", "?", ">", "requestingClass", ",", "String", "resource", ")", "throws", "ResourceMissingException", ",", "IOException", ",", "ParserConfigurationException", ",", "SAXException", "{", "// Default is non-validating...", "return", "getResourceAsDocument", "(", "requestingClass", ",", "resource", ",", "false", ")", ";", "}"], "docstring": "Get the contents of a URL as an XML Document, first trying to read the Document with\nvalidation turned on, and falling back to reading it with validation turned off.\n\n@param requestingClass the java.lang.Class object of the class that is attempting to load the\nresource\n@param resource a String describing the full or partial URL of the resource whose contents to\nload\n@return the actual contents of the resource as an XML Document\n@throws ResourceMissingException\n@throws java.io.IOException\n@throws javax.xml.parsers.ParserConfigurationException\n@throws org.xml.sax.SAXException", "docstring_tokens": ["Get", "the", "contents", "of", "a", "URL", "as", "an", "XML", "Document", "first", "trying", "to", "read", "the", "Document", "with", "validation", "turned", "on", "and", "falling", "back", "to", "reading", "it", "with", "validation", "turned", "off", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceLoader.java#L293-L299", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceLoader.java", "func_name": "ResourceLoader.getResourceAsProperties", "original_string": "public static Properties getResourceAsProperties(Class<?> requestingClass, String resource)\n            throws ResourceMissingException, IOException {\n        InputStream inputStream = null;\n        Properties props = null;\n        try {\n            inputStream = getResourceAsStream(requestingClass, resource);\n            props = new Properties();\n            props.load(inputStream);\n        } finally {\n            if (inputStream != null) inputStream.close();\n        }\n        return props;\n    }", "language": "java", "code": "public static Properties getResourceAsProperties(Class<?> requestingClass, String resource)\n            throws ResourceMissingException, IOException {\n        InputStream inputStream = null;\n        Properties props = null;\n        try {\n            inputStream = getResourceAsStream(requestingClass, resource);\n            props = new Properties();\n            props.load(inputStream);\n        } finally {\n            if (inputStream != null) inputStream.close();\n        }\n        return props;\n    }", "code_tokens": ["public", "static", "Properties", "getResourceAsProperties", "(", "Class", "<", "?", ">", "requestingClass", ",", "String", "resource", ")", "throws", "ResourceMissingException", ",", "IOException", "{", "InputStream", "inputStream", "=", "null", ";", "Properties", "props", "=", "null", ";", "try", "{", "inputStream", "=", "getResourceAsStream", "(", "requestingClass", ",", "resource", ")", ";", "props", "=", "new", "Properties", "(", ")", ";", "props", ".", "load", "(", "inputStream", ")", ";", "}", "finally", "{", "if", "(", "inputStream", "!=", "null", ")", "inputStream", ".", "close", "(", ")", ";", "}", "return", "props", ";", "}"], "docstring": "Get the contents of a URL as a java.util.Properties object\n\n@param requestingClass the java.lang.Class object of the class that is attempting to load the\nresource\n@param resource a String describing the full or partial URL of the resource whose contents to\nload\n@return the actual contents of the resource as a Properties object\n@throws ResourceMissingException\n@throws java.io.IOException", "docstring_tokens": ["Get", "the", "contents", "of", "a", "URL", "as", "a", "java", ".", "util", ".", "Properties", "object"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceLoader.java#L312-L324", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceLoader.java", "func_name": "ResourceLoader.getResourceAsString", "original_string": "public static String getResourceAsString(Class<?> requestingClass, String resource)\n            throws ResourceMissingException, IOException {\n        String line = null;\n        BufferedReader in = null;\n        StringBuffer sbText = null;\n        try {\n            in =\n                    new BufferedReader(\n                            new InputStreamReader(\n                                    getResourceAsStream(requestingClass, resource), UTF_8));\n            sbText = new StringBuffer(1024);\n            while ((line = in.readLine()) != null) sbText.append(line).append(\"\\n\");\n        } finally {\n            if (in != null) in.close();\n        }\n        return sbText.toString();\n    }", "language": "java", "code": "public static String getResourceAsString(Class<?> requestingClass, String resource)\n            throws ResourceMissingException, IOException {\n        String line = null;\n        BufferedReader in = null;\n        StringBuffer sbText = null;\n        try {\n            in =\n                    new BufferedReader(\n                            new InputStreamReader(\n                                    getResourceAsStream(requestingClass, resource), UTF_8));\n            sbText = new StringBuffer(1024);\n            while ((line = in.readLine()) != null) sbText.append(line).append(\"\\n\");\n        } finally {\n            if (in != null) in.close();\n        }\n        return sbText.toString();\n    }", "code_tokens": ["public", "static", "String", "getResourceAsString", "(", "Class", "<", "?", ">", "requestingClass", ",", "String", "resource", ")", "throws", "ResourceMissingException", ",", "IOException", "{", "String", "line", "=", "null", ";", "BufferedReader", "in", "=", "null", ";", "StringBuffer", "sbText", "=", "null", ";", "try", "{", "in", "=", "new", "BufferedReader", "(", "new", "InputStreamReader", "(", "getResourceAsStream", "(", "requestingClass", ",", "resource", ")", ",", "UTF_8", ")", ")", ";", "sbText", "=", "new", "StringBuffer", "(", "1024", ")", ";", "while", "(", "(", "line", "=", "in", ".", "readLine", "(", ")", ")", "!=", "null", ")", "sbText", ".", "append", "(", "line", ")", ".", "append", "(", "\"\\n\"", ")", ";", "}", "finally", "{", "if", "(", "in", "!=", "null", ")", "in", ".", "close", "(", ")", ";", "}", "return", "sbText", ".", "toString", "(", ")", ";", "}"], "docstring": "Get the contents of a URL as a String\n\n@param requestingClass the java.lang.Class object of the class that is attempting to load the\nresource\n@param resource a String describing the full or partial URL of the resource whose contents to\nload\n@return the actual contents of the resource as a String\n@throws ResourceMissingException\n@throws java.io.IOException", "docstring_tokens": ["Get", "the", "contents", "of", "a", "URL", "as", "a", "String"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/ResourceLoader.java#L337-L353", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-services/src/main/java/org/apereo/portal/services/Authentication.java", "func_name": "Authentication.authenticate", "original_string": "public void authenticate(\n            HttpServletRequest request,\n            Map<String, String> principals,\n            Map<String, String> credentials,\n            IPerson person)\n            throws PortalSecurityException {\n\n        // Retrieve the security context for the user\n        final ISecurityContext securityContext = person.getSecurityContext();\n\n        // Set the principals and credentials for the security context chain\n        this.configureSecurityContextChain(\n                principals, credentials, securityContext, BASE_CONTEXT_NAME);\n\n        // NOTE: PortalPreAuthenticatedProcessingFilter looks in the security.properties file to\n        // determine what tokens to look for that represent the principals and\n        // credentials for each context. It then retrieves the values from the request\n        // and stores the values in the principals and credentials HashMaps that are\n        // passed to the Authentication service.\n\n        // Attempt to authenticate the user\n        final long start = System.currentTimeMillis();\n        securityContext.authenticate();\n        final long elapsed = System.currentTimeMillis() - start;\n        // Check to see if the user was authenticated\n        if (securityContext.isAuthenticated()) {\n            lastAuthentication = authenticationTimes.add(elapsed); // metric\n            // Add the authenticated username to the person object\n            // the login name may have been provided or reset by the security provider\n            // so this needs to be done after authentication.\n            final String userName = securityContext.getPrincipal().getUID();\n            person.setAttribute(IPerson.USERNAME, userName);\n            if (log.isDebugEnabled()) {\n                log.debug(\n                        \"FINISHED SecurityContext authentication for user '\"\n                                + userName\n                                + \"' in \"\n                                + elapsed\n                                + \"ms #milestone\");\n            }\n\n            threadNamingRequestFilter.updateCurrentUsername(userName);\n\n            /*\n             * Clear cached group info for this user.\n             *\n             * There seem to be 2 systems in place for this information:\n             *   - The old system based on EntityCachingService\n             *   - The new system based on ehcache\n             *\n             * For uPortal 5, we should work to remove the old system.\n             */\n            GroupService.finishedSession(person); // Old system\n            for (IAuthenticationListener authListener : authenticationListeners) { // New system\n                authListener.userAuthenticated(person);\n            }\n\n            // Clear all existing cached data about the person\n            this.usernameTaggedCacheEntryPurger.purgeTaggedCacheEntries(userName);\n\n            // Retrieve the additional descriptor from the security context\n            final IAdditionalDescriptor addInfo =\n                    person.getSecurityContext().getAdditionalDescriptor();\n            // Process the additional descriptor if one was created\n            if (addInfo != null) {\n                // Replace the passed in IPerson with the additional descriptor if the\n                // additional descriptor is an IPerson object created by the security context\n                // NOTE: This is not the preferred method, creation of IPerson objects should be\n                //       handled by the PersonManager.\n                if (addInfo instanceof IPerson) {\n                    final IPerson newPerson = (IPerson) addInfo;\n                    person.setFullName(newPerson.getFullName());\n\n                    for (final String attributeName : newPerson.getAttributeMap().keySet()) {\n                        person.setAttribute(attributeName, newPerson.getAttribute(attributeName));\n                    }\n                }\n                // If the additional descriptor is a map then we can\n                // simply copy all of these additional attributes into the IPerson\n                else if (addInfo instanceof Map) {\n                    // Cast the additional descriptor as a Map\n                    final Map<?, ?> additionalAttributes = (Map<?, ?>) addInfo;\n                    // Copy each additional attribute into the person object\n                    for (final Iterator<?> keys = additionalAttributes.keySet().iterator();\n                            keys.hasNext(); ) {\n                        // Get a key\n                        final String key = (String) keys.next();\n                        // Set the attribute\n                        person.setAttribute(key, additionalAttributes.get(key));\n                    }\n                } else if (addInfo\n                        instanceof ChainingSecurityContext.ChainingAdditionalDescriptor) {\n                    // do nothing\n                } else {\n                    if (log.isWarnEnabled()) {\n                        log.warn(\n                                \"Authentication Service received unknown additional descriptor [\"\n                                        + addInfo\n                                        + \"]\");\n                    }\n                }\n            }\n\n            // Populate the person object using the PersonDirectory if applicable\n            if (PropertiesManager.getPropertyAsBoolean(\n                    \"org.apereo.portal.services.Authentication.usePersonDirectory\")) {\n                // Retrieve all of the attributes associated with the person logging in\n                final String username = person.getUserName();\n\n                final long timestamp = System.currentTimeMillis();\n                if (log.isDebugEnabled()) {\n                    log.debug(\n                            \"STARTING user attribute gathering for user '\"\n                                    + userName\n                                    + \"' #milestone\");\n                }\n\n                final IPersonAttributes personAttributes =\n                        this.personAttributeDao.getPerson(username);\n\n                if (log.isDebugEnabled()) {\n                    log.debug(\n                            \"FINISHED user attribute gathering for user '\"\n                                    + userName\n                                    + \"' in \"\n                                    + Long.toString(System.currentTimeMillis() - timestamp)\n                                    + \"ms #milestone\");\n                }\n\n                if (personAttributes != null) {\n                    // attribs may be null.  IPersonAttributeDao returns null when it does not\n                    // recognize a user at all, as\n                    // distinguished from returning an empty Map of attributes when it recognizes a\n                    // user has having no\n                    // attributes.\n\n                    person.setAttributes(personAttributes.getAttributes());\n                }\n            }\n            // Make sure the the user's fullname is set\n            if (person.getFullName() == null) {\n                // Use portal display name if one exists\n                if (person.getAttribute(\"portalDisplayName\") != null) {\n                    person.setFullName((String) person.getAttribute(\"portalDisplayName\"));\n                }\n                // If not try the eduPerson displayName\n                else if (person.getAttribute(\"displayName\") != null) {\n                    person.setFullName((String) person.getAttribute(\"displayName\"));\n                }\n                // If still no FullName use an unrecognized string\n                if (person.getFullName() == null) {\n                    person.setFullName(\n                            \"Unrecognized person: \" + person.getAttribute(IPerson.USERNAME));\n                }\n            }\n            // Find the uPortal userid for this user or flunk authentication if not found.\n            final boolean autocreate =\n                    PropertiesManager.getPropertyAsBoolean(\n                            \"org.apereo.portal.services.Authentication.autoCreateUsers\");\n            try {\n                // Attempt to retrieve the UID\n                final int newUID = this.userIdentityStore.getPortalUID(person, autocreate);\n                person.setID(newUID);\n            } catch (final AuthorizationException ae) {\n                log.error(\"Exception retrieving ID\", ae);\n                throw new PortalSecurityException(\n                        \"Authentication Service: Exception retrieving UID\");\n            }\n        }\n\n        // Publish a login event for the person\n        this.portalEventFactory.publishLoginEvent(request, this, person);\n    }", "language": "java", "code": "public void authenticate(\n            HttpServletRequest request,\n            Map<String, String> principals,\n            Map<String, String> credentials,\n            IPerson person)\n            throws PortalSecurityException {\n\n        // Retrieve the security context for the user\n        final ISecurityContext securityContext = person.getSecurityContext();\n\n        // Set the principals and credentials for the security context chain\n        this.configureSecurityContextChain(\n                principals, credentials, securityContext, BASE_CONTEXT_NAME);\n\n        // NOTE: PortalPreAuthenticatedProcessingFilter looks in the security.properties file to\n        // determine what tokens to look for that represent the principals and\n        // credentials for each context. It then retrieves the values from the request\n        // and stores the values in the principals and credentials HashMaps that are\n        // passed to the Authentication service.\n\n        // Attempt to authenticate the user\n        final long start = System.currentTimeMillis();\n        securityContext.authenticate();\n        final long elapsed = System.currentTimeMillis() - start;\n        // Check to see if the user was authenticated\n        if (securityContext.isAuthenticated()) {\n            lastAuthentication = authenticationTimes.add(elapsed); // metric\n            // Add the authenticated username to the person object\n            // the login name may have been provided or reset by the security provider\n            // so this needs to be done after authentication.\n            final String userName = securityContext.getPrincipal().getUID();\n            person.setAttribute(IPerson.USERNAME, userName);\n            if (log.isDebugEnabled()) {\n                log.debug(\n                        \"FINISHED SecurityContext authentication for user '\"\n                                + userName\n                                + \"' in \"\n                                + elapsed\n                                + \"ms #milestone\");\n            }\n\n            threadNamingRequestFilter.updateCurrentUsername(userName);\n\n            /*\n             * Clear cached group info for this user.\n             *\n             * There seem to be 2 systems in place for this information:\n             *   - The old system based on EntityCachingService\n             *   - The new system based on ehcache\n             *\n             * For uPortal 5, we should work to remove the old system.\n             */\n            GroupService.finishedSession(person); // Old system\n            for (IAuthenticationListener authListener : authenticationListeners) { // New system\n                authListener.userAuthenticated(person);\n            }\n\n            // Clear all existing cached data about the person\n            this.usernameTaggedCacheEntryPurger.purgeTaggedCacheEntries(userName);\n\n            // Retrieve the additional descriptor from the security context\n            final IAdditionalDescriptor addInfo =\n                    person.getSecurityContext().getAdditionalDescriptor();\n            // Process the additional descriptor if one was created\n            if (addInfo != null) {\n                // Replace the passed in IPerson with the additional descriptor if the\n                // additional descriptor is an IPerson object created by the security context\n                // NOTE: This is not the preferred method, creation of IPerson objects should be\n                //       handled by the PersonManager.\n                if (addInfo instanceof IPerson) {\n                    final IPerson newPerson = (IPerson) addInfo;\n                    person.setFullName(newPerson.getFullName());\n\n                    for (final String attributeName : newPerson.getAttributeMap().keySet()) {\n                        person.setAttribute(attributeName, newPerson.getAttribute(attributeName));\n                    }\n                }\n                // If the additional descriptor is a map then we can\n                // simply copy all of these additional attributes into the IPerson\n                else if (addInfo instanceof Map) {\n                    // Cast the additional descriptor as a Map\n                    final Map<?, ?> additionalAttributes = (Map<?, ?>) addInfo;\n                    // Copy each additional attribute into the person object\n                    for (final Iterator<?> keys = additionalAttributes.keySet().iterator();\n                            keys.hasNext(); ) {\n                        // Get a key\n                        final String key = (String) keys.next();\n                        // Set the attribute\n                        person.setAttribute(key, additionalAttributes.get(key));\n                    }\n                } else if (addInfo\n                        instanceof ChainingSecurityContext.ChainingAdditionalDescriptor) {\n                    // do nothing\n                } else {\n                    if (log.isWarnEnabled()) {\n                        log.warn(\n                                \"Authentication Service received unknown additional descriptor [\"\n                                        + addInfo\n                                        + \"]\");\n                    }\n                }\n            }\n\n            // Populate the person object using the PersonDirectory if applicable\n            if (PropertiesManager.getPropertyAsBoolean(\n                    \"org.apereo.portal.services.Authentication.usePersonDirectory\")) {\n                // Retrieve all of the attributes associated with the person logging in\n                final String username = person.getUserName();\n\n                final long timestamp = System.currentTimeMillis();\n                if (log.isDebugEnabled()) {\n                    log.debug(\n                            \"STARTING user attribute gathering for user '\"\n                                    + userName\n                                    + \"' #milestone\");\n                }\n\n                final IPersonAttributes personAttributes =\n                        this.personAttributeDao.getPerson(username);\n\n                if (log.isDebugEnabled()) {\n                    log.debug(\n                            \"FINISHED user attribute gathering for user '\"\n                                    + userName\n                                    + \"' in \"\n                                    + Long.toString(System.currentTimeMillis() - timestamp)\n                                    + \"ms #milestone\");\n                }\n\n                if (personAttributes != null) {\n                    // attribs may be null.  IPersonAttributeDao returns null when it does not\n                    // recognize a user at all, as\n                    // distinguished from returning an empty Map of attributes when it recognizes a\n                    // user has having no\n                    // attributes.\n\n                    person.setAttributes(personAttributes.getAttributes());\n                }\n            }\n            // Make sure the the user's fullname is set\n            if (person.getFullName() == null) {\n                // Use portal display name if one exists\n                if (person.getAttribute(\"portalDisplayName\") != null) {\n                    person.setFullName((String) person.getAttribute(\"portalDisplayName\"));\n                }\n                // If not try the eduPerson displayName\n                else if (person.getAttribute(\"displayName\") != null) {\n                    person.setFullName((String) person.getAttribute(\"displayName\"));\n                }\n                // If still no FullName use an unrecognized string\n                if (person.getFullName() == null) {\n                    person.setFullName(\n                            \"Unrecognized person: \" + person.getAttribute(IPerson.USERNAME));\n                }\n            }\n            // Find the uPortal userid for this user or flunk authentication if not found.\n            final boolean autocreate =\n                    PropertiesManager.getPropertyAsBoolean(\n                            \"org.apereo.portal.services.Authentication.autoCreateUsers\");\n            try {\n                // Attempt to retrieve the UID\n                final int newUID = this.userIdentityStore.getPortalUID(person, autocreate);\n                person.setID(newUID);\n            } catch (final AuthorizationException ae) {\n                log.error(\"Exception retrieving ID\", ae);\n                throw new PortalSecurityException(\n                        \"Authentication Service: Exception retrieving UID\");\n            }\n        }\n\n        // Publish a login event for the person\n        this.portalEventFactory.publishLoginEvent(request, this, person);\n    }", "code_tokens": ["public", "void", "authenticate", "(", "HttpServletRequest", "request", ",", "Map", "<", "String", ",", "String", ">", "principals", ",", "Map", "<", "String", ",", "String", ">", "credentials", ",", "IPerson", "person", ")", "throws", "PortalSecurityException", "{", "// Retrieve the security context for the user", "final", "ISecurityContext", "securityContext", "=", "person", ".", "getSecurityContext", "(", ")", ";", "// Set the principals and credentials for the security context chain", "this", ".", "configureSecurityContextChain", "(", "principals", ",", "credentials", ",", "securityContext", ",", "BASE_CONTEXT_NAME", ")", ";", "// NOTE: PortalPreAuthenticatedProcessingFilter looks in the security.properties file to", "// determine what tokens to look for that represent the principals and", "// credentials for each context. It then retrieves the values from the request", "// and stores the values in the principals and credentials HashMaps that are", "// passed to the Authentication service.", "// Attempt to authenticate the user", "final", "long", "start", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "securityContext", ".", "authenticate", "(", ")", ";", "final", "long", "elapsed", "=", "System", ".", "currentTimeMillis", "(", ")", "-", "start", ";", "// Check to see if the user was authenticated", "if", "(", "securityContext", ".", "isAuthenticated", "(", ")", ")", "{", "lastAuthentication", "=", "authenticationTimes", ".", "add", "(", "elapsed", ")", ";", "// metric", "// Add the authenticated username to the person object", "// the login name may have been provided or reset by the security provider", "// so this needs to be done after authentication.", "final", "String", "userName", "=", "securityContext", ".", "getPrincipal", "(", ")", ".", "getUID", "(", ")", ";", "person", ".", "setAttribute", "(", "IPerson", ".", "USERNAME", ",", "userName", ")", ";", "if", "(", "log", ".", "isDebugEnabled", "(", ")", ")", "{", "log", ".", "debug", "(", "\"FINISHED SecurityContext authentication for user '\"", "+", "userName", "+", "\"' in \"", "+", "elapsed", "+", "\"ms #milestone\"", ")", ";", "}", "threadNamingRequestFilter", ".", "updateCurrentUsername", "(", "userName", ")", ";", "/*\n             * Clear cached group info for this user.\n             *\n             * There seem to be 2 systems in place for this information:\n             *   - The old system based on EntityCachingService\n             *   - The new system based on ehcache\n             *\n             * For uPortal 5, we should work to remove the old system.\n             */", "GroupService", ".", "finishedSession", "(", "person", ")", ";", "// Old system", "for", "(", "IAuthenticationListener", "authListener", ":", "authenticationListeners", ")", "{", "// New system", "authListener", ".", "userAuthenticated", "(", "person", ")", ";", "}", "// Clear all existing cached data about the person", "this", ".", "usernameTaggedCacheEntryPurger", ".", "purgeTaggedCacheEntries", "(", "userName", ")", ";", "// Retrieve the additional descriptor from the security context", "final", "IAdditionalDescriptor", "addInfo", "=", "person", ".", "getSecurityContext", "(", ")", ".", "getAdditionalDescriptor", "(", ")", ";", "// Process the additional descriptor if one was created", "if", "(", "addInfo", "!=", "null", ")", "{", "// Replace the passed in IPerson with the additional descriptor if the", "// additional descriptor is an IPerson object created by the security context", "// NOTE: This is not the preferred method, creation of IPerson objects should be", "//       handled by the PersonManager.", "if", "(", "addInfo", "instanceof", "IPerson", ")", "{", "final", "IPerson", "newPerson", "=", "(", "IPerson", ")", "addInfo", ";", "person", ".", "setFullName", "(", "newPerson", ".", "getFullName", "(", ")", ")", ";", "for", "(", "final", "String", "attributeName", ":", "newPerson", ".", "getAttributeMap", "(", ")", ".", "keySet", "(", ")", ")", "{", "person", ".", "setAttribute", "(", "attributeName", ",", "newPerson", ".", "getAttribute", "(", "attributeName", ")", ")", ";", "}", "}", "// If the additional descriptor is a map then we can", "// simply copy all of these additional attributes into the IPerson", "else", "if", "(", "addInfo", "instanceof", "Map", ")", "{", "// Cast the additional descriptor as a Map", "final", "Map", "<", "?", ",", "?", ">", "additionalAttributes", "=", "(", "Map", "<", "?", ",", "?", ">", ")", "addInfo", ";", "// Copy each additional attribute into the person object", "for", "(", "final", "Iterator", "<", "?", ">", "keys", "=", "additionalAttributes", ".", "keySet", "(", ")", ".", "iterator", "(", ")", ";", "keys", ".", "hasNext", "(", ")", ";", ")", "{", "// Get a key", "final", "String", "key", "=", "(", "String", ")", "keys", ".", "next", "(", ")", ";", "// Set the attribute", "person", ".", "setAttribute", "(", "key", ",", "additionalAttributes", ".", "get", "(", "key", ")", ")", ";", "}", "}", "else", "if", "(", "addInfo", "instanceof", "ChainingSecurityContext", ".", "ChainingAdditionalDescriptor", ")", "{", "// do nothing", "}", "else", "{", "if", "(", "log", ".", "isWarnEnabled", "(", ")", ")", "{", "log", ".", "warn", "(", "\"Authentication Service received unknown additional descriptor [\"", "+", "addInfo", "+", "\"]\"", ")", ";", "}", "}", "}", "// Populate the person object using the PersonDirectory if applicable", "if", "(", "PropertiesManager", ".", "getPropertyAsBoolean", "(", "\"org.apereo.portal.services.Authentication.usePersonDirectory\"", ")", ")", "{", "// Retrieve all of the attributes associated with the person logging in", "final", "String", "username", "=", "person", ".", "getUserName", "(", ")", ";", "final", "long", "timestamp", "=", "System", ".", "currentTimeMillis", "(", ")", ";", "if", "(", "log", ".", "isDebugEnabled", "(", ")", ")", "{", "log", ".", "debug", "(", "\"STARTING user attribute gathering for user '\"", "+", "userName", "+", "\"' #milestone\"", ")", ";", "}", "final", "IPersonAttributes", "personAttributes", "=", "this", ".", "personAttributeDao", ".", "getPerson", "(", "username", ")", ";", "if", "(", "log", ".", "isDebugEnabled", "(", ")", ")", "{", "log", ".", "debug", "(", "\"FINISHED user attribute gathering for user '\"", "+", "userName", "+", "\"' in \"", "+", "Long", ".", "toString", "(", "System", ".", "currentTimeMillis", "(", ")", "-", "timestamp", ")", "+", "\"ms #milestone\"", ")", ";", "}", "if", "(", "personAttributes", "!=", "null", ")", "{", "// attribs may be null.  IPersonAttributeDao returns null when it does not", "// recognize a user at all, as", "// distinguished from returning an empty Map of attributes when it recognizes a", "// user has having no", "// attributes.", "person", ".", "setAttributes", "(", "personAttributes", ".", "getAttributes", "(", ")", ")", ";", "}", "}", "// Make sure the the user's fullname is set", "if", "(", "person", ".", "getFullName", "(", ")", "==", "null", ")", "{", "// Use portal display name if one exists", "if", "(", "person", ".", "getAttribute", "(", "\"portalDisplayName\"", ")", "!=", "null", ")", "{", "person", ".", "setFullName", "(", "(", "String", ")", "person", ".", "getAttribute", "(", "\"portalDisplayName\"", ")", ")", ";", "}", "// If not try the eduPerson displayName", "else", "if", "(", "person", ".", "getAttribute", "(", "\"displayName\"", ")", "!=", "null", ")", "{", "person", ".", "setFullName", "(", "(", "String", ")", "person", ".", "getAttribute", "(", "\"displayName\"", ")", ")", ";", "}", "// If still no FullName use an unrecognized string", "if", "(", "person", ".", "getFullName", "(", ")", "==", "null", ")", "{", "person", ".", "setFullName", "(", "\"Unrecognized person: \"", "+", "person", ".", "getAttribute", "(", "IPerson", ".", "USERNAME", ")", ")", ";", "}", "}", "// Find the uPortal userid for this user or flunk authentication if not found.", "final", "boolean", "autocreate", "=", "PropertiesManager", ".", "getPropertyAsBoolean", "(", "\"org.apereo.portal.services.Authentication.autoCreateUsers\"", ")", ";", "try", "{", "// Attempt to retrieve the UID", "final", "int", "newUID", "=", "this", ".", "userIdentityStore", ".", "getPortalUID", "(", "person", ",", "autocreate", ")", ";", "person", ".", "setID", "(", "newUID", ")", ";", "}", "catch", "(", "final", "AuthorizationException", "ae", ")", "{", "log", ".", "error", "(", "\"Exception retrieving ID\"", ",", "ae", ")", ";", "throw", "new", "PortalSecurityException", "(", "\"Authentication Service: Exception retrieving UID\"", ")", ";", "}", "}", "// Publish a login event for the person", "this", ".", "portalEventFactory", ".", "publishLoginEvent", "(", "request", ",", "this", ",", "person", ")", ";", "}"], "docstring": "Attempts to authenticate a given IPerson based on a set of principals and credentials\n\n@param principals\n@param credentials\n@param person\n@exception PortalSecurityException", "docstring_tokens": ["Attempts", "to", "authenticate", "a", "given", "IPerson", "based", "on", "a", "set", "of", "principals", "and", "credentials"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-services/src/main/java/org/apereo/portal/services/Authentication.java#L106-L278", "partition": "train"}
