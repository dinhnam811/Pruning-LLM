{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-permissions/src/main/java/org/apereo/portal/permission/target/EntityTargetProviderImpl.java", "func_name": "EntityTargetProviderImpl.getTarget", "original_string": "@Override\n    public IPermissionTarget getTarget(String key) {\n\n        /*\n         * If the specified key matches one of the \"all entity\" style targets,\n         * just return the appropriate target.\n         */\n        switch (key) {\n            case IPermission.ALL_CATEGORIES_TARGET:\n                return ALL_CATEGORIES_TARGET;\n            case IPermission.ALL_PORTLETS_TARGET:\n                return ALL_PORTLETS_TARGET;\n            case IPermission.ALL_GROUPS_TARGET:\n                return ALL_GROUPS_TARGET;\n                // Else just fall through...\n        }\n\n        /*\n         * Attempt to find a matching entity for each allowed entity type.  This\n         * implementation will return the first entity that it finds. If the\n         * portal contains duplicate entity keys across multiple types, it's\n         * possible that this implementation would demonstrate inconsistent\n         * behavior.\n         */\n        for (TargetType targetType : allowedTargetTypes) {\n            JsonEntityBean entity = groupListHelper.getEntity(targetType.toString(), key, false);\n            if (entity != null) {\n                IPermissionTarget target =\n                        new PermissionTargetImpl(entity.getId(), entity.getName(), targetType);\n                return target;\n            }\n        }\n\n        return null;\n    }", "language": "java", "code": "@Override\n    public IPermissionTarget getTarget(String key) {\n\n        /*\n         * If the specified key matches one of the \"all entity\" style targets,\n         * just return the appropriate target.\n         */\n        switch (key) {\n            case IPermission.ALL_CATEGORIES_TARGET:\n                return ALL_CATEGORIES_TARGET;\n            case IPermission.ALL_PORTLETS_TARGET:\n                return ALL_PORTLETS_TARGET;\n            case IPermission.ALL_GROUPS_TARGET:\n                return ALL_GROUPS_TARGET;\n                // Else just fall through...\n        }\n\n        /*\n         * Attempt to find a matching entity for each allowed entity type.  This\n         * implementation will return the first entity that it finds. If the\n         * portal contains duplicate entity keys across multiple types, it's\n         * possible that this implementation would demonstrate inconsistent\n         * behavior.\n         */\n        for (TargetType targetType : allowedTargetTypes) {\n            JsonEntityBean entity = groupListHelper.getEntity(targetType.toString(), key, false);\n            if (entity != null) {\n                IPermissionTarget target =\n                        new PermissionTargetImpl(entity.getId(), entity.getName(), targetType);\n                return target;\n            }\n        }\n\n        return null;\n    }", "code_tokens": ["@", "Override", "public", "IPermissionTarget", "getTarget", "(", "String", "key", ")", "{", "/*\n         * If the specified key matches one of the \"all entity\" style targets,\n         * just return the appropriate target.\n         */", "switch", "(", "key", ")", "{", "case", "IPermission", ".", "ALL_CATEGORIES_TARGET", ":", "return", "ALL_CATEGORIES_TARGET", ";", "case", "IPermission", ".", "ALL_PORTLETS_TARGET", ":", "return", "ALL_PORTLETS_TARGET", ";", "case", "IPermission", ".", "ALL_GROUPS_TARGET", ":", "return", "ALL_GROUPS_TARGET", ";", "// Else just fall through...", "}", "/*\n         * Attempt to find a matching entity for each allowed entity type.  This\n         * implementation will return the first entity that it finds. If the\n         * portal contains duplicate entity keys across multiple types, it's\n         * possible that this implementation would demonstrate inconsistent\n         * behavior.\n         */", "for", "(", "TargetType", "targetType", ":", "allowedTargetTypes", ")", "{", "JsonEntityBean", "entity", "=", "groupListHelper", ".", "getEntity", "(", "targetType", ".", "toString", "(", ")", ",", "key", ",", "false", ")", ";", "if", "(", "entity", "!=", "null", ")", "{", "IPermissionTarget", "target", "=", "new", "PermissionTargetImpl", "(", "entity", ".", "getId", "(", ")", ",", "entity", ".", "getName", "(", ")", ",", "targetType", ")", ";", "return", "target", ";", "}", "}", "return", "null", ";", "}"], "docstring": "The <code>key</code> parameter <em>should</em> specify a unique entity across all 4 supported\ntypes: people, groups, portlets, and categories.\n\n<p>Concrete examples of working keys:\n\n<ul>\n<li>admin (user)\n<li>local.0 (group)\n<li>PORTLET_ID.82 (portlet)\n<li>local.1 (category)\n</ul>", "docstring_tokens": ["The", "<code", ">", "key<", "/", "code", ">", "parameter", "<em", ">", "should<", "/", "em", ">", "specify", "a", "unique", "entity", "across", "all", "4", "supported", "types", ":", "people", "groups", "portlets", "and", "categories", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-permissions/src/main/java/org/apereo/portal/permission/target/EntityTargetProviderImpl.java#L116-L150", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-permissions/src/main/java/org/apereo/portal/permission/target/EntityTargetProviderImpl.java", "func_name": "EntityTargetProviderImpl.searchTargets", "original_string": "@Override\n    public Collection<IPermissionTarget> searchTargets(String term) {\n\n        // Initialize a new collection of matching targets.  We use a HashSet\n        // implementation here to prevent duplicate target entries.\n        Collection<IPermissionTarget> matching = new HashSet<IPermissionTarget>();\n\n        /*\n         * Attempt to find matching entities for each allowed entity type.\n         * Any matching entities will be added to our collection.\n         */\n        for (TargetType targetType : allowedTargetTypes) {\n            Set<JsonEntityBean> entities = groupListHelper.search(targetType.toString(), term);\n            for (JsonEntityBean entity : entities) {\n                IPermissionTarget target =\n                        new PermissionTargetImpl(entity.getId(), entity.getName(), targetType);\n                matching.add(target);\n            }\n        }\n\n        if (IPermission.ALL_CATEGORIES_TARGET.contains(term)) {\n            matching.add(ALL_CATEGORIES_TARGET);\n        } else if (IPermission.ALL_PORTLETS_TARGET.contains(term)) {\n            matching.add(ALL_PORTLETS_TARGET);\n        } else if (IPermission.ALL_GROUPS_TARGET.contains(term)) {\n            matching.add(ALL_GROUPS_TARGET);\n        }\n\n        // return the list of matching targets\n        return matching;\n    }", "language": "java", "code": "@Override\n    public Collection<IPermissionTarget> searchTargets(String term) {\n\n        // Initialize a new collection of matching targets.  We use a HashSet\n        // implementation here to prevent duplicate target entries.\n        Collection<IPermissionTarget> matching = new HashSet<IPermissionTarget>();\n\n        /*\n         * Attempt to find matching entities for each allowed entity type.\n         * Any matching entities will be added to our collection.\n         */\n        for (TargetType targetType : allowedTargetTypes) {\n            Set<JsonEntityBean> entities = groupListHelper.search(targetType.toString(), term);\n            for (JsonEntityBean entity : entities) {\n                IPermissionTarget target =\n                        new PermissionTargetImpl(entity.getId(), entity.getName(), targetType);\n                matching.add(target);\n            }\n        }\n\n        if (IPermission.ALL_CATEGORIES_TARGET.contains(term)) {\n            matching.add(ALL_CATEGORIES_TARGET);\n        } else if (IPermission.ALL_PORTLETS_TARGET.contains(term)) {\n            matching.add(ALL_PORTLETS_TARGET);\n        } else if (IPermission.ALL_GROUPS_TARGET.contains(term)) {\n            matching.add(ALL_GROUPS_TARGET);\n        }\n\n        // return the list of matching targets\n        return matching;\n    }", "code_tokens": ["@", "Override", "public", "Collection", "<", "IPermissionTarget", ">", "searchTargets", "(", "String", "term", ")", "{", "// Initialize a new collection of matching targets.  We use a HashSet", "// implementation here to prevent duplicate target entries.", "Collection", "<", "IPermissionTarget", ">", "matching", "=", "new", "HashSet", "<", "IPermissionTarget", ">", "(", ")", ";", "/*\n         * Attempt to find matching entities for each allowed entity type.\n         * Any matching entities will be added to our collection.\n         */", "for", "(", "TargetType", "targetType", ":", "allowedTargetTypes", ")", "{", "Set", "<", "JsonEntityBean", ">", "entities", "=", "groupListHelper", ".", "search", "(", "targetType", ".", "toString", "(", ")", ",", "term", ")", ";", "for", "(", "JsonEntityBean", "entity", ":", "entities", ")", "{", "IPermissionTarget", "target", "=", "new", "PermissionTargetImpl", "(", "entity", ".", "getId", "(", ")", ",", "entity", ".", "getName", "(", ")", ",", "targetType", ")", ";", "matching", ".", "add", "(", "target", ")", ";", "}", "}", "if", "(", "IPermission", ".", "ALL_CATEGORIES_TARGET", ".", "contains", "(", "term", ")", ")", "{", "matching", ".", "add", "(", "ALL_CATEGORIES_TARGET", ")", ";", "}", "else", "if", "(", "IPermission", ".", "ALL_PORTLETS_TARGET", ".", "contains", "(", "term", ")", ")", "{", "matching", ".", "add", "(", "ALL_PORTLETS_TARGET", ")", ";", "}", "else", "if", "(", "IPermission", ".", "ALL_GROUPS_TARGET", ".", "contains", "(", "term", ")", ")", "{", "matching", ".", "add", "(", "ALL_GROUPS_TARGET", ")", ";", "}", "// return the list of matching targets", "return", "matching", ";", "}"], "docstring": "/*\n(non-Javadoc)\n@see org.apereo.portal.permission.target.IPermissionTargetProvider#searchTargets(java.lang.String)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-permissions/src/main/java/org/apereo/portal/permission/target/EntityTargetProviderImpl.java#L156-L186", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/favorites/AbstractFavoritesController.java", "func_name": "AbstractFavoritesController.setMarketplaceFName", "original_string": "@Value(\"${org.apereo.portal.portlets.favorites.MarketplaceFunctionalName:null}\")\n    public void setMarketplaceFName(String marketplaceFunctionalName) {\n\n        // interpret null, non-text-having, or literal \"null\" as\n        // signaling lack of Marketplace functional name.\n        if (!StringUtils.hasText(marketplaceFunctionalName)\n                || \"null\".equalsIgnoreCase(marketplaceFunctionalName)) {\n            marketplaceFunctionalName = null;\n        }\n\n        this.marketplaceFName = marketplaceFunctionalName;\n    }", "language": "java", "code": "@Value(\"${org.apereo.portal.portlets.favorites.MarketplaceFunctionalName:null}\")\n    public void setMarketplaceFName(String marketplaceFunctionalName) {\n\n        // interpret null, non-text-having, or literal \"null\" as\n        // signaling lack of Marketplace functional name.\n        if (!StringUtils.hasText(marketplaceFunctionalName)\n                || \"null\".equalsIgnoreCase(marketplaceFunctionalName)) {\n            marketplaceFunctionalName = null;\n        }\n\n        this.marketplaceFName = marketplaceFunctionalName;\n    }", "code_tokens": ["@", "Value", "(", "\"${org.apereo.portal.portlets.favorites.MarketplaceFunctionalName:null}\"", ")", "public", "void", "setMarketplaceFName", "(", "String", "marketplaceFunctionalName", ")", "{", "// interpret null, non-text-having, or literal \"null\" as", "// signaling lack of Marketplace functional name.", "if", "(", "!", "StringUtils", ".", "hasText", "(", "marketplaceFunctionalName", ")", "||", "\"null\"", ".", "equalsIgnoreCase", "(", "marketplaceFunctionalName", ")", ")", "{", "marketplaceFunctionalName", "=", "null", ";", "}", "this", ".", "marketplaceFName", "=", "marketplaceFunctionalName", ";", "}"], "docstring": "Configures FavoritesController to include a Marketplace portlet functional name in the Model,\nwhich ultimately signals and enables the View to include convenient link to Marketplace for\nuser to add new favorites.\n\n<p>When set to null, signals Favorites portlet to suppress links to Marketplace. Setting to\nthe empty String or to the literal value \"null\" (ignoring case) is equivalent to setting to\nnull.\n\n<p>This is for convenience in expressing no-marketplace-fname-available via injected value\nfrom properties file. Defaults to the value of the property\n\"org.apereo.portal.portlets.favorites.MarketplaceFunctionalName\", or null if that property is\nnot set.\n\n<p>The functional name can technically be the fname of any portlet. It doesn't have to be The\nMarketplace Portlet. Perhaps you've got your own take on Marketplace.\n\n<p>This allows Favorites to support integration with Marketplace without requiring a\nMarketplace, gracefully degrading when no Marketplace available.\n\n@param marketplaceFunctionalName String fname of a marketplace portlet, or null.", "docstring_tokens": ["Configures", "FavoritesController", "to", "include", "a", "Marketplace", "portlet", "functional", "name", "in", "the", "Model", "which", "ultimately", "signals", "and", "enables", "the", "View", "to", "include", "convenient", "link", "to", "Marketplace", "for", "user", "to", "add", "new", "favorites", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/favorites/AbstractFavoritesController.java#L76-L87", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.setSearchTabs", "original_string": "@SuppressWarnings(\"unchecked\")\n    @Resource(name = \"searchTabs\")\n    // Map of tab-key to string or collection<string> of search result types\n    public void setSearchTabs(Map<String, Object> searchTabMappings) {\n        final Map<String, Set<String>> resultTypeMappingsBuilder = new LinkedHashMap<>();\n        final List<String> tabKeysBuilder = new ArrayList<>(searchTabMappings.size());\n\n        for (final Map.Entry<String, Object> tabMapping : searchTabMappings.entrySet()) {\n            final String tabKey = tabMapping.getKey();\n            tabKeysBuilder.add(tabKey);\n\n            final Object resultTypes = tabMapping.getValue();\n            if (resultTypes instanceof Collection) {\n                for (final String resultType : (Collection<String>) resultTypes) {\n                    addTabKey(resultTypeMappingsBuilder, tabKey, resultType);\n                }\n            } else {\n                final String resultType = (String) resultTypes;\n                addTabKey(resultTypeMappingsBuilder, tabKey, resultType);\n            }\n        }\n\n        this.resultTypeMappings = resultTypeMappingsBuilder;\n        this.tabKeys = tabKeysBuilder;\n    }", "language": "java", "code": "@SuppressWarnings(\"unchecked\")\n    @Resource(name = \"searchTabs\")\n    // Map of tab-key to string or collection<string> of search result types\n    public void setSearchTabs(Map<String, Object> searchTabMappings) {\n        final Map<String, Set<String>> resultTypeMappingsBuilder = new LinkedHashMap<>();\n        final List<String> tabKeysBuilder = new ArrayList<>(searchTabMappings.size());\n\n        for (final Map.Entry<String, Object> tabMapping : searchTabMappings.entrySet()) {\n            final String tabKey = tabMapping.getKey();\n            tabKeysBuilder.add(tabKey);\n\n            final Object resultTypes = tabMapping.getValue();\n            if (resultTypes instanceof Collection) {\n                for (final String resultType : (Collection<String>) resultTypes) {\n                    addTabKey(resultTypeMappingsBuilder, tabKey, resultType);\n                }\n            } else {\n                final String resultType = (String) resultTypes;\n                addTabKey(resultTypeMappingsBuilder, tabKey, resultType);\n            }\n        }\n\n        this.resultTypeMappings = resultTypeMappingsBuilder;\n        this.tabKeys = tabKeysBuilder;\n    }", "code_tokens": ["@", "SuppressWarnings", "(", "\"unchecked\"", ")", "@", "Resource", "(", "name", "=", "\"searchTabs\"", ")", "// Map of tab-key to string or collection<string> of search result types", "public", "void", "setSearchTabs", "(", "Map", "<", "String", ",", "Object", ">", "searchTabMappings", ")", "{", "final", "Map", "<", "String", ",", "Set", "<", "String", ">", ">", "resultTypeMappingsBuilder", "=", "new", "LinkedHashMap", "<>", "(", ")", ";", "final", "List", "<", "String", ">", "tabKeysBuilder", "=", "new", "ArrayList", "<>", "(", "searchTabMappings", ".", "size", "(", ")", ")", ";", "for", "(", "final", "Map", ".", "Entry", "<", "String", ",", "Object", ">", "tabMapping", ":", "searchTabMappings", ".", "entrySet", "(", ")", ")", "{", "final", "String", "tabKey", "=", "tabMapping", ".", "getKey", "(", ")", ";", "tabKeysBuilder", ".", "add", "(", "tabKey", ")", ";", "final", "Object", "resultTypes", "=", "tabMapping", ".", "getValue", "(", ")", ";", "if", "(", "resultTypes", "instanceof", "Collection", ")", "{", "for", "(", "final", "String", "resultType", ":", "(", "Collection", "<", "String", ">", ")", "resultTypes", ")", "{", "addTabKey", "(", "resultTypeMappingsBuilder", ",", "tabKey", ",", "resultType", ")", ";", "}", "}", "else", "{", "final", "String", "resultType", "=", "(", "String", ")", "resultTypes", ";", "addTabKey", "(", "resultTypeMappingsBuilder", ",", "tabKey", ",", "resultType", ")", ";", "}", "}", "this", ".", "resultTypeMappings", "=", "resultTypeMappingsBuilder", ";", "this", ".", "tabKeys", "=", "tabKeysBuilder", ";", "}"], "docstring": "Set the mappings from TabKey to ResultType. The map keys must be strings but the values can\nbe either String or Collection<String>", "docstring_tokens": ["Set", "the", "mappings", "from", "TabKey", "to", "ResultType", ".", "The", "map", "keys", "must", "be", "strings", "but", "the", "values", "can", "be", "either", "String", "or", "Collection<String", ">"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L194-L218", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.handleSearchRequest", "original_string": "@SuppressWarnings(\"unchecked\")\n    @EventMapping(SearchConstants.SEARCH_REQUEST_QNAME_STRING)\n    public void handleSearchRequest(EventRequest request, EventResponse response) {\n        // UP-3887 Design flaw.  Both the searchLauncher portlet instance and the search portlet\n        // instance receive\n        // searchRequest and searchResult events because they are in the same portlet code base (to\n        // share\n        // autosuggest_handler.jsp and because we have to calculate the search portlet url for the\n        // ajax call)\n        // and share the portlet.xml which defines the event handling behavior.\n        // If this instance is the searchLauncher, ignore the searchResult. The search was submitted\n        // to the search\n        // portlet instance.\n        final String searchLaunchFname =\n                request.getPreferences().getValue(SEARCH_LAUNCH_FNAME, null);\n        if (searchLaunchFname != null) {\n            // Noisy in debug mode so commented out log statement\n            // logger.debug(\"SearchLauncher does not participate in SearchRequest events so\n            // discarding message\");\n            return;\n        }\n\n        final Event event = request.getEvent();\n        final SearchRequest searchQuery = (SearchRequest) event.getValue();\n\n        // Map used to track searches that have been handled, used so that one search doesn't get\n        // duplicate results\n        ConcurrentMap<String, Boolean> searchHandledCache;\n        final PortletSession session = request.getPortletSession();\n        synchronized (org.springframework.web.portlet.util.PortletUtils.getSessionMutex(session)) {\n            searchHandledCache =\n                    (ConcurrentMap<String, Boolean>)\n                            session.getAttribute(\n                                    SEARCH_HANDLED_CACHE_NAME, PortletSession.APPLICATION_SCOPE);\n            if (searchHandledCache == null) {\n                searchHandledCache =\n                        CacheBuilder.newBuilder()\n                                .maximumSize(20)\n                                .expireAfterAccess(5, TimeUnit.MINUTES)\n                                .<String, Boolean>build()\n                                .asMap();\n                session.setAttribute(\n                        SEARCH_HANDLED_CACHE_NAME,\n                        searchHandledCache,\n                        PortletSession.APPLICATION_SCOPE);\n            }\n        }\n\n        final String queryId = searchQuery.getQueryId();\n        if (searchHandledCache.putIfAbsent(queryId, Boolean.TRUE) != null) {\n            // Already handled this search request\n            return;\n        }\n\n        // Create the results\n        final SearchResults results = new SearchResults();\n        results.setQueryId(queryId);\n        results.setWindowId(request.getWindowID());\n        final List<SearchResult> searchResultList = results.getSearchResult();\n\n        // Run the search for each service appending the results\n        for (IPortalSearchService searchService : searchServices) {\n            try {\n                logger.debug(\n                        \"For queryId {}, query '{}', searching search service {}\",\n                        queryId,\n                        searchQuery.getSearchTerms(),\n                        searchService.getClass().toString());\n                final SearchResults serviceResults =\n                        searchService.getSearchResults(request, searchQuery);\n                logger.debug(\n                        \"For queryId {}, obtained {} results from search service {}\",\n                        queryId,\n                        serviceResults.getSearchResult().size(),\n                        searchService.getClass().toString());\n                searchResultList.addAll(serviceResults.getSearchResult());\n            } catch (Exception e) {\n                logger.warn(\n                        searchService.getClass()\n                                + \" threw an exception when searching, it will be ignored. \"\n                                + searchQuery,\n                        e);\n            }\n        }\n\n        // Respond with a results event if results were found\n        if (!searchResultList.isEmpty()) {\n            response.setEvent(SearchConstants.SEARCH_RESULTS_QNAME, results);\n        }\n    }", "language": "java", "code": "@SuppressWarnings(\"unchecked\")\n    @EventMapping(SearchConstants.SEARCH_REQUEST_QNAME_STRING)\n    public void handleSearchRequest(EventRequest request, EventResponse response) {\n        // UP-3887 Design flaw.  Both the searchLauncher portlet instance and the search portlet\n        // instance receive\n        // searchRequest and searchResult events because they are in the same portlet code base (to\n        // share\n        // autosuggest_handler.jsp and because we have to calculate the search portlet url for the\n        // ajax call)\n        // and share the portlet.xml which defines the event handling behavior.\n        // If this instance is the searchLauncher, ignore the searchResult. The search was submitted\n        // to the search\n        // portlet instance.\n        final String searchLaunchFname =\n                request.getPreferences().getValue(SEARCH_LAUNCH_FNAME, null);\n        if (searchLaunchFname != null) {\n            // Noisy in debug mode so commented out log statement\n            // logger.debug(\"SearchLauncher does not participate in SearchRequest events so\n            // discarding message\");\n            return;\n        }\n\n        final Event event = request.getEvent();\n        final SearchRequest searchQuery = (SearchRequest) event.getValue();\n\n        // Map used to track searches that have been handled, used so that one search doesn't get\n        // duplicate results\n        ConcurrentMap<String, Boolean> searchHandledCache;\n        final PortletSession session = request.getPortletSession();\n        synchronized (org.springframework.web.portlet.util.PortletUtils.getSessionMutex(session)) {\n            searchHandledCache =\n                    (ConcurrentMap<String, Boolean>)\n                            session.getAttribute(\n                                    SEARCH_HANDLED_CACHE_NAME, PortletSession.APPLICATION_SCOPE);\n            if (searchHandledCache == null) {\n                searchHandledCache =\n                        CacheBuilder.newBuilder()\n                                .maximumSize(20)\n                                .expireAfterAccess(5, TimeUnit.MINUTES)\n                                .<String, Boolean>build()\n                                .asMap();\n                session.setAttribute(\n                        SEARCH_HANDLED_CACHE_NAME,\n                        searchHandledCache,\n                        PortletSession.APPLICATION_SCOPE);\n            }\n        }\n\n        final String queryId = searchQuery.getQueryId();\n        if (searchHandledCache.putIfAbsent(queryId, Boolean.TRUE) != null) {\n            // Already handled this search request\n            return;\n        }\n\n        // Create the results\n        final SearchResults results = new SearchResults();\n        results.setQueryId(queryId);\n        results.setWindowId(request.getWindowID());\n        final List<SearchResult> searchResultList = results.getSearchResult();\n\n        // Run the search for each service appending the results\n        for (IPortalSearchService searchService : searchServices) {\n            try {\n                logger.debug(\n                        \"For queryId {}, query '{}', searching search service {}\",\n                        queryId,\n                        searchQuery.getSearchTerms(),\n                        searchService.getClass().toString());\n                final SearchResults serviceResults =\n                        searchService.getSearchResults(request, searchQuery);\n                logger.debug(\n                        \"For queryId {}, obtained {} results from search service {}\",\n                        queryId,\n                        serviceResults.getSearchResult().size(),\n                        searchService.getClass().toString());\n                searchResultList.addAll(serviceResults.getSearchResult());\n            } catch (Exception e) {\n                logger.warn(\n                        searchService.getClass()\n                                + \" threw an exception when searching, it will be ignored. \"\n                                + searchQuery,\n                        e);\n            }\n        }\n\n        // Respond with a results event if results were found\n        if (!searchResultList.isEmpty()) {\n            response.setEvent(SearchConstants.SEARCH_RESULTS_QNAME, results);\n        }\n    }", "code_tokens": ["@", "SuppressWarnings", "(", "\"unchecked\"", ")", "@", "EventMapping", "(", "SearchConstants", ".", "SEARCH_REQUEST_QNAME_STRING", ")", "public", "void", "handleSearchRequest", "(", "EventRequest", "request", ",", "EventResponse", "response", ")", "{", "// UP-3887 Design flaw.  Both the searchLauncher portlet instance and the search portlet", "// instance receive", "// searchRequest and searchResult events because they are in the same portlet code base (to", "// share", "// autosuggest_handler.jsp and because we have to calculate the search portlet url for the", "// ajax call)", "// and share the portlet.xml which defines the event handling behavior.", "// If this instance is the searchLauncher, ignore the searchResult. The search was submitted", "// to the search", "// portlet instance.", "final", "String", "searchLaunchFname", "=", "request", ".", "getPreferences", "(", ")", ".", "getValue", "(", "SEARCH_LAUNCH_FNAME", ",", "null", ")", ";", "if", "(", "searchLaunchFname", "!=", "null", ")", "{", "// Noisy in debug mode so commented out log statement", "// logger.debug(\"SearchLauncher does not participate in SearchRequest events so", "// discarding message\");", "return", ";", "}", "final", "Event", "event", "=", "request", ".", "getEvent", "(", ")", ";", "final", "SearchRequest", "searchQuery", "=", "(", "SearchRequest", ")", "event", ".", "getValue", "(", ")", ";", "// Map used to track searches that have been handled, used so that one search doesn't get", "// duplicate results", "ConcurrentMap", "<", "String", ",", "Boolean", ">", "searchHandledCache", ";", "final", "PortletSession", "session", "=", "request", ".", "getPortletSession", "(", ")", ";", "synchronized", "(", "org", ".", "springframework", ".", "web", ".", "portlet", ".", "util", ".", "PortletUtils", ".", "getSessionMutex", "(", "session", ")", ")", "{", "searchHandledCache", "=", "(", "ConcurrentMap", "<", "String", ",", "Boolean", ">", ")", "session", ".", "getAttribute", "(", "SEARCH_HANDLED_CACHE_NAME", ",", "PortletSession", ".", "APPLICATION_SCOPE", ")", ";", "if", "(", "searchHandledCache", "==", "null", ")", "{", "searchHandledCache", "=", "CacheBuilder", ".", "newBuilder", "(", ")", ".", "maximumSize", "(", "20", ")", ".", "expireAfterAccess", "(", "5", ",", "TimeUnit", ".", "MINUTES", ")", ".", "<", "String", ",", "Boolean", ">", "build", "(", ")", ".", "asMap", "(", ")", ";", "session", ".", "setAttribute", "(", "SEARCH_HANDLED_CACHE_NAME", ",", "searchHandledCache", ",", "PortletSession", ".", "APPLICATION_SCOPE", ")", ";", "}", "}", "final", "String", "queryId", "=", "searchQuery", ".", "getQueryId", "(", ")", ";", "if", "(", "searchHandledCache", ".", "putIfAbsent", "(", "queryId", ",", "Boolean", ".", "TRUE", ")", "!=", "null", ")", "{", "// Already handled this search request", "return", ";", "}", "// Create the results", "final", "SearchResults", "results", "=", "new", "SearchResults", "(", ")", ";", "results", ".", "setQueryId", "(", "queryId", ")", ";", "results", ".", "setWindowId", "(", "request", ".", "getWindowID", "(", ")", ")", ";", "final", "List", "<", "SearchResult", ">", "searchResultList", "=", "results", ".", "getSearchResult", "(", ")", ";", "// Run the search for each service appending the results", "for", "(", "IPortalSearchService", "searchService", ":", "searchServices", ")", "{", "try", "{", "logger", ".", "debug", "(", "\"For queryId {}, query '{}', searching search service {}\"", ",", "queryId", ",", "searchQuery", ".", "getSearchTerms", "(", ")", ",", "searchService", ".", "getClass", "(", ")", ".", "toString", "(", ")", ")", ";", "final", "SearchResults", "serviceResults", "=", "searchService", ".", "getSearchResults", "(", "request", ",", "searchQuery", ")", ";", "logger", ".", "debug", "(", "\"For queryId {}, obtained {} results from search service {}\"", ",", "queryId", ",", "serviceResults", ".", "getSearchResult", "(", ")", ".", "size", "(", ")", ",", "searchService", ".", "getClass", "(", ")", ".", "toString", "(", ")", ")", ";", "searchResultList", ".", "addAll", "(", "serviceResults", ".", "getSearchResult", "(", ")", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "warn", "(", "searchService", ".", "getClass", "(", ")", "+", "\" threw an exception when searching, it will be ignored. \"", "+", "searchQuery", ",", "e", ")", ";", "}", "}", "// Respond with a results event if results were found", "if", "(", "!", "searchResultList", ".", "isEmpty", "(", ")", ")", "{", "response", ".", "setEvent", "(", "SearchConstants", ".", "SEARCH_RESULTS_QNAME", ",", "results", ")", ";", "}", "}"], "docstring": "Performs a search of the explicitly configured {@link IPortalSearchService}s. This is done as\nan event handler so that it can run concurrently with the other portlets handling the search\nrequest", "docstring_tokens": ["Performs", "a", "search", "of", "the", "explicitly", "configured", "{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L372-L461", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.handleSearchResult", "original_string": "@EventMapping(SearchConstants.SEARCH_RESULTS_QNAME_STRING)\n    public void handleSearchResult(EventRequest request) {\n\n        // UP-3887 Design flaw.  Both the searchLauncher portlet instance and the search portlet\n        // instance receive\n        // searchRequest and searchResult events because they are in the same portlet code base (to\n        // share\n        // autosuggest_handler.jsp and because we have to calculate the search portlet url for the\n        // ajax call)\n        // and share the portlet.xml which defines the event handling behavior.\n        // If this instance is the searchLauncher, ignore the searchResult. The search was submitted\n        // to the search\n        // portlet instance.\n        final String searchLaunchFname =\n                request.getPreferences().getValue(SEARCH_LAUNCH_FNAME, null);\n        if (searchLaunchFname != null) {\n            // Noisy in debug mode so commenting out debug message\n            // logger.debug(\"SearchLauncher does not process SearchResponse events so discarding\n            // message\");\n            return;\n        }\n\n        final Event event = request.getEvent();\n        final SearchResults portletSearchResults = (SearchResults) event.getValue();\n\n        // get the existing portal search result from the session and append\n        // the results for this event\n        final String queryId = portletSearchResults.getQueryId();\n        final PortalSearchResults results = this.getPortalSearchResults(request, queryId);\n        if (results == null) {\n            this.logger.warn(\n                    \"No PortalSearchResults found for queryId {}, ignoring search results from {}\",\n                    queryId,\n                    getSearchResultsSource(portletSearchResults));\n            return;\n        }\n\n        if (logger.isDebugEnabled()) {\n            logger.debug(\n                    \"For queryId {}, adding {} search results from {}\",\n                    queryId,\n                    portletSearchResults.getSearchResult().size(),\n                    getSearchResultsSource(portletSearchResults));\n        }\n\n        final String windowId = portletSearchResults.getWindowId();\n        final HttpServletRequest httpServletRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPortletWindowId portletWindowId =\n                this.portletWindowRegistry.getPortletWindowId(httpServletRequest, windowId);\n\n        // Add the other portlet's results to the main search results object\n        this.addSearchResults(portletSearchResults, results, httpServletRequest, portletWindowId);\n    }", "language": "java", "code": "@EventMapping(SearchConstants.SEARCH_RESULTS_QNAME_STRING)\n    public void handleSearchResult(EventRequest request) {\n\n        // UP-3887 Design flaw.  Both the searchLauncher portlet instance and the search portlet\n        // instance receive\n        // searchRequest and searchResult events because they are in the same portlet code base (to\n        // share\n        // autosuggest_handler.jsp and because we have to calculate the search portlet url for the\n        // ajax call)\n        // and share the portlet.xml which defines the event handling behavior.\n        // If this instance is the searchLauncher, ignore the searchResult. The search was submitted\n        // to the search\n        // portlet instance.\n        final String searchLaunchFname =\n                request.getPreferences().getValue(SEARCH_LAUNCH_FNAME, null);\n        if (searchLaunchFname != null) {\n            // Noisy in debug mode so commenting out debug message\n            // logger.debug(\"SearchLauncher does not process SearchResponse events so discarding\n            // message\");\n            return;\n        }\n\n        final Event event = request.getEvent();\n        final SearchResults portletSearchResults = (SearchResults) event.getValue();\n\n        // get the existing portal search result from the session and append\n        // the results for this event\n        final String queryId = portletSearchResults.getQueryId();\n        final PortalSearchResults results = this.getPortalSearchResults(request, queryId);\n        if (results == null) {\n            this.logger.warn(\n                    \"No PortalSearchResults found for queryId {}, ignoring search results from {}\",\n                    queryId,\n                    getSearchResultsSource(portletSearchResults));\n            return;\n        }\n\n        if (logger.isDebugEnabled()) {\n            logger.debug(\n                    \"For queryId {}, adding {} search results from {}\",\n                    queryId,\n                    portletSearchResults.getSearchResult().size(),\n                    getSearchResultsSource(portletSearchResults));\n        }\n\n        final String windowId = portletSearchResults.getWindowId();\n        final HttpServletRequest httpServletRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPortletWindowId portletWindowId =\n                this.portletWindowRegistry.getPortletWindowId(httpServletRequest, windowId);\n\n        // Add the other portlet's results to the main search results object\n        this.addSearchResults(portletSearchResults, results, httpServletRequest, portletWindowId);\n    }", "code_tokens": ["@", "EventMapping", "(", "SearchConstants", ".", "SEARCH_RESULTS_QNAME_STRING", ")", "public", "void", "handleSearchResult", "(", "EventRequest", "request", ")", "{", "// UP-3887 Design flaw.  Both the searchLauncher portlet instance and the search portlet", "// instance receive", "// searchRequest and searchResult events because they are in the same portlet code base (to", "// share", "// autosuggest_handler.jsp and because we have to calculate the search portlet url for the", "// ajax call)", "// and share the portlet.xml which defines the event handling behavior.", "// If this instance is the searchLauncher, ignore the searchResult. The search was submitted", "// to the search", "// portlet instance.", "final", "String", "searchLaunchFname", "=", "request", ".", "getPreferences", "(", ")", ".", "getValue", "(", "SEARCH_LAUNCH_FNAME", ",", "null", ")", ";", "if", "(", "searchLaunchFname", "!=", "null", ")", "{", "// Noisy in debug mode so commenting out debug message", "// logger.debug(\"SearchLauncher does not process SearchResponse events so discarding", "// message\");", "return", ";", "}", "final", "Event", "event", "=", "request", ".", "getEvent", "(", ")", ";", "final", "SearchResults", "portletSearchResults", "=", "(", "SearchResults", ")", "event", ".", "getValue", "(", ")", ";", "// get the existing portal search result from the session and append", "// the results for this event", "final", "String", "queryId", "=", "portletSearchResults", ".", "getQueryId", "(", ")", ";", "final", "PortalSearchResults", "results", "=", "this", ".", "getPortalSearchResults", "(", "request", ",", "queryId", ")", ";", "if", "(", "results", "==", "null", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"No PortalSearchResults found for queryId {}, ignoring search results from {}\"", ",", "queryId", ",", "getSearchResultsSource", "(", "portletSearchResults", ")", ")", ";", "return", ";", "}", "if", "(", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "logger", ".", "debug", "(", "\"For queryId {}, adding {} search results from {}\"", ",", "queryId", ",", "portletSearchResults", ".", "getSearchResult", "(", ")", ".", "size", "(", ")", ",", "getSearchResultsSource", "(", "portletSearchResults", ")", ")", ";", "}", "final", "String", "windowId", "=", "portletSearchResults", ".", "getWindowId", "(", ")", ";", "final", "HttpServletRequest", "httpServletRequest", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "request", ")", ";", "final", "IPortletWindowId", "portletWindowId", "=", "this", ".", "portletWindowRegistry", ".", "getPortletWindowId", "(", "httpServletRequest", ",", "windowId", ")", ";", "// Add the other portlet's results to the main search results object", "this", ".", "addSearchResults", "(", "portletSearchResults", ",", "results", ",", "httpServletRequest", ",", "portletWindowId", ")", ";", "}"], "docstring": "Handles all the SearchResults events coming back from portlets", "docstring_tokens": ["Handles", "all", "the", "SearchResults", "events", "coming", "back", "from", "portlets"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L464-L517", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.getSearchResultsSource", "original_string": "private String getSearchResultsSource(SearchResults portletSearchResults) {\n        // Return the first source in the result.\n        List<SearchResult> portletResults = portletSearchResults.getSearchResult();\n        String source = \"unknown\";\n        if (portletResults.size() > 0\n                && portletResults.get(0).getType() != null\n                && !portletResults.get(0).getType().isEmpty()) {\n            source = portletResults.get(0).getType().get(0);\n        }\n        return source;\n    }", "language": "java", "code": "private String getSearchResultsSource(SearchResults portletSearchResults) {\n        // Return the first source in the result.\n        List<SearchResult> portletResults = portletSearchResults.getSearchResult();\n        String source = \"unknown\";\n        if (portletResults.size() > 0\n                && portletResults.get(0).getType() != null\n                && !portletResults.get(0).getType().isEmpty()) {\n            source = portletResults.get(0).getType().get(0);\n        }\n        return source;\n    }", "code_tokens": ["private", "String", "getSearchResultsSource", "(", "SearchResults", "portletSearchResults", ")", "{", "// Return the first source in the result.", "List", "<", "SearchResult", ">", "portletResults", "=", "portletSearchResults", ".", "getSearchResult", "(", ")", ";", "String", "source", "=", "\"unknown\"", ";", "if", "(", "portletResults", ".", "size", "(", ")", ">", "0", "&&", "portletResults", ".", "get", "(", "0", ")", ".", "getType", "(", ")", "!=", "null", "&&", "!", "portletResults", ".", "get", "(", "0", ")", ".", "getType", "(", ")", ".", "isEmpty", "(", ")", ")", "{", "source", "=", "portletResults", ".", "get", "(", "0", ")", ".", "getType", "(", ")", ".", "get", "(", "0", ")", ";", "}", "return", "source", ";", "}"], "docstring": "Return the first search source (type string) in the result, else the string 'unknown'.\n\n@param portletSearchResults Search results\n@return String identifying the search result source if it was populated, else 'unknown'", "docstring_tokens": ["Return", "the", "first", "search", "source", "(", "type", "string", ")", "in", "the", "result", "else", "the", "string", "unknown", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L525-L535", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.showSearchForm", "original_string": "@RequestMapping\n    public ModelAndView showSearchForm(RenderRequest request, RenderResponse response) {\n        final Map<String, Object> model = new HashMap<>();\n\n        String viewName;\n        // Determine if the new REST search should be used\n        if (isRestSearch(request)) {\n            viewName = \"/jsp/Search/searchRest\";\n        } else {\n            // Determine if this portlet displays the search launch view or regular search view.\n            final boolean isMobile = isMobile(request);\n            viewName = isMobile ? \"/jsp/Search/mobileSearch\" : \"/jsp/Search/search\";\n        }\n\n        // If this search portlet is configured to be the searchLauncher, calculate the URLs to the\n        // indicated\n        // search portlet.\n        PortletPreferences prefs = request.getPreferences();\n        final String searchLaunchFname = prefs.getValue(SEARCH_LAUNCH_FNAME, null);\n        if (searchLaunchFname != null) {\n            model.put(\"searchLaunchUrl\", calculateSearchLaunchUrl(request, response));\n            model.put(\"autocompleteUrl\", calculateAutocompleteResourceUrl(request, response));\n            viewName = \"/jsp/Search/searchLauncher\";\n        }\n        return new ModelAndView(viewName, model);\n    }", "language": "java", "code": "@RequestMapping\n    public ModelAndView showSearchForm(RenderRequest request, RenderResponse response) {\n        final Map<String, Object> model = new HashMap<>();\n\n        String viewName;\n        // Determine if the new REST search should be used\n        if (isRestSearch(request)) {\n            viewName = \"/jsp/Search/searchRest\";\n        } else {\n            // Determine if this portlet displays the search launch view or regular search view.\n            final boolean isMobile = isMobile(request);\n            viewName = isMobile ? \"/jsp/Search/mobileSearch\" : \"/jsp/Search/search\";\n        }\n\n        // If this search portlet is configured to be the searchLauncher, calculate the URLs to the\n        // indicated\n        // search portlet.\n        PortletPreferences prefs = request.getPreferences();\n        final String searchLaunchFname = prefs.getValue(SEARCH_LAUNCH_FNAME, null);\n        if (searchLaunchFname != null) {\n            model.put(\"searchLaunchUrl\", calculateSearchLaunchUrl(request, response));\n            model.put(\"autocompleteUrl\", calculateAutocompleteResourceUrl(request, response));\n            viewName = \"/jsp/Search/searchLauncher\";\n        }\n        return new ModelAndView(viewName, model);\n    }", "code_tokens": ["@", "RequestMapping", "public", "ModelAndView", "showSearchForm", "(", "RenderRequest", "request", ",", "RenderResponse", "response", ")", "{", "final", "Map", "<", "String", ",", "Object", ">", "model", "=", "new", "HashMap", "<>", "(", ")", ";", "String", "viewName", ";", "// Determine if the new REST search should be used", "if", "(", "isRestSearch", "(", "request", ")", ")", "{", "viewName", "=", "\"/jsp/Search/searchRest\"", ";", "}", "else", "{", "// Determine if this portlet displays the search launch view or regular search view.", "final", "boolean", "isMobile", "=", "isMobile", "(", "request", ")", ";", "viewName", "=", "isMobile", "?", "\"/jsp/Search/mobileSearch\"", ":", "\"/jsp/Search/search\"", ";", "}", "// If this search portlet is configured to be the searchLauncher, calculate the URLs to the", "// indicated", "// search portlet.", "PortletPreferences", "prefs", "=", "request", ".", "getPreferences", "(", ")", ";", "final", "String", "searchLaunchFname", "=", "prefs", ".", "getValue", "(", "SEARCH_LAUNCH_FNAME", ",", "null", ")", ";", "if", "(", "searchLaunchFname", "!=", "null", ")", "{", "model", ".", "put", "(", "\"searchLaunchUrl\"", ",", "calculateSearchLaunchUrl", "(", "request", ",", "response", ")", ")", ";", "model", ".", "put", "(", "\"autocompleteUrl\"", ",", "calculateAutocompleteResourceUrl", "(", "request", ",", "response", ")", ")", ";", "viewName", "=", "\"/jsp/Search/searchLauncher\"", ";", "}", "return", "new", "ModelAndView", "(", "viewName", ",", "model", ")", ";", "}"], "docstring": "Display a search form", "docstring_tokens": ["Display", "a", "search", "form"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L538-L563", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.calculateSearchLaunchUrl", "original_string": "private String calculateSearchLaunchUrl(RenderRequest request, RenderResponse response) {\n        final HttpServletRequest httpRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPortalUrlBuilder portalUrlBuilder =\n                this.portalUrlProvider.getPortalUrlBuilderByPortletFName(\n                        httpRequest, \"search\", UrlType.ACTION);\n        return portalUrlBuilder.getUrlString();\n    }", "language": "java", "code": "private String calculateSearchLaunchUrl(RenderRequest request, RenderResponse response) {\n        final HttpServletRequest httpRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPortalUrlBuilder portalUrlBuilder =\n                this.portalUrlProvider.getPortalUrlBuilderByPortletFName(\n                        httpRequest, \"search\", UrlType.ACTION);\n        return portalUrlBuilder.getUrlString();\n    }", "code_tokens": ["private", "String", "calculateSearchLaunchUrl", "(", "RenderRequest", "request", ",", "RenderResponse", "response", ")", "{", "final", "HttpServletRequest", "httpRequest", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "request", ")", ";", "final", "IPortalUrlBuilder", "portalUrlBuilder", "=", "this", ".", "portalUrlProvider", ".", "getPortalUrlBuilderByPortletFName", "(", "httpRequest", ",", "\"search\"", ",", "UrlType", ".", "ACTION", ")", ";", "return", "portalUrlBuilder", ".", "getUrlString", "(", ")", ";", "}"], "docstring": "Create an actionUrl for the indicated portlet The resource URL is for the ajax typing search\nresults response.\n\n@param request render request\n@param response render response", "docstring_tokens": ["Create", "an", "actionUrl", "for", "the", "indicated", "portlet", "The", "resource", "URL", "is", "for", "the", "ajax", "typing", "search", "results", "response", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L572-L579", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.calculateAutocompleteResourceUrl", "original_string": "private String calculateAutocompleteResourceUrl(\n            RenderRequest request, RenderResponse response) {\n        final HttpServletRequest httpRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPortalUrlBuilder portalUrlBuilder =\n                this.portalUrlProvider.getPortalUrlBuilderByPortletFName(\n                        httpRequest, \"search\", UrlType.RESOURCE);\n        final IPortletUrlBuilder portletUrlBuilder =\n                portalUrlBuilder.getPortletUrlBuilder(portalUrlBuilder.getTargetPortletWindowId());\n        portletUrlBuilder.setResourceId(AJAX_RESPONSE_RESOURCE_ID);\n        return portletUrlBuilder.getPortalUrlBuilder().getUrlString();\n    }", "language": "java", "code": "private String calculateAutocompleteResourceUrl(\n            RenderRequest request, RenderResponse response) {\n        final HttpServletRequest httpRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPortalUrlBuilder portalUrlBuilder =\n                this.portalUrlProvider.getPortalUrlBuilderByPortletFName(\n                        httpRequest, \"search\", UrlType.RESOURCE);\n        final IPortletUrlBuilder portletUrlBuilder =\n                portalUrlBuilder.getPortletUrlBuilder(portalUrlBuilder.getTargetPortletWindowId());\n        portletUrlBuilder.setResourceId(AJAX_RESPONSE_RESOURCE_ID);\n        return portletUrlBuilder.getPortalUrlBuilder().getUrlString();\n    }", "code_tokens": ["private", "String", "calculateAutocompleteResourceUrl", "(", "RenderRequest", "request", ",", "RenderResponse", "response", ")", "{", "final", "HttpServletRequest", "httpRequest", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "request", ")", ";", "final", "IPortalUrlBuilder", "portalUrlBuilder", "=", "this", ".", "portalUrlProvider", ".", "getPortalUrlBuilderByPortletFName", "(", "httpRequest", ",", "\"search\"", ",", "UrlType", ".", "RESOURCE", ")", ";", "final", "IPortletUrlBuilder", "portletUrlBuilder", "=", "portalUrlBuilder", ".", "getPortletUrlBuilder", "(", "portalUrlBuilder", ".", "getTargetPortletWindowId", "(", ")", ")", ";", "portletUrlBuilder", ".", "setResourceId", "(", "AJAX_RESPONSE_RESOURCE_ID", ")", ";", "return", "portletUrlBuilder", ".", "getPortalUrlBuilder", "(", ")", ".", "getUrlString", "(", ")", ";", "}"], "docstring": "Create a resourceUrl for <code>AJAX_RESPONSE_RESOURCE_ID</code>. The resource URL is for the\najax typing search results response.\n\n@param request render request\n@param response render response", "docstring_tokens": ["Create", "a", "resourceUrl", "for", "<code", ">", "AJAX_RESPONSE_RESOURCE_ID<", "/", "code", ">", ".", "The", "resource", "URL", "is", "for", "the", "ajax", "typing", "search", "results", "response", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L588-L599", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.showSearchResults", "original_string": "@RequestMapping(params = {\"query\", \"queryId\"})\n    public ModelAndView showSearchResults(\n            PortletRequest request,\n            @RequestParam(value = \"query\") String query,\n            @RequestParam(value = \"queryId\") String queryId) {\n\n        final Map<String, Object> model = new HashMap<>();\n        model.put(\"query\", query);\n\n        // Determine if the new REST search should be used\n        if (isRestSearch(request)) {\n            // we only need query, so the model at this point is sufficient\n            return new ModelAndView(\"/jsp/Search/searchRest\", model);\n        }\n\n        ConcurrentMap<String, List<Tuple<SearchResult, String>>> results =\n                new ConcurrentHashMap<>();\n        final PortalSearchResults portalSearchResults =\n                this.getPortalSearchResults(request, queryId);\n        if (portalSearchResults != null) {\n            results = portalSearchResults.getResults();\n        }\n\n        results.forEach(\n                (key, value) -> {\n                    value.sort(Comparator.comparingInt(tuple -> tuple.first.getRank()));\n                });\n\n        logger.debug(\"Search results for query '{}' are:  {}\", query, results);\n\n        model.put(\"results\", results);\n        model.put(\"defaultTabKey\", this.defaultTabKey);\n        model.put(\"tabKeys\", this.tabKeys);\n\n        final boolean isMobile = isMobile(request);\n        String viewName = isMobile ? \"/jsp/Search/mobileSearch\" : \"/jsp/Search/search\";\n\n        return new ModelAndView(viewName, model);\n    }", "language": "java", "code": "@RequestMapping(params = {\"query\", \"queryId\"})\n    public ModelAndView showSearchResults(\n            PortletRequest request,\n            @RequestParam(value = \"query\") String query,\n            @RequestParam(value = \"queryId\") String queryId) {\n\n        final Map<String, Object> model = new HashMap<>();\n        model.put(\"query\", query);\n\n        // Determine if the new REST search should be used\n        if (isRestSearch(request)) {\n            // we only need query, so the model at this point is sufficient\n            return new ModelAndView(\"/jsp/Search/searchRest\", model);\n        }\n\n        ConcurrentMap<String, List<Tuple<SearchResult, String>>> results =\n                new ConcurrentHashMap<>();\n        final PortalSearchResults portalSearchResults =\n                this.getPortalSearchResults(request, queryId);\n        if (portalSearchResults != null) {\n            results = portalSearchResults.getResults();\n        }\n\n        results.forEach(\n                (key, value) -> {\n                    value.sort(Comparator.comparingInt(tuple -> tuple.first.getRank()));\n                });\n\n        logger.debug(\"Search results for query '{}' are:  {}\", query, results);\n\n        model.put(\"results\", results);\n        model.put(\"defaultTabKey\", this.defaultTabKey);\n        model.put(\"tabKeys\", this.tabKeys);\n\n        final boolean isMobile = isMobile(request);\n        String viewName = isMobile ? \"/jsp/Search/mobileSearch\" : \"/jsp/Search/search\";\n\n        return new ModelAndView(viewName, model);\n    }", "code_tokens": ["@", "RequestMapping", "(", "params", "=", "{", "\"query\"", ",", "\"queryId\"", "}", ")", "public", "ModelAndView", "showSearchResults", "(", "PortletRequest", "request", ",", "@", "RequestParam", "(", "value", "=", "\"query\"", ")", "String", "query", ",", "@", "RequestParam", "(", "value", "=", "\"queryId\"", ")", "String", "queryId", ")", "{", "final", "Map", "<", "String", ",", "Object", ">", "model", "=", "new", "HashMap", "<>", "(", ")", ";", "model", ".", "put", "(", "\"query\"", ",", "query", ")", ";", "// Determine if the new REST search should be used", "if", "(", "isRestSearch", "(", "request", ")", ")", "{", "// we only need query, so the model at this point is sufficient", "return", "new", "ModelAndView", "(", "\"/jsp/Search/searchRest\"", ",", "model", ")", ";", "}", "ConcurrentMap", "<", "String", ",", "List", "<", "Tuple", "<", "SearchResult", ",", "String", ">", ">", ">", "results", "=", "new", "ConcurrentHashMap", "<>", "(", ")", ";", "final", "PortalSearchResults", "portalSearchResults", "=", "this", ".", "getPortalSearchResults", "(", "request", ",", "queryId", ")", ";", "if", "(", "portalSearchResults", "!=", "null", ")", "{", "results", "=", "portalSearchResults", ".", "getResults", "(", ")", ";", "}", "results", ".", "forEach", "(", "(", "key", ",", "value", ")", "->", "{", "value", ".", "sort", "(", "Comparator", ".", "comparingInt", "(", "tuple", "->", "tuple", ".", "first", ".", "getRank", "(", ")", ")", ")", ";", "}", ")", ";", "logger", ".", "debug", "(", "\"Search results for query '{}' are:  {}\"", ",", "query", ",", "results", ")", ";", "model", ".", "put", "(", "\"results\"", ",", "results", ")", ";", "model", ".", "put", "(", "\"defaultTabKey\"", ",", "this", ".", "defaultTabKey", ")", ";", "model", ".", "put", "(", "\"tabKeys\"", ",", "this", ".", "tabKeys", ")", ";", "final", "boolean", "isMobile", "=", "isMobile", "(", "request", ")", ";", "String", "viewName", "=", "isMobile", "?", "\"/jsp/Search/mobileSearch\"", ":", "\"/jsp/Search/search\"", ";", "return", "new", "ModelAndView", "(", "viewName", ",", "model", ")", ";", "}"], "docstring": "Display search results", "docstring_tokens": ["Display", "search", "results"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L602-L640", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.showSearchError", "original_string": "@RequestMapping(params = {\"query\", \"hitMaxQueries\"})\n    public ModelAndView showSearchError(\n            PortletRequest request,\n            @RequestParam(value = \"query\") String query,\n            @RequestParam(value = \"hitMaxQueries\") boolean hitMaxQueries) {\n\n        final Map<String, Object> model = new HashMap<>();\n        model.put(\"query\", query);\n        model.put(\"hitMaxQueries\", hitMaxQueries);\n\n        final boolean isMobile = isMobile(request);\n        String viewName = isMobile ? \"/jsp/Search/mobileSearch\" : \"/jsp/Search/search\";\n\n        return new ModelAndView(viewName, model);\n    }", "language": "java", "code": "@RequestMapping(params = {\"query\", \"hitMaxQueries\"})\n    public ModelAndView showSearchError(\n            PortletRequest request,\n            @RequestParam(value = \"query\") String query,\n            @RequestParam(value = \"hitMaxQueries\") boolean hitMaxQueries) {\n\n        final Map<String, Object> model = new HashMap<>();\n        model.put(\"query\", query);\n        model.put(\"hitMaxQueries\", hitMaxQueries);\n\n        final boolean isMobile = isMobile(request);\n        String viewName = isMobile ? \"/jsp/Search/mobileSearch\" : \"/jsp/Search/search\";\n\n        return new ModelAndView(viewName, model);\n    }", "code_tokens": ["@", "RequestMapping", "(", "params", "=", "{", "\"query\"", ",", "\"hitMaxQueries\"", "}", ")", "public", "ModelAndView", "showSearchError", "(", "PortletRequest", "request", ",", "@", "RequestParam", "(", "value", "=", "\"query\"", ")", "String", "query", ",", "@", "RequestParam", "(", "value", "=", "\"hitMaxQueries\"", ")", "boolean", "hitMaxQueries", ")", "{", "final", "Map", "<", "String", ",", "Object", ">", "model", "=", "new", "HashMap", "<>", "(", ")", ";", "model", ".", "put", "(", "\"query\"", ",", "query", ")", ";", "model", ".", "put", "(", "\"hitMaxQueries\"", ",", "hitMaxQueries", ")", ";", "final", "boolean", "isMobile", "=", "isMobile", "(", "request", ")", ";", "String", "viewName", "=", "isMobile", "?", "\"/jsp/Search/mobileSearch\"", ":", "\"/jsp/Search/search\"", ";", "return", "new", "ModelAndView", "(", "viewName", ",", "model", ")", ";", "}"], "docstring": "Display search results", "docstring_tokens": ["Display", "search", "results"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L643-L657", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.showJSONSearchResults", "original_string": "@ResourceMapping(value = \"retrieveSearchJSONResults\")\n    public ModelAndView showJSONSearchResults(PortletRequest request) {\n\n        PortletPreferences prefs = request.getPreferences();\n        int maxTextLength =\n                Integer.parseInt(prefs.getValue(AUTOCOMPLETE_MAX_TEXT_LENGTH_PREF_NAME, \"180\"));\n\n        final Map<String, Object> model = new HashMap<>();\n        List<AutocompleteResultsModel> results = new ArrayList<>();\n\n        final PortletSession session = request.getPortletSession();\n        String queryId = (String) session.getAttribute(SEARCH_LAST_QUERY_ID);\n        if (queryId != null) {\n            final PortalSearchResults portalSearchResults =\n                    this.getPortalSearchResults(request, queryId);\n            if (portalSearchResults != null) {\n                final ConcurrentMap<String, List<Tuple<SearchResult, String>>> resultsMap =\n                        portalSearchResults.getResults();\n                results = collateResultsForAutoCompleteResponse(resultsMap, maxTextLength);\n            }\n        }\n        model.put(\"results\", results);\n        model.put(\"count\", results.size());\n        return new ModelAndView(\"json\", model);\n    }", "language": "java", "code": "@ResourceMapping(value = \"retrieveSearchJSONResults\")\n    public ModelAndView showJSONSearchResults(PortletRequest request) {\n\n        PortletPreferences prefs = request.getPreferences();\n        int maxTextLength =\n                Integer.parseInt(prefs.getValue(AUTOCOMPLETE_MAX_TEXT_LENGTH_PREF_NAME, \"180\"));\n\n        final Map<String, Object> model = new HashMap<>();\n        List<AutocompleteResultsModel> results = new ArrayList<>();\n\n        final PortletSession session = request.getPortletSession();\n        String queryId = (String) session.getAttribute(SEARCH_LAST_QUERY_ID);\n        if (queryId != null) {\n            final PortalSearchResults portalSearchResults =\n                    this.getPortalSearchResults(request, queryId);\n            if (portalSearchResults != null) {\n                final ConcurrentMap<String, List<Tuple<SearchResult, String>>> resultsMap =\n                        portalSearchResults.getResults();\n                results = collateResultsForAutoCompleteResponse(resultsMap, maxTextLength);\n            }\n        }\n        model.put(\"results\", results);\n        model.put(\"count\", results.size());\n        return new ModelAndView(\"json\", model);\n    }", "code_tokens": ["@", "ResourceMapping", "(", "value", "=", "\"retrieveSearchJSONResults\"", ")", "public", "ModelAndView", "showJSONSearchResults", "(", "PortletRequest", "request", ")", "{", "PortletPreferences", "prefs", "=", "request", ".", "getPreferences", "(", ")", ";", "int", "maxTextLength", "=", "Integer", ".", "parseInt", "(", "prefs", ".", "getValue", "(", "AUTOCOMPLETE_MAX_TEXT_LENGTH_PREF_NAME", ",", "\"180\"", ")", ")", ";", "final", "Map", "<", "String", ",", "Object", ">", "model", "=", "new", "HashMap", "<>", "(", ")", ";", "List", "<", "AutocompleteResultsModel", ">", "results", "=", "new", "ArrayList", "<>", "(", ")", ";", "final", "PortletSession", "session", "=", "request", ".", "getPortletSession", "(", ")", ";", "String", "queryId", "=", "(", "String", ")", "session", ".", "getAttribute", "(", "SEARCH_LAST_QUERY_ID", ")", ";", "if", "(", "queryId", "!=", "null", ")", "{", "final", "PortalSearchResults", "portalSearchResults", "=", "this", ".", "getPortalSearchResults", "(", "request", ",", "queryId", ")", ";", "if", "(", "portalSearchResults", "!=", "null", ")", "{", "final", "ConcurrentMap", "<", "String", ",", "List", "<", "Tuple", "<", "SearchResult", ",", "String", ">", ">", ">", "resultsMap", "=", "portalSearchResults", ".", "getResults", "(", ")", ";", "results", "=", "collateResultsForAutoCompleteResponse", "(", "resultsMap", ",", "maxTextLength", ")", ";", "}", "}", "model", ".", "put", "(", "\"results\"", ",", "results", ")", ";", "model", ".", "put", "(", "\"count\"", ",", "results", ".", "size", "(", ")", ")", ";", "return", "new", "ModelAndView", "(", "\"json\"", ",", "model", ")", ";", "}"], "docstring": "Display AJAX autocomplete search results for the last query", "docstring_tokens": ["Display", "AJAX", "autocomplete", "search", "results", "for", "the", "last", "query"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L660-L684", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.collateResultsForAutoCompleteResponse", "original_string": "private List<AutocompleteResultsModel> collateResultsForAutoCompleteResponse(\n            ConcurrentMap<String, List<Tuple<SearchResult, String>>> resultsMap,\n            int maxTextLength) {\n        SortedMap<Integer, List<AutocompleteResultsModel>> prioritizedResultsMap =\n                getCleanedAndSortedMapResults(resultsMap, maxTextLength);\n\n        // Consolidate the results into a single, ordered list of max entries.\n        List<AutocompleteResultsModel> results = new ArrayList<>();\n        for (List<AutocompleteResultsModel> items : prioritizedResultsMap.values()) {\n            results.addAll(items);\n            if (results.size() >= maxAutocompleteSearchResults) {\n                break;\n            }\n        }\n        return results.subList(\n                0,\n                results.size() > maxAutocompleteSearchResults\n                        ? maxAutocompleteSearchResults\n                        : results.size());\n    }", "language": "java", "code": "private List<AutocompleteResultsModel> collateResultsForAutoCompleteResponse(\n            ConcurrentMap<String, List<Tuple<SearchResult, String>>> resultsMap,\n            int maxTextLength) {\n        SortedMap<Integer, List<AutocompleteResultsModel>> prioritizedResultsMap =\n                getCleanedAndSortedMapResults(resultsMap, maxTextLength);\n\n        // Consolidate the results into a single, ordered list of max entries.\n        List<AutocompleteResultsModel> results = new ArrayList<>();\n        for (List<AutocompleteResultsModel> items : prioritizedResultsMap.values()) {\n            results.addAll(items);\n            if (results.size() >= maxAutocompleteSearchResults) {\n                break;\n            }\n        }\n        return results.subList(\n                0,\n                results.size() > maxAutocompleteSearchResults\n                        ? maxAutocompleteSearchResults\n                        : results.size());\n    }", "code_tokens": ["private", "List", "<", "AutocompleteResultsModel", ">", "collateResultsForAutoCompleteResponse", "(", "ConcurrentMap", "<", "String", ",", "List", "<", "Tuple", "<", "SearchResult", ",", "String", ">", ">", ">", "resultsMap", ",", "int", "maxTextLength", ")", "{", "SortedMap", "<", "Integer", ",", "List", "<", "AutocompleteResultsModel", ">", ">", "prioritizedResultsMap", "=", "getCleanedAndSortedMapResults", "(", "resultsMap", ",", "maxTextLength", ")", ";", "// Consolidate the results into a single, ordered list of max entries.", "List", "<", "AutocompleteResultsModel", ">", "results", "=", "new", "ArrayList", "<>", "(", ")", ";", "for", "(", "List", "<", "AutocompleteResultsModel", ">", "items", ":", "prioritizedResultsMap", ".", "values", "(", ")", ")", "{", "results", ".", "addAll", "(", "items", ")", ";", "if", "(", "results", ".", "size", "(", ")", ">=", "maxAutocompleteSearchResults", ")", "{", "break", ";", "}", "}", "return", "results", ".", "subList", "(", "0", ",", "results", ".", "size", "(", ")", ">", "maxAutocompleteSearchResults", "?", "maxAutocompleteSearchResults", ":", "results", ".", "size", "(", ")", ")", ";", "}"], "docstring": "Accepts a map (tab name, List of tuple search results) and returns a prioritized list of\nresults for the ajax autocomplete feature. The computing impact of moving the list items\naround should be fairly small since there are not too many search results (unless we get a\nlot of search providers, in which case the results could be put into the appropriate format\nin the Event SEARCH_RESULTS_QNAME_STRING handling).\n\n<p>Note that the method (as well as the SearchResults Event handler) do not impose a\nconsistent ordering on results. The results are ordered by priority, but within a particular\npriority the same search may have results ordered differently based upon when the\nSearchResults Event handler receives the search results event list. Also if a search result\nis in multiple category types, even within the same priority, the search result will show up\nmultiple times. Currently all results are in a single category so it is not worth adding\nextra complexity to handle a situation that is not present.\n\n<p>This method also cleans up and trims down the amount of data shipped so the feature is\nmore responsive, especially on mobile networks.\n\n@param resultsMap\n@return", "docstring_tokens": ["Accepts", "a", "map", "(", "tab", "name", "List", "of", "tuple", "search", "results", ")", "and", "returns", "a", "prioritized", "list", "of", "results", "for", "the", "ajax", "autocomplete", "feature", ".", "The", "computing", "impact", "of", "moving", "the", "list", "items", "around", "should", "be", "fairly", "small", "since", "there", "are", "not", "too", "many", "search", "results", "(", "unless", "we", "get", "a", "lot", "of", "search", "providers", "in", "which", "case", "the", "results", "could", "be", "put", "into", "the", "appropriate", "format", "in", "the", "Event", "SEARCH_RESULTS_QNAME_STRING", "handling", ")", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L707-L726", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.getCleanedAndSortedMapResults", "original_string": "private SortedMap<Integer, List<AutocompleteResultsModel>> getCleanedAndSortedMapResults(\n            ConcurrentMap<String, List<Tuple<SearchResult, String>>> resultsMap,\n            int maxTextLength) {\n        SortedMap<Integer, List<AutocompleteResultsModel>> prioritizedResultsMap =\n                createAutocompletePriorityMap();\n\n        // Put the results into the map of <priority,list>\n        for (Map.Entry<String, List<Tuple<SearchResult, String>>> entry : resultsMap.entrySet()) {\n            for (Tuple<SearchResult, String> tupleSearchResult : entry.getValue()) {\n                SearchResult searchResult = tupleSearchResult.getFirst();\n                List<String> resultTypes = searchResult.getType();\n                // If the search result doesn't have a type defined, use the undefined result type.\n                if (resultTypes.size() == 0) {\n                    resultTypes = UNDEFINED_SEARCH_RESULT_TYPE;\n                }\n                for (String category : resultTypes) {\n                    // Exclude the result if it is a result type that's in the ignore list.\n                    if (!autocompleteIgnoreResultTypes.contains(category)) {\n                        int priority = calculatePriorityFromCategory(category);\n                        AutocompleteResultsModel result =\n                                new AutocompleteResultsModel(\n                                        cleanAndTrimString(searchResult.getTitle(), maxTextLength),\n                                        cleanAndTrimString(\n                                                searchResult.getSummary(), maxTextLength),\n                                        tupleSearchResult.getSecond(),\n                                        category);\n                        prioritizedResultsMap.get(priority).add(result);\n                    }\n                }\n            }\n        }\n        return prioritizedResultsMap;\n    }", "language": "java", "code": "private SortedMap<Integer, List<AutocompleteResultsModel>> getCleanedAndSortedMapResults(\n            ConcurrentMap<String, List<Tuple<SearchResult, String>>> resultsMap,\n            int maxTextLength) {\n        SortedMap<Integer, List<AutocompleteResultsModel>> prioritizedResultsMap =\n                createAutocompletePriorityMap();\n\n        // Put the results into the map of <priority,list>\n        for (Map.Entry<String, List<Tuple<SearchResult, String>>> entry : resultsMap.entrySet()) {\n            for (Tuple<SearchResult, String> tupleSearchResult : entry.getValue()) {\n                SearchResult searchResult = tupleSearchResult.getFirst();\n                List<String> resultTypes = searchResult.getType();\n                // If the search result doesn't have a type defined, use the undefined result type.\n                if (resultTypes.size() == 0) {\n                    resultTypes = UNDEFINED_SEARCH_RESULT_TYPE;\n                }\n                for (String category : resultTypes) {\n                    // Exclude the result if it is a result type that's in the ignore list.\n                    if (!autocompleteIgnoreResultTypes.contains(category)) {\n                        int priority = calculatePriorityFromCategory(category);\n                        AutocompleteResultsModel result =\n                                new AutocompleteResultsModel(\n                                        cleanAndTrimString(searchResult.getTitle(), maxTextLength),\n                                        cleanAndTrimString(\n                                                searchResult.getSummary(), maxTextLength),\n                                        tupleSearchResult.getSecond(),\n                                        category);\n                        prioritizedResultsMap.get(priority).add(result);\n                    }\n                }\n            }\n        }\n        return prioritizedResultsMap;\n    }", "code_tokens": ["private", "SortedMap", "<", "Integer", ",", "List", "<", "AutocompleteResultsModel", ">", ">", "getCleanedAndSortedMapResults", "(", "ConcurrentMap", "<", "String", ",", "List", "<", "Tuple", "<", "SearchResult", ",", "String", ">", ">", ">", "resultsMap", ",", "int", "maxTextLength", ")", "{", "SortedMap", "<", "Integer", ",", "List", "<", "AutocompleteResultsModel", ">", ">", "prioritizedResultsMap", "=", "createAutocompletePriorityMap", "(", ")", ";", "// Put the results into the map of <priority,list>", "for", "(", "Map", ".", "Entry", "<", "String", ",", "List", "<", "Tuple", "<", "SearchResult", ",", "String", ">", ">", ">", "entry", ":", "resultsMap", ".", "entrySet", "(", ")", ")", "{", "for", "(", "Tuple", "<", "SearchResult", ",", "String", ">", "tupleSearchResult", ":", "entry", ".", "getValue", "(", ")", ")", "{", "SearchResult", "searchResult", "=", "tupleSearchResult", ".", "getFirst", "(", ")", ";", "List", "<", "String", ">", "resultTypes", "=", "searchResult", ".", "getType", "(", ")", ";", "// If the search result doesn't have a type defined, use the undefined result type.", "if", "(", "resultTypes", ".", "size", "(", ")", "==", "0", ")", "{", "resultTypes", "=", "UNDEFINED_SEARCH_RESULT_TYPE", ";", "}", "for", "(", "String", "category", ":", "resultTypes", ")", "{", "// Exclude the result if it is a result type that's in the ignore list.", "if", "(", "!", "autocompleteIgnoreResultTypes", ".", "contains", "(", "category", ")", ")", "{", "int", "priority", "=", "calculatePriorityFromCategory", "(", "category", ")", ";", "AutocompleteResultsModel", "result", "=", "new", "AutocompleteResultsModel", "(", "cleanAndTrimString", "(", "searchResult", ".", "getTitle", "(", ")", ",", "maxTextLength", ")", ",", "cleanAndTrimString", "(", "searchResult", ".", "getSummary", "(", ")", ",", "maxTextLength", ")", ",", "tupleSearchResult", ".", "getSecond", "(", ")", ",", "category", ")", ";", "prioritizedResultsMap", ".", "get", "(", "priority", ")", ".", "add", "(", "result", ")", ";", "}", "}", "}", "}", "return", "prioritizedResultsMap", ";", "}"], "docstring": "Return the search results in a sorted map based on priority of the search result type\n\n@param resultsMap Search results map\n@return Sorted map of search results ordered on search result type priority", "docstring_tokens": ["Return", "the", "search", "results", "in", "a", "sorted", "map", "based", "on", "priority", "of", "the", "search", "result", "type"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L734-L766", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.cleanAndTrimString", "original_string": "private String cleanAndTrimString(String text, int maxTextLength) {\n        if (StringUtils.isNotBlank(text)) {\n            String cleaned = text.trim().replaceAll(\"[\\\\s]+\", \" \");\n            return cleaned.length() <= maxTextLength\n                    ? cleaned\n                    : cleaned.substring(0, maxTextLength) + \" ...\";\n        }\n        return text;\n    }", "language": "java", "code": "private String cleanAndTrimString(String text, int maxTextLength) {\n        if (StringUtils.isNotBlank(text)) {\n            String cleaned = text.trim().replaceAll(\"[\\\\s]+\", \" \");\n            return cleaned.length() <= maxTextLength\n                    ? cleaned\n                    : cleaned.substring(0, maxTextLength) + \" ...\";\n        }\n        return text;\n    }", "code_tokens": ["private", "String", "cleanAndTrimString", "(", "String", "text", ",", "int", "maxTextLength", ")", "{", "if", "(", "StringUtils", ".", "isNotBlank", "(", "text", ")", ")", "{", "String", "cleaned", "=", "text", ".", "trim", "(", ")", ".", "replaceAll", "(", "\"[\\\\s]+\"", ",", "\" \"", ")", ";", "return", "cleaned", ".", "length", "(", ")", "<=", "maxTextLength", "?", "cleaned", ":", "cleaned", ".", "substring", "(", "0", ",", "maxTextLength", ")", "+", "\" ...\"", ";", "}", "return", "text", ";", "}"], "docstring": "for slower network connections and makes autocomplete UI results smaller/shorter.", "docstring_tokens": ["for", "slower", "network", "connections", "and", "makes", "autocomplete", "UI", "results", "smaller", "/", "shorter", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L771-L779", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.getPortalSearchResults", "original_string": "private PortalSearchResults getPortalSearchResults(PortletRequest request, String queryId) {\n        final PortletSession session = request.getPortletSession();\n        @SuppressWarnings(\"unchecked\")\n        final Cache<String, PortalSearchResults> searchResultsCache =\n                (Cache<String, PortalSearchResults>)\n                        session.getAttribute(SEARCH_RESULTS_CACHE_NAME);\n        if (searchResultsCache == null) {\n            return null;\n        }\n\n        return searchResultsCache.getIfPresent(queryId);\n    }", "language": "java", "code": "private PortalSearchResults getPortalSearchResults(PortletRequest request, String queryId) {\n        final PortletSession session = request.getPortletSession();\n        @SuppressWarnings(\"unchecked\")\n        final Cache<String, PortalSearchResults> searchResultsCache =\n                (Cache<String, PortalSearchResults>)\n                        session.getAttribute(SEARCH_RESULTS_CACHE_NAME);\n        if (searchResultsCache == null) {\n            return null;\n        }\n\n        return searchResultsCache.getIfPresent(queryId);\n    }", "code_tokens": ["private", "PortalSearchResults", "getPortalSearchResults", "(", "PortletRequest", "request", ",", "String", "queryId", ")", "{", "final", "PortletSession", "session", "=", "request", ".", "getPortletSession", "(", ")", ";", "@", "SuppressWarnings", "(", "\"unchecked\"", ")", "final", "Cache", "<", "String", ",", "PortalSearchResults", ">", "searchResultsCache", "=", "(", "Cache", "<", "String", ",", "PortalSearchResults", ">", ")", "session", ".", "getAttribute", "(", "SEARCH_RESULTS_CACHE_NAME", ")", ";", "if", "(", "searchResultsCache", "==", "null", ")", "{", "return", "null", ";", "}", "return", "searchResultsCache", ".", "getIfPresent", "(", "queryId", ")", ";", "}"], "docstring": "Get the {@link PortalSearchResults} for the specified query id from the session. If there are\nno results null is returned.", "docstring_tokens": ["Get", "the", "{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L802-L813", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.modifySearchResultLinkTitle", "original_string": "protected void modifySearchResultLinkTitle(\n            SearchResult result,\n            final HttpServletRequest httpServletRequest,\n            final IPortletWindowId portletWindowId) {\n        // If the title contains a SpEL expression, parse it with the portlet definition in the\n        // evaluation context.\n        if (result.getType().size() > 0 && result.getTitle().contains(\"${\")) {\n            final IPortletWindow portletWindow =\n                    this.portletWindowRegistry.getPortletWindow(\n                            httpServletRequest, portletWindowId);\n            final IPortletEntity portletEntity = portletWindow.getPortletEntity();\n            final IPortletDefinition portletDefinition = portletEntity.getPortletDefinition();\n            final SpELEnvironmentRoot spelEnvironment = new SpELEnvironmentRoot(portletDefinition);\n            try {\n                result.setTitle(spELService.getValue(result.getTitle(), spelEnvironment));\n            } catch (SpelParseException | SpelEvaluationException e) {\n                result.setTitle(\"(Invalid portlet title) - see details in log file\");\n                logger.error(\n                        \"Invalid Spring EL expression {} in search result portlet title\",\n                        result.getTitle(),\n                        e);\n            }\n        }\n    }", "language": "java", "code": "protected void modifySearchResultLinkTitle(\n            SearchResult result,\n            final HttpServletRequest httpServletRequest,\n            final IPortletWindowId portletWindowId) {\n        // If the title contains a SpEL expression, parse it with the portlet definition in the\n        // evaluation context.\n        if (result.getType().size() > 0 && result.getTitle().contains(\"${\")) {\n            final IPortletWindow portletWindow =\n                    this.portletWindowRegistry.getPortletWindow(\n                            httpServletRequest, portletWindowId);\n            final IPortletEntity portletEntity = portletWindow.getPortletEntity();\n            final IPortletDefinition portletDefinition = portletEntity.getPortletDefinition();\n            final SpELEnvironmentRoot spelEnvironment = new SpELEnvironmentRoot(portletDefinition);\n            try {\n                result.setTitle(spELService.getValue(result.getTitle(), spelEnvironment));\n            } catch (SpelParseException | SpelEvaluationException e) {\n                result.setTitle(\"(Invalid portlet title) - see details in log file\");\n                logger.error(\n                        \"Invalid Spring EL expression {} in search result portlet title\",\n                        result.getTitle(),\n                        e);\n            }\n        }\n    }", "code_tokens": ["protected", "void", "modifySearchResultLinkTitle", "(", "SearchResult", "result", ",", "final", "HttpServletRequest", "httpServletRequest", ",", "final", "IPortletWindowId", "portletWindowId", ")", "{", "// If the title contains a SpEL expression, parse it with the portlet definition in the", "// evaluation context.", "if", "(", "result", ".", "getType", "(", ")", ".", "size", "(", ")", ">", "0", "&&", "result", ".", "getTitle", "(", ")", ".", "contains", "(", "\"${\"", ")", ")", "{", "final", "IPortletWindow", "portletWindow", "=", "this", ".", "portletWindowRegistry", ".", "getPortletWindow", "(", "httpServletRequest", ",", "portletWindowId", ")", ";", "final", "IPortletEntity", "portletEntity", "=", "portletWindow", ".", "getPortletEntity", "(", ")", ";", "final", "IPortletDefinition", "portletDefinition", "=", "portletEntity", ".", "getPortletDefinition", "(", ")", ";", "final", "SpELEnvironmentRoot", "spelEnvironment", "=", "new", "SpELEnvironmentRoot", "(", "portletDefinition", ")", ";", "try", "{", "result", ".", "setTitle", "(", "spELService", ".", "getValue", "(", "result", ".", "getTitle", "(", ")", ",", "spelEnvironment", ")", ")", ";", "}", "catch", "(", "SpelParseException", "|", "SpelEvaluationException", "e", ")", "{", "result", ".", "setTitle", "(", "\"(Invalid portlet title) - see details in log file\"", ")", ";", "logger", ".", "error", "(", "\"Invalid Spring EL expression {} in search result portlet title\"", ",", "result", ".", "getTitle", "(", ")", ",", "e", ")", ";", "}", "}", "}"], "docstring": "Since portlets don't have access to the portlet definition to create a useful search results\nlink using something like the portlet definition's title, post-process the link text and for\nthose portlets whose type is present in the substitution set, replace the title with the\nportlet definition's title.\n\n@param result Search results object (may be modified)\n@param httpServletRequest HttpServletRequest\n@param portletWindowId Portlet Window ID", "docstring_tokens": ["Since", "portlets", "don", "t", "have", "access", "to", "the", "portlet", "definition", "to", "create", "a", "useful", "search", "results", "link", "using", "something", "like", "the", "portlet", "definition", "s", "title", "post", "-", "process", "the", "link", "text", "and", "for", "those", "portlets", "whose", "type", "is", "present", "in", "the", "substitution", "set", "replace", "the", "title", "with", "the", "portlet", "definition", "s", "title", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L845-L868", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java", "func_name": "SearchPortletController.getResultUrl", "original_string": "protected String getResultUrl(\n            HttpServletRequest httpServletRequest,\n            SearchResult result,\n            IPortletWindowId portletWindowId) {\n        final String externalUrl = result.getExternalUrl();\n        if (externalUrl != null) {\n            return externalUrl;\n        }\n\n        UrlType urlType = UrlType.RENDER;\n\n        final PortletUrl portletUrl = result.getPortletUrl();\n        if (portletUrl != null) {\n            final PortletUrlType type = portletUrl.getType();\n            if (type != null) {\n                switch (type) {\n                    case ACTION:\n                        {\n                            urlType = UrlType.ACTION;\n                            break;\n                        }\n                    default:\n                    case RENDER:\n                        {\n                            urlType = UrlType.RENDER;\n                            break;\n                        }\n                    case RESOURCE:\n                        {\n                            urlType = UrlType.RESOURCE;\n                            break;\n                        }\n                }\n            }\n        }\n\n        final IPortalUrlBuilder portalUrlBuilder =\n                this.portalUrlProvider.getPortalUrlBuilderByPortletWindow(\n                        httpServletRequest, portletWindowId, urlType);\n        final IPortletUrlBuilder portletUrlBuilder =\n                portalUrlBuilder.getTargetedPortletUrlBuilder();\n\n        if (portletUrl != null) {\n            final String portletMode = portletUrl.getPortletMode();\n            if (portletMode != null) {\n                portletUrlBuilder.setPortletMode(PortletUtils.getPortletMode(portletMode));\n            }\n            final String windowState = portletUrl.getWindowState();\n            if (windowState != null) {\n                portletUrlBuilder.setWindowState(PortletUtils.getWindowState(windowState));\n            }\n            for (final PortletUrlParameter param : portletUrl.getParam()) {\n                final String name = param.getName();\n                final List<String> values = param.getValue();\n                portletUrlBuilder.addParameter(name, values.toArray(new String[values.size()]));\n            }\n        }\n\n        return portalUrlBuilder.getUrlString();\n    }", "language": "java", "code": "protected String getResultUrl(\n            HttpServletRequest httpServletRequest,\n            SearchResult result,\n            IPortletWindowId portletWindowId) {\n        final String externalUrl = result.getExternalUrl();\n        if (externalUrl != null) {\n            return externalUrl;\n        }\n\n        UrlType urlType = UrlType.RENDER;\n\n        final PortletUrl portletUrl = result.getPortletUrl();\n        if (portletUrl != null) {\n            final PortletUrlType type = portletUrl.getType();\n            if (type != null) {\n                switch (type) {\n                    case ACTION:\n                        {\n                            urlType = UrlType.ACTION;\n                            break;\n                        }\n                    default:\n                    case RENDER:\n                        {\n                            urlType = UrlType.RENDER;\n                            break;\n                        }\n                    case RESOURCE:\n                        {\n                            urlType = UrlType.RESOURCE;\n                            break;\n                        }\n                }\n            }\n        }\n\n        final IPortalUrlBuilder portalUrlBuilder =\n                this.portalUrlProvider.getPortalUrlBuilderByPortletWindow(\n                        httpServletRequest, portletWindowId, urlType);\n        final IPortletUrlBuilder portletUrlBuilder =\n                portalUrlBuilder.getTargetedPortletUrlBuilder();\n\n        if (portletUrl != null) {\n            final String portletMode = portletUrl.getPortletMode();\n            if (portletMode != null) {\n                portletUrlBuilder.setPortletMode(PortletUtils.getPortletMode(portletMode));\n            }\n            final String windowState = portletUrl.getWindowState();\n            if (windowState != null) {\n                portletUrlBuilder.setWindowState(PortletUtils.getWindowState(windowState));\n            }\n            for (final PortletUrlParameter param : portletUrl.getParam()) {\n                final String name = param.getName();\n                final List<String> values = param.getValue();\n                portletUrlBuilder.addParameter(name, values.toArray(new String[values.size()]));\n            }\n        }\n\n        return portalUrlBuilder.getUrlString();\n    }", "code_tokens": ["protected", "String", "getResultUrl", "(", "HttpServletRequest", "httpServletRequest", ",", "SearchResult", "result", ",", "IPortletWindowId", "portletWindowId", ")", "{", "final", "String", "externalUrl", "=", "result", ".", "getExternalUrl", "(", ")", ";", "if", "(", "externalUrl", "!=", "null", ")", "{", "return", "externalUrl", ";", "}", "UrlType", "urlType", "=", "UrlType", ".", "RENDER", ";", "final", "PortletUrl", "portletUrl", "=", "result", ".", "getPortletUrl", "(", ")", ";", "if", "(", "portletUrl", "!=", "null", ")", "{", "final", "PortletUrlType", "type", "=", "portletUrl", ".", "getType", "(", ")", ";", "if", "(", "type", "!=", "null", ")", "{", "switch", "(", "type", ")", "{", "case", "ACTION", ":", "{", "urlType", "=", "UrlType", ".", "ACTION", ";", "break", ";", "}", "default", ":", "case", "RENDER", ":", "{", "urlType", "=", "UrlType", ".", "RENDER", ";", "break", ";", "}", "case", "RESOURCE", ":", "{", "urlType", "=", "UrlType", ".", "RESOURCE", ";", "break", ";", "}", "}", "}", "}", "final", "IPortalUrlBuilder", "portalUrlBuilder", "=", "this", ".", "portalUrlProvider", ".", "getPortalUrlBuilderByPortletWindow", "(", "httpServletRequest", ",", "portletWindowId", ",", "urlType", ")", ";", "final", "IPortletUrlBuilder", "portletUrlBuilder", "=", "portalUrlBuilder", ".", "getTargetedPortletUrlBuilder", "(", ")", ";", "if", "(", "portletUrl", "!=", "null", ")", "{", "final", "String", "portletMode", "=", "portletUrl", ".", "getPortletMode", "(", ")", ";", "if", "(", "portletMode", "!=", "null", ")", "{", "portletUrlBuilder", ".", "setPortletMode", "(", "PortletUtils", ".", "getPortletMode", "(", "portletMode", ")", ")", ";", "}", "final", "String", "windowState", "=", "portletUrl", ".", "getWindowState", "(", ")", ";", "if", "(", "windowState", "!=", "null", ")", "{", "portletUrlBuilder", ".", "setWindowState", "(", "PortletUtils", ".", "getWindowState", "(", "windowState", ")", ")", ";", "}", "for", "(", "final", "PortletUrlParameter", "param", ":", "portletUrl", ".", "getParam", "(", ")", ")", "{", "final", "String", "name", "=", "param", ".", "getName", "(", ")", ";", "final", "List", "<", "String", ">", "values", "=", "param", ".", "getValue", "(", ")", ";", "portletUrlBuilder", ".", "addParameter", "(", "name", ",", "values", ".", "toArray", "(", "new", "String", "[", "values", ".", "size", "(", ")", "]", ")", ")", ";", "}", "}", "return", "portalUrlBuilder", ".", "getUrlString", "(", ")", ";", "}"], "docstring": "Determine the url for the search result", "docstring_tokens": ["Determine", "the", "url", "for", "the", "search", "result"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/search/SearchPortletController.java#L871-L930", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-ldap/src/main/java/org/apereo/portal/groups/ldap/LDAPGroupStore.java", "func_name": "LDAPGroupStore.contains", "original_string": "@Override\n    public boolean contains(IEntityGroup group, IGroupMember member) throws GroupsException {\n        boolean found = false;\n        Iterator itr = (member.isGroup()) ? findMemberGroups(group) : findEntitiesForGroup(group);\n        while (itr.hasNext() && !found) {\n            found = member.equals(itr.next());\n        }\n        return found;\n    }", "language": "java", "code": "@Override\n    public boolean contains(IEntityGroup group, IGroupMember member) throws GroupsException {\n        boolean found = false;\n        Iterator itr = (member.isGroup()) ? findMemberGroups(group) : findEntitiesForGroup(group);\n        while (itr.hasNext() && !found) {\n            found = member.equals(itr.next());\n        }\n        return found;\n    }", "code_tokens": ["@", "Override", "public", "boolean", "contains", "(", "IEntityGroup", "group", ",", "IGroupMember", "member", ")", "throws", "GroupsException", "{", "boolean", "found", "=", "false", ";", "Iterator", "itr", "=", "(", "member", ".", "isGroup", "(", ")", ")", "?", "findMemberGroups", "(", "group", ")", ":", "findEntitiesForGroup", "(", "group", ")", ";", "while", "(", "itr", ".", "hasNext", "(", ")", "&&", "!", "found", ")", "{", "found", "=", "member", ".", "equals", "(", "itr", ".", "next", "(", ")", ")", ";", "}", "return", "found", ";", "}"], "docstring": "Answers if <code>group</code> contains <code>member</code>.\n\n@return boolean\n@param group org.apereo.portal.groups.IEntityGroup\n@param member org.apereo.portal.groups.IGroupMember", "docstring_tokens": ["Answers", "if", "<code", ">", "group<", "/", "code", ">", "contains", "<code", ">", "member<", "/", "code", ">", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-ldap/src/main/java/org/apereo/portal/groups/ldap/LDAPGroupStore.java#L709-L717", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/dlm/FragmentChannelInfo.java", "func_name": "FragmentChannelInfo.getParameterValue", "original_string": "public String getParameterValue(String name) {\n        NodeList parms = node.getChildNodes();\n\n        for (int i = 0; i < parms.getLength(); i++) {\n            Element parm = (Element) parms.item(i);\n            if (parm.getTagName().equals(Constants.ELM_PARAMETER)) {\n                String parmName = parm.getAttribute(Constants.ATT_NAME);\n                if (parmName.equals(name)) {\n                    return parm.getAttribute(Constants.ATT_VALUE);\n                }\n            }\n        }\n        // if we get here then neither the fragment  nor the channel definition\n        // provided this parameter\n        return null;\n    }", "language": "java", "code": "public String getParameterValue(String name) {\n        NodeList parms = node.getChildNodes();\n\n        for (int i = 0; i < parms.getLength(); i++) {\n            Element parm = (Element) parms.item(i);\n            if (parm.getTagName().equals(Constants.ELM_PARAMETER)) {\n                String parmName = parm.getAttribute(Constants.ATT_NAME);\n                if (parmName.equals(name)) {\n                    return parm.getAttribute(Constants.ATT_VALUE);\n                }\n            }\n        }\n        // if we get here then neither the fragment  nor the channel definition\n        // provided this parameter\n        return null;\n    }", "code_tokens": ["public", "String", "getParameterValue", "(", "String", "name", ")", "{", "NodeList", "parms", "=", "node", ".", "getChildNodes", "(", ")", ";", "for", "(", "int", "i", "=", "0", ";", "i", "<", "parms", ".", "getLength", "(", ")", ";", "i", "++", ")", "{", "Element", "parm", "=", "(", "Element", ")", "parms", ".", "item", "(", "i", ")", ";", "if", "(", "parm", ".", "getTagName", "(", ")", ".", "equals", "(", "Constants", ".", "ELM_PARAMETER", ")", ")", "{", "String", "parmName", "=", "parm", ".", "getAttribute", "(", "Constants", ".", "ATT_NAME", ")", ";", "if", "(", "parmName", ".", "equals", "(", "name", ")", ")", "{", "return", "parm", ".", "getAttribute", "(", "Constants", ".", "ATT_VALUE", ")", ";", "}", "}", "}", "// if we get here then neither the fragment  nor the channel definition", "// provided this parameter", "return", "null", ";", "}"], "docstring": "Returns the value of an parameter or null if such a parameter is not defined on the\nunderlying channel element.", "docstring_tokens": ["Returns", "the", "value", "of", "an", "parameter", "or", "null", "if", "such", "a", "parameter", "is", "not", "defined", "on", "the", "underlying", "channel", "element", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/dlm/FragmentChannelInfo.java#L37-L52", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/oauth/OidcUserInfoController.java", "func_name": "OidcUserInfoController.userInfo", "original_string": "@RequestMapping(\n            value = USERINFO_ENDPOINT_URI,\n            produces = USERINFO_CONTENT_TYPE,\n            method = {RequestMethod.GET, RequestMethod.POST})\n    public String userInfo(\n            HttpServletRequest request,\n            @RequestParam(value = \"claims\", required = false) String claims,\n            @RequestParam(value = \"groups\", required = false) String groups) {\n\n        final IPerson person = personManager.getPerson(request);\n        return createToken(person, claims, groups);\n    }", "language": "java", "code": "@RequestMapping(\n            value = USERINFO_ENDPOINT_URI,\n            produces = USERINFO_CONTENT_TYPE,\n            method = {RequestMethod.GET, RequestMethod.POST})\n    public String userInfo(\n            HttpServletRequest request,\n            @RequestParam(value = \"claims\", required = false) String claims,\n            @RequestParam(value = \"groups\", required = false) String groups) {\n\n        final IPerson person = personManager.getPerson(request);\n        return createToken(person, claims, groups);\n    }", "code_tokens": ["@", "RequestMapping", "(", "value", "=", "USERINFO_ENDPOINT_URI", ",", "produces", "=", "USERINFO_CONTENT_TYPE", ",", "method", "=", "{", "RequestMethod", ".", "GET", ",", "RequestMethod", ".", "POST", "}", ")", "public", "String", "userInfo", "(", "HttpServletRequest", "request", ",", "@", "RequestParam", "(", "value", "=", "\"claims\"", ",", "required", "=", "false", ")", "String", "claims", ",", "@", "RequestParam", "(", "value", "=", "\"groups\"", ",", "required", "=", "false", ")", "String", "groups", ")", "{", "final", "IPerson", "person", "=", "personManager", ".", "getPerson", "(", "request", ")", ";", "return", "createToken", "(", "person", ",", "claims", ",", "groups", ")", ";", "}"], "docstring": "Obtain an OIDC Id token for the current user.", "docstring_tokens": ["Obtain", "an", "OIDC", "Id", "token", "for", "the", "current", "user", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/oauth/OidcUserInfoController.java#L92-L103", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/oauth/OidcUserInfoController.java", "func_name": "OidcUserInfoController.oauthToken", "original_string": "@PostMapping(value = TOKEN_ENDPOINT_URI, produces = MediaType.APPLICATION_JSON_VALUE)\n    public ResponseEntity oauthToken(\n            @RequestParam(value = \"client_id\") String clientId,\n            @RequestParam(value = \"client_secret\") String clientSecret,\n            @RequestParam(\n                            value = \"grant_type\",\n                            required = false,\n                            defaultValue = \"client_credentials\")\n                    String grantType,\n            @RequestParam(value = \"scope\", required = false, defaultValue = \"/all\") String scope,\n            @RequestParam(value = \"claims\", required = false) String claims,\n            @RequestParam(value = \"groups\", required = false) String groups) {\n\n        /*\n         * NB:  Several of this method's parameters are not consumed (yet) in any way.  They are\n         * defined to match a two-legged OAuth strategy and for future use.\n         */\n\n        final String msg =\n                \"Processing request for OAuth access token;  client_id='{}', client_secret='{}', \"\n                        + \"grant_type='{}', scope='{}', claims='{}', groups='{}'\";\n        logger.debug(\n                msg,\n                clientId,\n                StringUtils.repeat(\"*\", clientSecret.length()),\n                grantType,\n                scope,\n                claims,\n                groups);\n\n        // STEP 1:  identify the client\n        final OAuthClient oAuthClient = clientMap.get(clientId);\n        if (oAuthClient == null) {\n            return ResponseEntity.status(HttpStatus.FORBIDDEN)\n                    .body(Collections.singletonMap(\"message\", \"client_id not found\"));\n        }\n\n        logger.debug(\n                \"Selected known OAuthClient with client_id='{}' for access token request\",\n                oAuthClient.getClientId());\n\n        // STEP 2:  validate the client_secret\n        if (!oAuthClient.getClientSecret().equals(clientSecret)) {\n            return ResponseEntity.status(HttpStatus.FORBIDDEN)\n                    .body(Collections.singletonMap(\"message\", \"authentication failed\"));\n        }\n\n        // STEP 3:  obtain the specified user\n        final IPerson person = personService.getPerson(oAuthClient.getPortalUserAccount());\n        if (person == null) {\n            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)\n                    .body(\n                            Collections.singletonMap(\n                                    \"message\",\n                                    \"portal user account not found: \"\n                                            + oAuthClient.getPortalUserAccount()));\n        }\n\n        logger.debug(\n                \"Selected portal Person with username='{}' for client_id='{}'\",\n                person.getUserName(),\n                oAuthClient.getClientId());\n\n        // STEP 4:  build a standard OAuth2 access token response\n        final String token = createToken(person, claims, groups);\n        final Map<String, Object> rslt = new HashMap<>();\n        rslt.put(\"access_token\", token);\n        rslt.put(\"token_type\", \"bearer\");\n        rslt.put(\n                \"expires_in\",\n                timeoutSeconds > 2 ? timeoutSeconds - 2L /* fudge factor */ : timeoutSeconds);\n        rslt.put(\"scope\", scope);\n\n        logger.debug(\n                \"Produced the following access token for client_id='{}':  {}\",\n                oAuthClient.getClientId(),\n                rslt);\n\n        return ResponseEntity.ok(rslt);\n    }", "language": "java", "code": "@PostMapping(value = TOKEN_ENDPOINT_URI, produces = MediaType.APPLICATION_JSON_VALUE)\n    public ResponseEntity oauthToken(\n            @RequestParam(value = \"client_id\") String clientId,\n            @RequestParam(value = \"client_secret\") String clientSecret,\n            @RequestParam(\n                            value = \"grant_type\",\n                            required = false,\n                            defaultValue = \"client_credentials\")\n                    String grantType,\n            @RequestParam(value = \"scope\", required = false, defaultValue = \"/all\") String scope,\n            @RequestParam(value = \"claims\", required = false) String claims,\n            @RequestParam(value = \"groups\", required = false) String groups) {\n\n        /*\n         * NB:  Several of this method's parameters are not consumed (yet) in any way.  They are\n         * defined to match a two-legged OAuth strategy and for future use.\n         */\n\n        final String msg =\n                \"Processing request for OAuth access token;  client_id='{}', client_secret='{}', \"\n                        + \"grant_type='{}', scope='{}', claims='{}', groups='{}'\";\n        logger.debug(\n                msg,\n                clientId,\n                StringUtils.repeat(\"*\", clientSecret.length()),\n                grantType,\n                scope,\n                claims,\n                groups);\n\n        // STEP 1:  identify the client\n        final OAuthClient oAuthClient = clientMap.get(clientId);\n        if (oAuthClient == null) {\n            return ResponseEntity.status(HttpStatus.FORBIDDEN)\n                    .body(Collections.singletonMap(\"message\", \"client_id not found\"));\n        }\n\n        logger.debug(\n                \"Selected known OAuthClient with client_id='{}' for access token request\",\n                oAuthClient.getClientId());\n\n        // STEP 2:  validate the client_secret\n        if (!oAuthClient.getClientSecret().equals(clientSecret)) {\n            return ResponseEntity.status(HttpStatus.FORBIDDEN)\n                    .body(Collections.singletonMap(\"message\", \"authentication failed\"));\n        }\n\n        // STEP 3:  obtain the specified user\n        final IPerson person = personService.getPerson(oAuthClient.getPortalUserAccount());\n        if (person == null) {\n            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)\n                    .body(\n                            Collections.singletonMap(\n                                    \"message\",\n                                    \"portal user account not found: \"\n                                            + oAuthClient.getPortalUserAccount()));\n        }\n\n        logger.debug(\n                \"Selected portal Person with username='{}' for client_id='{}'\",\n                person.getUserName(),\n                oAuthClient.getClientId());\n\n        // STEP 4:  build a standard OAuth2 access token response\n        final String token = createToken(person, claims, groups);\n        final Map<String, Object> rslt = new HashMap<>();\n        rslt.put(\"access_token\", token);\n        rslt.put(\"token_type\", \"bearer\");\n        rslt.put(\n                \"expires_in\",\n                timeoutSeconds > 2 ? timeoutSeconds - 2L /* fudge factor */ : timeoutSeconds);\n        rslt.put(\"scope\", scope);\n\n        logger.debug(\n                \"Produced the following access token for client_id='{}':  {}\",\n                oAuthClient.getClientId(),\n                rslt);\n\n        return ResponseEntity.ok(rslt);\n    }", "code_tokens": ["@", "PostMapping", "(", "value", "=", "TOKEN_ENDPOINT_URI", ",", "produces", "=", "MediaType", ".", "APPLICATION_JSON_VALUE", ")", "public", "ResponseEntity", "oauthToken", "(", "@", "RequestParam", "(", "value", "=", "\"client_id\"", ")", "String", "clientId", ",", "@", "RequestParam", "(", "value", "=", "\"client_secret\"", ")", "String", "clientSecret", ",", "@", "RequestParam", "(", "value", "=", "\"grant_type\"", ",", "required", "=", "false", ",", "defaultValue", "=", "\"client_credentials\"", ")", "String", "grantType", ",", "@", "RequestParam", "(", "value", "=", "\"scope\"", ",", "required", "=", "false", ",", "defaultValue", "=", "\"/all\"", ")", "String", "scope", ",", "@", "RequestParam", "(", "value", "=", "\"claims\"", ",", "required", "=", "false", ")", "String", "claims", ",", "@", "RequestParam", "(", "value", "=", "\"groups\"", ",", "required", "=", "false", ")", "String", "groups", ")", "{", "/*\n         * NB:  Several of this method's parameters are not consumed (yet) in any way.  They are\n         * defined to match a two-legged OAuth strategy and for future use.\n         */", "final", "String", "msg", "=", "\"Processing request for OAuth access token;  client_id='{}', client_secret='{}', \"", "+", "\"grant_type='{}', scope='{}', claims='{}', groups='{}'\"", ";", "logger", ".", "debug", "(", "msg", ",", "clientId", ",", "StringUtils", ".", "repeat", "(", "\"*\"", ",", "clientSecret", ".", "length", "(", ")", ")", ",", "grantType", ",", "scope", ",", "claims", ",", "groups", ")", ";", "// STEP 1:  identify the client", "final", "OAuthClient", "oAuthClient", "=", "clientMap", ".", "get", "(", "clientId", ")", ";", "if", "(", "oAuthClient", "==", "null", ")", "{", "return", "ResponseEntity", ".", "status", "(", "HttpStatus", ".", "FORBIDDEN", ")", ".", "body", "(", "Collections", ".", "singletonMap", "(", "\"message\"", ",", "\"client_id not found\"", ")", ")", ";", "}", "logger", ".", "debug", "(", "\"Selected known OAuthClient with client_id='{}' for access token request\"", ",", "oAuthClient", ".", "getClientId", "(", ")", ")", ";", "// STEP 2:  validate the client_secret", "if", "(", "!", "oAuthClient", ".", "getClientSecret", "(", ")", ".", "equals", "(", "clientSecret", ")", ")", "{", "return", "ResponseEntity", ".", "status", "(", "HttpStatus", ".", "FORBIDDEN", ")", ".", "body", "(", "Collections", ".", "singletonMap", "(", "\"message\"", ",", "\"authentication failed\"", ")", ")", ";", "}", "// STEP 3:  obtain the specified user", "final", "IPerson", "person", "=", "personService", ".", "getPerson", "(", "oAuthClient", ".", "getPortalUserAccount", "(", ")", ")", ";", "if", "(", "person", "==", "null", ")", "{", "return", "ResponseEntity", ".", "status", "(", "HttpStatus", ".", "INTERNAL_SERVER_ERROR", ")", ".", "body", "(", "Collections", ".", "singletonMap", "(", "\"message\"", ",", "\"portal user account not found: \"", "+", "oAuthClient", ".", "getPortalUserAccount", "(", ")", ")", ")", ";", "}", "logger", ".", "debug", "(", "\"Selected portal Person with username='{}' for client_id='{}'\"", ",", "person", ".", "getUserName", "(", ")", ",", "oAuthClient", ".", "getClientId", "(", ")", ")", ";", "// STEP 4:  build a standard OAuth2 access token response", "final", "String", "token", "=", "createToken", "(", "person", ",", "claims", ",", "groups", ")", ";", "final", "Map", "<", "String", ",", "Object", ">", "rslt", "=", "new", "HashMap", "<>", "(", ")", ";", "rslt", ".", "put", "(", "\"access_token\"", ",", "token", ")", ";", "rslt", ".", "put", "(", "\"token_type\"", ",", "\"bearer\"", ")", ";", "rslt", ".", "put", "(", "\"expires_in\"", ",", "timeoutSeconds", ">", "2", "?", "timeoutSeconds", "-", "2L", "/* fudge factor */", ":", "timeoutSeconds", ")", ";", "rslt", ".", "put", "(", "\"scope\"", ",", "scope", ")", ";", "logger", ".", "debug", "(", "\"Produced the following access token for client_id='{}':  {}\"", ",", "oAuthClient", ".", "getClientId", "(", ")", ",", "rslt", ")", ";", "return", "ResponseEntity", ".", "ok", "(", "rslt", ")", ";", "}"], "docstring": "Obtain an OIDC Id token for the specified <code>client_id</code>. At least one bean of type\n{@link OAuthClient} is required to use this endpoint.\n\n<p>This token strategy supports Spring's <code>OAuth2RestTemplate</code> for accessing\nuPortal REST APIs from external systems. Use a <code>ClientCredentialsResourceDetails</code>\nwith <code>clientAuthenticationScheme=AuthenticationScheme.form</code>, together with a\n<code>ClientCredentialsAccessTokenProvider</code>.\n\n@since 5.5", "docstring_tokens": ["Obtain", "an", "OIDC", "Id", "token", "for", "the", "specified", "<code", ">", "client_id<", "/", "code", ">", ".", "At", "least", "one", "bean", "of", "type", "{", "@link", "OAuthClient", "}", "is", "required", "to", "use", "this", "endpoint", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-rest/src/main/java/org/apereo/portal/rest/oauth/OidcUserInfoController.java#L116-L195", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-web/src/main/java/org/apereo/portal/portlet/delegation/PortletDelegationLocatorImpl.java", "func_name": "PortletDelegationLocatorImpl.createRequestDispatcher", "original_string": "@Override\n    public PortletDelegationDispatcher createRequestDispatcher(\n            PortletRequest portletRequest, String fName) {\n        final IPortletDefinition portletDefinition =\n                this.portletDefinitionRegistry.getPortletDefinitionByFname(fName);\n        final IPortletDefinitionId portletDefinitionId = portletDefinition.getPortletDefinitionId();\n\n        return this.createRequestDispatcher(portletRequest, portletDefinitionId);\n    }", "language": "java", "code": "@Override\n    public PortletDelegationDispatcher createRequestDispatcher(\n            PortletRequest portletRequest, String fName) {\n        final IPortletDefinition portletDefinition =\n                this.portletDefinitionRegistry.getPortletDefinitionByFname(fName);\n        final IPortletDefinitionId portletDefinitionId = portletDefinition.getPortletDefinitionId();\n\n        return this.createRequestDispatcher(portletRequest, portletDefinitionId);\n    }", "code_tokens": ["@", "Override", "public", "PortletDelegationDispatcher", "createRequestDispatcher", "(", "PortletRequest", "portletRequest", ",", "String", "fName", ")", "{", "final", "IPortletDefinition", "portletDefinition", "=", "this", ".", "portletDefinitionRegistry", ".", "getPortletDefinitionByFname", "(", "fName", ")", ";", "final", "IPortletDefinitionId", "portletDefinitionId", "=", "portletDefinition", ".", "getPortletDefinitionId", "(", ")", ";", "return", "this", ".", "createRequestDispatcher", "(", "portletRequest", ",", "portletDefinitionId", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.api.portlet.PortletDelegationLocator#createRequestDispatcher(java.lang.String)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-web/src/main/java/org/apereo/portal/portlet/delegation/PortletDelegationLocatorImpl.java#L93-L101", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-web/src/main/java/org/apereo/portal/portlet/delegation/PortletDelegationLocatorImpl.java", "func_name": "PortletDelegationLocatorImpl.createRequestDispatcher", "original_string": "@Override\n    public PortletDelegationDispatcher createRequestDispatcher(\n            PortletRequest portletRequest, IPortletDefinitionId delegatePortletDefinitionId) {\n        final HttpServletRequest request =\n                this.portalRequestUtils.getPortletHttpRequest(portletRequest);\n\n        final String windowID = portletRequest.getWindowID();\n        final IPortletWindowId parentPortletWindowId =\n                this.portletWindowRegistry.getPortletWindowId(request, windowID);\n\n        final IPortletEntity delegatePortletEntity =\n                this.portletEntityRegistry.getOrCreateDelegatePortletEntity(\n                        request, parentPortletWindowId, delegatePortletDefinitionId);\n        final IPortletEntityId delegatePortletEntityId = delegatePortletEntity.getPortletEntityId();\n\n        final IPortletWindow delegatePortletWindow =\n                this.portletWindowRegistry.createDelegatePortletWindow(\n                        request, delegatePortletEntityId, parentPortletWindowId);\n\n        final IPerson person = this.personManager.getPerson(request);\n        final int userId = person.getID();\n\n        return new PortletDelegationDispatcherImpl(\n                delegatePortletWindow,\n                userId,\n                portalRequestUtils,\n                personManager,\n                portletRenderer,\n                portalUrlProvider,\n                portletDelegationManager);\n    }", "language": "java", "code": "@Override\n    public PortletDelegationDispatcher createRequestDispatcher(\n            PortletRequest portletRequest, IPortletDefinitionId delegatePortletDefinitionId) {\n        final HttpServletRequest request =\n                this.portalRequestUtils.getPortletHttpRequest(portletRequest);\n\n        final String windowID = portletRequest.getWindowID();\n        final IPortletWindowId parentPortletWindowId =\n                this.portletWindowRegistry.getPortletWindowId(request, windowID);\n\n        final IPortletEntity delegatePortletEntity =\n                this.portletEntityRegistry.getOrCreateDelegatePortletEntity(\n                        request, parentPortletWindowId, delegatePortletDefinitionId);\n        final IPortletEntityId delegatePortletEntityId = delegatePortletEntity.getPortletEntityId();\n\n        final IPortletWindow delegatePortletWindow =\n                this.portletWindowRegistry.createDelegatePortletWindow(\n                        request, delegatePortletEntityId, parentPortletWindowId);\n\n        final IPerson person = this.personManager.getPerson(request);\n        final int userId = person.getID();\n\n        return new PortletDelegationDispatcherImpl(\n                delegatePortletWindow,\n                userId,\n                portalRequestUtils,\n                personManager,\n                portletRenderer,\n                portalUrlProvider,\n                portletDelegationManager);\n    }", "code_tokens": ["@", "Override", "public", "PortletDelegationDispatcher", "createRequestDispatcher", "(", "PortletRequest", "portletRequest", ",", "IPortletDefinitionId", "delegatePortletDefinitionId", ")", "{", "final", "HttpServletRequest", "request", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "portletRequest", ")", ";", "final", "String", "windowID", "=", "portletRequest", ".", "getWindowID", "(", ")", ";", "final", "IPortletWindowId", "parentPortletWindowId", "=", "this", ".", "portletWindowRegistry", ".", "getPortletWindowId", "(", "request", ",", "windowID", ")", ";", "final", "IPortletEntity", "delegatePortletEntity", "=", "this", ".", "portletEntityRegistry", ".", "getOrCreateDelegatePortletEntity", "(", "request", ",", "parentPortletWindowId", ",", "delegatePortletDefinitionId", ")", ";", "final", "IPortletEntityId", "delegatePortletEntityId", "=", "delegatePortletEntity", ".", "getPortletEntityId", "(", ")", ";", "final", "IPortletWindow", "delegatePortletWindow", "=", "this", ".", "portletWindowRegistry", ".", "createDelegatePortletWindow", "(", "request", ",", "delegatePortletEntityId", ",", "parentPortletWindowId", ")", ";", "final", "IPerson", "person", "=", "this", ".", "personManager", ".", "getPerson", "(", "request", ")", ";", "final", "int", "userId", "=", "person", ".", "getID", "(", ")", ";", "return", "new", "PortletDelegationDispatcherImpl", "(", "delegatePortletWindow", ",", "userId", ",", "portalRequestUtils", ",", "personManager", ",", "portletRenderer", ",", "portalUrlProvider", ",", "portletDelegationManager", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.api.portlet.PortletDelegationLocator#createRequestDispatcher(org.apereo.portal.portlet.om.IPortletDefinitionId)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-web/src/main/java/org/apereo/portal/portlet/delegation/PortletDelegationLocatorImpl.java#L106-L136", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-web/src/main/java/org/apereo/portal/portlet/delegation/PortletDelegationLocatorImpl.java", "func_name": "PortletDelegationLocatorImpl.getRequestDispatcher", "original_string": "@Override\n    public PortletDelegationDispatcher getRequestDispatcher(\n            PortletRequest portletRequest, IPortletWindowId portletWindowId) {\n        final HttpServletRequest request =\n                this.portalRequestUtils.getPortletHttpRequest(portletRequest);\n        final IPerson person = this.personManager.getPerson(request);\n\n        final IPortletWindow portletWindow =\n                this.portletWindowRegistry.getPortletWindow(request, portletWindowId);\n\n        final IPortletWindowId delegationParentId = portletWindow.getDelegationParentId();\n        if (delegationParentId == null) {\n            throw new IllegalArgumentException(\n                    \"Portlet window '\"\n                            + portletWindow\n                            + \"' is not a delegate window and cannot be delgated to.\");\n        }\n\n        return new PortletDelegationDispatcherImpl(\n                portletWindow,\n                person.getID(),\n                this.portalRequestUtils,\n                this.personManager,\n                this.portletRenderer,\n                this.portalUrlProvider,\n                this.portletDelegationManager);\n    }", "language": "java", "code": "@Override\n    public PortletDelegationDispatcher getRequestDispatcher(\n            PortletRequest portletRequest, IPortletWindowId portletWindowId) {\n        final HttpServletRequest request =\n                this.portalRequestUtils.getPortletHttpRequest(portletRequest);\n        final IPerson person = this.personManager.getPerson(request);\n\n        final IPortletWindow portletWindow =\n                this.portletWindowRegistry.getPortletWindow(request, portletWindowId);\n\n        final IPortletWindowId delegationParentId = portletWindow.getDelegationParentId();\n        if (delegationParentId == null) {\n            throw new IllegalArgumentException(\n                    \"Portlet window '\"\n                            + portletWindow\n                            + \"' is not a delegate window and cannot be delgated to.\");\n        }\n\n        return new PortletDelegationDispatcherImpl(\n                portletWindow,\n                person.getID(),\n                this.portalRequestUtils,\n                this.personManager,\n                this.portletRenderer,\n                this.portalUrlProvider,\n                this.portletDelegationManager);\n    }", "code_tokens": ["@", "Override", "public", "PortletDelegationDispatcher", "getRequestDispatcher", "(", "PortletRequest", "portletRequest", ",", "IPortletWindowId", "portletWindowId", ")", "{", "final", "HttpServletRequest", "request", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "portletRequest", ")", ";", "final", "IPerson", "person", "=", "this", ".", "personManager", ".", "getPerson", "(", "request", ")", ";", "final", "IPortletWindow", "portletWindow", "=", "this", ".", "portletWindowRegistry", ".", "getPortletWindow", "(", "request", ",", "portletWindowId", ")", ";", "final", "IPortletWindowId", "delegationParentId", "=", "portletWindow", ".", "getDelegationParentId", "(", ")", ";", "if", "(", "delegationParentId", "==", "null", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"Portlet window '\"", "+", "portletWindow", "+", "\"' is not a delegate window and cannot be delgated to.\"", ")", ";", "}", "return", "new", "PortletDelegationDispatcherImpl", "(", "portletWindow", ",", "person", ".", "getID", "(", ")", ",", "this", ".", "portalRequestUtils", ",", "this", ".", "personManager", ",", "this", ".", "portletRenderer", ",", "this", ".", "portalUrlProvider", ",", "this", ".", "portletDelegationManager", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.api.portlet.PortletDelegationLocator#getRequestDispatcher(org.apereo.portal.portlet.om.IPortletWindowId)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-web/src/main/java/org/apereo/portal/portlet/delegation/PortletDelegationLocatorImpl.java#L141-L167", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-core/src/main/java/org/apereo/portal/groups/LockableEntityGroupImpl.java", "func_name": "LockableEntityGroupImpl.primUpdate", "original_string": "private void primUpdate(boolean renewLock) throws GroupsException {\n        getLockableGroupService().updateGroup(this, renewLock);\n        clearPendingUpdates();\n        this.invalidateInParentGroupsCache(Collections.singleton((IGroupMember) this));\n    }", "language": "java", "code": "private void primUpdate(boolean renewLock) throws GroupsException {\n        getLockableGroupService().updateGroup(this, renewLock);\n        clearPendingUpdates();\n        this.invalidateInParentGroupsCache(Collections.singleton((IGroupMember) this));\n    }", "code_tokens": ["private", "void", "primUpdate", "(", "boolean", "renewLock", ")", "throws", "GroupsException", "{", "getLockableGroupService", "(", ")", ".", "updateGroup", "(", "this", ",", "renewLock", ")", ";", "clearPendingUpdates", "(", ")", ";", "this", ".", "invalidateInParentGroupsCache", "(", "Collections", ".", "singleton", "(", "(", "IGroupMember", ")", "this", ")", ")", ";", "}"], "docstring": "Ask the service to update this group (in the store), update the back-pointers of the updated\nmembers, and force the retrieval of containing groups in case the memberships of THIS group\nhave changed during the time the group has been locked.", "docstring_tokens": ["Ask", "the", "service", "to", "update", "this", "group", "(", "in", "the", "store", ")", "update", "the", "back", "-", "pointers", "of", "the", "updated", "members", "and", "force", "the", "retrieval", "of", "containing", "groups", "in", "case", "the", "memberships", "of", "THIS", "group", "have", "changed", "during", "the", "time", "the", "group", "has", "been", "locked", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-core/src/main/java/org/apereo/portal/groups/LockableEntityGroupImpl.java#L60-L64", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-core/src/main/java/org/apereo/portal/groups/LockableEntityGroupImpl.java", "func_name": "LockableEntityGroupImpl.primUpdateMembers", "original_string": "private void primUpdateMembers(boolean renewLock) throws GroupsException {\n        getLockableGroupService().updateGroupMembers(this, renewLock);\n        clearPendingUpdates();\n        this.invalidateInParentGroupsCache(Collections.singleton((IGroupMember) this));\n    }", "language": "java", "code": "private void primUpdateMembers(boolean renewLock) throws GroupsException {\n        getLockableGroupService().updateGroupMembers(this, renewLock);\n        clearPendingUpdates();\n        this.invalidateInParentGroupsCache(Collections.singleton((IGroupMember) this));\n    }", "code_tokens": ["private", "void", "primUpdateMembers", "(", "boolean", "renewLock", ")", "throws", "GroupsException", "{", "getLockableGroupService", "(", ")", ".", "updateGroupMembers", "(", "this", ",", "renewLock", ")", ";", "clearPendingUpdates", "(", ")", ";", "this", ".", "invalidateInParentGroupsCache", "(", "Collections", ".", "singleton", "(", "(", "IGroupMember", ")", "this", ")", ")", ";", "}"], "docstring": "Ask the service to update this group (in the store), update the back-pointers of the updated\nmembers, and force the retrieval of containing groups in case the memberships of THIS group\nhave changed during the time the group has been locked.", "docstring_tokens": ["Ask", "the", "service", "to", "update", "this", "group", "(", "in", "the", "store", ")", "update", "the", "back", "-", "pointers", "of", "the", "updated", "members", "and", "force", "the", "retrieval", "of", "containing", "groups", "in", "case", "the", "memberships", "of", "THIS", "group", "have", "changed", "during", "the", "time", "the", "group", "has", "been", "locked", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-core/src/main/java/org/apereo/portal/groups/LockableEntityGroupImpl.java#L71-L75", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-permissions/src/main/java/org/apereo/portal/permission/target/SimpleStringTargetProviderImpl.java", "func_name": "SimpleStringTargetProviderImpl.setTargets", "original_string": "public void setTargets(Collection<IPermissionTarget> targets) {\n\n        // clear out any existing targets\n        targetMap.clear();\n\n        // add each target to the internal map and index it by the target key\n        for (IPermissionTarget target : targets) {\n            targetMap.put(target.getKey(), target);\n        }\n    }", "language": "java", "code": "public void setTargets(Collection<IPermissionTarget> targets) {\n\n        // clear out any existing targets\n        targetMap.clear();\n\n        // add each target to the internal map and index it by the target key\n        for (IPermissionTarget target : targets) {\n            targetMap.put(target.getKey(), target);\n        }\n    }", "code_tokens": ["public", "void", "setTargets", "(", "Collection", "<", "IPermissionTarget", ">", "targets", ")", "{", "// clear out any existing targets", "targetMap", ".", "clear", "(", ")", ";", "// add each target to the internal map and index it by the target key", "for", "(", "IPermissionTarget", "target", ":", "targets", ")", "{", "targetMap", ".", "put", "(", "target", ".", "getKey", "(", ")", ",", "target", ")", ";", "}", "}"], "docstring": "Set the permission targets for this provider.\n\n@param targets collection of targets", "docstring_tokens": ["Set", "the", "permission", "targets", "for", "this", "provider", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-permissions/src/main/java/org/apereo/portal/permission/target/SimpleStringTargetProviderImpl.java#L48-L57", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-persondir/src/main/java/org/apereo/portal/persondir/PortalRootPersonAttributeDao.java", "func_name": "PortalRootPersonAttributeDao.getPerson", "original_string": "@Override\n    public IPersonAttributes getPerson(String uid) {\n\n        final IPersonAttributes rslt = delegatePersonAttributeDao.getPerson(uid);\n        if (rslt == null) {\n            // Nothing we can do with that\n            return null;\n        }\n\n        return postProcessPerson(rslt, uid);\n    }", "language": "java", "code": "@Override\n    public IPersonAttributes getPerson(String uid) {\n\n        final IPersonAttributes rslt = delegatePersonAttributeDao.getPerson(uid);\n        if (rslt == null) {\n            // Nothing we can do with that\n            return null;\n        }\n\n        return postProcessPerson(rslt, uid);\n    }", "code_tokens": ["@", "Override", "public", "IPersonAttributes", "getPerson", "(", "String", "uid", ")", "{", "final", "IPersonAttributes", "rslt", "=", "delegatePersonAttributeDao", ".", "getPerson", "(", "uid", ")", ";", "if", "(", "rslt", "==", "null", ")", "{", "// Nothing we can do with that", "return", "null", ";", "}", "return", "postProcessPerson", "(", "rslt", ",", "uid", ")", ";", "}"], "docstring": "This method is for \"filling\" a specific individual.\n\n@param uid The username (identity) of a known individual\n@return A completely \"filled\" person, including overrides, or <code>null</code> if the person\nis unknown", "docstring_tokens": ["This", "method", "is", "for", "filling", "a", "specific", "individual", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-persondir/src/main/java/org/apereo/portal/persondir/PortalRootPersonAttributeDao.java#L110-L120", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-persondir/src/main/java/org/apereo/portal/persondir/PortalRootPersonAttributeDao.java", "func_name": "PortalRootPersonAttributeDao.getPeopleWithMultivaluedAttributes", "original_string": "@Override\n    public Set<IPersonAttributes> getPeopleWithMultivaluedAttributes(\n            Map<String, List<Object>> query) {\n        final Set<IPersonAttributes> people =\n                delegatePersonAttributeDao.getPeopleWithMultivaluedAttributes(query);\n        if (people == null) {\n            return null;\n        }\n\n        final Set<IPersonAttributes> modifiedPeople = new LinkedHashSet<>();\n\n        for (final IPersonAttributes person : people) {\n            /*\n             * WARNING:  Not safe to pass uidInQuery in this scenario;  results will be \"filled\" by\n             * getPerson(uid) subsequently.\n             */\n            final IPersonAttributes mergedPerson = postProcessPerson(person, null);\n            modifiedPeople.add(mergedPerson);\n        }\n\n        return modifiedPeople;\n    }", "language": "java", "code": "@Override\n    public Set<IPersonAttributes> getPeopleWithMultivaluedAttributes(\n            Map<String, List<Object>> query) {\n        final Set<IPersonAttributes> people =\n                delegatePersonAttributeDao.getPeopleWithMultivaluedAttributes(query);\n        if (people == null) {\n            return null;\n        }\n\n        final Set<IPersonAttributes> modifiedPeople = new LinkedHashSet<>();\n\n        for (final IPersonAttributes person : people) {\n            /*\n             * WARNING:  Not safe to pass uidInQuery in this scenario;  results will be \"filled\" by\n             * getPerson(uid) subsequently.\n             */\n            final IPersonAttributes mergedPerson = postProcessPerson(person, null);\n            modifiedPeople.add(mergedPerson);\n        }\n\n        return modifiedPeople;\n    }", "code_tokens": ["@", "Override", "public", "Set", "<", "IPersonAttributes", ">", "getPeopleWithMultivaluedAttributes", "(", "Map", "<", "String", ",", "List", "<", "Object", ">", ">", "query", ")", "{", "final", "Set", "<", "IPersonAttributes", ">", "people", "=", "delegatePersonAttributeDao", ".", "getPeopleWithMultivaluedAttributes", "(", "query", ")", ";", "if", "(", "people", "==", "null", ")", "{", "return", "null", ";", "}", "final", "Set", "<", "IPersonAttributes", ">", "modifiedPeople", "=", "new", "LinkedHashSet", "<>", "(", ")", ";", "for", "(", "final", "IPersonAttributes", "person", ":", "people", ")", "{", "/*\n             * WARNING:  Not safe to pass uidInQuery in this scenario;  results will be \"filled\" by\n             * getPerson(uid) subsequently.\n             */", "final", "IPersonAttributes", "mergedPerson", "=", "postProcessPerson", "(", "person", ",", "null", ")", ";", "modifiedPeople", ".", "add", "(", "mergedPerson", ")", ";", "}", "return", "modifiedPeople", ";", "}"], "docstring": "This method is for matching a search query. Each matching item will subsequently be passed to\n<code>getPerson(uid)</code> for \"filling.\"", "docstring_tokens": ["This", "method", "is", "for", "matching", "a", "search", "query", ".", "Each", "matching", "item", "will", "subsequently", "be", "passed", "to", "<code", ">", "getPerson", "(", "uid", ")", "<", "/", "code", ">", "for", "filling", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-persondir/src/main/java/org/apereo/portal/persondir/PortalRootPersonAttributeDao.java#L126-L147", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-persondir/src/main/java/org/apereo/portal/persondir/PortalRootPersonAttributeDao.java", "func_name": "PortalRootPersonAttributeDao.postProcessPerson", "original_string": "private IPersonAttributes postProcessPerson(IPersonAttributes person, String uidInQuery) {\n\n        // Verify the person has a name\n        final String name = person.getName();\n        if (name == null) {\n            logger.warn(\"IPerson '{}' has no name and therefore cannot be post-processed\", person);\n            return person;\n        }\n\n        // First apply specified overrides\n        IPersonAttributes rslt =\n                applyOverridesIfPresent(person); // default -- won't normally need to do anything\n\n        /*\n         * And secondly there are two attributes in uPortal that cause havoc if they're missing:\n         *\n         *   - username\n         *   - displayName\n         *\n         * We need to do our best to provide these if the external data sources don't cover it.\n         */\n        rslt = selectUsernameIfAbsent(rslt);\n        rslt = selectDisplayNameIfAbsent(rslt);\n\n        logger.debug(\n                \"Post-processing of person with name='{}' produced the following person:  {}\",\n                person.getName(),\n                rslt);\n\n        return rslt;\n    }", "language": "java", "code": "private IPersonAttributes postProcessPerson(IPersonAttributes person, String uidInQuery) {\n\n        // Verify the person has a name\n        final String name = person.getName();\n        if (name == null) {\n            logger.warn(\"IPerson '{}' has no name and therefore cannot be post-processed\", person);\n            return person;\n        }\n\n        // First apply specified overrides\n        IPersonAttributes rslt =\n                applyOverridesIfPresent(person); // default -- won't normally need to do anything\n\n        /*\n         * And secondly there are two attributes in uPortal that cause havoc if they're missing:\n         *\n         *   - username\n         *   - displayName\n         *\n         * We need to do our best to provide these if the external data sources don't cover it.\n         */\n        rslt = selectUsernameIfAbsent(rslt);\n        rslt = selectDisplayNameIfAbsent(rslt);\n\n        logger.debug(\n                \"Post-processing of person with name='{}' produced the following person:  {}\",\n                person.getName(),\n                rslt);\n\n        return rslt;\n    }", "code_tokens": ["private", "IPersonAttributes", "postProcessPerson", "(", "IPersonAttributes", "person", ",", "String", "uidInQuery", ")", "{", "// Verify the person has a name", "final", "String", "name", "=", "person", ".", "getName", "(", ")", ";", "if", "(", "name", "==", "null", ")", "{", "logger", ".", "warn", "(", "\"IPerson '{}' has no name and therefore cannot be post-processed\"", ",", "person", ")", ";", "return", "person", ";", "}", "// First apply specified overrides", "IPersonAttributes", "rslt", "=", "applyOverridesIfPresent", "(", "person", ")", ";", "// default -- won't normally need to do anything", "/*\n         * And secondly there are two attributes in uPortal that cause havoc if they're missing:\n         *\n         *   - username\n         *   - displayName\n         *\n         * We need to do our best to provide these if the external data sources don't cover it.\n         */", "rslt", "=", "selectUsernameIfAbsent", "(", "rslt", ")", ";", "rslt", "=", "selectDisplayNameIfAbsent", "(", "rslt", ")", ";", "logger", ".", "debug", "(", "\"Post-processing of person with name='{}' produced the following person:  {}\"", ",", "person", ".", "getName", "(", ")", ",", "rslt", ")", ";", "return", "rslt", ";", "}"], "docstring": "Implements support for overriding attributes by administrator choice and for intelligently\nselecting (if possible) values for 'username' and 'displayName' if none have been provided by\nother data sources.\n\n@param person The user\n@param uidInQuery The username specified in the PersonDirectory query, if certain\n@return The user, possibly with modifications", "docstring_tokens": ["Implements", "support", "for", "overriding", "attributes", "by", "administrator", "choice", "and", "for", "intelligently", "selecting", "(", "if", "possible", ")", "values", "for", "username", "and", "displayName", "if", "none", "have", "been", "provided", "by", "other", "data", "sources", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-persondir/src/main/java/org/apereo/portal/persondir/PortalRootPersonAttributeDao.java#L168-L198", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-web/src/main/java/org/apereo/portal/portlet/container/services/LocalPortletContextManager.java", "func_name": "LocalPortletContextManager.register", "original_string": "@Override\n    public synchronized String register(ServletConfig config) throws PortletContainerException {\n        ServletContext servletContext = config.getServletContext();\n        String contextPath = servletContext.getContextPath();\n        if (!portletContexts.containsKey(contextPath)) {\n\n            PortletApplicationDefinition portletApp =\n                    this.getPortletAppDD(servletContext, contextPath, contextPath);\n\n            DriverPortletContext portletContext =\n                    new DriverPortletContextImpl(\n                            servletContext, portletApp, requestDispatcherService);\n\n            portletContext.setAttribute(\n                    PlatformApiBroker.PORTLET_CONTEXT_ATTRIBUTE_NAME, platformApiBroker);\n            portletContexts.put(contextPath, portletContext);\n\n            fireRegistered(portletContext);\n\n            if (logger.isInfoEnabled()) {\n                logger.info(\"Registered portlet application for context '\" + contextPath + \"'\");\n\n                logger.info(\n                        \"Registering \"\n                                + portletApp.getPortlets().size()\n                                + \" portlets for context \"\n                                + portletContext.getApplicationName());\n            }\n\n            // TODO have the portlet servlet provide the portlet's classloader as parameter to this\n            // method\n            // This approach is needed as all pluto callbacks in uPortal have an aspect that\n            // switches the thread classloader back\n            // to uPortal's classloader.\n            ClassLoader classLoader = ThreadContextClassLoaderAspect.getPreviousClassLoader();\n            if (classLoader == null) {\n                classLoader = Thread.currentThread().getContextClassLoader();\n            }\n            classLoaders.put(portletApp.getName(), classLoader);\n            for (PortletDefinition portlet : portletApp.getPortlets()) {\n                String appName = portletContext.getApplicationName();\n                if (appName == null) {\n                    throw new PortletContainerException(\n                            \"Portlet application name should not be null.\");\n                }\n                portletConfigs.put(\n                        portletContext.getApplicationName() + \"/\" + portlet.getPortletName(),\n                        new DriverPortletConfigImpl(portletContext, portlet));\n            }\n        } else {\n            if (logger.isInfoEnabled()) {\n                logger.info(\n                        \"Portlet application for context '\"\n                                + contextPath\n                                + \"' already registered.\");\n            }\n        }\n        return contextPath;\n    }", "language": "java", "code": "@Override\n    public synchronized String register(ServletConfig config) throws PortletContainerException {\n        ServletContext servletContext = config.getServletContext();\n        String contextPath = servletContext.getContextPath();\n        if (!portletContexts.containsKey(contextPath)) {\n\n            PortletApplicationDefinition portletApp =\n                    this.getPortletAppDD(servletContext, contextPath, contextPath);\n\n            DriverPortletContext portletContext =\n                    new DriverPortletContextImpl(\n                            servletContext, portletApp, requestDispatcherService);\n\n            portletContext.setAttribute(\n                    PlatformApiBroker.PORTLET_CONTEXT_ATTRIBUTE_NAME, platformApiBroker);\n            portletContexts.put(contextPath, portletContext);\n\n            fireRegistered(portletContext);\n\n            if (logger.isInfoEnabled()) {\n                logger.info(\"Registered portlet application for context '\" + contextPath + \"'\");\n\n                logger.info(\n                        \"Registering \"\n                                + portletApp.getPortlets().size()\n                                + \" portlets for context \"\n                                + portletContext.getApplicationName());\n            }\n\n            // TODO have the portlet servlet provide the portlet's classloader as parameter to this\n            // method\n            // This approach is needed as all pluto callbacks in uPortal have an aspect that\n            // switches the thread classloader back\n            // to uPortal's classloader.\n            ClassLoader classLoader = ThreadContextClassLoaderAspect.getPreviousClassLoader();\n            if (classLoader == null) {\n                classLoader = Thread.currentThread().getContextClassLoader();\n            }\n            classLoaders.put(portletApp.getName(), classLoader);\n            for (PortletDefinition portlet : portletApp.getPortlets()) {\n                String appName = portletContext.getApplicationName();\n                if (appName == null) {\n                    throw new PortletContainerException(\n                            \"Portlet application name should not be null.\");\n                }\n                portletConfigs.put(\n                        portletContext.getApplicationName() + \"/\" + portlet.getPortletName(),\n                        new DriverPortletConfigImpl(portletContext, portlet));\n            }\n        } else {\n            if (logger.isInfoEnabled()) {\n                logger.info(\n                        \"Portlet application for context '\"\n                                + contextPath\n                                + \"' already registered.\");\n            }\n        }\n        return contextPath;\n    }", "code_tokens": ["@", "Override", "public", "synchronized", "String", "register", "(", "ServletConfig", "config", ")", "throws", "PortletContainerException", "{", "ServletContext", "servletContext", "=", "config", ".", "getServletContext", "(", ")", ";", "String", "contextPath", "=", "servletContext", ".", "getContextPath", "(", ")", ";", "if", "(", "!", "portletContexts", ".", "containsKey", "(", "contextPath", ")", ")", "{", "PortletApplicationDefinition", "portletApp", "=", "this", ".", "getPortletAppDD", "(", "servletContext", ",", "contextPath", ",", "contextPath", ")", ";", "DriverPortletContext", "portletContext", "=", "new", "DriverPortletContextImpl", "(", "servletContext", ",", "portletApp", ",", "requestDispatcherService", ")", ";", "portletContext", ".", "setAttribute", "(", "PlatformApiBroker", ".", "PORTLET_CONTEXT_ATTRIBUTE_NAME", ",", "platformApiBroker", ")", ";", "portletContexts", ".", "put", "(", "contextPath", ",", "portletContext", ")", ";", "fireRegistered", "(", "portletContext", ")", ";", "if", "(", "logger", ".", "isInfoEnabled", "(", ")", ")", "{", "logger", ".", "info", "(", "\"Registered portlet application for context '\"", "+", "contextPath", "+", "\"'\"", ")", ";", "logger", ".", "info", "(", "\"Registering \"", "+", "portletApp", ".", "getPortlets", "(", ")", ".", "size", "(", ")", "+", "\" portlets for context \"", "+", "portletContext", ".", "getApplicationName", "(", ")", ")", ";", "}", "// TODO have the portlet servlet provide the portlet's classloader as parameter to this", "// method", "// This approach is needed as all pluto callbacks in uPortal have an aspect that", "// switches the thread classloader back", "// to uPortal's classloader.", "ClassLoader", "classLoader", "=", "ThreadContextClassLoaderAspect", ".", "getPreviousClassLoader", "(", ")", ";", "if", "(", "classLoader", "==", "null", ")", "{", "classLoader", "=", "Thread", ".", "currentThread", "(", ")", ".", "getContextClassLoader", "(", ")", ";", "}", "classLoaders", ".", "put", "(", "portletApp", ".", "getName", "(", ")", ",", "classLoader", ")", ";", "for", "(", "PortletDefinition", "portlet", ":", "portletApp", ".", "getPortlets", "(", ")", ")", "{", "String", "appName", "=", "portletContext", ".", "getApplicationName", "(", ")", ";", "if", "(", "appName", "==", "null", ")", "{", "throw", "new", "PortletContainerException", "(", "\"Portlet application name should not be null.\"", ")", ";", "}", "portletConfigs", ".", "put", "(", "portletContext", ".", "getApplicationName", "(", ")", "+", "\"/\"", "+", "portlet", ".", "getPortletName", "(", ")", ",", "new", "DriverPortletConfigImpl", "(", "portletContext", ",", "portlet", ")", ")", ";", "}", "}", "else", "{", "if", "(", "logger", ".", "isInfoEnabled", "(", ")", ")", "{", "logger", ".", "info", "(", "\"Portlet application for context '\"", "+", "contextPath", "+", "\"' already registered.\"", ")", ";", "}", "}", "return", "contextPath", ";", "}"], "docstring": "Retrieves the PortletContext associated with the given ServletContext. If one does not exist,\nit is created.\n\n@param config the servlet config.\n@return the InternalPortletContext associated with the ServletContext.\n@throws PortletContainerException", "docstring_tokens": ["Retrieves", "the", "PortletContext", "associated", "with", "the", "given", "ServletContext", ".", "If", "one", "does", "not", "exist", "it", "is", "created", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-web/src/main/java/org/apereo/portal/portlet/container/services/LocalPortletContextManager.java#L126-L184", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-web/src/main/java/org/apereo/portal/portlet/container/services/LocalPortletContextManager.java", "func_name": "LocalPortletContextManager.getPortletAppDD", "original_string": "public synchronized PortletApplicationDefinition getPortletAppDD(\n            ServletContext servletContext, String name, String contextPath)\n            throws PortletContainerException {\n        PortletApplicationDefinition portletApp =\n                this.portletAppDefinitionCache.get(servletContext);\n        if (portletApp == null) {\n            portletApp = createDefinition(servletContext, name, contextPath);\n            this.portletAppDefinitionCache.put(servletContext, portletApp);\n        }\n        return portletApp;\n    }", "language": "java", "code": "public synchronized PortletApplicationDefinition getPortletAppDD(\n            ServletContext servletContext, String name, String contextPath)\n            throws PortletContainerException {\n        PortletApplicationDefinition portletApp =\n                this.portletAppDefinitionCache.get(servletContext);\n        if (portletApp == null) {\n            portletApp = createDefinition(servletContext, name, contextPath);\n            this.portletAppDefinitionCache.put(servletContext, portletApp);\n        }\n        return portletApp;\n    }", "code_tokens": ["public", "synchronized", "PortletApplicationDefinition", "getPortletAppDD", "(", "ServletContext", "servletContext", ",", "String", "name", ",", "String", "contextPath", ")", "throws", "PortletContainerException", "{", "PortletApplicationDefinition", "portletApp", "=", "this", ".", "portletAppDefinitionCache", ".", "get", "(", "servletContext", ")", ";", "if", "(", "portletApp", "==", "null", ")", "{", "portletApp", "=", "createDefinition", "(", "servletContext", ",", "name", ",", "contextPath", ")", ";", "this", ".", "portletAppDefinitionCache", ".", "put", "(", "servletContext", ",", "portletApp", ")", ";", "}", "return", "portletApp", ";", "}"], "docstring": "Retrieve the Portlet Application Deployment Descriptor for the given servlet context. Create\nit if it does not allready exist.\n\n@param servletContext the servlet context.\n@return The portlet application deployment descriptor.\n@throws PortletContainerException if the descriptor can not be found or parsed", "docstring_tokens": ["Retrieve", "the", "Portlet", "Application", "Deployment", "Descriptor", "for", "the", "given", "servlet", "context", ".", "Create", "it", "if", "it", "does", "not", "allready", "exist", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-web/src/main/java/org/apereo/portal/portlet/container/services/LocalPortletContextManager.java#L306-L316", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-web/src/main/java/org/apereo/portal/portlet/container/services/LocalPortletContextManager.java", "func_name": "LocalPortletContextManager.createDefinition", "original_string": "private PortletApplicationDefinition createDefinition(\n            ServletContext servletContext, String name, String contextPath)\n            throws PortletContainerException {\n        PortletApplicationDefinition portletApp = null;\n        try {\n            InputStream paIn = servletContext.getResourceAsStream(PORTLET_XML);\n            InputStream webIn = servletContext.getResourceAsStream(WEB_XML);\n            if (paIn == null) {\n                throw new PortletContainerException(\n                        \"Cannot find '\"\n                                + PORTLET_XML\n                                + \"'. Are you sure it is in the deployed package?\");\n            }\n            if (webIn == null) {\n                throw new PortletContainerException(\n                        \"Cannot find '\"\n                                + WEB_XML\n                                + \"'. Are you sure it is in the deployed package?\");\n            }\n            portletApp = this.portletAppDescriptorService.read(name, contextPath, paIn);\n            this.portletAppDescriptorService.mergeWebDescriptor(portletApp, webIn);\n        } catch (Exception ex) {\n            throw new PortletContainerException(\n                    \"Exception loading portlet descriptor for: \"\n                            + servletContext.getServletContextName(),\n                    ex);\n        }\n        return portletApp;\n    }", "language": "java", "code": "private PortletApplicationDefinition createDefinition(\n            ServletContext servletContext, String name, String contextPath)\n            throws PortletContainerException {\n        PortletApplicationDefinition portletApp = null;\n        try {\n            InputStream paIn = servletContext.getResourceAsStream(PORTLET_XML);\n            InputStream webIn = servletContext.getResourceAsStream(WEB_XML);\n            if (paIn == null) {\n                throw new PortletContainerException(\n                        \"Cannot find '\"\n                                + PORTLET_XML\n                                + \"'. Are you sure it is in the deployed package?\");\n            }\n            if (webIn == null) {\n                throw new PortletContainerException(\n                        \"Cannot find '\"\n                                + WEB_XML\n                                + \"'. Are you sure it is in the deployed package?\");\n            }\n            portletApp = this.portletAppDescriptorService.read(name, contextPath, paIn);\n            this.portletAppDescriptorService.mergeWebDescriptor(portletApp, webIn);\n        } catch (Exception ex) {\n            throw new PortletContainerException(\n                    \"Exception loading portlet descriptor for: \"\n                            + servletContext.getServletContextName(),\n                    ex);\n        }\n        return portletApp;\n    }", "code_tokens": ["private", "PortletApplicationDefinition", "createDefinition", "(", "ServletContext", "servletContext", ",", "String", "name", ",", "String", "contextPath", ")", "throws", "PortletContainerException", "{", "PortletApplicationDefinition", "portletApp", "=", "null", ";", "try", "{", "InputStream", "paIn", "=", "servletContext", ".", "getResourceAsStream", "(", "PORTLET_XML", ")", ";", "InputStream", "webIn", "=", "servletContext", ".", "getResourceAsStream", "(", "WEB_XML", ")", ";", "if", "(", "paIn", "==", "null", ")", "{", "throw", "new", "PortletContainerException", "(", "\"Cannot find '\"", "+", "PORTLET_XML", "+", "\"'. Are you sure it is in the deployed package?\"", ")", ";", "}", "if", "(", "webIn", "==", "null", ")", "{", "throw", "new", "PortletContainerException", "(", "\"Cannot find '\"", "+", "WEB_XML", "+", "\"'. Are you sure it is in the deployed package?\"", ")", ";", "}", "portletApp", "=", "this", ".", "portletAppDescriptorService", ".", "read", "(", "name", ",", "contextPath", ",", "paIn", ")", ";", "this", ".", "portletAppDescriptorService", ".", "mergeWebDescriptor", "(", "portletApp", ",", "webIn", ")", ";", "}", "catch", "(", "Exception", "ex", ")", "{", "throw", "new", "PortletContainerException", "(", "\"Exception loading portlet descriptor for: \"", "+", "servletContext", ".", "getServletContextName", "(", ")", ",", "ex", ")", ";", "}", "return", "portletApp", ";", "}"], "docstring": "Creates the portlet.xml deployment descriptor representation.\n\n@param servletContext the servlet context for which the DD is requested.\n@return the Portlet Application Deployment Descriptor.\n@throws PortletContainerException", "docstring_tokens": ["Creates", "the", "portlet", ".", "xml", "deployment", "descriptor", "representation", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-web/src/main/java/org/apereo/portal/portlet/container/services/LocalPortletContextManager.java#L327-L355", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/PortletMimeResponseContextImpl.java", "func_name": "PortletMimeResponseContextImpl.getPortletURLProvider", "original_string": "@Override\n    public PortletURLProvider getPortletURLProvider(TYPE type) {\n        final IPortletWindowId portletWindowId = this.portletWindow.getPortletWindowId();\n        final UrlType urlType = UrlType.fromPortletUrlType(type);\n        final IPortalUrlBuilder portalUrlBuilder =\n                this.portalUrlProvider.getPortalUrlBuilderByPortletWindow(\n                        containerRequest, portletWindowId, urlType);\n        final IPortletUrlBuilder portletUrlBuilder =\n                portalUrlBuilder.getPortletUrlBuilder(portletWindowId);\n        return new PortletURLProviderImpl(portletUrlBuilder);\n    }", "language": "java", "code": "@Override\n    public PortletURLProvider getPortletURLProvider(TYPE type) {\n        final IPortletWindowId portletWindowId = this.portletWindow.getPortletWindowId();\n        final UrlType urlType = UrlType.fromPortletUrlType(type);\n        final IPortalUrlBuilder portalUrlBuilder =\n                this.portalUrlProvider.getPortalUrlBuilderByPortletWindow(\n                        containerRequest, portletWindowId, urlType);\n        final IPortletUrlBuilder portletUrlBuilder =\n                portalUrlBuilder.getPortletUrlBuilder(portletWindowId);\n        return new PortletURLProviderImpl(portletUrlBuilder);\n    }", "code_tokens": ["@", "Override", "public", "PortletURLProvider", "getPortletURLProvider", "(", "TYPE", "type", ")", "{", "final", "IPortletWindowId", "portletWindowId", "=", "this", ".", "portletWindow", ".", "getPortletWindowId", "(", ")", ";", "final", "UrlType", "urlType", "=", "UrlType", ".", "fromPortletUrlType", "(", "type", ")", ";", "final", "IPortalUrlBuilder", "portalUrlBuilder", "=", "this", ".", "portalUrlProvider", ".", "getPortalUrlBuilderByPortletWindow", "(", "containerRequest", ",", "portletWindowId", ",", "urlType", ")", ";", "final", "IPortletUrlBuilder", "portletUrlBuilder", "=", "portalUrlBuilder", ".", "getPortletUrlBuilder", "(", "portletWindowId", ")", ";", "return", "new", "PortletURLProviderImpl", "(", "portletUrlBuilder", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apache.pluto.container.PortletMimeResponseContext#getPortletURLProvider(org.apache.pluto.container.PortletURLProvider.TYPE)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/PortletMimeResponseContextImpl.java#L160-L170", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java", "func_name": "JpaClusterLockDao.getClusterMutexInternal", "original_string": "protected ClusterMutex getClusterMutexInternal(final String mutexName) {\n        final TransactionOperations transactionOperations = this.getTransactionOperations();\n        return transactionOperations.execute(\n                new TransactionCallback<ClusterMutex>() {\n                    @Override\n                    public ClusterMutex doInTransaction(TransactionStatus status) {\n                        final CacheKey key = CacheKey.build(CLUSTER_MUTEX_SOURCE, mutexName);\n                        ClusterMutex clusterMutex =\n                                entityManagerCache.get(BasePortalJpaDao.PERSISTENCE_UNIT_NAME, key);\n                        if (clusterMutex != null) {\n                            return clusterMutex;\n                        }\n\n                        final NaturalIdQuery<ClusterMutex> query =\n                                createNaturalIdQuery(ClusterMutex.class);\n                        query.using(ClusterMutex_.name, mutexName);\n                        clusterMutex = query.load();\n\n                        entityManagerCache.put(\n                                BasePortalJpaDao.PERSISTENCE_UNIT_NAME, key, clusterMutex);\n\n                        return clusterMutex;\n                    }\n                });\n    }", "language": "java", "code": "protected ClusterMutex getClusterMutexInternal(final String mutexName) {\n        final TransactionOperations transactionOperations = this.getTransactionOperations();\n        return transactionOperations.execute(\n                new TransactionCallback<ClusterMutex>() {\n                    @Override\n                    public ClusterMutex doInTransaction(TransactionStatus status) {\n                        final CacheKey key = CacheKey.build(CLUSTER_MUTEX_SOURCE, mutexName);\n                        ClusterMutex clusterMutex =\n                                entityManagerCache.get(BasePortalJpaDao.PERSISTENCE_UNIT_NAME, key);\n                        if (clusterMutex != null) {\n                            return clusterMutex;\n                        }\n\n                        final NaturalIdQuery<ClusterMutex> query =\n                                createNaturalIdQuery(ClusterMutex.class);\n                        query.using(ClusterMutex_.name, mutexName);\n                        clusterMutex = query.load();\n\n                        entityManagerCache.put(\n                                BasePortalJpaDao.PERSISTENCE_UNIT_NAME, key, clusterMutex);\n\n                        return clusterMutex;\n                    }\n                });\n    }", "code_tokens": ["protected", "ClusterMutex", "getClusterMutexInternal", "(", "final", "String", "mutexName", ")", "{", "final", "TransactionOperations", "transactionOperations", "=", "this", ".", "getTransactionOperations", "(", ")", ";", "return", "transactionOperations", ".", "execute", "(", "new", "TransactionCallback", "<", "ClusterMutex", ">", "(", ")", "{", "@", "Override", "public", "ClusterMutex", "doInTransaction", "(", "TransactionStatus", "status", ")", "{", "final", "CacheKey", "key", "=", "CacheKey", ".", "build", "(", "CLUSTER_MUTEX_SOURCE", ",", "mutexName", ")", ";", "ClusterMutex", "clusterMutex", "=", "entityManagerCache", ".", "get", "(", "BasePortalJpaDao", ".", "PERSISTENCE_UNIT_NAME", ",", "key", ")", ";", "if", "(", "clusterMutex", "!=", "null", ")", "{", "return", "clusterMutex", ";", "}", "final", "NaturalIdQuery", "<", "ClusterMutex", ">", "query", "=", "createNaturalIdQuery", "(", "ClusterMutex", ".", "class", ")", ";", "query", ".", "using", "(", "ClusterMutex_", ".", "name", ",", "mutexName", ")", ";", "clusterMutex", "=", "query", ".", "load", "(", ")", ";", "entityManagerCache", ".", "put", "(", "BasePortalJpaDao", ".", "PERSISTENCE_UNIT_NAME", ",", "key", ",", "clusterMutex", ")", ";", "return", "clusterMutex", ";", "}", "}", ")", ";", "}"], "docstring": "Retrieves a ClusterMutex in a new TX", "docstring_tokens": ["Retrieves", "a", "ClusterMutex", "in", "a", "new", "TX"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java#L217-L241", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java", "func_name": "JpaClusterLockDao.createClusterMutex", "original_string": "protected void createClusterMutex(final String mutexName) {\n        this.executeIgnoreRollback(\n                new TransactionCallbackWithoutResult() {\n                    @Override\n                    protected void doInTransactionWithoutResult(TransactionStatus status) {\n                        final EntityManager entityManager = getEntityManager();\n                        final ClusterMutex clusterMutex = new ClusterMutex(mutexName);\n                        entityManager.persist(clusterMutex);\n                        try {\n                            entityManager.flush();\n                            logger.trace(\"Created {}\", clusterMutex);\n                        } catch (PersistenceException e) {\n                            if (e.getCause() instanceof ConstraintViolationException) {\n                                // ignore, another thread beat us to creation\n                                logger.debug(\n                                        \"Failed to create mutex, it was likely created concurrently by another thread: \"\n                                                + clusterMutex,\n                                        e);\n                                return;\n                            }\n\n                            // re-throw exception with unhandled cause\n                            throw e;\n                        }\n                    }\n                });\n    }", "language": "java", "code": "protected void createClusterMutex(final String mutexName) {\n        this.executeIgnoreRollback(\n                new TransactionCallbackWithoutResult() {\n                    @Override\n                    protected void doInTransactionWithoutResult(TransactionStatus status) {\n                        final EntityManager entityManager = getEntityManager();\n                        final ClusterMutex clusterMutex = new ClusterMutex(mutexName);\n                        entityManager.persist(clusterMutex);\n                        try {\n                            entityManager.flush();\n                            logger.trace(\"Created {}\", clusterMutex);\n                        } catch (PersistenceException e) {\n                            if (e.getCause() instanceof ConstraintViolationException) {\n                                // ignore, another thread beat us to creation\n                                logger.debug(\n                                        \"Failed to create mutex, it was likely created concurrently by another thread: \"\n                                                + clusterMutex,\n                                        e);\n                                return;\n                            }\n\n                            // re-throw exception with unhandled cause\n                            throw e;\n                        }\n                    }\n                });\n    }", "code_tokens": ["protected", "void", "createClusterMutex", "(", "final", "String", "mutexName", ")", "{", "this", ".", "executeIgnoreRollback", "(", "new", "TransactionCallbackWithoutResult", "(", ")", "{", "@", "Override", "protected", "void", "doInTransactionWithoutResult", "(", "TransactionStatus", "status", ")", "{", "final", "EntityManager", "entityManager", "=", "getEntityManager", "(", ")", ";", "final", "ClusterMutex", "clusterMutex", "=", "new", "ClusterMutex", "(", "mutexName", ")", ";", "entityManager", ".", "persist", "(", "clusterMutex", ")", ";", "try", "{", "entityManager", ".", "flush", "(", ")", ";", "logger", ".", "trace", "(", "\"Created {}\"", ",", "clusterMutex", ")", ";", "}", "catch", "(", "PersistenceException", "e", ")", "{", "if", "(", "e", ".", "getCause", "(", ")", "instanceof", "ConstraintViolationException", ")", "{", "// ignore, another thread beat us to creation", "logger", ".", "debug", "(", "\"Failed to create mutex, it was likely created concurrently by another thread: \"", "+", "clusterMutex", ",", "e", ")", ";", "return", ";", "}", "// re-throw exception with unhandled cause", "throw", "e", ";", "}", "}", "}", ")", ";", "}"], "docstring": "Creates a new ClusterMutex with the specified name. Returns the created mutex or null if the\nmutex already exists.", "docstring_tokens": ["Creates", "a", "new", "ClusterMutex", "with", "the", "specified", "name", ".", "Returns", "the", "created", "mutex", "or", "null", "if", "the", "mutex", "already", "exists", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java#L247-L273", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java", "func_name": "JpaClusterLockDao.validateLockedMutex", "original_string": "protected void validateLockedMutex(ClusterMutex clusterMutex) {\n        if (!clusterMutex.isLocked()) {\n            throw new IllegalMonitorStateException(\n                    \"Mutex is not currently locked, it cannot be updated: \" + clusterMutex);\n        }\n        final String serverName = this.portalInfoProvider.getUniqueServerName();\n        if (!serverName.equals(clusterMutex.getServerId())) {\n            throw new IllegalMonitorStateException(\n                    \"Mutex is currently locked by another server: \"\n                            + clusterMutex\n                            + \" local serverName: \"\n                            + serverName);\n        }\n    }", "language": "java", "code": "protected void validateLockedMutex(ClusterMutex clusterMutex) {\n        if (!clusterMutex.isLocked()) {\n            throw new IllegalMonitorStateException(\n                    \"Mutex is not currently locked, it cannot be updated: \" + clusterMutex);\n        }\n        final String serverName = this.portalInfoProvider.getUniqueServerName();\n        if (!serverName.equals(clusterMutex.getServerId())) {\n            throw new IllegalMonitorStateException(\n                    \"Mutex is currently locked by another server: \"\n                            + clusterMutex\n                            + \" local serverName: \"\n                            + serverName);\n        }\n    }", "code_tokens": ["protected", "void", "validateLockedMutex", "(", "ClusterMutex", "clusterMutex", ")", "{", "if", "(", "!", "clusterMutex", ".", "isLocked", "(", ")", ")", "{", "throw", "new", "IllegalMonitorStateException", "(", "\"Mutex is not currently locked, it cannot be updated: \"", "+", "clusterMutex", ")", ";", "}", "final", "String", "serverName", "=", "this", ".", "portalInfoProvider", ".", "getUniqueServerName", "(", ")", ";", "if", "(", "!", "serverName", ".", "equals", "(", "clusterMutex", ".", "getServerId", "(", ")", ")", ")", "{", "throw", "new", "IllegalMonitorStateException", "(", "\"Mutex is currently locked by another server: \"", "+", "clusterMutex", "+", "\" local serverName: \"", "+", "serverName", ")", ";", "}", "}"], "docstring": "Validates that the specified mutex is locked by this server, throws\nIllegalMonitorStateException if either test fails", "docstring_tokens": ["Validates", "that", "the", "specified", "mutex", "is", "locked", "by", "this", "server", "throws", "IllegalMonitorStateException", "if", "either", "test", "fails"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java#L279-L292", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java", "func_name": "JpaClusterLockDao.unlockAbandonedLock", "original_string": "protected void unlockAbandonedLock(final String mutexName) {\n        this.executeIgnoreRollback(\n                new TransactionCallbackWithoutResult() {\n                    @Override\n                    protected void doInTransactionWithoutResult(TransactionStatus status) {\n                        final EntityManager entityManager = getEntityManager();\n                        final ClusterMutex clusterMutex = getClusterMutex(mutexName);\n\n                        if (!isLockAbandoned(clusterMutex)) {\n                            // No longer abandoned\n                            return;\n                        }\n\n                        logger.warn(\"Unlocking abandoned \" + clusterMutex);\n                        clusterMutex.unlock();\n                        entityManager.persist(clusterMutex);\n                        try {\n                            entityManager.flush();\n                        } catch (OptimisticLockException e) {\n                            logger.trace(\n                                    \"Abandoned mutex {} was cleared by another thread or server\",\n                                    mutexName);\n                        }\n                    }\n                });\n    }", "language": "java", "code": "protected void unlockAbandonedLock(final String mutexName) {\n        this.executeIgnoreRollback(\n                new TransactionCallbackWithoutResult() {\n                    @Override\n                    protected void doInTransactionWithoutResult(TransactionStatus status) {\n                        final EntityManager entityManager = getEntityManager();\n                        final ClusterMutex clusterMutex = getClusterMutex(mutexName);\n\n                        if (!isLockAbandoned(clusterMutex)) {\n                            // No longer abandoned\n                            return;\n                        }\n\n                        logger.warn(\"Unlocking abandoned \" + clusterMutex);\n                        clusterMutex.unlock();\n                        entityManager.persist(clusterMutex);\n                        try {\n                            entityManager.flush();\n                        } catch (OptimisticLockException e) {\n                            logger.trace(\n                                    \"Abandoned mutex {} was cleared by another thread or server\",\n                                    mutexName);\n                        }\n                    }\n                });\n    }", "code_tokens": ["protected", "void", "unlockAbandonedLock", "(", "final", "String", "mutexName", ")", "{", "this", ".", "executeIgnoreRollback", "(", "new", "TransactionCallbackWithoutResult", "(", ")", "{", "@", "Override", "protected", "void", "doInTransactionWithoutResult", "(", "TransactionStatus", "status", ")", "{", "final", "EntityManager", "entityManager", "=", "getEntityManager", "(", ")", ";", "final", "ClusterMutex", "clusterMutex", "=", "getClusterMutex", "(", "mutexName", ")", ";", "if", "(", "!", "isLockAbandoned", "(", "clusterMutex", ")", ")", "{", "// No longer abandoned", "return", ";", "}", "logger", ".", "warn", "(", "\"Unlocking abandoned \"", "+", "clusterMutex", ")", ";", "clusterMutex", ".", "unlock", "(", ")", ";", "entityManager", ".", "persist", "(", "clusterMutex", ")", ";", "try", "{", "entityManager", ".", "flush", "(", ")", ";", "}", "catch", "(", "OptimisticLockException", "e", ")", "{", "logger", ".", "trace", "(", "\"Abandoned mutex {} was cleared by another thread or server\"", ",", "mutexName", ")", ";", "}", "}", "}", ")", ";", "}"], "docstring": "Unlocks an abandoned mutex", "docstring_tokens": ["Unlocks", "an", "abandoned", "mutex"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java#L295-L320", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java", "func_name": "JpaClusterLockDao.executeIgnoreRollback", "original_string": "protected <T> T executeIgnoreRollback(TransactionCallback<T> action, T rollbackValue) {\n        try {\n            // Try to create the mutex in a new TX\n            return this.newTransactionTemplate.execute(action);\n        } catch (TransactionSystemException e) {\n            if (e.getCause() instanceof RollbackException) {\n                // Ignore rollbacks\n                return rollbackValue;\n            }\n\n            // re-throw exception with unhandled cause\n            throw e;\n        }\n    }", "language": "java", "code": "protected <T> T executeIgnoreRollback(TransactionCallback<T> action, T rollbackValue) {\n        try {\n            // Try to create the mutex in a new TX\n            return this.newTransactionTemplate.execute(action);\n        } catch (TransactionSystemException e) {\n            if (e.getCause() instanceof RollbackException) {\n                // Ignore rollbacks\n                return rollbackValue;\n            }\n\n            // re-throw exception with unhandled cause\n            throw e;\n        }\n    }", "code_tokens": ["protected", "<", "T", ">", "T", "executeIgnoreRollback", "(", "TransactionCallback", "<", "T", ">", "action", ",", "T", "rollbackValue", ")", "{", "try", "{", "// Try to create the mutex in a new TX", "return", "this", ".", "newTransactionTemplate", ".", "execute", "(", "action", ")", ";", "}", "catch", "(", "TransactionSystemException", "e", ")", "{", "if", "(", "e", ".", "getCause", "(", ")", "instanceof", "RollbackException", ")", "{", "// Ignore rollbacks", "return", "rollbackValue", ";", "}", "// re-throw exception with unhandled cause", "throw", "e", ";", "}", "}"], "docstring": "Utility for using TransactionTemplate when we know that a rollback might happen and just want\nto ignore it", "docstring_tokens": ["Utility", "for", "using", "TransactionTemplate", "when", "we", "know", "that", "a", "rollback", "might", "happen", "and", "just", "want", "to", "ignore", "it"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/locking/JpaClusterLockDao.java#L335-L348", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/favorites/FavoritesUtils.java", "func_name": "FavoritesUtils.getFavoriteCollections", "original_string": "public List<IUserLayoutNodeDescription> getFavoriteCollections(IUserLayout userLayout) {\n\n        if (null == userLayout) {\n            throw new IllegalArgumentException(\n                    \"Cannot get favorites collections from a null userLayout\");\n        }\n\n        logger.trace(\"Extracting favorites collections from layout [{}].\", userLayout);\n\n        Enumeration<String> nodeIds = userLayout.getChildIds(userLayout.getRootId());\n\n        List<IUserLayoutNodeDescription> results = new LinkedList<IUserLayoutNodeDescription>();\n\n        while (nodeIds.hasMoreElements()) {\n            String nodeId = nodeIds.nextElement();\n\n            try {\n                IUserLayoutNodeDescription nodeDescription = userLayout.getNodeDescription(nodeId);\n\n                String parentId = userLayout.getParentId(nodeId);\n                String nodeName = nodeDescription.getName();\n                IUserLayoutNodeDescription.LayoutNodeType nodeType = nodeDescription.getType();\n\n                if (FOLDER.equals(nodeType)\n                        && nodeDescription instanceof IUserLayoutFolderDescription) {\n\n                    IUserLayoutFolderDescription folderDescription =\n                            (IUserLayoutFolderDescription) nodeDescription;\n\n                    String folderType = folderDescription.getFolderType();\n\n                    if (FAVORITE_COLLECTION_TYPE.equals(folderType)) {\n\n                        results.add(nodeDescription);\n\n                        logger.trace(\n                                \"Selected node with id [{}] named [{}] with \"\n                                        + \"folderType [{}] and type [{}] as a collection of favorites.\",\n                                nodeId,\n                                nodeName,\n                                folderType,\n                                nodeType);\n\n                    } else {\n\n                        logger.trace(\n                                \"Rejected node with id [{}] named [{}] with \"\n                                        + \"folderType [{}] and type [{}] as not a collection of favorites.\",\n                                nodeId,\n                                nodeName,\n                                folderType,\n                                nodeType);\n                    }\n\n                } else {\n                    logger.trace(\n                            \"Rejected non-folder node with id [{}] named [{}] \"\n                                    + \"with parentId [{}] and type [{}] as not a collection of favorites.\",\n                            nodeId,\n                            nodeName,\n                            parentId,\n                            nodeType);\n                }\n\n                // if something goes wrong in processing a node, exclude it\n            } catch (Exception e) {\n                logger.error(\n                        \"Error determining whether to include layout node [{}]\"\n                                + \" as a collection of favorites.  Excluding.\",\n                        nodeId,\n                        e);\n            }\n        }\n\n        logger.debug(\"Extracted favorites collections [{}] from [{}]\", results, userLayout);\n\n        return results;\n    }", "language": "java", "code": "public List<IUserLayoutNodeDescription> getFavoriteCollections(IUserLayout userLayout) {\n\n        if (null == userLayout) {\n            throw new IllegalArgumentException(\n                    \"Cannot get favorites collections from a null userLayout\");\n        }\n\n        logger.trace(\"Extracting favorites collections from layout [{}].\", userLayout);\n\n        Enumeration<String> nodeIds = userLayout.getChildIds(userLayout.getRootId());\n\n        List<IUserLayoutNodeDescription> results = new LinkedList<IUserLayoutNodeDescription>();\n\n        while (nodeIds.hasMoreElements()) {\n            String nodeId = nodeIds.nextElement();\n\n            try {\n                IUserLayoutNodeDescription nodeDescription = userLayout.getNodeDescription(nodeId);\n\n                String parentId = userLayout.getParentId(nodeId);\n                String nodeName = nodeDescription.getName();\n                IUserLayoutNodeDescription.LayoutNodeType nodeType = nodeDescription.getType();\n\n                if (FOLDER.equals(nodeType)\n                        && nodeDescription instanceof IUserLayoutFolderDescription) {\n\n                    IUserLayoutFolderDescription folderDescription =\n                            (IUserLayoutFolderDescription) nodeDescription;\n\n                    String folderType = folderDescription.getFolderType();\n\n                    if (FAVORITE_COLLECTION_TYPE.equals(folderType)) {\n\n                        results.add(nodeDescription);\n\n                        logger.trace(\n                                \"Selected node with id [{}] named [{}] with \"\n                                        + \"folderType [{}] and type [{}] as a collection of favorites.\",\n                                nodeId,\n                                nodeName,\n                                folderType,\n                                nodeType);\n\n                    } else {\n\n                        logger.trace(\n                                \"Rejected node with id [{}] named [{}] with \"\n                                        + \"folderType [{}] and type [{}] as not a collection of favorites.\",\n                                nodeId,\n                                nodeName,\n                                folderType,\n                                nodeType);\n                    }\n\n                } else {\n                    logger.trace(\n                            \"Rejected non-folder node with id [{}] named [{}] \"\n                                    + \"with parentId [{}] and type [{}] as not a collection of favorites.\",\n                            nodeId,\n                            nodeName,\n                            parentId,\n                            nodeType);\n                }\n\n                // if something goes wrong in processing a node, exclude it\n            } catch (Exception e) {\n                logger.error(\n                        \"Error determining whether to include layout node [{}]\"\n                                + \" as a collection of favorites.  Excluding.\",\n                        nodeId,\n                        e);\n            }\n        }\n\n        logger.debug(\"Extracted favorites collections [{}] from [{}]\", results, userLayout);\n\n        return results;\n    }", "code_tokens": ["public", "List", "<", "IUserLayoutNodeDescription", ">", "getFavoriteCollections", "(", "IUserLayout", "userLayout", ")", "{", "if", "(", "null", "==", "userLayout", ")", "{", "throw", "new", "IllegalArgumentException", "(", "\"Cannot get favorites collections from a null userLayout\"", ")", ";", "}", "logger", ".", "trace", "(", "\"Extracting favorites collections from layout [{}].\"", ",", "userLayout", ")", ";", "Enumeration", "<", "String", ">", "nodeIds", "=", "userLayout", ".", "getChildIds", "(", "userLayout", ".", "getRootId", "(", ")", ")", ";", "List", "<", "IUserLayoutNodeDescription", ">", "results", "=", "new", "LinkedList", "<", "IUserLayoutNodeDescription", ">", "(", ")", ";", "while", "(", "nodeIds", ".", "hasMoreElements", "(", ")", ")", "{", "String", "nodeId", "=", "nodeIds", ".", "nextElement", "(", ")", ";", "try", "{", "IUserLayoutNodeDescription", "nodeDescription", "=", "userLayout", ".", "getNodeDescription", "(", "nodeId", ")", ";", "String", "parentId", "=", "userLayout", ".", "getParentId", "(", "nodeId", ")", ";", "String", "nodeName", "=", "nodeDescription", ".", "getName", "(", ")", ";", "IUserLayoutNodeDescription", ".", "LayoutNodeType", "nodeType", "=", "nodeDescription", ".", "getType", "(", ")", ";", "if", "(", "FOLDER", ".", "equals", "(", "nodeType", ")", "&&", "nodeDescription", "instanceof", "IUserLayoutFolderDescription", ")", "{", "IUserLayoutFolderDescription", "folderDescription", "=", "(", "IUserLayoutFolderDescription", ")", "nodeDescription", ";", "String", "folderType", "=", "folderDescription", ".", "getFolderType", "(", ")", ";", "if", "(", "FAVORITE_COLLECTION_TYPE", ".", "equals", "(", "folderType", ")", ")", "{", "results", ".", "add", "(", "nodeDescription", ")", ";", "logger", ".", "trace", "(", "\"Selected node with id [{}] named [{}] with \"", "+", "\"folderType [{}] and type [{}] as a collection of favorites.\"", ",", "nodeId", ",", "nodeName", ",", "folderType", ",", "nodeType", ")", ";", "}", "else", "{", "logger", ".", "trace", "(", "\"Rejected node with id [{}] named [{}] with \"", "+", "\"folderType [{}] and type [{}] as not a collection of favorites.\"", ",", "nodeId", ",", "nodeName", ",", "folderType", ",", "nodeType", ")", ";", "}", "}", "else", "{", "logger", ".", "trace", "(", "\"Rejected non-folder node with id [{}] named [{}] \"", "+", "\"with parentId [{}] and type [{}] as not a collection of favorites.\"", ",", "nodeId", ",", "nodeName", ",", "parentId", ",", "nodeType", ")", ";", "}", "// if something goes wrong in processing a node, exclude it", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "error", "(", "\"Error determining whether to include layout node [{}]\"", "+", "\" as a collection of favorites.  Excluding.\"", ",", "nodeId", ",", "e", ")", ";", "}", "}", "logger", ".", "debug", "(", "\"Extracted favorites collections [{}] from [{}]\"", ",", "results", ",", "userLayout", ")", ";", "return", "results", ";", "}"], "docstring": "Get the favorite collections of portlets (i.e. suitable folders (\"tabs\") in the user layout.)\nSuitable layout nodes are of type folder with @type attribute favorite_collection.\n\n@param userLayout\n@return non-null List of IUserLayoutDescriptions describing the tabs", "docstring_tokens": ["Get", "the", "favorite", "collections", "of", "portlets", "(", "i", ".", "e", ".", "suitable", "folders", "(", "tabs", ")", "in", "the", "user", "layout", ".", ")", "Suitable", "layout", "nodes", "are", "of", "type", "folder", "with", "@type", "attribute", "favorite_collection", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/favorites/FavoritesUtils.java#L58-L135", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/favorites/FavoritesUtils.java", "func_name": "FavoritesUtils.getFavoritePortletLayoutNodes", "original_string": "@SuppressWarnings(\"unchecked\")\n    public List<IUserLayoutNodeDescription> getFavoritePortletLayoutNodes(IUserLayout userLayout) {\n\n        logger.trace(\"Extracting favorite portlets from layout [{}]\", userLayout);\n\n        List<IUserLayoutNodeDescription> favorites = new LinkedList<>();\n\n        Enumeration<String> childrenOfRoot = userLayout.getChildIds(userLayout.getRootId());\n\n        // loop over folders that might be the favorites folder\n        while (childrenOfRoot.hasMoreElements()) {\n            String nodeId = childrenOfRoot.nextElement();\n\n            try {\n\n                IUserLayoutNodeDescription nodeDescription = userLayout.getNodeDescription(nodeId);\n\n                if (FOLDER.equals(nodeDescription.getType())\n                        && nodeDescription instanceof IUserLayoutFolderDescription) {\n\n                    IUserLayoutFolderDescription folderDescription =\n                            (IUserLayoutFolderDescription) nodeDescription;\n\n                    if (FAVORITES_TYPE.equalsIgnoreCase(folderDescription.getFolderType())) {\n                        // TODO: assumes columns structure, but should traverse tree to collect all\n                        // portlets regardless\n                        Enumeration<String> columns = userLayout.getChildIds(nodeId);\n\n                        // loop through columns to gather beloved portlets\n                        while (columns.hasMoreElements()) {\n                            String column = columns.nextElement();\n                            Enumeration<String> portlets = userLayout.getChildIds(column);\n                            while (portlets.hasMoreElements()) {\n                                String portlet = portlets.nextElement();\n                                IUserLayoutNodeDescription portletDescription =\n                                        userLayout.getNodeDescription(portlet);\n                                favorites.add(portletDescription);\n                            }\n                        }\n                    } else {\n                        logger.trace(\"Ignoring non-favorites folder node [{}]\", nodeDescription);\n                    }\n\n                } else {\n                    logger.trace(\"Ignoring non-folder node [{}]\", nodeDescription);\n                }\n\n            } catch (Exception e) {\n                logger.error(\n                        \"Ignoring on error a node while examining for favorites: node ID is [{}]\",\n                        nodeId,\n                        e);\n            }\n        }\n\n        logger.debug(\"Extracted favorite portlets [{}] from [{}]\", favorites, userLayout);\n\n        return favorites;\n    }", "language": "java", "code": "@SuppressWarnings(\"unchecked\")\n    public List<IUserLayoutNodeDescription> getFavoritePortletLayoutNodes(IUserLayout userLayout) {\n\n        logger.trace(\"Extracting favorite portlets from layout [{}]\", userLayout);\n\n        List<IUserLayoutNodeDescription> favorites = new LinkedList<>();\n\n        Enumeration<String> childrenOfRoot = userLayout.getChildIds(userLayout.getRootId());\n\n        // loop over folders that might be the favorites folder\n        while (childrenOfRoot.hasMoreElements()) {\n            String nodeId = childrenOfRoot.nextElement();\n\n            try {\n\n                IUserLayoutNodeDescription nodeDescription = userLayout.getNodeDescription(nodeId);\n\n                if (FOLDER.equals(nodeDescription.getType())\n                        && nodeDescription instanceof IUserLayoutFolderDescription) {\n\n                    IUserLayoutFolderDescription folderDescription =\n                            (IUserLayoutFolderDescription) nodeDescription;\n\n                    if (FAVORITES_TYPE.equalsIgnoreCase(folderDescription.getFolderType())) {\n                        // TODO: assumes columns structure, but should traverse tree to collect all\n                        // portlets regardless\n                        Enumeration<String> columns = userLayout.getChildIds(nodeId);\n\n                        // loop through columns to gather beloved portlets\n                        while (columns.hasMoreElements()) {\n                            String column = columns.nextElement();\n                            Enumeration<String> portlets = userLayout.getChildIds(column);\n                            while (portlets.hasMoreElements()) {\n                                String portlet = portlets.nextElement();\n                                IUserLayoutNodeDescription portletDescription =\n                                        userLayout.getNodeDescription(portlet);\n                                favorites.add(portletDescription);\n                            }\n                        }\n                    } else {\n                        logger.trace(\"Ignoring non-favorites folder node [{}]\", nodeDescription);\n                    }\n\n                } else {\n                    logger.trace(\"Ignoring non-folder node [{}]\", nodeDescription);\n                }\n\n            } catch (Exception e) {\n                logger.error(\n                        \"Ignoring on error a node while examining for favorites: node ID is [{}]\",\n                        nodeId,\n                        e);\n            }\n        }\n\n        logger.debug(\"Extracted favorite portlets [{}] from [{}]\", favorites, userLayout);\n\n        return favorites;\n    }", "code_tokens": ["@", "SuppressWarnings", "(", "\"unchecked\"", ")", "public", "List", "<", "IUserLayoutNodeDescription", ">", "getFavoritePortletLayoutNodes", "(", "IUserLayout", "userLayout", ")", "{", "logger", ".", "trace", "(", "\"Extracting favorite portlets from layout [{}]\"", ",", "userLayout", ")", ";", "List", "<", "IUserLayoutNodeDescription", ">", "favorites", "=", "new", "LinkedList", "<>", "(", ")", ";", "Enumeration", "<", "String", ">", "childrenOfRoot", "=", "userLayout", ".", "getChildIds", "(", "userLayout", ".", "getRootId", "(", ")", ")", ";", "// loop over folders that might be the favorites folder", "while", "(", "childrenOfRoot", ".", "hasMoreElements", "(", ")", ")", "{", "String", "nodeId", "=", "childrenOfRoot", ".", "nextElement", "(", ")", ";", "try", "{", "IUserLayoutNodeDescription", "nodeDescription", "=", "userLayout", ".", "getNodeDescription", "(", "nodeId", ")", ";", "if", "(", "FOLDER", ".", "equals", "(", "nodeDescription", ".", "getType", "(", ")", ")", "&&", "nodeDescription", "instanceof", "IUserLayoutFolderDescription", ")", "{", "IUserLayoutFolderDescription", "folderDescription", "=", "(", "IUserLayoutFolderDescription", ")", "nodeDescription", ";", "if", "(", "FAVORITES_TYPE", ".", "equalsIgnoreCase", "(", "folderDescription", ".", "getFolderType", "(", ")", ")", ")", "{", "// TODO: assumes columns structure, but should traverse tree to collect all", "// portlets regardless", "Enumeration", "<", "String", ">", "columns", "=", "userLayout", ".", "getChildIds", "(", "nodeId", ")", ";", "// loop through columns to gather beloved portlets", "while", "(", "columns", ".", "hasMoreElements", "(", ")", ")", "{", "String", "column", "=", "columns", ".", "nextElement", "(", ")", ";", "Enumeration", "<", "String", ">", "portlets", "=", "userLayout", ".", "getChildIds", "(", "column", ")", ";", "while", "(", "portlets", ".", "hasMoreElements", "(", ")", ")", "{", "String", "portlet", "=", "portlets", ".", "nextElement", "(", ")", ";", "IUserLayoutNodeDescription", "portletDescription", "=", "userLayout", ".", "getNodeDescription", "(", "portlet", ")", ";", "favorites", ".", "add", "(", "portletDescription", ")", ";", "}", "}", "}", "else", "{", "logger", ".", "trace", "(", "\"Ignoring non-favorites folder node [{}]\"", ",", "nodeDescription", ")", ";", "}", "}", "else", "{", "logger", ".", "trace", "(", "\"Ignoring non-folder node [{}]\"", ",", "nodeDescription", ")", ";", "}", "}", "catch", "(", "Exception", "e", ")", "{", "logger", ".", "error", "(", "\"Ignoring on error a node while examining for favorites: node ID is [{}]\"", ",", "nodeId", ",", "e", ")", ";", "}", "}", "logger", ".", "debug", "(", "\"Extracted favorite portlets [{}] from [{}]\"", ",", "favorites", ",", "userLayout", ")", ";", "return", "favorites", ";", "}"], "docstring": "Get the portlets that are in the folder(s) of type \"favorites\".\n\n@param userLayout\n@return", "docstring_tokens": ["Get", "the", "portlets", "that", "are", "in", "the", "folder", "(", "s", ")", "of", "type", "favorites", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/favorites/FavoritesUtils.java#L178-L236", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/favorites/FavoritesUtils.java", "func_name": "FavoritesUtils.hasAnyFavorites", "original_string": "public boolean hasAnyFavorites(IUserLayout layout) {\n        Validate.notNull(layout, \"Cannot determine whether a null layout contains favorites.\");\n\n        // (premature) performance optimization: short circuit returns true if nonzero favorite\n        // portlets\n        return (!getFavoritePortletLayoutNodes(layout).isEmpty()\n                || !getFavoriteCollections(layout).isEmpty());\n    }", "language": "java", "code": "public boolean hasAnyFavorites(IUserLayout layout) {\n        Validate.notNull(layout, \"Cannot determine whether a null layout contains favorites.\");\n\n        // (premature) performance optimization: short circuit returns true if nonzero favorite\n        // portlets\n        return (!getFavoritePortletLayoutNodes(layout).isEmpty()\n                || !getFavoriteCollections(layout).isEmpty());\n    }", "code_tokens": ["public", "boolean", "hasAnyFavorites", "(", "IUserLayout", "layout", ")", "{", "Validate", ".", "notNull", "(", "layout", ",", "\"Cannot determine whether a null layout contains favorites.\"", ")", ";", "// (premature) performance optimization: short circuit returns true if nonzero favorite", "// portlets", "return", "(", "!", "getFavoritePortletLayoutNodes", "(", "layout", ")", ".", "isEmpty", "(", ")", "||", "!", "getFavoriteCollections", "(", "layout", ")", ".", "isEmpty", "(", ")", ")", ";", "}"], "docstring": "True if the layout contains any favorited collections or favorited individual portlets, false\notherwise.\n\n@param layout non-null user layout that might contain favorite portlets and/or collections\n@return true if the layout contains at least one favorited portlet or collection, false\notherwise\n@throws IllegalArgumentException if layout is null", "docstring_tokens": ["True", "if", "the", "layout", "contains", "any", "favorited", "collections", "or", "favorited", "individual", "portlets", "false", "otherwise", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/favorites/FavoritesUtils.java#L280-L287", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/LocaleTransformerConfigurationSource.java", "func_name": "LocaleTransformerConfigurationSource.getParameters", "original_string": "@Override\n    public Map<String, Object> getParameters(\n            HttpServletRequest request, HttpServletResponse response) {\n        final LocaleManager localeManager = this.getLocaleManager(request);\n\n        final List<Locale> locales = localeManager.getLocales();\n        if (locales != null && locales.size() > 0 && locales.get(0) != null) {\n            final String locale = locales.get(0).toString();\n            final String xslLocale = locale.replace('_', '-');\n            this.logger.debug(\"Setting USER_LANG to {}\", xslLocale);\n            return Collections.singletonMap(\"USER_LANG\", (Object) xslLocale);\n        }\n\n        return null;\n    }", "language": "java", "code": "@Override\n    public Map<String, Object> getParameters(\n            HttpServletRequest request, HttpServletResponse response) {\n        final LocaleManager localeManager = this.getLocaleManager(request);\n\n        final List<Locale> locales = localeManager.getLocales();\n        if (locales != null && locales.size() > 0 && locales.get(0) != null) {\n            final String locale = locales.get(0).toString();\n            final String xslLocale = locale.replace('_', '-');\n            this.logger.debug(\"Setting USER_LANG to {}\", xslLocale);\n            return Collections.singletonMap(\"USER_LANG\", (Object) xslLocale);\n        }\n\n        return null;\n    }", "code_tokens": ["@", "Override", "public", "Map", "<", "String", ",", "Object", ">", "getParameters", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "final", "LocaleManager", "localeManager", "=", "this", ".", "getLocaleManager", "(", "request", ")", ";", "final", "List", "<", "Locale", ">", "locales", "=", "localeManager", ".", "getLocales", "(", ")", ";", "if", "(", "locales", "!=", "null", "&&", "locales", ".", "size", "(", ")", ">", "0", "&&", "locales", ".", "get", "(", "0", ")", "!=", "null", ")", "{", "final", "String", "locale", "=", "locales", ".", "get", "(", "0", ")", ".", "toString", "(", ")", ";", "final", "String", "xslLocale", "=", "locale", ".", "replace", "(", "'", "'", ",", "'", "'", ")", ";", "this", ".", "logger", ".", "debug", "(", "\"Setting USER_LANG to {}\"", ",", "xslLocale", ")", ";", "return", "Collections", ".", "singletonMap", "(", "\"USER_LANG\"", ",", "(", "Object", ")", "xslLocale", ")", ";", "}", "return", "null", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.xslt.TransformerConfigurationSource#getParameters(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/LocaleTransformerConfigurationSource.java#L50-L64", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/LocaleTransformerConfigurationSource.java", "func_name": "LocaleTransformerConfigurationSource.getCacheKey", "original_string": "@Override\n    public CacheKey getCacheKey(HttpServletRequest request, HttpServletResponse response) {\n        final LocaleManager localeManager = this.getLocaleManager(request);\n\n        final List<Locale> locales = localeManager.getLocales();\n        if (locales != null && locales.size() > 0 && locales.get(0) != null) {\n            final String locale = locales.get(0).toString();\n            final String xslLocale = locale.replace('_', '-');\n            return CacheKey.build(this.getClass().getName(), xslLocale);\n        }\n\n        return null;\n    }", "language": "java", "code": "@Override\n    public CacheKey getCacheKey(HttpServletRequest request, HttpServletResponse response) {\n        final LocaleManager localeManager = this.getLocaleManager(request);\n\n        final List<Locale> locales = localeManager.getLocales();\n        if (locales != null && locales.size() > 0 && locales.get(0) != null) {\n            final String locale = locales.get(0).toString();\n            final String xslLocale = locale.replace('_', '-');\n            return CacheKey.build(this.getClass().getName(), xslLocale);\n        }\n\n        return null;\n    }", "code_tokens": ["@", "Override", "public", "CacheKey", "getCacheKey", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "final", "LocaleManager", "localeManager", "=", "this", ".", "getLocaleManager", "(", "request", ")", ";", "final", "List", "<", "Locale", ">", "locales", "=", "localeManager", ".", "getLocales", "(", ")", ";", "if", "(", "locales", "!=", "null", "&&", "locales", ".", "size", "(", ")", ">", "0", "&&", "locales", ".", "get", "(", "0", ")", "!=", "null", ")", "{", "final", "String", "locale", "=", "locales", ".", "get", "(", "0", ")", ".", "toString", "(", ")", ";", "final", "String", "xslLocale", "=", "locale", ".", "replace", "(", "'", "'", ",", "'", "'", ")", ";", "return", "CacheKey", ".", "build", "(", "this", ".", "getClass", "(", ")", ".", "getName", "(", ")", ",", "xslLocale", ")", ";", "}", "return", "null", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.xslt.TransformerConfigurationSource#getCacheKey(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/LocaleTransformerConfigurationSource.java#L69-L81", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/LPAChangeAttribute.java", "func_name": "LPAChangeAttribute.perform", "original_string": "@Override\n    public void perform() throws PortalException {\n        // push the change into the PLF\n        if (nodeId.startsWith(Constants.FRAGMENT_ID_USER_PREFIX)) {\n            // we are dealing with an incorporated node, so get a plf ghost\n            // node, set its attribute, then add a directive indicating the\n            // attribute that should be pushed into the ilf during merge\n            Element plfNode =\n                    HandlerUtils.getPLFNode(\n                            ilfNode, person, true, // create node if not found\n                            false); // don't create children\n            plfNode.setAttribute(name, value);\n            /*\n             * add directive to hold override value. This is not necessary for\n             * folder names since they are overridden at render time with their\n             * locale specific version and persisted via a different mechanism.\n             */\n            EditManager.addEditDirective(plfNode, name, person);\n        } else {\n            // node owned by user so change attribute in child directly\n            Document plf = RDBMDistributedLayoutStore.getPLF(person);\n            Element plfNode = plf.getElementById(nodeId);\n            if (plfNode != null) // should always be non-null\n            {\n                plfNode.setAttribute(name, value);\n            }\n        }\n        /*\n         * push the change into the ILF if not the name attribute. For names\n         * the rendering will inject the localized name via a special processor.\n         * So it doesn't matter what is in the ILF's folder name attribute.\n         */\n        if (!name.equals(Constants.ATT_NAME))\n        // should always be non-null\n        {\n            ilfNode.setAttribute(name, value);\n        }\n    }", "language": "java", "code": "@Override\n    public void perform() throws PortalException {\n        // push the change into the PLF\n        if (nodeId.startsWith(Constants.FRAGMENT_ID_USER_PREFIX)) {\n            // we are dealing with an incorporated node, so get a plf ghost\n            // node, set its attribute, then add a directive indicating the\n            // attribute that should be pushed into the ilf during merge\n            Element plfNode =\n                    HandlerUtils.getPLFNode(\n                            ilfNode, person, true, // create node if not found\n                            false); // don't create children\n            plfNode.setAttribute(name, value);\n            /*\n             * add directive to hold override value. This is not necessary for\n             * folder names since they are overridden at render time with their\n             * locale specific version and persisted via a different mechanism.\n             */\n            EditManager.addEditDirective(plfNode, name, person);\n        } else {\n            // node owned by user so change attribute in child directly\n            Document plf = RDBMDistributedLayoutStore.getPLF(person);\n            Element plfNode = plf.getElementById(nodeId);\n            if (plfNode != null) // should always be non-null\n            {\n                plfNode.setAttribute(name, value);\n            }\n        }\n        /*\n         * push the change into the ILF if not the name attribute. For names\n         * the rendering will inject the localized name via a special processor.\n         * So it doesn't matter what is in the ILF's folder name attribute.\n         */\n        if (!name.equals(Constants.ATT_NAME))\n        // should always be non-null\n        {\n            ilfNode.setAttribute(name, value);\n        }\n    }", "code_tokens": ["@", "Override", "public", "void", "perform", "(", ")", "throws", "PortalException", "{", "// push the change into the PLF", "if", "(", "nodeId", ".", "startsWith", "(", "Constants", ".", "FRAGMENT_ID_USER_PREFIX", ")", ")", "{", "// we are dealing with an incorporated node, so get a plf ghost", "// node, set its attribute, then add a directive indicating the", "// attribute that should be pushed into the ilf during merge", "Element", "plfNode", "=", "HandlerUtils", ".", "getPLFNode", "(", "ilfNode", ",", "person", ",", "true", ",", "// create node if not found", "false", ")", ";", "// don't create children", "plfNode", ".", "setAttribute", "(", "name", ",", "value", ")", ";", "/*\n             * add directive to hold override value. This is not necessary for\n             * folder names since they are overridden at render time with their\n             * locale specific version and persisted via a different mechanism.\n             */", "EditManager", ".", "addEditDirective", "(", "plfNode", ",", "name", ",", "person", ")", ";", "}", "else", "{", "// node owned by user so change attribute in child directly", "Document", "plf", "=", "RDBMDistributedLayoutStore", ".", "getPLF", "(", "person", ")", ";", "Element", "plfNode", "=", "plf", ".", "getElementById", "(", "nodeId", ")", ";", "if", "(", "plfNode", "!=", "null", ")", "// should always be non-null", "{", "plfNode", ".", "setAttribute", "(", "name", ",", "value", ")", ";", "}", "}", "/*\n         * push the change into the ILF if not the name attribute. For names\n         * the rendering will inject the localized name via a special processor.\n         * So it doesn't matter what is in the ILF's folder name attribute.\n         */", "if", "(", "!", "name", ".", "equals", "(", "Constants", ".", "ATT_NAME", ")", ")", "// should always be non-null", "{", "ilfNode", ".", "setAttribute", "(", "name", ",", "value", ")", ";", "}", "}"], "docstring": "Apply the attribute change.", "docstring_tokens": ["Apply", "the", "attribute", "change", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/LPAChangeAttribute.java#L39-L76", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/session/PortletSessionExpirationManager.java", "func_name": "PortletSessionExpirationManager.onEnd", "original_string": "@SuppressWarnings(\"unchecked\")\n    @Override\n    public void onEnd(PortletInvocationEvent event) {\n        final PortletRequest portletRequest = event.getPortletRequest();\n        final PortletSession portletSession = portletRequest.getPortletSession(false);\n        if (portletSession == null) {\n            return;\n        }\n\n        final HttpServletRequest portalRequest =\n                this.portalRequestUtils.getPortletHttpRequest(portletRequest);\n        final HttpSession portalSession = portalRequest.getSession();\n\n        if (portalSession != null) {\n            NonSerializableMapHolder<String, PortletSession> portletSessions;\n            synchronized (WebUtils.getSessionMutex(portalSession)) {\n                portletSessions =\n                        (NonSerializableMapHolder<String, PortletSession>)\n                                portalSession.getAttribute(PORTLET_SESSIONS_MAP);\n                if (portletSessions == null || !portletSessions.isValid()) {\n                    portletSessions =\n                            new NonSerializableMapHolder(\n                                    new ConcurrentHashMap<String, PortletSession>());\n                    portalSession.setAttribute(PORTLET_SESSIONS_MAP, portletSessions);\n                }\n            }\n\n            final String contextPath = portletRequest.getContextPath();\n            portletSessions.put(contextPath, portletSession);\n        }\n    }", "language": "java", "code": "@SuppressWarnings(\"unchecked\")\n    @Override\n    public void onEnd(PortletInvocationEvent event) {\n        final PortletRequest portletRequest = event.getPortletRequest();\n        final PortletSession portletSession = portletRequest.getPortletSession(false);\n        if (portletSession == null) {\n            return;\n        }\n\n        final HttpServletRequest portalRequest =\n                this.portalRequestUtils.getPortletHttpRequest(portletRequest);\n        final HttpSession portalSession = portalRequest.getSession();\n\n        if (portalSession != null) {\n            NonSerializableMapHolder<String, PortletSession> portletSessions;\n            synchronized (WebUtils.getSessionMutex(portalSession)) {\n                portletSessions =\n                        (NonSerializableMapHolder<String, PortletSession>)\n                                portalSession.getAttribute(PORTLET_SESSIONS_MAP);\n                if (portletSessions == null || !portletSessions.isValid()) {\n                    portletSessions =\n                            new NonSerializableMapHolder(\n                                    new ConcurrentHashMap<String, PortletSession>());\n                    portalSession.setAttribute(PORTLET_SESSIONS_MAP, portletSessions);\n                }\n            }\n\n            final String contextPath = portletRequest.getContextPath();\n            portletSessions.put(contextPath, portletSession);\n        }\n    }", "code_tokens": ["@", "SuppressWarnings", "(", "\"unchecked\"", ")", "@", "Override", "public", "void", "onEnd", "(", "PortletInvocationEvent", "event", ")", "{", "final", "PortletRequest", "portletRequest", "=", "event", ".", "getPortletRequest", "(", ")", ";", "final", "PortletSession", "portletSession", "=", "portletRequest", ".", "getPortletSession", "(", "false", ")", ";", "if", "(", "portletSession", "==", "null", ")", "{", "return", ";", "}", "final", "HttpServletRequest", "portalRequest", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "portletRequest", ")", ";", "final", "HttpSession", "portalSession", "=", "portalRequest", ".", "getSession", "(", ")", ";", "if", "(", "portalSession", "!=", "null", ")", "{", "NonSerializableMapHolder", "<", "String", ",", "PortletSession", ">", "portletSessions", ";", "synchronized", "(", "WebUtils", ".", "getSessionMutex", "(", "portalSession", ")", ")", "{", "portletSessions", "=", "(", "NonSerializableMapHolder", "<", "String", ",", "PortletSession", ">", ")", "portalSession", ".", "getAttribute", "(", "PORTLET_SESSIONS_MAP", ")", ";", "if", "(", "portletSessions", "==", "null", "||", "!", "portletSessions", ".", "isValid", "(", ")", ")", "{", "portletSessions", "=", "new", "NonSerializableMapHolder", "(", "new", "ConcurrentHashMap", "<", "String", ",", "PortletSession", ">", "(", ")", ")", ";", "portalSession", ".", "setAttribute", "(", "PORTLET_SESSIONS_MAP", ",", "portletSessions", ")", ";", "}", "}", "final", "String", "contextPath", "=", "portletRequest", ".", "getContextPath", "(", ")", ";", "portletSessions", ".", "put", "(", "contextPath", ",", "portletSession", ")", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.apache.pluto.spi.optional.PortletInvocationListener#onEnd(org.apache.pluto.spi.optional.PortletInvocationEvent)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/session/PortletSessionExpirationManager.java#L71-L101", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/session/PortletSessionExpirationManager.java", "func_name": "PortletSessionExpirationManager.onApplicationEvent", "original_string": "@Override\n    public void onApplicationEvent(HttpSessionDestroyedEvent event) {\n        final HttpSession session = ((HttpSessionDestroyedEvent) event).getSession();\n        @SuppressWarnings(\"unchecked\")\n        final Map<String, PortletSession> portletSessions =\n                (Map<String, PortletSession>) session.getAttribute(PORTLET_SESSIONS_MAP);\n        if (portletSessions == null) {\n            return;\n        }\n\n        /*\n         * Since (at least) Tomcat 7.0.47, this method has the potential to\n         * generate a StackOverflowError because PortletSession.invalidate()\n         * will trigger another HttpSessionDestroyedEvent, which means this\n         * method will be called again.  I don't know if this behavior is a bug\n         * in Tomcat or Spring, if this behavior is entirely proper, or if the\n         * reality somewhere in between.\n         *\n         * For the present, let's put a token in the HttpSession (which is\n         * available from the event object) as soon as we start invalidating it.\n         * We'll then ignore sessions that already have this token.\n         */\n        if (session.getAttribute(ALREADY_INVALIDATING_SESSION_ATTRIBUTE) != null) {\n            // We're already invalidating;  don't do it again\n            return;\n        }\n        session.setAttribute(ALREADY_INVALIDATING_SESSION_ATTRIBUTE, Boolean.TRUE);\n\n        for (final Map.Entry<String, PortletSession> portletSessionEntry :\n                portletSessions.entrySet()) {\n            final String contextPath = portletSessionEntry.getKey();\n            final PortletSession portletSession = portletSessionEntry.getValue();\n            try {\n                portletSession.invalidate();\n            } catch (IllegalStateException e) {\n                this.logger.info(\n                        \"PortletSession with id '\"\n                                + portletSession.getId()\n                                + \"' for context '\"\n                                + contextPath\n                                + \"' has already been invalidated.\");\n            } catch (Exception e) {\n                this.logger.warn(\n                        \"Failed to invalidate PortletSession with id '\"\n                                + portletSession.getId()\n                                + \"' for context '\"\n                                + contextPath\n                                + \"'\",\n                        e);\n            }\n        }\n    }", "language": "java", "code": "@Override\n    public void onApplicationEvent(HttpSessionDestroyedEvent event) {\n        final HttpSession session = ((HttpSessionDestroyedEvent) event).getSession();\n        @SuppressWarnings(\"unchecked\")\n        final Map<String, PortletSession> portletSessions =\n                (Map<String, PortletSession>) session.getAttribute(PORTLET_SESSIONS_MAP);\n        if (portletSessions == null) {\n            return;\n        }\n\n        /*\n         * Since (at least) Tomcat 7.0.47, this method has the potential to\n         * generate a StackOverflowError because PortletSession.invalidate()\n         * will trigger another HttpSessionDestroyedEvent, which means this\n         * method will be called again.  I don't know if this behavior is a bug\n         * in Tomcat or Spring, if this behavior is entirely proper, or if the\n         * reality somewhere in between.\n         *\n         * For the present, let's put a token in the HttpSession (which is\n         * available from the event object) as soon as we start invalidating it.\n         * We'll then ignore sessions that already have this token.\n         */\n        if (session.getAttribute(ALREADY_INVALIDATING_SESSION_ATTRIBUTE) != null) {\n            // We're already invalidating;  don't do it again\n            return;\n        }\n        session.setAttribute(ALREADY_INVALIDATING_SESSION_ATTRIBUTE, Boolean.TRUE);\n\n        for (final Map.Entry<String, PortletSession> portletSessionEntry :\n                portletSessions.entrySet()) {\n            final String contextPath = portletSessionEntry.getKey();\n            final PortletSession portletSession = portletSessionEntry.getValue();\n            try {\n                portletSession.invalidate();\n            } catch (IllegalStateException e) {\n                this.logger.info(\n                        \"PortletSession with id '\"\n                                + portletSession.getId()\n                                + \"' for context '\"\n                                + contextPath\n                                + \"' has already been invalidated.\");\n            } catch (Exception e) {\n                this.logger.warn(\n                        \"Failed to invalidate PortletSession with id '\"\n                                + portletSession.getId()\n                                + \"' for context '\"\n                                + contextPath\n                                + \"'\",\n                        e);\n            }\n        }\n    }", "code_tokens": ["@", "Override", "public", "void", "onApplicationEvent", "(", "HttpSessionDestroyedEvent", "event", ")", "{", "final", "HttpSession", "session", "=", "(", "(", "HttpSessionDestroyedEvent", ")", "event", ")", ".", "getSession", "(", ")", ";", "@", "SuppressWarnings", "(", "\"unchecked\"", ")", "final", "Map", "<", "String", ",", "PortletSession", ">", "portletSessions", "=", "(", "Map", "<", "String", ",", "PortletSession", ">", ")", "session", ".", "getAttribute", "(", "PORTLET_SESSIONS_MAP", ")", ";", "if", "(", "portletSessions", "==", "null", ")", "{", "return", ";", "}", "/*\n         * Since (at least) Tomcat 7.0.47, this method has the potential to\n         * generate a StackOverflowError because PortletSession.invalidate()\n         * will trigger another HttpSessionDestroyedEvent, which means this\n         * method will be called again.  I don't know if this behavior is a bug\n         * in Tomcat or Spring, if this behavior is entirely proper, or if the\n         * reality somewhere in between.\n         *\n         * For the present, let's put a token in the HttpSession (which is\n         * available from the event object) as soon as we start invalidating it.\n         * We'll then ignore sessions that already have this token.\n         */", "if", "(", "session", ".", "getAttribute", "(", "ALREADY_INVALIDATING_SESSION_ATTRIBUTE", ")", "!=", "null", ")", "{", "// We're already invalidating;  don't do it again", "return", ";", "}", "session", ".", "setAttribute", "(", "ALREADY_INVALIDATING_SESSION_ATTRIBUTE", ",", "Boolean", ".", "TRUE", ")", ";", "for", "(", "final", "Map", ".", "Entry", "<", "String", ",", "PortletSession", ">", "portletSessionEntry", ":", "portletSessions", ".", "entrySet", "(", ")", ")", "{", "final", "String", "contextPath", "=", "portletSessionEntry", ".", "getKey", "(", ")", ";", "final", "PortletSession", "portletSession", "=", "portletSessionEntry", ".", "getValue", "(", ")", ";", "try", "{", "portletSession", ".", "invalidate", "(", ")", ";", "}", "catch", "(", "IllegalStateException", "e", ")", "{", "this", ".", "logger", ".", "info", "(", "\"PortletSession with id '\"", "+", "portletSession", ".", "getId", "(", ")", "+", "\"' for context '\"", "+", "contextPath", "+", "\"' has already been invalidated.\"", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"Failed to invalidate PortletSession with id '\"", "+", "portletSession", ".", "getId", "(", ")", "+", "\"' for context '\"", "+", "contextPath", "+", "\"'\"", ",", "e", ")", ";", "}", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.springframework.context.ApplicationListener#onApplicationEvent(org.springframework.context.ApplicationEvent)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/session/PortletSessionExpirationManager.java#L106-L157", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java", "func_name": "PortletDefinitionRegistryImpl.getPortletDefinition", "original_string": "@Override\n    public IPortletDefinition getPortletDefinition(IPortletDefinitionId portletDefinitionId) {\n        Validate.notNull(portletDefinitionId, \"portletDefinitionId can not be null\");\n\n        return this.portletDefinitionDao.getPortletDefinition(portletDefinitionId);\n    }", "language": "java", "code": "@Override\n    public IPortletDefinition getPortletDefinition(IPortletDefinitionId portletDefinitionId) {\n        Validate.notNull(portletDefinitionId, \"portletDefinitionId can not be null\");\n\n        return this.portletDefinitionDao.getPortletDefinition(portletDefinitionId);\n    }", "code_tokens": ["@", "Override", "public", "IPortletDefinition", "getPortletDefinition", "(", "IPortletDefinitionId", "portletDefinitionId", ")", "{", "Validate", ".", "notNull", "(", "portletDefinitionId", ",", "\"portletDefinitionId can not be null\"", ")", ";", "return", "this", ".", "portletDefinitionDao", ".", "getPortletDefinition", "(", "portletDefinitionId", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.portlet.registry.IPortletDefinitionRegistry#getPortletDefinition(org.apereo.portal.portlet.om.IPortletDefinitionId)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java#L80-L85", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java", "func_name": "PortletDefinitionRegistryImpl.savePortletDefinition", "original_string": "@Override\n    public IPortletDefinition savePortletDefinition(IPortletDefinition portletDefinition) {\n        Validate.notNull(portletDefinition, \"portletDefinition can not be null\");\n        return this.portletDefinitionDao.savePortletDefinition(portletDefinition);\n    }", "language": "java", "code": "@Override\n    public IPortletDefinition savePortletDefinition(IPortletDefinition portletDefinition) {\n        Validate.notNull(portletDefinition, \"portletDefinition can not be null\");\n        return this.portletDefinitionDao.savePortletDefinition(portletDefinition);\n    }", "code_tokens": ["@", "Override", "public", "IPortletDefinition", "savePortletDefinition", "(", "IPortletDefinition", "portletDefinition", ")", "{", "Validate", ".", "notNull", "(", "portletDefinition", ",", "\"portletDefinition can not be null\"", ")", ";", "return", "this", ".", "portletDefinitionDao", ".", "savePortletDefinition", "(", "portletDefinition", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.portlet.registry.IPortletDefinitionRegistry#savePortletDefinition(org.apereo.portal.portlet.om.IPortletDefinition)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java#L122-L126", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java", "func_name": "PortletDefinitionRegistryImpl.getParentPortletApplicationDescriptor", "original_string": "@Override\n    public PortletApplicationDefinition getParentPortletApplicationDescriptor(\n            IPortletDefinitionId portletDefinitionId) {\n        final IPortletDefinition portletDefinition = this.getPortletDefinition(portletDefinitionId);\n        if (portletDefinition == null) {\n            return null;\n        }\n\n        final Tuple<String, String> portletDescriptorKeys =\n                this.getPortletDescriptorKeys(portletDefinition);\n\n        final PortletRegistryService portletRegistryService =\n                this.portalDriverContainerServices.getPortletRegistryService();\n        try {\n            return portletRegistryService.getPortletApplication(portletDescriptorKeys.first);\n        } catch (PortletContainerException e) {\n            this.logger.warn(\n                    \"No portlet application descriptor could be found likely not deployed. For portlet definition: \"\n                            + portletDefinition,\n                    e);\n            return null;\n        }\n    }", "language": "java", "code": "@Override\n    public PortletApplicationDefinition getParentPortletApplicationDescriptor(\n            IPortletDefinitionId portletDefinitionId) {\n        final IPortletDefinition portletDefinition = this.getPortletDefinition(portletDefinitionId);\n        if (portletDefinition == null) {\n            return null;\n        }\n\n        final Tuple<String, String> portletDescriptorKeys =\n                this.getPortletDescriptorKeys(portletDefinition);\n\n        final PortletRegistryService portletRegistryService =\n                this.portalDriverContainerServices.getPortletRegistryService();\n        try {\n            return portletRegistryService.getPortletApplication(portletDescriptorKeys.first);\n        } catch (PortletContainerException e) {\n            this.logger.warn(\n                    \"No portlet application descriptor could be found likely not deployed. For portlet definition: \"\n                            + portletDefinition,\n                    e);\n            return null;\n        }\n    }", "code_tokens": ["@", "Override", "public", "PortletApplicationDefinition", "getParentPortletApplicationDescriptor", "(", "IPortletDefinitionId", "portletDefinitionId", ")", "{", "final", "IPortletDefinition", "portletDefinition", "=", "this", ".", "getPortletDefinition", "(", "portletDefinitionId", ")", ";", "if", "(", "portletDefinition", "==", "null", ")", "{", "return", "null", ";", "}", "final", "Tuple", "<", "String", ",", "String", ">", "portletDescriptorKeys", "=", "this", ".", "getPortletDescriptorKeys", "(", "portletDefinition", ")", ";", "final", "PortletRegistryService", "portletRegistryService", "=", "this", ".", "portalDriverContainerServices", ".", "getPortletRegistryService", "(", ")", ";", "try", "{", "return", "portletRegistryService", ".", "getPortletApplication", "(", "portletDescriptorKeys", ".", "first", ")", ";", "}", "catch", "(", "PortletContainerException", "e", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"No portlet application descriptor could be found likely not deployed. For portlet definition: \"", "+", "portletDefinition", ",", "e", ")", ";", "return", "null", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.portlet.registry.IPortletDefinitionRegistry#getParentPortletApplicationDescriptor(org.apereo.portal.portlet.om.IPortletDefinitionId)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java#L131-L153", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java", "func_name": "PortletDefinitionRegistryImpl.getParentPortletDescriptor", "original_string": "@Override\n    public PortletDefinition getParentPortletDescriptor(IPortletDefinitionId portletDefinitionId) {\n        final IPortletDefinition portletDefinition = this.getPortletDefinition(portletDefinitionId);\n        if (portletDefinition == null) {\n            return null;\n        }\n\n        final Tuple<String, String> portletDescriptorKeys =\n                this.getPortletDescriptorKeys(portletDefinition);\n\n        final PortletRegistryService portletRegistryService =\n                this.portalDriverContainerServices.getPortletRegistryService();\n        try {\n            return portletRegistryService.getPortlet(\n                    portletDescriptorKeys.first, portletDescriptorKeys.second);\n        } catch (PortletContainerException e) {\n            if (this.logger.isDebugEnabled()) {\n                this.logger.warn(\n                        \"No portlet descriptor could be found for the portlet definition, null will be returned: \"\n                                + portletDefinition,\n                        e);\n            } else {\n                this.logger.warn(\n                        \"No portlet descriptor could be found for the portlet definition, null will be returned: \"\n                                + portletDefinition\n                                + \" Enable DEBUG for stack trace.\");\n            }\n            return null;\n        }\n    }", "language": "java", "code": "@Override\n    public PortletDefinition getParentPortletDescriptor(IPortletDefinitionId portletDefinitionId) {\n        final IPortletDefinition portletDefinition = this.getPortletDefinition(portletDefinitionId);\n        if (portletDefinition == null) {\n            return null;\n        }\n\n        final Tuple<String, String> portletDescriptorKeys =\n                this.getPortletDescriptorKeys(portletDefinition);\n\n        final PortletRegistryService portletRegistryService =\n                this.portalDriverContainerServices.getPortletRegistryService();\n        try {\n            return portletRegistryService.getPortlet(\n                    portletDescriptorKeys.first, portletDescriptorKeys.second);\n        } catch (PortletContainerException e) {\n            if (this.logger.isDebugEnabled()) {\n                this.logger.warn(\n                        \"No portlet descriptor could be found for the portlet definition, null will be returned: \"\n                                + portletDefinition,\n                        e);\n            } else {\n                this.logger.warn(\n                        \"No portlet descriptor could be found for the portlet definition, null will be returned: \"\n                                + portletDefinition\n                                + \" Enable DEBUG for stack trace.\");\n            }\n            return null;\n        }\n    }", "code_tokens": ["@", "Override", "public", "PortletDefinition", "getParentPortletDescriptor", "(", "IPortletDefinitionId", "portletDefinitionId", ")", "{", "final", "IPortletDefinition", "portletDefinition", "=", "this", ".", "getPortletDefinition", "(", "portletDefinitionId", ")", ";", "if", "(", "portletDefinition", "==", "null", ")", "{", "return", "null", ";", "}", "final", "Tuple", "<", "String", ",", "String", ">", "portletDescriptorKeys", "=", "this", ".", "getPortletDescriptorKeys", "(", "portletDefinition", ")", ";", "final", "PortletRegistryService", "portletRegistryService", "=", "this", ".", "portalDriverContainerServices", ".", "getPortletRegistryService", "(", ")", ";", "try", "{", "return", "portletRegistryService", ".", "getPortlet", "(", "portletDescriptorKeys", ".", "first", ",", "portletDescriptorKeys", ".", "second", ")", ";", "}", "catch", "(", "PortletContainerException", "e", ")", "{", "if", "(", "this", ".", "logger", ".", "isDebugEnabled", "(", ")", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"No portlet descriptor could be found for the portlet definition, null will be returned: \"", "+", "portletDefinition", ",", "e", ")", ";", "}", "else", "{", "this", ".", "logger", ".", "warn", "(", "\"No portlet descriptor could be found for the portlet definition, null will be returned: \"", "+", "portletDefinition", "+", "\" Enable DEBUG for stack trace.\"", ")", ";", "}", "return", "null", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.portlet.registry.IPortletDefinitionRegistry#getParentPortletDescriptor(org.apereo.portal.portlet.om.IPortletDefinitionId)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java#L158-L187", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java", "func_name": "PortletDefinitionRegistryImpl.getPortletDescriptorKeys", "original_string": "@Override\n    public Tuple<String, String> getPortletDescriptorKeys(IPortletDefinition portletDefinition) {\n\n        final String portletApplicationId;\n        if (portletDefinition.getPortletDescriptorKey().isFrameworkPortlet()) {\n            portletApplicationId = this.servletContext.getContextPath();\n        } else {\n            portletApplicationId = portletDefinition.getPortletDescriptorKey().getWebAppName();\n        }\n\n        final String portletName = portletDefinition.getPortletDescriptorKey().getPortletName();\n\n        return new Tuple<String, String>(portletApplicationId, portletName);\n    }", "language": "java", "code": "@Override\n    public Tuple<String, String> getPortletDescriptorKeys(IPortletDefinition portletDefinition) {\n\n        final String portletApplicationId;\n        if (portletDefinition.getPortletDescriptorKey().isFrameworkPortlet()) {\n            portletApplicationId = this.servletContext.getContextPath();\n        } else {\n            portletApplicationId = portletDefinition.getPortletDescriptorKey().getWebAppName();\n        }\n\n        final String portletName = portletDefinition.getPortletDescriptorKey().getPortletName();\n\n        return new Tuple<String, String>(portletApplicationId, portletName);\n    }", "code_tokens": ["@", "Override", "public", "Tuple", "<", "String", ",", "String", ">", "getPortletDescriptorKeys", "(", "IPortletDefinition", "portletDefinition", ")", "{", "final", "String", "portletApplicationId", ";", "if", "(", "portletDefinition", ".", "getPortletDescriptorKey", "(", ")", ".", "isFrameworkPortlet", "(", ")", ")", "{", "portletApplicationId", "=", "this", ".", "servletContext", ".", "getContextPath", "(", ")", ";", "}", "else", "{", "portletApplicationId", "=", "portletDefinition", ".", "getPortletDescriptorKey", "(", ")", ".", "getWebAppName", "(", ")", ";", "}", "final", "String", "portletName", "=", "portletDefinition", ".", "getPortletDescriptorKey", "(", ")", ".", "getPortletName", "(", ")", ";", "return", "new", "Tuple", "<", "String", ",", "String", ">", "(", "portletApplicationId", ",", "portletName", ")", ";", "}"], "docstring": "Get the portletApplicationId and portletName for the specified channel definition id. The\nportletApplicationId will be {@link Tuple#first} and the portletName will be {@link\nTuple#second}", "docstring_tokens": ["Get", "the", "portletApplicationId", "and", "portletName", "for", "the", "specified", "channel", "definition", "id", ".", "The", "portletApplicationId", "will", "be", "{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/registry/PortletDefinitionRegistryImpl.java#L194-L207", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/services/PersonDirectoryUserInfoService.java", "func_name": "PersonDirectoryUserInfoService.getUserInfo", "original_string": "@Override\n    public Map<String, String> getUserInfo(PortletRequest request, PortletWindow plutoPortletWindow)\n            throws PortletContainerException {\n        // Get the remote user\n        final String remoteUser = request.getRemoteUser();\n        if (remoteUser == null) {\n            return null;\n        }\n\n        final HttpServletRequest httpServletRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPortletWindow portletWindow =\n                this.portletWindowRegistry.convertPortletWindow(\n                        httpServletRequest, plutoPortletWindow);\n\n        return this.getUserInfo(remoteUser, httpServletRequest, portletWindow);\n    }", "language": "java", "code": "@Override\n    public Map<String, String> getUserInfo(PortletRequest request, PortletWindow plutoPortletWindow)\n            throws PortletContainerException {\n        // Get the remote user\n        final String remoteUser = request.getRemoteUser();\n        if (remoteUser == null) {\n            return null;\n        }\n\n        final HttpServletRequest httpServletRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        final IPortletWindow portletWindow =\n                this.portletWindowRegistry.convertPortletWindow(\n                        httpServletRequest, plutoPortletWindow);\n\n        return this.getUserInfo(remoteUser, httpServletRequest, portletWindow);\n    }", "code_tokens": ["@", "Override", "public", "Map", "<", "String", ",", "String", ">", "getUserInfo", "(", "PortletRequest", "request", ",", "PortletWindow", "plutoPortletWindow", ")", "throws", "PortletContainerException", "{", "// Get the remote user", "final", "String", "remoteUser", "=", "request", ".", "getRemoteUser", "(", ")", ";", "if", "(", "remoteUser", "==", "null", ")", "{", "return", "null", ";", "}", "final", "HttpServletRequest", "httpServletRequest", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "request", ")", ";", "final", "IPortletWindow", "portletWindow", "=", "this", ".", "portletWindowRegistry", ".", "convertPortletWindow", "(", "httpServletRequest", ",", "plutoPortletWindow", ")", ";", "return", "this", ".", "getUserInfo", "(", "remoteUser", ",", "httpServletRequest", ",", "portletWindow", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apache.pluto.spi.optional.UserInfoService#getUserInfo(javax.portlet.PortletRequest, org.apache.pluto.PortletWindow)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/services/PersonDirectoryUserInfoService.java#L95-L111", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/services/PersonDirectoryUserInfoService.java", "func_name": "PersonDirectoryUserInfoService.getUserInfo", "original_string": "protected Map<String, String> getUserInfo(\n            String remoteUser, HttpServletRequest httpServletRequest, IPortletWindow portletWindow)\n            throws PortletContainerException {\n        // Get the list of user attributes the portal knows about the user\n        final IPersonAttributes personAttributes = this.personAttributeDao.getPerson(remoteUser);\n        if (personAttributes == null) {\n            return Collections.emptyMap();\n        }\n        final List<? extends UserAttribute> expectedUserAttributes =\n                this.getExpectedUserAttributes(httpServletRequest, portletWindow);\n\n        final Map<String, String> portletUserAttributes =\n                this.generateUserInfo(personAttributes, expectedUserAttributes, httpServletRequest);\n        return portletUserAttributes;\n    }", "language": "java", "code": "protected Map<String, String> getUserInfo(\n            String remoteUser, HttpServletRequest httpServletRequest, IPortletWindow portletWindow)\n            throws PortletContainerException {\n        // Get the list of user attributes the portal knows about the user\n        final IPersonAttributes personAttributes = this.personAttributeDao.getPerson(remoteUser);\n        if (personAttributes == null) {\n            return Collections.emptyMap();\n        }\n        final List<? extends UserAttribute> expectedUserAttributes =\n                this.getExpectedUserAttributes(httpServletRequest, portletWindow);\n\n        final Map<String, String> portletUserAttributes =\n                this.generateUserInfo(personAttributes, expectedUserAttributes, httpServletRequest);\n        return portletUserAttributes;\n    }", "code_tokens": ["protected", "Map", "<", "String", ",", "String", ">", "getUserInfo", "(", "String", "remoteUser", ",", "HttpServletRequest", "httpServletRequest", ",", "IPortletWindow", "portletWindow", ")", "throws", "PortletContainerException", "{", "// Get the list of user attributes the portal knows about the user", "final", "IPersonAttributes", "personAttributes", "=", "this", ".", "personAttributeDao", ".", "getPerson", "(", "remoteUser", ")", ";", "if", "(", "personAttributes", "==", "null", ")", "{", "return", "Collections", ".", "emptyMap", "(", ")", ";", "}", "final", "List", "<", "?", "extends", "UserAttribute", ">", "expectedUserAttributes", "=", "this", ".", "getExpectedUserAttributes", "(", "httpServletRequest", ",", "portletWindow", ")", ";", "final", "Map", "<", "String", ",", "String", ">", "portletUserAttributes", "=", "this", ".", "generateUserInfo", "(", "personAttributes", ",", "expectedUserAttributes", ",", "httpServletRequest", ")", ";", "return", "portletUserAttributes", ";", "}"], "docstring": "Commons logic to get a subset of the user's attributes for the specified portlet window.\n\n@param remoteUser The user to get attributes for.\n@param httpServletRequest The current, underlying httpServletRequest\n@param portletWindow The window to filter attributes for\n@return A Map of user attributes for the user and windows\n@throws PortletContainerException", "docstring_tokens": ["Commons", "logic", "to", "get", "a", "subset", "of", "the", "user", "s", "attributes", "for", "the", "specified", "portlet", "window", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/services/PersonDirectoryUserInfoService.java#L122-L136", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/services/PersonDirectoryUserInfoService.java", "func_name": "PersonDirectoryUserInfoService.generateUserInfo", "original_string": "protected Map<String, String> generateUserInfo(\n            final IPersonAttributes personAttributes,\n            final List<? extends UserAttribute> expectedUserAttributes,\n            HttpServletRequest httpServletRequest) {\n        final Map<String, String> portletUserAttributes =\n                new HashMap<String, String>(expectedUserAttributes.size());\n\n        // Copy expected attributes to the USER_INFO Map\n        final Map<String, List<Object>> attributes = personAttributes.getAttributes();\n        for (final UserAttribute userAttributeDD : expectedUserAttributes) {\n            final String attributeName = userAttributeDD.getName();\n\n            // TODO a personAttributes.hasAttribute(String) API is needed here, if hasAttribute and\n            // null then put the key with no value in the returned map\n            if (attributes.containsKey(attributeName)) {\n                final Object valueObj = personAttributes.getAttributeValue(attributeName);\n                final String value = valueObj == null ? null : String.valueOf(valueObj);\n                portletUserAttributes.put(attributeName, value);\n            }\n        }\n\n        return portletUserAttributes;\n    }", "language": "java", "code": "protected Map<String, String> generateUserInfo(\n            final IPersonAttributes personAttributes,\n            final List<? extends UserAttribute> expectedUserAttributes,\n            HttpServletRequest httpServletRequest) {\n        final Map<String, String> portletUserAttributes =\n                new HashMap<String, String>(expectedUserAttributes.size());\n\n        // Copy expected attributes to the USER_INFO Map\n        final Map<String, List<Object>> attributes = personAttributes.getAttributes();\n        for (final UserAttribute userAttributeDD : expectedUserAttributes) {\n            final String attributeName = userAttributeDD.getName();\n\n            // TODO a personAttributes.hasAttribute(String) API is needed here, if hasAttribute and\n            // null then put the key with no value in the returned map\n            if (attributes.containsKey(attributeName)) {\n                final Object valueObj = personAttributes.getAttributeValue(attributeName);\n                final String value = valueObj == null ? null : String.valueOf(valueObj);\n                portletUserAttributes.put(attributeName, value);\n            }\n        }\n\n        return portletUserAttributes;\n    }", "code_tokens": ["protected", "Map", "<", "String", ",", "String", ">", "generateUserInfo", "(", "final", "IPersonAttributes", "personAttributes", ",", "final", "List", "<", "?", "extends", "UserAttribute", ">", "expectedUserAttributes", ",", "HttpServletRequest", "httpServletRequest", ")", "{", "final", "Map", "<", "String", ",", "String", ">", "portletUserAttributes", "=", "new", "HashMap", "<", "String", ",", "String", ">", "(", "expectedUserAttributes", ".", "size", "(", ")", ")", ";", "// Copy expected attributes to the USER_INFO Map", "final", "Map", "<", "String", ",", "List", "<", "Object", ">", ">", "attributes", "=", "personAttributes", ".", "getAttributes", "(", ")", ";", "for", "(", "final", "UserAttribute", "userAttributeDD", ":", "expectedUserAttributes", ")", "{", "final", "String", "attributeName", "=", "userAttributeDD", ".", "getName", "(", ")", ";", "// TODO a personAttributes.hasAttribute(String) API is needed here, if hasAttribute and", "// null then put the key with no value in the returned map", "if", "(", "attributes", ".", "containsKey", "(", "attributeName", ")", ")", "{", "final", "Object", "valueObj", "=", "personAttributes", ".", "getAttributeValue", "(", "attributeName", ")", ";", "final", "String", "value", "=", "valueObj", "==", "null", "?", "null", ":", "String", ".", "valueOf", "(", "valueObj", ")", ";", "portletUserAttributes", ".", "put", "(", "attributeName", ",", "value", ")", ";", "}", "}", "return", "portletUserAttributes", ";", "}"], "docstring": "Using the Map of portal user attributes and a List of expected attributes generate the\nUSER_INFO map for the portlet\n\n@param portalUserAttributes All the attributes the portal knows about the user\n@param expectedUserAttributes The attributes the portlet expects to get\n@return The Map to use for the USER_INFO attribute", "docstring_tokens": ["Using", "the", "Map", "of", "portal", "user", "attributes", "and", "a", "List", "of", "expected", "attributes", "generate", "the", "USER_INFO", "map", "for", "the", "portlet"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/portlet/container/services/PersonDirectoryUserInfoService.java#L146-L168", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/TransformerConfigurationSourceAdapter.java", "func_name": "TransformerConfigurationSourceAdapter.getParameters", "original_string": "@Override\n    public Map<String, Object> getParameters(\n            HttpServletRequest request, HttpServletResponse response) {\n        return null;\n    }", "language": "java", "code": "@Override\n    public Map<String, Object> getParameters(\n            HttpServletRequest request, HttpServletResponse response) {\n        return null;\n    }", "code_tokens": ["@", "Override", "public", "Map", "<", "String", ",", "Object", ">", "getParameters", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "return", "null", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.xslt.TransformerConfigurationSource#getParameters(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/xslt/TransformerConfigurationSourceAdapter.java#L32-L36", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/AbstractBeanLocator.java", "func_name": "AbstractBeanLocator.afterPropertiesSet", "original_string": "@Override\n    public final void afterPropertiesSet() throws Exception {\n        if (this.getLocator() != null) {\n            this.logger.warn(\n                    \"Static \"\n                            + this.getClass().getName()\n                            + \" reference has already been set and setInstance is being called\");\n        }\n        this.setLocator(this);\n    }", "language": "java", "code": "@Override\n    public final void afterPropertiesSet() throws Exception {\n        if (this.getLocator() != null) {\n            this.logger.warn(\n                    \"Static \"\n                            + this.getClass().getName()\n                            + \" reference has already been set and setInstance is being called\");\n        }\n        this.setLocator(this);\n    }", "code_tokens": ["@", "Override", "public", "final", "void", "afterPropertiesSet", "(", ")", "throws", "Exception", "{", "if", "(", "this", ".", "getLocator", "(", ")", "!=", "null", ")", "{", "this", ".", "logger", ".", "warn", "(", "\"Static \"", "+", "this", ".", "getClass", "(", ")", ".", "getName", "(", ")", "+", "\" reference has already been set and setInstance is being called\"", ")", ";", "}", "this", ".", "setLocator", "(", "this", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.springframework.beans.factory.InitializingBean#afterPropertiesSet()", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/utils/AbstractBeanLocator.java#L52-L61", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-mvc/src/main/java/org/apereo/portal/security/mvc/LoginController.java", "func_name": "LoginController.service", "original_string": "@RequestMapping\n    public void service(HttpServletRequest request, HttpServletResponse response)\n            throws ServletException, IOException {\n        response.setHeader(\"Pragma\", \"no-cache\");\n        response.setHeader(\"Cache-Control\", \"no-cache\");\n        response.setDateHeader(\"Expires\", 0);\n\n        // create the redirect URL, adding fname and args parameters if necessary\n        String redirectTarget = null;\n\n        final String refUrl = request.getParameter(REFERER_URL_PARAM);\n        final URL redirectLocation = parseLocalRefUrl(request, refUrl);\n        if (redirectLocation != null) {\n            redirectTarget = redirectLocation.toString();\n        }\n\n        if (redirectTarget == null) {\n            /* Grab the target functional name, if any, off the login request.\n             * Also any arguments for the target. We will pass them  along after authentication.\n             */\n            String targetFname = request.getParameter(\"uP_fname\");\n\n            if (targetFname == null) {\n                final IPortalUrlBuilder defaultUrl = this.portalUrlProvider.getDefaultUrl(request);\n                redirectTarget = defaultUrl.getUrlString();\n            } else {\n                try {\n                    final IPortalUrlBuilder urlBuilder =\n                            this.portalUrlProvider.getPortalUrlBuilderByPortletFName(\n                                    request, targetFname, UrlType.RENDER);\n\n                    Enumeration<String> e = request.getParameterNames();\n                    while (e.hasMoreElements()) {\n                        String paramName = e.nextElement();\n                        if (!paramName.equals(\"uP_fname\")) {\n                            urlBuilder.addParameter(\n                                    paramName, request.getParameterValues(paramName));\n                        }\n                    }\n\n                    redirectTarget = urlBuilder.getUrlString();\n                } catch (IllegalArgumentException e) {\n                    final IPortalUrlBuilder defaultUrl =\n                            this.portalUrlProvider.getDefaultUrl(request);\n                    redirectTarget = defaultUrl.getUrlString();\n                }\n            }\n        }\n\n        IPerson person = null;\n\n        final Object authError =\n                request.getSession(false).getAttribute(LoginController.AUTH_ERROR_KEY);\n        if (authError == null || !((Boolean) authError)) {\n            person = this.personManager.getPerson(request);\n        }\n\n        if (person == null || !person.getSecurityContext().isAuthenticated()) {\n            if (request.getMethod().equals(\"POST\"))\n                request.getSession(false).setAttribute(AUTH_ATTEMPTED_KEY, \"true\");\n            // Preserve the attempted username so it can be redisplayed to the user\n            String attemptedUserName = request.getParameter(\"userName\");\n            if (attemptedUserName != null)\n                request.getSession(false)\n                        .setAttribute(ATTEMPTED_USERNAME_KEY, request.getParameter(\"userName\"));\n        }\n\n        final String encodedRedirectURL = response.encodeRedirectURL(redirectTarget);\n\n        if (log.isDebugEnabled()) {\n            log.debug(\"Redirecting to \" + redirectTarget);\n        }\n\n        response.sendRedirect(encodedRedirectURL);\n    }", "language": "java", "code": "@RequestMapping\n    public void service(HttpServletRequest request, HttpServletResponse response)\n            throws ServletException, IOException {\n        response.setHeader(\"Pragma\", \"no-cache\");\n        response.setHeader(\"Cache-Control\", \"no-cache\");\n        response.setDateHeader(\"Expires\", 0);\n\n        // create the redirect URL, adding fname and args parameters if necessary\n        String redirectTarget = null;\n\n        final String refUrl = request.getParameter(REFERER_URL_PARAM);\n        final URL redirectLocation = parseLocalRefUrl(request, refUrl);\n        if (redirectLocation != null) {\n            redirectTarget = redirectLocation.toString();\n        }\n\n        if (redirectTarget == null) {\n            /* Grab the target functional name, if any, off the login request.\n             * Also any arguments for the target. We will pass them  along after authentication.\n             */\n            String targetFname = request.getParameter(\"uP_fname\");\n\n            if (targetFname == null) {\n                final IPortalUrlBuilder defaultUrl = this.portalUrlProvider.getDefaultUrl(request);\n                redirectTarget = defaultUrl.getUrlString();\n            } else {\n                try {\n                    final IPortalUrlBuilder urlBuilder =\n                            this.portalUrlProvider.getPortalUrlBuilderByPortletFName(\n                                    request, targetFname, UrlType.RENDER);\n\n                    Enumeration<String> e = request.getParameterNames();\n                    while (e.hasMoreElements()) {\n                        String paramName = e.nextElement();\n                        if (!paramName.equals(\"uP_fname\")) {\n                            urlBuilder.addParameter(\n                                    paramName, request.getParameterValues(paramName));\n                        }\n                    }\n\n                    redirectTarget = urlBuilder.getUrlString();\n                } catch (IllegalArgumentException e) {\n                    final IPortalUrlBuilder defaultUrl =\n                            this.portalUrlProvider.getDefaultUrl(request);\n                    redirectTarget = defaultUrl.getUrlString();\n                }\n            }\n        }\n\n        IPerson person = null;\n\n        final Object authError =\n                request.getSession(false).getAttribute(LoginController.AUTH_ERROR_KEY);\n        if (authError == null || !((Boolean) authError)) {\n            person = this.personManager.getPerson(request);\n        }\n\n        if (person == null || !person.getSecurityContext().isAuthenticated()) {\n            if (request.getMethod().equals(\"POST\"))\n                request.getSession(false).setAttribute(AUTH_ATTEMPTED_KEY, \"true\");\n            // Preserve the attempted username so it can be redisplayed to the user\n            String attemptedUserName = request.getParameter(\"userName\");\n            if (attemptedUserName != null)\n                request.getSession(false)\n                        .setAttribute(ATTEMPTED_USERNAME_KEY, request.getParameter(\"userName\"));\n        }\n\n        final String encodedRedirectURL = response.encodeRedirectURL(redirectTarget);\n\n        if (log.isDebugEnabled()) {\n            log.debug(\"Redirecting to \" + redirectTarget);\n        }\n\n        response.sendRedirect(encodedRedirectURL);\n    }", "code_tokens": ["@", "RequestMapping", "public", "void", "service", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "throws", "ServletException", ",", "IOException", "{", "response", ".", "setHeader", "(", "\"Pragma\"", ",", "\"no-cache\"", ")", ";", "response", ".", "setHeader", "(", "\"Cache-Control\"", ",", "\"no-cache\"", ")", ";", "response", ".", "setDateHeader", "(", "\"Expires\"", ",", "0", ")", ";", "// create the redirect URL, adding fname and args parameters if necessary", "String", "redirectTarget", "=", "null", ";", "final", "String", "refUrl", "=", "request", ".", "getParameter", "(", "REFERER_URL_PARAM", ")", ";", "final", "URL", "redirectLocation", "=", "parseLocalRefUrl", "(", "request", ",", "refUrl", ")", ";", "if", "(", "redirectLocation", "!=", "null", ")", "{", "redirectTarget", "=", "redirectLocation", ".", "toString", "(", ")", ";", "}", "if", "(", "redirectTarget", "==", "null", ")", "{", "/* Grab the target functional name, if any, off the login request.\n             * Also any arguments for the target. We will pass them  along after authentication.\n             */", "String", "targetFname", "=", "request", ".", "getParameter", "(", "\"uP_fname\"", ")", ";", "if", "(", "targetFname", "==", "null", ")", "{", "final", "IPortalUrlBuilder", "defaultUrl", "=", "this", ".", "portalUrlProvider", ".", "getDefaultUrl", "(", "request", ")", ";", "redirectTarget", "=", "defaultUrl", ".", "getUrlString", "(", ")", ";", "}", "else", "{", "try", "{", "final", "IPortalUrlBuilder", "urlBuilder", "=", "this", ".", "portalUrlProvider", ".", "getPortalUrlBuilderByPortletFName", "(", "request", ",", "targetFname", ",", "UrlType", ".", "RENDER", ")", ";", "Enumeration", "<", "String", ">", "e", "=", "request", ".", "getParameterNames", "(", ")", ";", "while", "(", "e", ".", "hasMoreElements", "(", ")", ")", "{", "String", "paramName", "=", "e", ".", "nextElement", "(", ")", ";", "if", "(", "!", "paramName", ".", "equals", "(", "\"uP_fname\"", ")", ")", "{", "urlBuilder", ".", "addParameter", "(", "paramName", ",", "request", ".", "getParameterValues", "(", "paramName", ")", ")", ";", "}", "}", "redirectTarget", "=", "urlBuilder", ".", "getUrlString", "(", ")", ";", "}", "catch", "(", "IllegalArgumentException", "e", ")", "{", "final", "IPortalUrlBuilder", "defaultUrl", "=", "this", ".", "portalUrlProvider", ".", "getDefaultUrl", "(", "request", ")", ";", "redirectTarget", "=", "defaultUrl", ".", "getUrlString", "(", ")", ";", "}", "}", "}", "IPerson", "person", "=", "null", ";", "final", "Object", "authError", "=", "request", ".", "getSession", "(", "false", ")", ".", "getAttribute", "(", "LoginController", ".", "AUTH_ERROR_KEY", ")", ";", "if", "(", "authError", "==", "null", "||", "!", "(", "(", "Boolean", ")", "authError", ")", ")", "{", "person", "=", "this", ".", "personManager", ".", "getPerson", "(", "request", ")", ";", "}", "if", "(", "person", "==", "null", "||", "!", "person", ".", "getSecurityContext", "(", ")", ".", "isAuthenticated", "(", ")", ")", "{", "if", "(", "request", ".", "getMethod", "(", ")", ".", "equals", "(", "\"POST\"", ")", ")", "request", ".", "getSession", "(", "false", ")", ".", "setAttribute", "(", "AUTH_ATTEMPTED_KEY", ",", "\"true\"", ")", ";", "// Preserve the attempted username so it can be redisplayed to the user", "String", "attemptedUserName", "=", "request", ".", "getParameter", "(", "\"userName\"", ")", ";", "if", "(", "attemptedUserName", "!=", "null", ")", "request", ".", "getSession", "(", "false", ")", ".", "setAttribute", "(", "ATTEMPTED_USERNAME_KEY", ",", "request", ".", "getParameter", "(", "\"userName\"", ")", ")", ";", "}", "final", "String", "encodedRedirectURL", "=", "response", ".", "encodeRedirectURL", "(", "redirectTarget", ")", ";", "if", "(", "log", ".", "isDebugEnabled", "(", ")", ")", "{", "log", ".", "debug", "(", "\"Redirecting to \"", "+", "redirectTarget", ")", ";", "}", "response", ".", "sendRedirect", "(", "encodedRedirectURL", ")", ";", "}"], "docstring": "Process the incoming HttpServletRequest. Note that this processing occurs after\nPortalPreAuthenticatedProcessingFilter has run and performed pre-processing.\n\n@param request\n@param response\n@exception ServletException\n@exception IOException", "docstring_tokens": ["Process", "the", "incoming", "HttpServletRequest", ".", "Note", "that", "this", "processing", "occurs", "after", "PortalPreAuthenticatedProcessingFilter", "has", "run", "and", "performed", "pre", "-", "processing", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-mvc/src/main/java/org/apereo/portal/security/mvc/LoginController.java#L75-L149", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-mvc/src/main/java/org/apereo/portal/security/mvc/LoginController.java", "func_name": "LoginController.parseLocalRefUrl", "original_string": "URL parseLocalRefUrl(\n            final HttpServletRequest request, final String refUrl) {\n        URL rslt = null; // default\n        if (StringUtils.isNotBlank(refUrl)) {\n            try {\n                final URL context = new URL(request.getRequestURL().toString());\n                final URL location = new URL(context, refUrl);\n\n                if (location.getProtocol().equals(context.getProtocol())\n                        && location.getHost().equals(context.getHost())\n                        && location.getPort() == context.getPort()) {\n                    rslt = location;\n                } else {\n                    log.warn(\"The specified refUrl is not local:  \" + refUrl);\n                }\n            } catch (Exception e) {\n                log.warn(\"Unable to analyze specified refUrl:  \" + refUrl);\n                log.debug(e);\n            }\n        }\n        return rslt;\n    }", "language": "java", "code": "URL parseLocalRefUrl(\n            final HttpServletRequest request, final String refUrl) {\n        URL rslt = null; // default\n        if (StringUtils.isNotBlank(refUrl)) {\n            try {\n                final URL context = new URL(request.getRequestURL().toString());\n                final URL location = new URL(context, refUrl);\n\n                if (location.getProtocol().equals(context.getProtocol())\n                        && location.getHost().equals(context.getHost())\n                        && location.getPort() == context.getPort()) {\n                    rslt = location;\n                } else {\n                    log.warn(\"The specified refUrl is not local:  \" + refUrl);\n                }\n            } catch (Exception e) {\n                log.warn(\"Unable to analyze specified refUrl:  \" + refUrl);\n                log.debug(e);\n            }\n        }\n        return rslt;\n    }", "code_tokens": ["URL", "parseLocalRefUrl", "(", "final", "HttpServletRequest", "request", ",", "final", "String", "refUrl", ")", "{", "URL", "rslt", "=", "null", ";", "// default", "if", "(", "StringUtils", ".", "isNotBlank", "(", "refUrl", ")", ")", "{", "try", "{", "final", "URL", "context", "=", "new", "URL", "(", "request", ".", "getRequestURL", "(", ")", ".", "toString", "(", ")", ")", ";", "final", "URL", "location", "=", "new", "URL", "(", "context", ",", "refUrl", ")", ";", "if", "(", "location", ".", "getProtocol", "(", ")", ".", "equals", "(", "context", ".", "getProtocol", "(", ")", ")", "&&", "location", ".", "getHost", "(", ")", ".", "equals", "(", "context", ".", "getHost", "(", ")", ")", "&&", "location", ".", "getPort", "(", ")", "==", "context", ".", "getPort", "(", ")", ")", "{", "rslt", "=", "location", ";", "}", "else", "{", "log", ".", "warn", "(", "\"The specified refUrl is not local:  \"", "+", "refUrl", ")", ";", "}", "}", "catch", "(", "Exception", "e", ")", "{", "log", ".", "warn", "(", "\"Unable to analyze specified refUrl:  \"", "+", "refUrl", ")", ";", "log", ".", "debug", "(", "e", ")", ";", "}", "}", "return", "rslt", ";", "}"], "docstring": "/* package-private", "docstring_tokens": ["/", "*", "package", "-", "private"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-mvc/src/main/java/org/apereo/portal/security/mvc/LoginController.java#L159-L180", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/LoggingCharacterComponent.java", "func_name": "LoggingCharacterComponent.getEventReader", "original_string": "@Override\n    public PipelineEventReader<CharacterEventReader, CharacterEvent> getEventReader(\n            HttpServletRequest request, HttpServletResponse response) {\n        final PipelineEventReader<CharacterEventReader, CharacterEvent> pipelineEventReader =\n                this.wrappedComponent.getEventReader(request, response);\n\n        final CharacterEventReader eventReader = pipelineEventReader.getEventReader();\n\n        final LoggingCharacterEventReader loggingEventReader =\n                new LoggingCharacterEventReader(eventReader);\n\n        final Map<String, String> outputProperties = pipelineEventReader.getOutputProperties();\n        return new PipelineEventReaderImpl<CharacterEventReader, CharacterEvent>(\n                loggingEventReader, outputProperties);\n    }", "language": "java", "code": "@Override\n    public PipelineEventReader<CharacterEventReader, CharacterEvent> getEventReader(\n            HttpServletRequest request, HttpServletResponse response) {\n        final PipelineEventReader<CharacterEventReader, CharacterEvent> pipelineEventReader =\n                this.wrappedComponent.getEventReader(request, response);\n\n        final CharacterEventReader eventReader = pipelineEventReader.getEventReader();\n\n        final LoggingCharacterEventReader loggingEventReader =\n                new LoggingCharacterEventReader(eventReader);\n\n        final Map<String, String> outputProperties = pipelineEventReader.getOutputProperties();\n        return new PipelineEventReaderImpl<CharacterEventReader, CharacterEvent>(\n                loggingEventReader, outputProperties);\n    }", "code_tokens": ["@", "Override", "public", "PipelineEventReader", "<", "CharacterEventReader", ",", "CharacterEvent", ">", "getEventReader", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "final", "PipelineEventReader", "<", "CharacterEventReader", ",", "CharacterEvent", ">", "pipelineEventReader", "=", "this", ".", "wrappedComponent", ".", "getEventReader", "(", "request", ",", "response", ")", ";", "final", "CharacterEventReader", "eventReader", "=", "pipelineEventReader", ".", "getEventReader", "(", ")", ";", "final", "LoggingCharacterEventReader", "loggingEventReader", "=", "new", "LoggingCharacterEventReader", "(", "eventReader", ")", ";", "final", "Map", "<", "String", ",", "String", ">", "outputProperties", "=", "pipelineEventReader", ".", "getOutputProperties", "(", ")", ";", "return", "new", "PipelineEventReaderImpl", "<", "CharacterEventReader", ",", "CharacterEvent", ">", "(", "loggingEventReader", ",", "outputProperties", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.PipelineComponent#getEventReader(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/LoggingCharacterComponent.java#L43-L57", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/statistics/BasePortletLayoutStatisticsController.java", "func_name": "BasePortletLayoutStatisticsController.selectFormDefaultPortlet", "original_string": "protected void selectFormDefaultPortlet(final F report) {\n        final Set<AggregatedPortletMapping> portlets = this.getPortlets();\n        if (!portlets.isEmpty()) {\n            report.getPortlets().add(portlets.iterator().next().getFname());\n        }\n    }", "language": "java", "code": "protected void selectFormDefaultPortlet(final F report) {\n        final Set<AggregatedPortletMapping> portlets = this.getPortlets();\n        if (!portlets.isEmpty()) {\n            report.getPortlets().add(portlets.iterator().next().getFname());\n        }\n    }", "code_tokens": ["protected", "void", "selectFormDefaultPortlet", "(", "final", "F", "report", ")", "{", "final", "Set", "<", "AggregatedPortletMapping", ">", "portlets", "=", "this", ".", "getPortlets", "(", ")", ";", "if", "(", "!", "portlets", ".", "isEmpty", "(", ")", ")", "{", "report", ".", "getPortlets", "(", ")", ".", "add", "(", "portlets", ".", "iterator", "(", ")", ".", "next", "(", ")", ".", "getFname", "(", ")", ")", ";", "}", "}"], "docstring": "Select the first portlet name by default for the form", "docstring_tokens": ["Select", "the", "first", "portlet", "name", "by", "default", "for", "the", "form"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/statistics/BasePortletLayoutStatisticsController.java#L83-L88", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/statistics/BasePortletLayoutStatisticsController.java", "func_name": "BasePortletLayoutStatisticsController.getReportTitleAugmentation", "original_string": "@Override\n    protected String getReportTitleAugmentation(F form) {\n        int groupSize = form.getGroups().size();\n        int portletSize = form.getPortlets().size();\n\n        // If multiple of all selected, the report title does not change.\n        if (portletSize > 1 && groupSize > 1) {\n            return null;\n        }\n\n        // Look up names in case we need them.  They should be in cache so no real performance hit.\n        String firstPortletName =\n                this.aggregatedPortletLookupDao\n                        .getMappedPortletForFname(form.getPortlets().iterator().next())\n                        .getFname();\n        Long firstGroupId = form.getGroups().iterator().next().longValue();\n        String firstGroupName =\n                this.aggregatedGroupLookupDao.getGroupMapping(firstGroupId).getGroupName();\n\n        // Default to show portlet name else group name in title\n        String augmentedTitle =\n                groupSize == 1 && portletSize > 1 ? firstGroupName : firstPortletName;\n\n        return augmentedTitle;\n    }", "language": "java", "code": "@Override\n    protected String getReportTitleAugmentation(F form) {\n        int groupSize = form.getGroups().size();\n        int portletSize = form.getPortlets().size();\n\n        // If multiple of all selected, the report title does not change.\n        if (portletSize > 1 && groupSize > 1) {\n            return null;\n        }\n\n        // Look up names in case we need them.  They should be in cache so no real performance hit.\n        String firstPortletName =\n                this.aggregatedPortletLookupDao\n                        .getMappedPortletForFname(form.getPortlets().iterator().next())\n                        .getFname();\n        Long firstGroupId = form.getGroups().iterator().next().longValue();\n        String firstGroupName =\n                this.aggregatedGroupLookupDao.getGroupMapping(firstGroupId).getGroupName();\n\n        // Default to show portlet name else group name in title\n        String augmentedTitle =\n                groupSize == 1 && portletSize > 1 ? firstGroupName : firstPortletName;\n\n        return augmentedTitle;\n    }", "code_tokens": ["@", "Override", "protected", "String", "getReportTitleAugmentation", "(", "F", "form", ")", "{", "int", "groupSize", "=", "form", ".", "getGroups", "(", ")", ".", "size", "(", ")", ";", "int", "portletSize", "=", "form", ".", "getPortlets", "(", ")", ".", "size", "(", ")", ";", "// If multiple of all selected, the report title does not change.", "if", "(", "portletSize", ">", "1", "&&", "groupSize", ">", "1", ")", "{", "return", "null", ";", "}", "// Look up names in case we need them.  They should be in cache so no real performance hit.", "String", "firstPortletName", "=", "this", ".", "aggregatedPortletLookupDao", ".", "getMappedPortletForFname", "(", "form", ".", "getPortlets", "(", ")", ".", "iterator", "(", ")", ".", "next", "(", ")", ")", ".", "getFname", "(", ")", ";", "Long", "firstGroupId", "=", "form", ".", "getGroups", "(", ")", ".", "iterator", "(", ")", ".", "next", "(", ")", ".", "longValue", "(", ")", ";", "String", "firstGroupName", "=", "this", ".", "aggregatedGroupLookupDao", ".", "getGroupMapping", "(", "firstGroupId", ")", ".", "getGroupName", "(", ")", ";", "// Default to show portlet name else group name in title", "String", "augmentedTitle", "=", "groupSize", "==", "1", "&&", "portletSize", ">", "1", "?", "firstGroupName", ":", "firstPortletName", ";", "return", "augmentedTitle", ";", "}"], "docstring": "Create report title. Criteria that have a single value selected are put into the title.\nFormat and possible options are:\n\n<ul>\n<li>null (no change needed)\n<li>portlet\n<li>portlet (execution)\n<li>group\n<li>group (execution)\n<li>execution\n<li>portlet - group (also displayed if one of each criteria selected)\n</ul>\n\n@param form the form\n@return report title", "docstring_tokens": ["Create", "report", "title", ".", "Criteria", "that", "have", "a", "single", "value", "selected", "are", "put", "into", "the", "title", ".", "Format", "and", "possible", "options", "are", ":"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/statistics/BasePortletLayoutStatisticsController.java#L188-L212", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-portlets/src/main/java/org/apereo/portal/portlets/statistics/BasePortletLayoutStatisticsController.java", "func_name": "BasePortletLayoutStatisticsController.getColumnDescriptions", "original_string": "@Override\n    protected List<ColumnDescription> getColumnDescriptions(\n            PortletLayoutAggregationDiscriminator reportColumnDiscriminator, F form) {\n        int groupSize = form.getGroups().size();\n        int portletSize = form.getPortlets().size();\n\n        String portletName = reportColumnDiscriminator.getPortletMapping().getFname();\n        String groupName = reportColumnDiscriminator.getAggregatedGroup().getGroupName();\n\n        String description = null;\n        if (showFullColumnHeaderDescriptions(form) || (groupSize > 1 && portletSize > 1)) {\n            description = String.format(\"%s - %s\", portletName, groupName);\n        } else {\n            // Default to group name, else portlet name\n            description = groupSize == 1 && portletSize > 1 ? portletName : groupName;\n        }\n\n        final List<ColumnDescription> columnDescriptions = new ArrayList<ColumnDescription>();\n        columnDescriptions.add(new ColumnDescription(description, ValueType.NUMBER, description));\n        return columnDescriptions;\n    }", "language": "java", "code": "@Override\n    protected List<ColumnDescription> getColumnDescriptions(\n            PortletLayoutAggregationDiscriminator reportColumnDiscriminator, F form) {\n        int groupSize = form.getGroups().size();\n        int portletSize = form.getPortlets().size();\n\n        String portletName = reportColumnDiscriminator.getPortletMapping().getFname();\n        String groupName = reportColumnDiscriminator.getAggregatedGroup().getGroupName();\n\n        String description = null;\n        if (showFullColumnHeaderDescriptions(form) || (groupSize > 1 && portletSize > 1)) {\n            description = String.format(\"%s - %s\", portletName, groupName);\n        } else {\n            // Default to group name, else portlet name\n            description = groupSize == 1 && portletSize > 1 ? portletName : groupName;\n        }\n\n        final List<ColumnDescription> columnDescriptions = new ArrayList<ColumnDescription>();\n        columnDescriptions.add(new ColumnDescription(description, ValueType.NUMBER, description));\n        return columnDescriptions;\n    }", "code_tokens": ["@", "Override", "protected", "List", "<", "ColumnDescription", ">", "getColumnDescriptions", "(", "PortletLayoutAggregationDiscriminator", "reportColumnDiscriminator", ",", "F", "form", ")", "{", "int", "groupSize", "=", "form", ".", "getGroups", "(", ")", ".", "size", "(", ")", ";", "int", "portletSize", "=", "form", ".", "getPortlets", "(", ")", ".", "size", "(", ")", ";", "String", "portletName", "=", "reportColumnDiscriminator", ".", "getPortletMapping", "(", ")", ".", "getFname", "(", ")", ";", "String", "groupName", "=", "reportColumnDiscriminator", ".", "getAggregatedGroup", "(", ")", ".", "getGroupName", "(", ")", ";", "String", "description", "=", "null", ";", "if", "(", "showFullColumnHeaderDescriptions", "(", "form", ")", "||", "(", "groupSize", ">", "1", "&&", "portletSize", ">", "1", ")", ")", "{", "description", "=", "String", ".", "format", "(", "\"%s - %s\"", ",", "portletName", ",", "groupName", ")", ";", "}", "else", "{", "// Default to group name, else portlet name", "description", "=", "groupSize", "==", "1", "&&", "portletSize", ">", "1", "?", "portletName", ":", "groupName", ";", "}", "final", "List", "<", "ColumnDescription", ">", "columnDescriptions", "=", "new", "ArrayList", "<", "ColumnDescription", ">", "(", ")", ";", "columnDescriptions", ".", "add", "(", "new", "ColumnDescription", "(", "description", ",", "ValueType", ".", "NUMBER", ",", "description", ")", ")", ";", "return", "columnDescriptions", ";", "}"], "docstring": "Create column descriptions for the portlet report. The default column description is the\ngroup name, but those items that are singular will move to the report title and only those\nthat have 2 or more values selected on the form will be in the column title. Format: P - G P\nG P - G where P is portlet name, G is group name\n\n@param reportColumnDiscriminator\n@param form The original query form\n@return", "docstring_tokens": ["Create", "column", "descriptions", "for", "the", "portlet", "report", ".", "The", "default", "column", "description", "is", "the", "group", "name", "but", "those", "items", "that", "are", "singular", "will", "move", "to", "the", "report", "title", "and", "only", "those", "that", "have", "2", "or", "more", "values", "selected", "on", "the", "form", "will", "be", "in", "the", "column", "title", ".", "Format", ":", "P", "-", "G", "P", "G", "P", "-", "G", "where", "P", "is", "portlet", "name", "G", "is", "group", "name"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-portlets/src/main/java/org/apereo/portal/portlets/statistics/BasePortletLayoutStatisticsController.java#L224-L244", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/jdbc/DatabaseMetaDataImpl.java", "func_name": "DatabaseMetaDataImpl.afterPropertiesSet", "original_string": "@Override\n    public void afterPropertiesSet() throws Exception {\n        this.transactionTemplate = new TransactionTemplate(this.transactionManager);\n        this.transactionTemplate.setPropagationBehavior(\n                TransactionTemplate.PROPAGATION_REQUIRES_NEW);\n        this.transactionTemplate.setReadOnly(true);\n        this.transactionTemplate.afterPropertiesSet();\n\n        this.runDatabaseTests();\n        if (LOG.isDebugEnabled()) LOG.debug(this.toString());\n    }", "language": "java", "code": "@Override\n    public void afterPropertiesSet() throws Exception {\n        this.transactionTemplate = new TransactionTemplate(this.transactionManager);\n        this.transactionTemplate.setPropagationBehavior(\n                TransactionTemplate.PROPAGATION_REQUIRES_NEW);\n        this.transactionTemplate.setReadOnly(true);\n        this.transactionTemplate.afterPropertiesSet();\n\n        this.runDatabaseTests();\n        if (LOG.isDebugEnabled()) LOG.debug(this.toString());\n    }", "code_tokens": ["@", "Override", "public", "void", "afterPropertiesSet", "(", ")", "throws", "Exception", "{", "this", ".", "transactionTemplate", "=", "new", "TransactionTemplate", "(", "this", ".", "transactionManager", ")", ";", "this", ".", "transactionTemplate", ".", "setPropagationBehavior", "(", "TransactionTemplate", ".", "PROPAGATION_REQUIRES_NEW", ")", ";", "this", ".", "transactionTemplate", ".", "setReadOnly", "(", "true", ")", ";", "this", ".", "transactionTemplate", ".", "afterPropertiesSet", "(", ")", ";", "this", ".", "runDatabaseTests", "(", ")", ";", "if", "(", "LOG", ".", "isDebugEnabled", "(", ")", ")", "LOG", ".", "debug", "(", "this", ".", "toString", "(", ")", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.springframework.beans.factory.InitializingBean#afterPropertiesSet()", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/jdbc/DatabaseMetaDataImpl.java#L113-L123", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/jdbc/DatabaseMetaDataImpl.java", "func_name": "DatabaseMetaDataImpl.getMetaData", "original_string": "private void getMetaData(final Connection conn) {\n        try {\n            final DatabaseMetaData dmd = conn.getMetaData();\n\n            this.databaseProductName = dmd.getDatabaseProductName();\n            this.databaseProductVersion = dmd.getDatabaseProductVersion();\n            this.driverName = dmd.getDriverName();\n            this.driverVersion = dmd.getDriverVersion();\n            this.userName = dmd.getUserName();\n            this.dbUrl = dmd.getURL();\n            this.dbmdSupportsOuterJoins = dmd.supportsOuterJoins();\n        } catch (SQLException sqle) {\n            LOG.error(\"Error getting database meta data.\", sqle);\n        }\n    }", "language": "java", "code": "private void getMetaData(final Connection conn) {\n        try {\n            final DatabaseMetaData dmd = conn.getMetaData();\n\n            this.databaseProductName = dmd.getDatabaseProductName();\n            this.databaseProductVersion = dmd.getDatabaseProductVersion();\n            this.driverName = dmd.getDriverName();\n            this.driverVersion = dmd.getDriverVersion();\n            this.userName = dmd.getUserName();\n            this.dbUrl = dmd.getURL();\n            this.dbmdSupportsOuterJoins = dmd.supportsOuterJoins();\n        } catch (SQLException sqle) {\n            LOG.error(\"Error getting database meta data.\", sqle);\n        }\n    }", "code_tokens": ["private", "void", "getMetaData", "(", "final", "Connection", "conn", ")", "{", "try", "{", "final", "DatabaseMetaData", "dmd", "=", "conn", ".", "getMetaData", "(", ")", ";", "this", ".", "databaseProductName", "=", "dmd", ".", "getDatabaseProductName", "(", ")", ";", "this", ".", "databaseProductVersion", "=", "dmd", ".", "getDatabaseProductVersion", "(", ")", ";", "this", ".", "driverName", "=", "dmd", ".", "getDriverName", "(", ")", ";", "this", ".", "driverVersion", "=", "dmd", ".", "getDriverVersion", "(", ")", ";", "this", ".", "userName", "=", "dmd", ".", "getUserName", "(", ")", ";", "this", ".", "dbUrl", "=", "dmd", ".", "getURL", "(", ")", ";", "this", ".", "dbmdSupportsOuterJoins", "=", "dmd", ".", "supportsOuterJoins", "(", ")", ";", "}", "catch", "(", "SQLException", "sqle", ")", "{", "LOG", ".", "error", "(", "\"Error getting database meta data.\"", ",", "sqle", ")", ";", "}", "}"], "docstring": "Gets meta data about the connection.", "docstring_tokens": ["Gets", "meta", "data", "about", "the", "connection", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/jdbc/DatabaseMetaDataImpl.java#L314-L328", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/PortalController.java", "func_name": "PortalController.actionRequest", "original_string": "@RequestMapping(\n            headers = {\"org.apereo.portal.url.UrlType=ACTION\"},\n            method = RequestMethod.POST)\n    public void actionRequest(HttpServletRequest request, HttpServletResponse response)\n            throws IOException {\n\n        final IPortalRequestInfo portalRequestInfo =\n                this.urlSyntaxProvider.getPortalRequestInfo(request);\n        final IPortletRequestInfo portletRequestInfo =\n                portalRequestInfo.getTargetedPortletRequestInfo();\n\n        final IPortalUrlBuilder actionRedirectUrl;\n        if (portletRequestInfo != null) {\n            final IPortletWindowId targetWindowId = portletRequestInfo.getPortletWindowId();\n            actionRedirectUrl =\n                    this.portalUrlProvider.getPortalUrlBuilderByPortletWindow(\n                            request, targetWindowId, UrlType.RENDER);\n        } else {\n            final String targetedLayoutNodeId = portalRequestInfo.getTargetedLayoutNodeId();\n\n            if (targetedLayoutNodeId != null) {\n                actionRedirectUrl =\n                        this.portalUrlProvider.getPortalUrlBuilderByLayoutNode(\n                                request, targetedLayoutNodeId, UrlType.RENDER);\n            } else {\n                actionRedirectUrl = this.portalUrlProvider.getDefaultUrl(request);\n            }\n        }\n\n        // Stuff the action-redirect URL builder into the request so other code can use it during\n        // request processing\n        this.portalUrlProvider.convertToPortalActionUrlBuilder(request, actionRedirectUrl);\n\n        if (portletRequestInfo != null) {\n            final IPortletWindowId targetWindowId = portletRequestInfo.getPortletWindowId();\n\n            try {\n                this.portletExecutionManager.doPortletAction(targetWindowId, request, response);\n            } catch (RuntimeException e) {\n                this.logger.error(\n                        \"Exception thrown while executing portlet action for: \"\n                                + portletRequestInfo,\n                        e);\n\n                // TODO this should be a constant right?\n                actionRedirectUrl.setParameter(\"portletActionError\", targetWindowId.toString());\n            }\n        }\n\n        sendRedirect(actionRedirectUrl, response);\n    }", "language": "java", "code": "@RequestMapping(\n            headers = {\"org.apereo.portal.url.UrlType=ACTION\"},\n            method = RequestMethod.POST)\n    public void actionRequest(HttpServletRequest request, HttpServletResponse response)\n            throws IOException {\n\n        final IPortalRequestInfo portalRequestInfo =\n                this.urlSyntaxProvider.getPortalRequestInfo(request);\n        final IPortletRequestInfo portletRequestInfo =\n                portalRequestInfo.getTargetedPortletRequestInfo();\n\n        final IPortalUrlBuilder actionRedirectUrl;\n        if (portletRequestInfo != null) {\n            final IPortletWindowId targetWindowId = portletRequestInfo.getPortletWindowId();\n            actionRedirectUrl =\n                    this.portalUrlProvider.getPortalUrlBuilderByPortletWindow(\n                            request, targetWindowId, UrlType.RENDER);\n        } else {\n            final String targetedLayoutNodeId = portalRequestInfo.getTargetedLayoutNodeId();\n\n            if (targetedLayoutNodeId != null) {\n                actionRedirectUrl =\n                        this.portalUrlProvider.getPortalUrlBuilderByLayoutNode(\n                                request, targetedLayoutNodeId, UrlType.RENDER);\n            } else {\n                actionRedirectUrl = this.portalUrlProvider.getDefaultUrl(request);\n            }\n        }\n\n        // Stuff the action-redirect URL builder into the request so other code can use it during\n        // request processing\n        this.portalUrlProvider.convertToPortalActionUrlBuilder(request, actionRedirectUrl);\n\n        if (portletRequestInfo != null) {\n            final IPortletWindowId targetWindowId = portletRequestInfo.getPortletWindowId();\n\n            try {\n                this.portletExecutionManager.doPortletAction(targetWindowId, request, response);\n            } catch (RuntimeException e) {\n                this.logger.error(\n                        \"Exception thrown while executing portlet action for: \"\n                                + portletRequestInfo,\n                        e);\n\n                // TODO this should be a constant right?\n                actionRedirectUrl.setParameter(\"portletActionError\", targetWindowId.toString());\n            }\n        }\n\n        sendRedirect(actionRedirectUrl, response);\n    }", "code_tokens": ["@", "RequestMapping", "(", "headers", "=", "{", "\"org.apereo.portal.url.UrlType=ACTION\"", "}", ",", "method", "=", "RequestMethod", ".", "POST", ")", "public", "void", "actionRequest", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "throws", "IOException", "{", "final", "IPortalRequestInfo", "portalRequestInfo", "=", "this", ".", "urlSyntaxProvider", ".", "getPortalRequestInfo", "(", "request", ")", ";", "final", "IPortletRequestInfo", "portletRequestInfo", "=", "portalRequestInfo", ".", "getTargetedPortletRequestInfo", "(", ")", ";", "final", "IPortalUrlBuilder", "actionRedirectUrl", ";", "if", "(", "portletRequestInfo", "!=", "null", ")", "{", "final", "IPortletWindowId", "targetWindowId", "=", "portletRequestInfo", ".", "getPortletWindowId", "(", ")", ";", "actionRedirectUrl", "=", "this", ".", "portalUrlProvider", ".", "getPortalUrlBuilderByPortletWindow", "(", "request", ",", "targetWindowId", ",", "UrlType", ".", "RENDER", ")", ";", "}", "else", "{", "final", "String", "targetedLayoutNodeId", "=", "portalRequestInfo", ".", "getTargetedLayoutNodeId", "(", ")", ";", "if", "(", "targetedLayoutNodeId", "!=", "null", ")", "{", "actionRedirectUrl", "=", "this", ".", "portalUrlProvider", ".", "getPortalUrlBuilderByLayoutNode", "(", "request", ",", "targetedLayoutNodeId", ",", "UrlType", ".", "RENDER", ")", ";", "}", "else", "{", "actionRedirectUrl", "=", "this", ".", "portalUrlProvider", ".", "getDefaultUrl", "(", "request", ")", ";", "}", "}", "// Stuff the action-redirect URL builder into the request so other code can use it during", "// request processing", "this", ".", "portalUrlProvider", ".", "convertToPortalActionUrlBuilder", "(", "request", ",", "actionRedirectUrl", ")", ";", "if", "(", "portletRequestInfo", "!=", "null", ")", "{", "final", "IPortletWindowId", "targetWindowId", "=", "portletRequestInfo", ".", "getPortletWindowId", "(", ")", ";", "try", "{", "this", ".", "portletExecutionManager", ".", "doPortletAction", "(", "targetWindowId", ",", "request", ",", "response", ")", ";", "}", "catch", "(", "RuntimeException", "e", ")", "{", "this", ".", "logger", ".", "error", "(", "\"Exception thrown while executing portlet action for: \"", "+", "portletRequestInfo", ",", "e", ")", ";", "// TODO this should be a constant right?", "actionRedirectUrl", ".", "setParameter", "(", "\"portletActionError\"", ",", "targetWindowId", ".", "toString", "(", ")", ")", ";", "}", "}", "sendRedirect", "(", "actionRedirectUrl", ",", "response", ")", ";", "}"], "docstring": "HTTP POST required for security.", "docstring_tokens": ["HTTP", "POST", "required", "for", "security", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/PortalController.java#L112-L162", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/localization/UserLocaleHelper.java", "func_name": "UserLocaleHelper.getLocales", "original_string": "public List<LocaleBean> getLocales(Locale currentLocale) {\n        List<LocaleBean> locales = new ArrayList<>();\n\n        // get the array of locales available from the portal\n        List<Locale> portalLocales = localeManagerFactory.getPortalLocales();\n        for (Locale locale : portalLocales) {\n            if (currentLocale != null) {\n                // if a current locale is available, display language names\n                // using the current locale\n                locales.add(new LocaleBean(locale, currentLocale));\n            } else {\n                locales.add(new LocaleBean(locale));\n            }\n        }\n        return locales;\n    }", "language": "java", "code": "public List<LocaleBean> getLocales(Locale currentLocale) {\n        List<LocaleBean> locales = new ArrayList<>();\n\n        // get the array of locales available from the portal\n        List<Locale> portalLocales = localeManagerFactory.getPortalLocales();\n        for (Locale locale : portalLocales) {\n            if (currentLocale != null) {\n                // if a current locale is available, display language names\n                // using the current locale\n                locales.add(new LocaleBean(locale, currentLocale));\n            } else {\n                locales.add(new LocaleBean(locale));\n            }\n        }\n        return locales;\n    }", "code_tokens": ["public", "List", "<", "LocaleBean", ">", "getLocales", "(", "Locale", "currentLocale", ")", "{", "List", "<", "LocaleBean", ">", "locales", "=", "new", "ArrayList", "<>", "(", ")", ";", "// get the array of locales available from the portal", "List", "<", "Locale", ">", "portalLocales", "=", "localeManagerFactory", ".", "getPortalLocales", "(", ")", ";", "for", "(", "Locale", "locale", ":", "portalLocales", ")", "{", "if", "(", "currentLocale", "!=", "null", ")", "{", "// if a current locale is available, display language names", "// using the current locale", "locales", ".", "add", "(", "new", "LocaleBean", "(", "locale", ",", "currentLocale", ")", ")", ";", "}", "else", "{", "locales", ".", "add", "(", "new", "LocaleBean", "(", "locale", ")", ")", ";", "}", "}", "return", "locales", ";", "}"], "docstring": "Return a list of LocaleBeans matching the currently available locales for the portal.\n\n@param currentLocale\n@return", "docstring_tokens": ["Return", "a", "list", "of", "LocaleBeans", "matching", "the", "currently", "available", "locales", "for", "the", "portal", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/localization/UserLocaleHelper.java#L77-L92", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/localization/UserLocaleHelper.java", "func_name": "UserLocaleHelper.getCurrentUserLocale", "original_string": "public Locale getCurrentUserLocale(PortletRequest request) {\n        final HttpServletRequest originalPortalRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        IUserInstance ui = userInstanceManager.getUserInstance(originalPortalRequest);\n        IUserPreferencesManager upm = ui.getPreferencesManager();\n        final IUserProfile userProfile = upm.getUserProfile();\n        LocaleManager localeManager = userProfile.getLocaleManager();\n\n        // first check the session locales\n        List<Locale> sessionLocales = localeManager.getSessionLocales();\n        if (sessionLocales != null && sessionLocales.size() > 0) {\n            return sessionLocales.get(0);\n        }\n\n        // if no session locales were found, check the user locales\n        List<Locale> userLocales = localeManager.getUserLocales();\n        if (userLocales != null && userLocales.size() > 0) {\n            return userLocales.get(0);\n        }\n\n        // if no selected locale was found either in the session or user layout,\n        // just return null\n        return null;\n    }", "language": "java", "code": "public Locale getCurrentUserLocale(PortletRequest request) {\n        final HttpServletRequest originalPortalRequest =\n                this.portalRequestUtils.getPortletHttpRequest(request);\n        IUserInstance ui = userInstanceManager.getUserInstance(originalPortalRequest);\n        IUserPreferencesManager upm = ui.getPreferencesManager();\n        final IUserProfile userProfile = upm.getUserProfile();\n        LocaleManager localeManager = userProfile.getLocaleManager();\n\n        // first check the session locales\n        List<Locale> sessionLocales = localeManager.getSessionLocales();\n        if (sessionLocales != null && sessionLocales.size() > 0) {\n            return sessionLocales.get(0);\n        }\n\n        // if no session locales were found, check the user locales\n        List<Locale> userLocales = localeManager.getUserLocales();\n        if (userLocales != null && userLocales.size() > 0) {\n            return userLocales.get(0);\n        }\n\n        // if no selected locale was found either in the session or user layout,\n        // just return null\n        return null;\n    }", "code_tokens": ["public", "Locale", "getCurrentUserLocale", "(", "PortletRequest", "request", ")", "{", "final", "HttpServletRequest", "originalPortalRequest", "=", "this", ".", "portalRequestUtils", ".", "getPortletHttpRequest", "(", "request", ")", ";", "IUserInstance", "ui", "=", "userInstanceManager", ".", "getUserInstance", "(", "originalPortalRequest", ")", ";", "IUserPreferencesManager", "upm", "=", "ui", ".", "getPreferencesManager", "(", ")", ";", "final", "IUserProfile", "userProfile", "=", "upm", ".", "getUserProfile", "(", ")", ";", "LocaleManager", "localeManager", "=", "userProfile", ".", "getLocaleManager", "(", ")", ";", "// first check the session locales", "List", "<", "Locale", ">", "sessionLocales", "=", "localeManager", ".", "getSessionLocales", "(", ")", ";", "if", "(", "sessionLocales", "!=", "null", "&&", "sessionLocales", ".", "size", "(", ")", ">", "0", ")", "{", "return", "sessionLocales", ".", "get", "(", "0", ")", ";", "}", "// if no session locales were found, check the user locales", "List", "<", "Locale", ">", "userLocales", "=", "localeManager", ".", "getUserLocales", "(", ")", ";", "if", "(", "userLocales", "!=", "null", "&&", "userLocales", ".", "size", "(", ")", ">", "0", ")", "{", "return", "userLocales", ".", "get", "(", "0", ")", ";", "}", "// if no selected locale was found either in the session or user layout,", "// just return null", "return", "null", ";", "}"], "docstring": "Return the current user's locale.\n\n@param request The current {@link PortletRequest}\n@return", "docstring_tokens": ["Return", "the", "current", "user", "s", "locale", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/localization/UserLocaleHelper.java#L100-L123", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/localization/UserLocaleHelper.java", "func_name": "UserLocaleHelper.updateUserLocale", "original_string": "public void updateUserLocale(HttpServletRequest request, String localeString) {\n\n        IUserInstance ui = userInstanceManager.getUserInstance(request);\n        IUserPreferencesManager upm = ui.getPreferencesManager();\n        final IUserProfile userProfile = upm.getUserProfile();\n        LocaleManager localeManager = userProfile.getLocaleManager();\n\n        if (localeString != null) {\n\n            // build a new List<Locale> from the specified locale\n            Locale userLocale = localeManagerFactory.parseLocale(localeString);\n            List<Locale> locales = Collections.singletonList(userLocale);\n\n            // set this locale in the session\n            localeManager.setSessionLocales(locales);\n\n            // if the current user is logged in, also update the persisted\n            // user locale\n            final IPerson person = ui.getPerson();\n            if (!person.isGuest()) {\n                try {\n                    localeManager.setUserLocales(Collections.singletonList(userLocale));\n                    localeStore.updateUserLocales(person, new Locale[] {userLocale});\n\n                    // remove person layout framgent from session since it contains some of the data\n                    // in previous\n                    // translation and won't be cleared until next logout-login (applies when using\n                    // RDBMDistributedLayoutStore as user layout store).\n                    person.setAttribute(Constants.PLF, null);\n                    upm.getUserLayoutManager().loadUserLayout(true);\n                } catch (Exception e) {\n                    throw new PortalException(e);\n                }\n            }\n        }\n    }", "language": "java", "code": "public void updateUserLocale(HttpServletRequest request, String localeString) {\n\n        IUserInstance ui = userInstanceManager.getUserInstance(request);\n        IUserPreferencesManager upm = ui.getPreferencesManager();\n        final IUserProfile userProfile = upm.getUserProfile();\n        LocaleManager localeManager = userProfile.getLocaleManager();\n\n        if (localeString != null) {\n\n            // build a new List<Locale> from the specified locale\n            Locale userLocale = localeManagerFactory.parseLocale(localeString);\n            List<Locale> locales = Collections.singletonList(userLocale);\n\n            // set this locale in the session\n            localeManager.setSessionLocales(locales);\n\n            // if the current user is logged in, also update the persisted\n            // user locale\n            final IPerson person = ui.getPerson();\n            if (!person.isGuest()) {\n                try {\n                    localeManager.setUserLocales(Collections.singletonList(userLocale));\n                    localeStore.updateUserLocales(person, new Locale[] {userLocale});\n\n                    // remove person layout framgent from session since it contains some of the data\n                    // in previous\n                    // translation and won't be cleared until next logout-login (applies when using\n                    // RDBMDistributedLayoutStore as user layout store).\n                    person.setAttribute(Constants.PLF, null);\n                    upm.getUserLayoutManager().loadUserLayout(true);\n                } catch (Exception e) {\n                    throw new PortalException(e);\n                }\n            }\n        }\n    }", "code_tokens": ["public", "void", "updateUserLocale", "(", "HttpServletRequest", "request", ",", "String", "localeString", ")", "{", "IUserInstance", "ui", "=", "userInstanceManager", ".", "getUserInstance", "(", "request", ")", ";", "IUserPreferencesManager", "upm", "=", "ui", ".", "getPreferencesManager", "(", ")", ";", "final", "IUserProfile", "userProfile", "=", "upm", ".", "getUserProfile", "(", ")", ";", "LocaleManager", "localeManager", "=", "userProfile", ".", "getLocaleManager", "(", ")", ";", "if", "(", "localeString", "!=", "null", ")", "{", "// build a new List<Locale> from the specified locale", "Locale", "userLocale", "=", "localeManagerFactory", ".", "parseLocale", "(", "localeString", ")", ";", "List", "<", "Locale", ">", "locales", "=", "Collections", ".", "singletonList", "(", "userLocale", ")", ";", "// set this locale in the session", "localeManager", ".", "setSessionLocales", "(", "locales", ")", ";", "// if the current user is logged in, also update the persisted", "// user locale", "final", "IPerson", "person", "=", "ui", ".", "getPerson", "(", ")", ";", "if", "(", "!", "person", ".", "isGuest", "(", ")", ")", "{", "try", "{", "localeManager", ".", "setUserLocales", "(", "Collections", ".", "singletonList", "(", "userLocale", ")", ")", ";", "localeStore", ".", "updateUserLocales", "(", "person", ",", "new", "Locale", "[", "]", "{", "userLocale", "}", ")", ";", "// remove person layout framgent from session since it contains some of the data", "// in previous", "// translation and won't be cleared until next logout-login (applies when using", "// RDBMDistributedLayoutStore as user layout store).", "person", ".", "setAttribute", "(", "Constants", ".", "PLF", ",", "null", ")", ";", "upm", ".", "getUserLayoutManager", "(", ")", ".", "loadUserLayout", "(", "true", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "throw", "new", "PortalException", "(", "e", ")", ";", "}", "}", "}", "}"], "docstring": "Update the current user's locale to match the selected locale. This implementation will\nupdate the session locale, and if the user is not a guest, will also update the locale in the\nuser's persisted preferences.\n\n@param request\n@param localeString", "docstring_tokens": ["Update", "the", "current", "user", "s", "locale", "to", "match", "the", "selected", "locale", ".", "This", "implementation", "will", "update", "the", "session", "locale", "and", "if", "the", "user", "is", "not", "a", "guest", "will", "also", "update", "the", "locale", "in", "the", "user", "s", "persisted", "preferences", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/portlets/localization/UserLocaleHelper.java#L133-L168", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/caching/CacheStatistics.java", "func_name": "CacheStatistics.getLoadExceptionRate", "original_string": "@Override\n    public double getLoadExceptionRate() {\n        long totalLoadCount = loadSuccessCount.get() + loadExceptionCount.get();\n        return (totalLoadCount == 0) ? 0.0 : (double) loadExceptionCount.get() / totalLoadCount;\n    }", "language": "java", "code": "@Override\n    public double getLoadExceptionRate() {\n        long totalLoadCount = loadSuccessCount.get() + loadExceptionCount.get();\n        return (totalLoadCount == 0) ? 0.0 : (double) loadExceptionCount.get() / totalLoadCount;\n    }", "code_tokens": ["@", "Override", "public", "double", "getLoadExceptionRate", "(", ")", "{", "long", "totalLoadCount", "=", "loadSuccessCount", ".", "get", "(", ")", "+", "loadExceptionCount", ".", "get", "(", ")", ";", "return", "(", "totalLoadCount", "==", "0", ")", "?", "0.0", ":", "(", "double", ")", "loadExceptionCount", ".", "get", "(", ")", "/", "totalLoadCount", ";", "}"], "docstring": "Returns the ratio of cache loading attempts which threw exceptions. This is defined as {@code\nloadExceptionCount / (loadSuccessCount + loadExceptionCount)}, or {@code 0.0} when {@code\nloadSuccessCount + loadExceptionCount == 0}.", "docstring_tokens": ["Returns", "the", "ratio", "of", "cache", "loading", "attempts", "which", "threw", "exceptions", ".", "This", "is", "defined", "as", "{"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/concurrency/caching/CacheStatistics.java#L137-L141", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java", "func_name": "TemplateDataTenantOperationsListener.setDataTypeImportOrder", "original_string": "@Autowired\n    public void setDataTypeImportOrder(List<IPortalDataType> dataTypeImportOrder) {\n        final ArrayList<PortalDataKey> dataKeyImportOrder =\n                new ArrayList<>(dataTypeImportOrder.size() * 2);\n\n        for (final IPortalDataType portalDataType : dataTypeImportOrder) {\n            final List<PortalDataKey> supportedDataKeys = portalDataType.getDataKeyImportOrder();\n            for (final PortalDataKey portalDataKey : supportedDataKeys) {\n                /*\n                 * Special Handling:  Need to prevent some keys from entering our\n                 * sorted collection because they attempt to import both a group\n                 * part and the membership parts of a group (either local or PAGS)\n                 * in one go.  We import several entities at once, so it's important\n                 * to do these in 2 phases.\n                 */\n                if (!KEYS_TO_IGNORE.contains(portalDataKey)) {\n                    dataKeyImportOrder.add(portalDataKey);\n                }\n            }\n        }\n        dataKeyImportOrder.trimToSize();\n        this.dataKeyImportOrder = Collections.unmodifiableList(dataKeyImportOrder);\n    }", "language": "java", "code": "@Autowired\n    public void setDataTypeImportOrder(List<IPortalDataType> dataTypeImportOrder) {\n        final ArrayList<PortalDataKey> dataKeyImportOrder =\n                new ArrayList<>(dataTypeImportOrder.size() * 2);\n\n        for (final IPortalDataType portalDataType : dataTypeImportOrder) {\n            final List<PortalDataKey> supportedDataKeys = portalDataType.getDataKeyImportOrder();\n            for (final PortalDataKey portalDataKey : supportedDataKeys) {\n                /*\n                 * Special Handling:  Need to prevent some keys from entering our\n                 * sorted collection because they attempt to import both a group\n                 * part and the membership parts of a group (either local or PAGS)\n                 * in one go.  We import several entities at once, so it's important\n                 * to do these in 2 phases.\n                 */\n                if (!KEYS_TO_IGNORE.contains(portalDataKey)) {\n                    dataKeyImportOrder.add(portalDataKey);\n                }\n            }\n        }\n        dataKeyImportOrder.trimToSize();\n        this.dataKeyImportOrder = Collections.unmodifiableList(dataKeyImportOrder);\n    }", "code_tokens": ["@", "Autowired", "public", "void", "setDataTypeImportOrder", "(", "List", "<", "IPortalDataType", ">", "dataTypeImportOrder", ")", "{", "final", "ArrayList", "<", "PortalDataKey", ">", "dataKeyImportOrder", "=", "new", "ArrayList", "<>", "(", "dataTypeImportOrder", ".", "size", "(", ")", "*", "2", ")", ";", "for", "(", "final", "IPortalDataType", "portalDataType", ":", "dataTypeImportOrder", ")", "{", "final", "List", "<", "PortalDataKey", ">", "supportedDataKeys", "=", "portalDataType", ".", "getDataKeyImportOrder", "(", ")", ";", "for", "(", "final", "PortalDataKey", "portalDataKey", ":", "supportedDataKeys", ")", "{", "/*\n                 * Special Handling:  Need to prevent some keys from entering our\n                 * sorted collection because they attempt to import both a group\n                 * part and the membership parts of a group (either local or PAGS)\n                 * in one go.  We import several entities at once, so it's important\n                 * to do these in 2 phases.\n                 */", "if", "(", "!", "KEYS_TO_IGNORE", ".", "contains", "(", "portalDataKey", ")", ")", "{", "dataKeyImportOrder", ".", "add", "(", "portalDataKey", ")", ";", "}", "}", "}", "dataKeyImportOrder", ".", "trimToSize", "(", ")", ";", "this", ".", "dataKeyImportOrder", "=", "Collections", ".", "unmodifiableList", "(", "dataKeyImportOrder", ")", ";", "}"], "docstring": "The <code>@Autowired</code> list will reflect the order in which data types should be\nimported.", "docstring_tokens": ["The", "<code", ">"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java#L110-L132", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java", "func_name": "TemplateDataTenantOperationsListener.determineImportOnUpdatePaths", "original_string": "static Set<String> determineImportOnUpdatePaths(\n            String templateLoc, Set<String> relResourcePathSet) {\n        String templateLocPath = templateLoc.split(\"\\\\*\")[0]; // up to wildcard pattern\n        if (!templateLocPath.endsWith(\"/\")) {\n            templateLocPath = templateLocPath + \"/\";\n        }\n        final Set<String> fullResourcePathSet = new HashSet<>();\n        for (String resourcePath : relResourcePathSet) {\n            final String fullPath;\n            try {\n                fullPath =\n                        resourcePath.matches(\"^[a-zA-Z]+:.*\")\n                                ? resourcePath\n                                : (new URI(templateLocPath).resolve(resourcePath)).toString();\n            } catch (URISyntaxException e) {\n                throw new RuntimeException(\n                        \"Unable to construct a URI by resolving '\"\n                                + resourcePath\n                                + \"'from '\"\n                                + templateLocPath\n                                + \"'\");\n            }\n            log.debug(\"Calculated full path: {} -> {}\", resourcePath, fullPath);\n            fullResourcePathSet.add(fullPath);\n        }\n        return fullResourcePathSet;\n    }", "language": "java", "code": "static Set<String> determineImportOnUpdatePaths(\n            String templateLoc, Set<String> relResourcePathSet) {\n        String templateLocPath = templateLoc.split(\"\\\\*\")[0]; // up to wildcard pattern\n        if (!templateLocPath.endsWith(\"/\")) {\n            templateLocPath = templateLocPath + \"/\";\n        }\n        final Set<String> fullResourcePathSet = new HashSet<>();\n        for (String resourcePath : relResourcePathSet) {\n            final String fullPath;\n            try {\n                fullPath =\n                        resourcePath.matches(\"^[a-zA-Z]+:.*\")\n                                ? resourcePath\n                                : (new URI(templateLocPath).resolve(resourcePath)).toString();\n            } catch (URISyntaxException e) {\n                throw new RuntimeException(\n                        \"Unable to construct a URI by resolving '\"\n                                + resourcePath\n                                + \"'from '\"\n                                + templateLocPath\n                                + \"'\");\n            }\n            log.debug(\"Calculated full path: {} -> {}\", resourcePath, fullPath);\n            fullResourcePathSet.add(fullPath);\n        }\n        return fullResourcePathSet;\n    }", "code_tokens": ["static", "Set", "<", "String", ">", "determineImportOnUpdatePaths", "(", "String", "templateLoc", ",", "Set", "<", "String", ">", "relResourcePathSet", ")", "{", "String", "templateLocPath", "=", "templateLoc", ".", "split", "(", "\"\\\\*\"", ")", "[", "0", "]", ";", "// up to wildcard pattern", "if", "(", "!", "templateLocPath", ".", "endsWith", "(", "\"/\"", ")", ")", "{", "templateLocPath", "=", "templateLocPath", "+", "\"/\"", ";", "}", "final", "Set", "<", "String", ">", "fullResourcePathSet", "=", "new", "HashSet", "<>", "(", ")", ";", "for", "(", "String", "resourcePath", ":", "relResourcePathSet", ")", "{", "final", "String", "fullPath", ";", "try", "{", "fullPath", "=", "resourcePath", ".", "matches", "(", "\"^[a-zA-Z]+:.*\"", ")", "?", "resourcePath", ":", "(", "new", "URI", "(", "templateLocPath", ")", ".", "resolve", "(", "resourcePath", ")", ")", ".", "toString", "(", ")", ";", "}", "catch", "(", "URISyntaxException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Unable to construct a URI by resolving '\"", "+", "resourcePath", "+", "\"'from '\"", "+", "templateLocPath", "+", "\"'\"", ")", ";", "}", "log", ".", "debug", "(", "\"Calculated full path: {} -> {}\"", ",", "resourcePath", ",", "fullPath", ")", ";", "fullResourcePathSet", ".", "add", "(", "fullPath", ")", ";", "}", "return", "fullResourcePathSet", ";", "}"], "docstring": "/*package", "docstring_tokens": ["/", "*", "package"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java#L150-L176", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java", "func_name": "TemplateDataTenantOperationsListener.buildResourcesFromPaths", "original_string": "static Set<Resource> buildResourcesFromPaths(\n            ResourceLoader resourceLoader, Set<String> resourcePaths) {\n        final Set<Resource> resourceSet = new HashSet<>();\n        for (String resourcePath : resourcePaths) {\n            Resource resource = resourceLoader.getResource(resourcePath);\n            log.debug(\"Resource {} exists?: {}\", resource, resource.exists());\n            resourceSet.add(resource);\n        }\n        return resourceSet;\n    }", "language": "java", "code": "static Set<Resource> buildResourcesFromPaths(\n            ResourceLoader resourceLoader, Set<String> resourcePaths) {\n        final Set<Resource> resourceSet = new HashSet<>();\n        for (String resourcePath : resourcePaths) {\n            Resource resource = resourceLoader.getResource(resourcePath);\n            log.debug(\"Resource {} exists?: {}\", resource, resource.exists());\n            resourceSet.add(resource);\n        }\n        return resourceSet;\n    }", "code_tokens": ["static", "Set", "<", "Resource", ">", "buildResourcesFromPaths", "(", "ResourceLoader", "resourceLoader", ",", "Set", "<", "String", ">", "resourcePaths", ")", "{", "final", "Set", "<", "Resource", ">", "resourceSet", "=", "new", "HashSet", "<>", "(", ")", ";", "for", "(", "String", "resourcePath", ":", "resourcePaths", ")", "{", "Resource", "resource", "=", "resourceLoader", ".", "getResource", "(", "resourcePath", ")", ";", "log", ".", "debug", "(", "\"Resource {} exists?: {}\"", ",", "resource", ",", "resource", ".", "exists", "(", ")", ")", ";", "resourceSet", ".", "add", "(", "resource", ")", ";", "}", "return", "resourceSet", ";", "}"], "docstring": "/*package", "docstring_tokens": ["/", "*", "package"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java#L186-L195", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java", "func_name": "TemplateDataTenantOperationsListener.importWithResources", "original_string": "public TenantOperationResponse importWithResources(\n            final ITenant tenant, final Set<Resource> resources) {\n        /*\n         * First load dom4j Documents and sort the entity files into the proper order\n         */\n        final Map<PortalDataKey, Set<BucketTuple>> importQueue;\n        try {\n            importQueue = prepareImportQueue(tenant, resources);\n        } catch (Exception e) {\n            final TenantOperationResponse error =\n                    new TenantOperationResponse(this, TenantOperationResponse.Result.ABORT);\n            error.addMessage(\n                    createLocalizedMessage(\n                            FAILED_TO_LOAD_TENANT_TEMPLATE, new String[] {tenant.getName()}));\n            return error;\n        }\n\n        log.trace(\n                \"Ready to import data entity templates for new tenant '{}';  importQueue={}\",\n                tenant.getName(),\n                importQueue);\n\n        // We're going to report on every item imported;  TODO it would be better\n        // if we could display human-friendly entity type name + sysid (fname, etc.)\n        final StringBuilder importReport = new StringBuilder();\n\n        /*\n         * Now import the identified entities each bucket in turn\n         */\n        try {\n            importQueue(tenant, importQueue, importReport);\n        } catch (Exception e) {\n            final TenantOperationResponse error =\n                    new TenantOperationResponse(this, TenantOperationResponse.Result.ABORT);\n            error.addMessage(finalizeImportReport(importReport));\n            error.addMessage(\n                    createLocalizedMessage(\n                            FAILED_TO_IMPORT_TENANT_TEMPLATE_DATA,\n                            new String[] {tenant.getName()}));\n            return error;\n        }\n\n        TenantOperationResponse rslt =\n                new TenantOperationResponse(this, TenantOperationResponse.Result.SUCCESS);\n        rslt.addMessage(finalizeImportReport(importReport));\n        rslt.addMessage(\n                createLocalizedMessage(TENANT_ENTITIES_IMPORTED, new String[] {tenant.getName()}));\n        return rslt;\n    }", "language": "java", "code": "public TenantOperationResponse importWithResources(\n            final ITenant tenant, final Set<Resource> resources) {\n        /*\n         * First load dom4j Documents and sort the entity files into the proper order\n         */\n        final Map<PortalDataKey, Set<BucketTuple>> importQueue;\n        try {\n            importQueue = prepareImportQueue(tenant, resources);\n        } catch (Exception e) {\n            final TenantOperationResponse error =\n                    new TenantOperationResponse(this, TenantOperationResponse.Result.ABORT);\n            error.addMessage(\n                    createLocalizedMessage(\n                            FAILED_TO_LOAD_TENANT_TEMPLATE, new String[] {tenant.getName()}));\n            return error;\n        }\n\n        log.trace(\n                \"Ready to import data entity templates for new tenant '{}';  importQueue={}\",\n                tenant.getName(),\n                importQueue);\n\n        // We're going to report on every item imported;  TODO it would be better\n        // if we could display human-friendly entity type name + sysid (fname, etc.)\n        final StringBuilder importReport = new StringBuilder();\n\n        /*\n         * Now import the identified entities each bucket in turn\n         */\n        try {\n            importQueue(tenant, importQueue, importReport);\n        } catch (Exception e) {\n            final TenantOperationResponse error =\n                    new TenantOperationResponse(this, TenantOperationResponse.Result.ABORT);\n            error.addMessage(finalizeImportReport(importReport));\n            error.addMessage(\n                    createLocalizedMessage(\n                            FAILED_TO_IMPORT_TENANT_TEMPLATE_DATA,\n                            new String[] {tenant.getName()}));\n            return error;\n        }\n\n        TenantOperationResponse rslt =\n                new TenantOperationResponse(this, TenantOperationResponse.Result.SUCCESS);\n        rslt.addMessage(finalizeImportReport(importReport));\n        rslt.addMessage(\n                createLocalizedMessage(TENANT_ENTITIES_IMPORTED, new String[] {tenant.getName()}));\n        return rslt;\n    }", "code_tokens": ["public", "TenantOperationResponse", "importWithResources", "(", "final", "ITenant", "tenant", ",", "final", "Set", "<", "Resource", ">", "resources", ")", "{", "/*\n         * First load dom4j Documents and sort the entity files into the proper order\n         */", "final", "Map", "<", "PortalDataKey", ",", "Set", "<", "BucketTuple", ">", ">", "importQueue", ";", "try", "{", "importQueue", "=", "prepareImportQueue", "(", "tenant", ",", "resources", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "final", "TenantOperationResponse", "error", "=", "new", "TenantOperationResponse", "(", "this", ",", "TenantOperationResponse", ".", "Result", ".", "ABORT", ")", ";", "error", ".", "addMessage", "(", "createLocalizedMessage", "(", "FAILED_TO_LOAD_TENANT_TEMPLATE", ",", "new", "String", "[", "]", "{", "tenant", ".", "getName", "(", ")", "}", ")", ")", ";", "return", "error", ";", "}", "log", ".", "trace", "(", "\"Ready to import data entity templates for new tenant '{}';  importQueue={}\"", ",", "tenant", ".", "getName", "(", ")", ",", "importQueue", ")", ";", "// We're going to report on every item imported;  TODO it would be better", "// if we could display human-friendly entity type name + sysid (fname, etc.)", "final", "StringBuilder", "importReport", "=", "new", "StringBuilder", "(", ")", ";", "/*\n         * Now import the identified entities each bucket in turn\n         */", "try", "{", "importQueue", "(", "tenant", ",", "importQueue", ",", "importReport", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "final", "TenantOperationResponse", "error", "=", "new", "TenantOperationResponse", "(", "this", ",", "TenantOperationResponse", ".", "Result", ".", "ABORT", ")", ";", "error", ".", "addMessage", "(", "finalizeImportReport", "(", "importReport", ")", ")", ";", "error", ".", "addMessage", "(", "createLocalizedMessage", "(", "FAILED_TO_IMPORT_TENANT_TEMPLATE_DATA", ",", "new", "String", "[", "]", "{", "tenant", ".", "getName", "(", ")", "}", ")", ")", ";", "return", "error", ";", "}", "TenantOperationResponse", "rslt", "=", "new", "TenantOperationResponse", "(", "this", ",", "TenantOperationResponse", ".", "Result", ".", "SUCCESS", ")", ";", "rslt", ".", "addMessage", "(", "finalizeImportReport", "(", "importReport", ")", ")", ";", "rslt", ".", "addMessage", "(", "createLocalizedMessage", "(", "TENANT_ENTITIES_IMPORTED", ",", "new", "String", "[", "]", "{", "tenant", ".", "getName", "(", ")", "}", ")", ")", ";", "return", "rslt", ";", "}"], "docstring": "High-level implementation method that brokers the queuing, importing, and reporting that is\ncommon to Create and Update.", "docstring_tokens": ["High", "-", "level", "implementation", "method", "that", "brokers", "the", "queuing", "importing", "and", "reporting", "that", "is", "common", "to", "Create", "and", "Update", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java#L319-L367", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java", "func_name": "TemplateDataTenantOperationsListener.prepareImportQueue", "original_string": "private Map<PortalDataKey, Set<BucketTuple>> prepareImportQueue(\n            final ITenant tenant, final Set<Resource> templates) throws Exception {\n        final Map<PortalDataKey, Set<BucketTuple>> rslt = new HashMap<>();\n        Resource rsc = null;\n        try {\n            for (Resource r : templates) {\n                rsc = r;\n                if (log.isDebugEnabled()) {\n                    log.debug(\n                            \"Loading template resource file for tenant \"\n                                    + \"'\"\n                                    + tenant.getFname()\n                                    + \"':  \"\n                                    + rsc.getFilename());\n                }\n                final Document doc = reader.read(rsc.getInputStream());\n                PortalDataKey atLeastOneMatchingDataKey = null;\n                for (PortalDataKey pdk : dataKeyImportOrder) {\n                    boolean matches = evaluatePortalDataKeyMatch(doc, pdk);\n                    if (matches) {\n                        // Found the right bucket...\n                        log.debug(\"Found PortalDataKey '{}' for data document {}\", pdk, r.getURI());\n                        atLeastOneMatchingDataKey = pdk;\n                        Set<BucketTuple> bucket = rslt.get(atLeastOneMatchingDataKey);\n                        if (bucket == null) {\n                            // First of these we've seen;  create the bucket;\n                            bucket = new HashSet<>();\n                            rslt.put(atLeastOneMatchingDataKey, bucket);\n                        }\n                        BucketTuple tuple = new BucketTuple(rsc, doc);\n                        bucket.add(tuple);\n                        /*\n                         * At this point, we would normally add a break;\n                         * statement, but group_membership.xml files need to\n                         * match more than one PortalDataKey.\n                         */\n                    }\n                }\n                if (atLeastOneMatchingDataKey == null) {\n                    // We can't proceed\n                    throw new RuntimeException(\n                            \"No PortalDataKey found for QName:  \"\n                                    + doc.getRootElement().getQName());\n                }\n            }\n        } catch (Exception e) {\n            log.error(\n                    \"Failed to process the specified template:  {}\",\n                    (rsc != null ? rsc.getFilename() : \"null\"),\n                    e);\n            throw e;\n        }\n        return rslt;\n    }", "language": "java", "code": "private Map<PortalDataKey, Set<BucketTuple>> prepareImportQueue(\n            final ITenant tenant, final Set<Resource> templates) throws Exception {\n        final Map<PortalDataKey, Set<BucketTuple>> rslt = new HashMap<>();\n        Resource rsc = null;\n        try {\n            for (Resource r : templates) {\n                rsc = r;\n                if (log.isDebugEnabled()) {\n                    log.debug(\n                            \"Loading template resource file for tenant \"\n                                    + \"'\"\n                                    + tenant.getFname()\n                                    + \"':  \"\n                                    + rsc.getFilename());\n                }\n                final Document doc = reader.read(rsc.getInputStream());\n                PortalDataKey atLeastOneMatchingDataKey = null;\n                for (PortalDataKey pdk : dataKeyImportOrder) {\n                    boolean matches = evaluatePortalDataKeyMatch(doc, pdk);\n                    if (matches) {\n                        // Found the right bucket...\n                        log.debug(\"Found PortalDataKey '{}' for data document {}\", pdk, r.getURI());\n                        atLeastOneMatchingDataKey = pdk;\n                        Set<BucketTuple> bucket = rslt.get(atLeastOneMatchingDataKey);\n                        if (bucket == null) {\n                            // First of these we've seen;  create the bucket;\n                            bucket = new HashSet<>();\n                            rslt.put(atLeastOneMatchingDataKey, bucket);\n                        }\n                        BucketTuple tuple = new BucketTuple(rsc, doc);\n                        bucket.add(tuple);\n                        /*\n                         * At this point, we would normally add a break;\n                         * statement, but group_membership.xml files need to\n                         * match more than one PortalDataKey.\n                         */\n                    }\n                }\n                if (atLeastOneMatchingDataKey == null) {\n                    // We can't proceed\n                    throw new RuntimeException(\n                            \"No PortalDataKey found for QName:  \"\n                                    + doc.getRootElement().getQName());\n                }\n            }\n        } catch (Exception e) {\n            log.error(\n                    \"Failed to process the specified template:  {}\",\n                    (rsc != null ? rsc.getFilename() : \"null\"),\n                    e);\n            throw e;\n        }\n        return rslt;\n    }", "code_tokens": ["private", "Map", "<", "PortalDataKey", ",", "Set", "<", "BucketTuple", ">", ">", "prepareImportQueue", "(", "final", "ITenant", "tenant", ",", "final", "Set", "<", "Resource", ">", "templates", ")", "throws", "Exception", "{", "final", "Map", "<", "PortalDataKey", ",", "Set", "<", "BucketTuple", ">", ">", "rslt", "=", "new", "HashMap", "<>", "(", ")", ";", "Resource", "rsc", "=", "null", ";", "try", "{", "for", "(", "Resource", "r", ":", "templates", ")", "{", "rsc", "=", "r", ";", "if", "(", "log", ".", "isDebugEnabled", "(", ")", ")", "{", "log", ".", "debug", "(", "\"Loading template resource file for tenant \"", "+", "\"'\"", "+", "tenant", ".", "getFname", "(", ")", "+", "\"':  \"", "+", "rsc", ".", "getFilename", "(", ")", ")", ";", "}", "final", "Document", "doc", "=", "reader", ".", "read", "(", "rsc", ".", "getInputStream", "(", ")", ")", ";", "PortalDataKey", "atLeastOneMatchingDataKey", "=", "null", ";", "for", "(", "PortalDataKey", "pdk", ":", "dataKeyImportOrder", ")", "{", "boolean", "matches", "=", "evaluatePortalDataKeyMatch", "(", "doc", ",", "pdk", ")", ";", "if", "(", "matches", ")", "{", "// Found the right bucket...", "log", ".", "debug", "(", "\"Found PortalDataKey '{}' for data document {}\"", ",", "pdk", ",", "r", ".", "getURI", "(", ")", ")", ";", "atLeastOneMatchingDataKey", "=", "pdk", ";", "Set", "<", "BucketTuple", ">", "bucket", "=", "rslt", ".", "get", "(", "atLeastOneMatchingDataKey", ")", ";", "if", "(", "bucket", "==", "null", ")", "{", "// First of these we've seen;  create the bucket;", "bucket", "=", "new", "HashSet", "<>", "(", ")", ";", "rslt", ".", "put", "(", "atLeastOneMatchingDataKey", ",", "bucket", ")", ";", "}", "BucketTuple", "tuple", "=", "new", "BucketTuple", "(", "rsc", ",", "doc", ")", ";", "bucket", ".", "add", "(", "tuple", ")", ";", "/*\n                         * At this point, we would normally add a break;\n                         * statement, but group_membership.xml files need to\n                         * match more than one PortalDataKey.\n                         */", "}", "}", "if", "(", "atLeastOneMatchingDataKey", "==", "null", ")", "{", "// We can't proceed", "throw", "new", "RuntimeException", "(", "\"No PortalDataKey found for QName:  \"", "+", "doc", ".", "getRootElement", "(", ")", ".", "getQName", "(", ")", ")", ";", "}", "}", "}", "catch", "(", "Exception", "e", ")", "{", "log", ".", "error", "(", "\"Failed to process the specified template:  {}\"", ",", "(", "rsc", "!=", "null", "?", "rsc", ".", "getFilename", "(", ")", ":", "\"null\"", ")", ",", "e", ")", ";", "throw", "e", ";", "}", "return", "rslt", ";", "}"], "docstring": "Loads dom4j Documents and sorts the entity files into the proper order for Import.", "docstring_tokens": ["Loads", "dom4j", "Documents", "and", "sorts", "the", "entity", "files", "into", "the", "proper", "order", "for", "Import", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java#L370-L423", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java", "func_name": "TemplateDataTenantOperationsListener.importQueue", "original_string": "private void importQueue(\n            final ITenant tenant,\n            final Map<PortalDataKey, Set<BucketTuple>> queue,\n            final StringBuilder importReport)\n            throws Exception {\n\n        final StandardEvaluationContext ctx = new StandardEvaluationContext();\n        ctx.setRootObject(new RootObjectImpl(tenant));\n        IDataTemplatingStrategy templating = new SpELDataTemplatingStrategy(portalSpELService, ctx);\n        Document doc = null;\n        try {\n            for (PortalDataKey pdk : dataKeyImportOrder) {\n                Set<BucketTuple> bucket = queue.get(pdk);\n                if (bucket != null) {\n                    log.debug(\n                            \"Importing the specified PortalDataKey tenant '{}':  {}\",\n                            tenant.getName(),\n                            pdk.getName());\n                    for (BucketTuple tuple : bucket) {\n                        doc = tuple.getDocument();\n                        Source data =\n                                templating.processTemplates(\n                                        doc, tuple.getResource().getURL().toString());\n                        dataHandlerService.importData(data, pdk);\n                        importReport.append(createImportReportLineItem(pdk, tuple));\n                    }\n                }\n            }\n\n        } catch (Exception e) {\n            log.error(\n                    \"Failed to process the specified template document:\\n{}\",\n                    (doc != null ? doc.asXML() : \"null\"),\n                    e);\n            throw e;\n        }\n    }", "language": "java", "code": "private void importQueue(\n            final ITenant tenant,\n            final Map<PortalDataKey, Set<BucketTuple>> queue,\n            final StringBuilder importReport)\n            throws Exception {\n\n        final StandardEvaluationContext ctx = new StandardEvaluationContext();\n        ctx.setRootObject(new RootObjectImpl(tenant));\n        IDataTemplatingStrategy templating = new SpELDataTemplatingStrategy(portalSpELService, ctx);\n        Document doc = null;\n        try {\n            for (PortalDataKey pdk : dataKeyImportOrder) {\n                Set<BucketTuple> bucket = queue.get(pdk);\n                if (bucket != null) {\n                    log.debug(\n                            \"Importing the specified PortalDataKey tenant '{}':  {}\",\n                            tenant.getName(),\n                            pdk.getName());\n                    for (BucketTuple tuple : bucket) {\n                        doc = tuple.getDocument();\n                        Source data =\n                                templating.processTemplates(\n                                        doc, tuple.getResource().getURL().toString());\n                        dataHandlerService.importData(data, pdk);\n                        importReport.append(createImportReportLineItem(pdk, tuple));\n                    }\n                }\n            }\n\n        } catch (Exception e) {\n            log.error(\n                    \"Failed to process the specified template document:\\n{}\",\n                    (doc != null ? doc.asXML() : \"null\"),\n                    e);\n            throw e;\n        }\n    }", "code_tokens": ["private", "void", "importQueue", "(", "final", "ITenant", "tenant", ",", "final", "Map", "<", "PortalDataKey", ",", "Set", "<", "BucketTuple", ">", ">", "queue", ",", "final", "StringBuilder", "importReport", ")", "throws", "Exception", "{", "final", "StandardEvaluationContext", "ctx", "=", "new", "StandardEvaluationContext", "(", ")", ";", "ctx", ".", "setRootObject", "(", "new", "RootObjectImpl", "(", "tenant", ")", ")", ";", "IDataTemplatingStrategy", "templating", "=", "new", "SpELDataTemplatingStrategy", "(", "portalSpELService", ",", "ctx", ")", ";", "Document", "doc", "=", "null", ";", "try", "{", "for", "(", "PortalDataKey", "pdk", ":", "dataKeyImportOrder", ")", "{", "Set", "<", "BucketTuple", ">", "bucket", "=", "queue", ".", "get", "(", "pdk", ")", ";", "if", "(", "bucket", "!=", "null", ")", "{", "log", ".", "debug", "(", "\"Importing the specified PortalDataKey tenant '{}':  {}\"", ",", "tenant", ".", "getName", "(", ")", ",", "pdk", ".", "getName", "(", ")", ")", ";", "for", "(", "BucketTuple", "tuple", ":", "bucket", ")", "{", "doc", "=", "tuple", ".", "getDocument", "(", ")", ";", "Source", "data", "=", "templating", ".", "processTemplates", "(", "doc", ",", "tuple", ".", "getResource", "(", ")", ".", "getURL", "(", ")", ".", "toString", "(", ")", ")", ";", "dataHandlerService", ".", "importData", "(", "data", ",", "pdk", ")", ";", "importReport", ".", "append", "(", "createImportReportLineItem", "(", "pdk", ",", "tuple", ")", ")", ";", "}", "}", "}", "}", "catch", "(", "Exception", "e", ")", "{", "log", ".", "error", "(", "\"Failed to process the specified template document:\\n{}\"", ",", "(", "doc", "!=", "null", "?", "doc", ".", "asXML", "(", ")", ":", "\"null\"", ")", ",", "e", ")", ";", "throw", "e", ";", "}", "}"], "docstring": "Imports the specified entities in the proper order.", "docstring_tokens": ["Imports", "the", "specified", "entities", "in", "the", "proper", "order", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-tenants/src/main/java/org/apereo/portal/tenants/TemplateDataTenantOperationsListener.java#L426-L462", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/PortletRenderingInitiationStAXComponent.java", "func_name": "PortletRenderingInitiationStAXComponent.getCacheKey", "original_string": "@Override\n    public CacheKey getCacheKey(HttpServletRequest request, HttpServletResponse response) {\n        // Initiating rendering of portlets will change the stream at all\n        return this.wrappedComponent.getCacheKey(request, response);\n    }", "language": "java", "code": "@Override\n    public CacheKey getCacheKey(HttpServletRequest request, HttpServletResponse response) {\n        // Initiating rendering of portlets will change the stream at all\n        return this.wrappedComponent.getCacheKey(request, response);\n    }", "code_tokens": ["@", "Override", "public", "CacheKey", "getCacheKey", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "// Initiating rendering of portlets will change the stream at all", "return", "this", ".", "wrappedComponent", ".", "getCacheKey", "(", "request", ",", "response", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.PipelineComponent#getCacheKey(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/PortletRenderingInitiationStAXComponent.java#L59-L63", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-rendering/src/main/java/org/apereo/portal/rendering/PortletRenderingInitiationStAXComponent.java", "func_name": "PortletRenderingInitiationStAXComponent.getEventReader", "original_string": "@Override\n    public PipelineEventReader<XMLEventReader, XMLEvent> getEventReader(\n            HttpServletRequest request, HttpServletResponse response) {\n        final PipelineEventReader<XMLEventReader, XMLEvent> pipelineEventReader =\n                this.wrappedComponent.getEventReader(request, response);\n\n        final XMLEventReader eventReader = pipelineEventReader.getEventReader();\n        final PortletRenderingXMLEventReader filteredEventReader =\n                new PortletRenderingXMLEventReader(request, response, eventReader);\n\n        final Map<String, String> outputProperties = pipelineEventReader.getOutputProperties();\n        return new PipelineEventReaderImpl<XMLEventReader, XMLEvent>(\n                filteredEventReader, outputProperties);\n    }", "language": "java", "code": "@Override\n    public PipelineEventReader<XMLEventReader, XMLEvent> getEventReader(\n            HttpServletRequest request, HttpServletResponse response) {\n        final PipelineEventReader<XMLEventReader, XMLEvent> pipelineEventReader =\n                this.wrappedComponent.getEventReader(request, response);\n\n        final XMLEventReader eventReader = pipelineEventReader.getEventReader();\n        final PortletRenderingXMLEventReader filteredEventReader =\n                new PortletRenderingXMLEventReader(request, response, eventReader);\n\n        final Map<String, String> outputProperties = pipelineEventReader.getOutputProperties();\n        return new PipelineEventReaderImpl<XMLEventReader, XMLEvent>(\n                filteredEventReader, outputProperties);\n    }", "code_tokens": ["@", "Override", "public", "PipelineEventReader", "<", "XMLEventReader", ",", "XMLEvent", ">", "getEventReader", "(", "HttpServletRequest", "request", ",", "HttpServletResponse", "response", ")", "{", "final", "PipelineEventReader", "<", "XMLEventReader", ",", "XMLEvent", ">", "pipelineEventReader", "=", "this", ".", "wrappedComponent", ".", "getEventReader", "(", "request", ",", "response", ")", ";", "final", "XMLEventReader", "eventReader", "=", "pipelineEventReader", ".", "getEventReader", "(", ")", ";", "final", "PortletRenderingXMLEventReader", "filteredEventReader", "=", "new", "PortletRenderingXMLEventReader", "(", "request", ",", "response", ",", "eventReader", ")", ";", "final", "Map", "<", "String", ",", "String", ">", "outputProperties", "=", "pipelineEventReader", ".", "getOutputProperties", "(", ")", ";", "return", "new", "PipelineEventReaderImpl", "<", "XMLEventReader", ",", "XMLEvent", ">", "(", "filteredEventReader", ",", "outputProperties", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.rendering.PipelineComponent#getEventReader(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-rendering/src/main/java/org/apereo/portal/rendering/PortletRenderingInitiationStAXComponent.java#L68-L81", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-xslt/src/main/java/org/apereo/portal/security/xslt/XalanLayoutElementTitleHelper.java", "func_name": "XalanLayoutElementTitleHelper.getTitle", "original_string": "public static String getTitle(String id, String language, String name) {\n        if (id != null && id.startsWith(Constants.FRAGMENT_ID_USER_PREFIX)) {\n            final Locale locale = localeManagerFactory.parseLocale(language);\n            return messageSource.getMessage(name, new Object[] {}, name, locale);\n        }\n        return name;\n    }", "language": "java", "code": "public static String getTitle(String id, String language, String name) {\n        if (id != null && id.startsWith(Constants.FRAGMENT_ID_USER_PREFIX)) {\n            final Locale locale = localeManagerFactory.parseLocale(language);\n            return messageSource.getMessage(name, new Object[] {}, name, locale);\n        }\n        return name;\n    }", "code_tokens": ["public", "static", "String", "getTitle", "(", "String", "id", ",", "String", "language", ",", "String", "name", ")", "{", "if", "(", "id", "!=", "null", "&&", "id", ".", "startsWith", "(", "Constants", ".", "FRAGMENT_ID_USER_PREFIX", ")", ")", "{", "final", "Locale", "locale", "=", "localeManagerFactory", ".", "parseLocale", "(", "language", ")", ";", "return", "messageSource", ".", "getMessage", "(", "name", ",", "new", "Object", "[", "]", "{", "}", ",", "name", ",", "locale", ")", ";", "}", "return", "name", ";", "}"], "docstring": "This method checks whether id indicates that it is a layout owner's structure element (or at\nleast derived from it). If it is the case, then it asks {@link MessageSource} to resolve the\nmessage using layout element's name. Otherwise it returns the name. Note that layout owner's\nelement identifier format is 'uXlYnZ' where X stands for layout owners id, Y stands for\nlayout id, and Z stands for element (node) identifier, hence identifiers that start with 'u'\nare considered as derived from layout owner.\n\n@param id - layout structure element's identifier.\n@param language - locale identifier.\n@param name - default layout strucute element's name.\n@return localized title in case of layout owner's element or default name otherwise.", "docstring_tokens": ["This", "method", "checks", "whether", "id", "indicates", "that", "it", "is", "a", "layout", "owner", "s", "structure", "element", "(", "or", "at", "least", "derived", "from", "it", ")", ".", "If", "it", "is", "the", "case", "then", "it", "asks", "{", "@link", "MessageSource", "}", "to", "resolve", "the", "message", "using", "layout", "element", "s", "name", ".", "Otherwise", "it", "returns", "the", "name", ".", "Note", "that", "layout", "owner", "s", "element", "identifier", "format", "is", "uXlYnZ", "where", "X", "stands", "for", "layout", "owners", "id", "Y", "stands", "for", "layout", "id", "and", "Z", "stands", "for", "element", "(", "node", ")", "identifier", "hence", "identifiers", "that", "start", "with", "u", "are", "considered", "as", "derived", "from", "layout", "owner", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-xslt/src/main/java/org/apereo/portal/security/xslt/XalanLayoutElementTitleHelper.java#L57-L63", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-security/uPortal-security-core/src/main/java/org/apereo/portal/security/ThreadNamingRequestFilter.java", "func_name": "ThreadNamingRequestFilter.updateCurrentUsername", "original_string": "public void updateCurrentUsername(String newUsername) {\n        final String originalThreadName = originalThreadNameLocal.get();\n        if (originalThreadName != null && newUsername != null) {\n            final Thread currentThread = Thread.currentThread();\n            final String threadName = getThreadName(originalThreadName, newUsername);\n            currentThread.setName(threadName);\n        }\n    }", "language": "java", "code": "public void updateCurrentUsername(String newUsername) {\n        final String originalThreadName = originalThreadNameLocal.get();\n        if (originalThreadName != null && newUsername != null) {\n            final Thread currentThread = Thread.currentThread();\n            final String threadName = getThreadName(originalThreadName, newUsername);\n            currentThread.setName(threadName);\n        }\n    }", "code_tokens": ["public", "void", "updateCurrentUsername", "(", "String", "newUsername", ")", "{", "final", "String", "originalThreadName", "=", "originalThreadNameLocal", ".", "get", "(", ")", ";", "if", "(", "originalThreadName", "!=", "null", "&&", "newUsername", "!=", "null", ")", "{", "final", "Thread", "currentThread", "=", "Thread", ".", "currentThread", "(", ")", ";", "final", "String", "threadName", "=", "getThreadName", "(", "originalThreadName", ",", "newUsername", ")", ";", "currentThread", ".", "setName", "(", "threadName", ")", ";", "}", "}"], "docstring": "Update the thread name to use the specified username. Useful for authentication requests\nwhere the username changes mid-request", "docstring_tokens": ["Update", "the", "thread", "name", "to", "use", "the", "specified", "username", ".", "Useful", "for", "authentication", "requests", "where", "the", "username", "changes", "mid", "-", "request"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-security/uPortal-security-core/src/main/java/org/apereo/portal/security/ThreadNamingRequestFilter.java#L41-L48", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-platform-impl/src/main/java/org/apereo/portal/api/groups/EntityService.java", "func_name": "EntityService.search", "original_string": "public Set<Entity> search(String entityType, String searchTerm) {\n        if (StringUtils.isBlank(entityType) && StringUtils.isBlank(searchTerm)) {\n            return null;\n        }\n        Set<Entity> results = new HashSet<Entity>();\n        EntityEnum entityEnum = EntityEnum.getEntityEnum(entityType);\n        EntityIdentifier[] identifiers;\n        Class<?> identifierType;\n\n        // if the entity type is a group, use the group service's findGroup method\n        // to locate it\n        if (entityEnum.isGroup()) {\n            identifiers =\n                    GroupService.searchForGroups(\n                            searchTerm,\n                            GroupService.SearchMethod.CONTAINS_CI,\n                            entityEnum.getClazz());\n            identifierType = IEntityGroup.class;\n        }\n        // otherwise use the getGroupMember method\n        else {\n            identifiers =\n                    GroupService.searchForEntities(\n                            searchTerm,\n                            GroupService.SearchMethod.CONTAINS_CI,\n                            entityEnum.getClazz());\n            identifierType = entityEnum.getClazz();\n        }\n\n        for (EntityIdentifier entityIdentifier : identifiers) {\n            if (entityIdentifier.getType().equals(identifierType)) {\n                IGroupMember groupMember = GroupService.getGroupMember(entityIdentifier);\n                Entity entity = getEntity(groupMember);\n                results.add(entity);\n            }\n        }\n\n        return results;\n    }", "language": "java", "code": "public Set<Entity> search(String entityType, String searchTerm) {\n        if (StringUtils.isBlank(entityType) && StringUtils.isBlank(searchTerm)) {\n            return null;\n        }\n        Set<Entity> results = new HashSet<Entity>();\n        EntityEnum entityEnum = EntityEnum.getEntityEnum(entityType);\n        EntityIdentifier[] identifiers;\n        Class<?> identifierType;\n\n        // if the entity type is a group, use the group service's findGroup method\n        // to locate it\n        if (entityEnum.isGroup()) {\n            identifiers =\n                    GroupService.searchForGroups(\n                            searchTerm,\n                            GroupService.SearchMethod.CONTAINS_CI,\n                            entityEnum.getClazz());\n            identifierType = IEntityGroup.class;\n        }\n        // otherwise use the getGroupMember method\n        else {\n            identifiers =\n                    GroupService.searchForEntities(\n                            searchTerm,\n                            GroupService.SearchMethod.CONTAINS_CI,\n                            entityEnum.getClazz());\n            identifierType = entityEnum.getClazz();\n        }\n\n        for (EntityIdentifier entityIdentifier : identifiers) {\n            if (entityIdentifier.getType().equals(identifierType)) {\n                IGroupMember groupMember = GroupService.getGroupMember(entityIdentifier);\n                Entity entity = getEntity(groupMember);\n                results.add(entity);\n            }\n        }\n\n        return results;\n    }", "code_tokens": ["public", "Set", "<", "Entity", ">", "search", "(", "String", "entityType", ",", "String", "searchTerm", ")", "{", "if", "(", "StringUtils", ".", "isBlank", "(", "entityType", ")", "&&", "StringUtils", ".", "isBlank", "(", "searchTerm", ")", ")", "{", "return", "null", ";", "}", "Set", "<", "Entity", ">", "results", "=", "new", "HashSet", "<", "Entity", ">", "(", ")", ";", "EntityEnum", "entityEnum", "=", "EntityEnum", ".", "getEntityEnum", "(", "entityType", ")", ";", "EntityIdentifier", "[", "]", "identifiers", ";", "Class", "<", "?", ">", "identifierType", ";", "// if the entity type is a group, use the group service's findGroup method", "// to locate it", "if", "(", "entityEnum", ".", "isGroup", "(", ")", ")", "{", "identifiers", "=", "GroupService", ".", "searchForGroups", "(", "searchTerm", ",", "GroupService", ".", "SearchMethod", ".", "CONTAINS_CI", ",", "entityEnum", ".", "getClazz", "(", ")", ")", ";", "identifierType", "=", "IEntityGroup", ".", "class", ";", "}", "// otherwise use the getGroupMember method", "else", "{", "identifiers", "=", "GroupService", ".", "searchForEntities", "(", "searchTerm", ",", "GroupService", ".", "SearchMethod", ".", "CONTAINS_CI", ",", "entityEnum", ".", "getClazz", "(", ")", ")", ";", "identifierType", "=", "entityEnum", ".", "getClazz", "(", ")", ";", "}", "for", "(", "EntityIdentifier", "entityIdentifier", ":", "identifiers", ")", "{", "if", "(", "entityIdentifier", ".", "getType", "(", ")", ".", "equals", "(", "identifierType", ")", ")", "{", "IGroupMember", "groupMember", "=", "GroupService", ".", "getGroupMember", "(", "entityIdentifier", ")", ";", "Entity", "entity", "=", "getEntity", "(", "groupMember", ")", ";", "results", ".", "add", "(", "entity", ")", ";", "}", "}", "return", "results", ";", "}"], "docstring": "External search, thus case insensitive.", "docstring_tokens": ["External", "search", "thus", "case", "insensitive", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-platform-impl/src/main/java/org/apereo/portal/api/groups/EntityService.java#L52-L90", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-platform-impl/src/main/java/org/apereo/portal/api/groups/EntityService.java", "func_name": "EntityService.lookupEntityName", "original_string": "public String lookupEntityName(Entity entity) {\n        if (entity == null) {\n            return null;\n        }\n        EntityEnum entityEnum = EntityEnum.getEntityEnum(entity.getEntityType());\n        return lookupEntityName(entityEnum, entity.getId());\n    }", "language": "java", "code": "public String lookupEntityName(Entity entity) {\n        if (entity == null) {\n            return null;\n        }\n        EntityEnum entityEnum = EntityEnum.getEntityEnum(entity.getEntityType());\n        return lookupEntityName(entityEnum, entity.getId());\n    }", "code_tokens": ["public", "String", "lookupEntityName", "(", "Entity", "entity", ")", "{", "if", "(", "entity", "==", "null", ")", "{", "return", "null", ";", "}", "EntityEnum", "entityEnum", "=", "EntityEnum", ".", "getEntityEnum", "(", "entity", ".", "getEntityType", "(", ")", ")", ";", "return", "lookupEntityName", "(", "entityEnum", ",", "entity", ".", "getId", "(", ")", ")", ";", "}"], "docstring": "Convenience method that looks up the name of the given group member. Used for person types.\n\n@param entity Entity to look up\n@return groupMember's name or null if there's an error", "docstring_tokens": ["Convenience", "method", "that", "looks", "up", "the", "name", "of", "the", "given", "group", "member", ".", "Used", "for", "person", "types", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-platform-impl/src/main/java/org/apereo/portal/api/groups/EntityService.java#L205-L211", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-spring/src/main/java/org/apereo/portal/spring/security/evaluator/PortalPermissionEvaluator.java", "func_name": "PortalPermissionEvaluator.getAuthorizationPrincipal", "original_string": "private IAuthorizationPrincipal getAuthorizationPrincipal(Authentication authentication) {\n\n        final Object authPrincipal = authentication.getPrincipal();\n        logger.trace(\"getAuthorizationPrincipal -- authPrincipal=[{}]\", authPrincipal);\n\n        String username;\n        if (authPrincipal instanceof UserDetails) {\n            // User is authenticated\n            UserDetails userDetails = (UserDetails) authPrincipal;\n            logger.trace(\n                    \"getAuthorizationPrincipal -- AUTHENTICATED, userDetails=[{}]\", userDetails);\n            username = userDetails.getUsername();\n        } else {\n            // Which guest user are we?\n            final HttpServletRequest req = portalRequestUtils.getCurrentPortalRequest();\n            final IPerson person = personManager.getPerson(req);\n            logger.trace(\"getAuthorizationPrincipal -- UNAUTHENTICATED, person=[{}]\", person);\n            username = person.getUserName();\n        }\n\n        return authorizationServiceFacade.newPrincipal(username, IPerson.class);\n    }", "language": "java", "code": "private IAuthorizationPrincipal getAuthorizationPrincipal(Authentication authentication) {\n\n        final Object authPrincipal = authentication.getPrincipal();\n        logger.trace(\"getAuthorizationPrincipal -- authPrincipal=[{}]\", authPrincipal);\n\n        String username;\n        if (authPrincipal instanceof UserDetails) {\n            // User is authenticated\n            UserDetails userDetails = (UserDetails) authPrincipal;\n            logger.trace(\n                    \"getAuthorizationPrincipal -- AUTHENTICATED, userDetails=[{}]\", userDetails);\n            username = userDetails.getUsername();\n        } else {\n            // Which guest user are we?\n            final HttpServletRequest req = portalRequestUtils.getCurrentPortalRequest();\n            final IPerson person = personManager.getPerson(req);\n            logger.trace(\"getAuthorizationPrincipal -- UNAUTHENTICATED, person=[{}]\", person);\n            username = person.getUserName();\n        }\n\n        return authorizationServiceFacade.newPrincipal(username, IPerson.class);\n    }", "code_tokens": ["private", "IAuthorizationPrincipal", "getAuthorizationPrincipal", "(", "Authentication", "authentication", ")", "{", "final", "Object", "authPrincipal", "=", "authentication", ".", "getPrincipal", "(", ")", ";", "logger", ".", "trace", "(", "\"getAuthorizationPrincipal -- authPrincipal=[{}]\"", ",", "authPrincipal", ")", ";", "String", "username", ";", "if", "(", "authPrincipal", "instanceof", "UserDetails", ")", "{", "// User is authenticated", "UserDetails", "userDetails", "=", "(", "UserDetails", ")", "authPrincipal", ";", "logger", ".", "trace", "(", "\"getAuthorizationPrincipal -- AUTHENTICATED, userDetails=[{}]\"", ",", "userDetails", ")", ";", "username", "=", "userDetails", ".", "getUsername", "(", ")", ";", "}", "else", "{", "// Which guest user are we?", "final", "HttpServletRequest", "req", "=", "portalRequestUtils", ".", "getCurrentPortalRequest", "(", ")", ";", "final", "IPerson", "person", "=", "personManager", ".", "getPerson", "(", "req", ")", ";", "logger", ".", "trace", "(", "\"getAuthorizationPrincipal -- UNAUTHENTICATED, person=[{}]\"", ",", "person", ")", ";", "username", "=", "person", ".", "getUserName", "(", ")", ";", "}", "return", "authorizationServiceFacade", ".", "newPrincipal", "(", "username", ",", "IPerson", ".", "class", ")", ";", "}"], "docstring": "Prepare a uPortal IAuthorizationPrincipal based in the Spring principal", "docstring_tokens": ["Prepare", "a", "uPortal", "IAuthorizationPrincipal", "based", "in", "the", "Spring", "principal"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-spring/src/main/java/org/apereo/portal/spring/security/evaluator/PortalPermissionEvaluator.java#L153-L174", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/StylesheetUserPreferencesImpl.java", "func_name": "StylesheetUserPreferencesImpl.removeLayoutAttribute", "original_string": "@Override\n    public String removeLayoutAttribute(String nodeId, String name) {\n        Validate.notEmpty(nodeId, \"nodeId cannot be null\");\n        Validate.notEmpty(name, \"name cannot be null\");\n\n        final Map<String, String> nodeAttributes = this.layoutAttributes.get(nodeId);\n        if (nodeAttributes == null) {\n            return null;\n        }\n\n        return nodeAttributes.remove(name);\n    }", "language": "java", "code": "@Override\n    public String removeLayoutAttribute(String nodeId, String name) {\n        Validate.notEmpty(nodeId, \"nodeId cannot be null\");\n        Validate.notEmpty(name, \"name cannot be null\");\n\n        final Map<String, String> nodeAttributes = this.layoutAttributes.get(nodeId);\n        if (nodeAttributes == null) {\n            return null;\n        }\n\n        return nodeAttributes.remove(name);\n    }", "code_tokens": ["@", "Override", "public", "String", "removeLayoutAttribute", "(", "String", "nodeId", ",", "String", "name", ")", "{", "Validate", ".", "notEmpty", "(", "nodeId", ",", "\"nodeId cannot be null\"", ")", ";", "Validate", ".", "notEmpty", "(", "name", ",", "\"name cannot be null\"", ")", ";", "final", "Map", "<", "String", ",", "String", ">", "nodeAttributes", "=", "this", ".", "layoutAttributes", ".", "get", "(", "nodeId", ")", ";", "if", "(", "nodeAttributes", "==", "null", ")", "{", "return", "null", ";", "}", "return", "nodeAttributes", ".", "remove", "(", "name", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.layout.om.IStylesheetUserPreferences#removeLayoutAttribute(java.lang.String, java.lang.String)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-core/src/main/java/org/apereo/portal/layout/StylesheetUserPreferencesImpl.java#L122-L133", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-events/src/main/java/org/apereo/portal/events/aggr/BaseAggregationImpl.java", "func_name": "BaseAggregationImpl.setDuration", "original_string": "public final void setDuration(int duration) {\n        if (isComplete()) {\n            this.getLogger()\n                    .warn(\n                            \"{} is already closed, the new duration of {} will be ignored on: {}\",\n                            this.getClass().getSimpleName(),\n                            duration,\n                            this);\n            return;\n        }\n        this.duration = duration;\n    }", "language": "java", "code": "public final void setDuration(int duration) {\n        if (isComplete()) {\n            this.getLogger()\n                    .warn(\n                            \"{} is already closed, the new duration of {} will be ignored on: {}\",\n                            this.getClass().getSimpleName(),\n                            duration,\n                            this);\n            return;\n        }\n        this.duration = duration;\n    }", "code_tokens": ["public", "final", "void", "setDuration", "(", "int", "duration", ")", "{", "if", "(", "isComplete", "(", ")", ")", "{", "this", ".", "getLogger", "(", ")", ".", "warn", "(", "\"{} is already closed, the new duration of {} will be ignored on: {}\"", ",", "this", ".", "getClass", "(", ")", ".", "getSimpleName", "(", ")", ",", "duration", ",", "this", ")", ";", "return", ";", "}", "this", ".", "duration", "=", "duration", ";", "}"], "docstring": "Set the duration of the interval", "docstring_tokens": ["Set", "the", "duration", "of", "the", "interval"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-events/src/main/java/org/apereo/portal/events/aggr/BaseAggregationImpl.java#L133-L144", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/XsltDataUpgrader.java", "func_name": "XsltDataUpgrader.upgradeData", "original_string": "@Override\n    public boolean upgradeData(Source source, Result result) {\n        final Transformer transformer;\n        try {\n            transformer = this.upgradeTemplates.newTransformer();\n        } catch (TransformerConfigurationException e) {\n            throw new RuntimeException(\n                    \"Failed to create new Transformer from the configured templates: \"\n                            + this.xslResource,\n                    e);\n        }\n\n        try {\n            transformer.transform(source, result);\n        } catch (TransformerException e) {\n            throw new RuntimeException(\n                    \"Failed to upgrade data using XSLT transformation: \" + this.xslResource, e);\n        }\n\n        return true;\n    }", "language": "java", "code": "@Override\n    public boolean upgradeData(Source source, Result result) {\n        final Transformer transformer;\n        try {\n            transformer = this.upgradeTemplates.newTransformer();\n        } catch (TransformerConfigurationException e) {\n            throw new RuntimeException(\n                    \"Failed to create new Transformer from the configured templates: \"\n                            + this.xslResource,\n                    e);\n        }\n\n        try {\n            transformer.transform(source, result);\n        } catch (TransformerException e) {\n            throw new RuntimeException(\n                    \"Failed to upgrade data using XSLT transformation: \" + this.xslResource, e);\n        }\n\n        return true;\n    }", "code_tokens": ["@", "Override", "public", "boolean", "upgradeData", "(", "Source", "source", ",", "Result", "result", ")", "{", "final", "Transformer", "transformer", ";", "try", "{", "transformer", "=", "this", ".", "upgradeTemplates", ".", "newTransformer", "(", ")", ";", "}", "catch", "(", "TransformerConfigurationException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Failed to create new Transformer from the configured templates: \"", "+", "this", ".", "xslResource", ",", "e", ")", ";", "}", "try", "{", "transformer", ".", "transform", "(", "source", ",", "result", ")", ";", "}", "catch", "(", "TransformerException", "e", ")", "{", "throw", "new", "RuntimeException", "(", "\"Failed to upgrade data using XSLT transformation: \"", "+", "this", ".", "xslResource", ",", "e", ")", ";", "}", "return", "true", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.io.xml.IDataUpgrader#upgradeData(javax.xml.transform.Source, javax.xml.transform.Result)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-io/uPortal-io-core/src/main/java/org/apereo/portal/io/xml/XsltDataUpgrader.java#L72-L92", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-web/src/main/java/org/apereo/portal/portlet/delegation/jsp/ParamTag.java", "func_name": "ParamTag.doStartTag", "original_string": "@Override\n    public int doStartTag() throws JspException {\n        final ParameterizableTag parameterizableTag =\n                (ParameterizableTag)\n                        TagSupport.findAncestorWithClass(this, ParameterizableTag.class);\n\n        if (parameterizableTag == null) {\n            throw new JspException(\n                    \"the 'param' Tag must have a parent tag that implements ParameterizableTag\");\n        }\n\n        if (this.name != null) {\n            parameterizableTag.addParameter(this.name, this.value);\n        }\n\n        return SKIP_BODY;\n    }", "language": "java", "code": "@Override\n    public int doStartTag() throws JspException {\n        final ParameterizableTag parameterizableTag =\n                (ParameterizableTag)\n                        TagSupport.findAncestorWithClass(this, ParameterizableTag.class);\n\n        if (parameterizableTag == null) {\n            throw new JspException(\n                    \"the 'param' Tag must have a parent tag that implements ParameterizableTag\");\n        }\n\n        if (this.name != null) {\n            parameterizableTag.addParameter(this.name, this.value);\n        }\n\n        return SKIP_BODY;\n    }", "code_tokens": ["@", "Override", "public", "int", "doStartTag", "(", ")", "throws", "JspException", "{", "final", "ParameterizableTag", "parameterizableTag", "=", "(", "ParameterizableTag", ")", "TagSupport", ".", "findAncestorWithClass", "(", "this", ",", "ParameterizableTag", ".", "class", ")", ";", "if", "(", "parameterizableTag", "==", "null", ")", "{", "throw", "new", "JspException", "(", "\"the 'param' Tag must have a parent tag that implements ParameterizableTag\"", ")", ";", "}", "if", "(", "this", ".", "name", "!=", "null", ")", "{", "parameterizableTag", ".", "addParameter", "(", "this", ".", "name", ",", "this", ".", "value", ")", ";", "}", "return", "SKIP_BODY", ";", "}"], "docstring": "Processes the <CODE>param</CODE> tag.\n\n@return <CODE>SKIP_BODY</CODE>", "docstring_tokens": ["Processes", "the", "<CODE", ">", "param<", "/", "CODE", ">", "tag", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-web/src/main/java/org/apereo/portal/portlet/delegation/jsp/ParamTag.java#L32-L48", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java", "func_name": "GrouperEntityGroupStore.contains", "original_string": "@Override\n    public boolean contains(IEntityGroup group, IGroupMember member) throws GroupsException {\n\n        String groupContainerName = group.getLocalKey();\n        String groupMemberName = member.getKey();\n\n        if (!validKey(groupContainerName) || !validKey(groupMemberName)) {\n            return false;\n        }\n\n        GcHasMember gcHasMember = new GcHasMember();\n        gcHasMember.assignGroupName(groupContainerName);\n        gcHasMember.addSubjectLookup(new WsSubjectLookup(null, \"g:gsa\", groupMemberName));\n        WsHasMemberResults wsHasMemberResults = gcHasMember.execute();\n        if (GrouperClientUtils.length(wsHasMemberResults.getResults()) == 1) {\n            WsHasMemberResult wsHasMemberResult = wsHasMemberResults.getResults()[0];\n            return StringUtils.equals(\n                    \"IS_MEMBER\", wsHasMemberResult.getResultMetadata().getResultCode());\n        }\n        return false;\n    }", "language": "java", "code": "@Override\n    public boolean contains(IEntityGroup group, IGroupMember member) throws GroupsException {\n\n        String groupContainerName = group.getLocalKey();\n        String groupMemberName = member.getKey();\n\n        if (!validKey(groupContainerName) || !validKey(groupMemberName)) {\n            return false;\n        }\n\n        GcHasMember gcHasMember = new GcHasMember();\n        gcHasMember.assignGroupName(groupContainerName);\n        gcHasMember.addSubjectLookup(new WsSubjectLookup(null, \"g:gsa\", groupMemberName));\n        WsHasMemberResults wsHasMemberResults = gcHasMember.execute();\n        if (GrouperClientUtils.length(wsHasMemberResults.getResults()) == 1) {\n            WsHasMemberResult wsHasMemberResult = wsHasMemberResults.getResults()[0];\n            return StringUtils.equals(\n                    \"IS_MEMBER\", wsHasMemberResult.getResultMetadata().getResultCode());\n        }\n        return false;\n    }", "code_tokens": ["@", "Override", "public", "boolean", "contains", "(", "IEntityGroup", "group", ",", "IGroupMember", "member", ")", "throws", "GroupsException", "{", "String", "groupContainerName", "=", "group", ".", "getLocalKey", "(", ")", ";", "String", "groupMemberName", "=", "member", ".", "getKey", "(", ")", ";", "if", "(", "!", "validKey", "(", "groupContainerName", ")", "||", "!", "validKey", "(", "groupMemberName", ")", ")", "{", "return", "false", ";", "}", "GcHasMember", "gcHasMember", "=", "new", "GcHasMember", "(", ")", ";", "gcHasMember", ".", "assignGroupName", "(", "groupContainerName", ")", ";", "gcHasMember", ".", "addSubjectLookup", "(", "new", "WsSubjectLookup", "(", "null", ",", "\"g:gsa\"", ",", "groupMemberName", ")", ")", ";", "WsHasMemberResults", "wsHasMemberResults", "=", "gcHasMember", ".", "execute", "(", ")", ";", "if", "(", "GrouperClientUtils", ".", "length", "(", "wsHasMemberResults", ".", "getResults", "(", ")", ")", "==", "1", ")", "{", "WsHasMemberResult", "wsHasMemberResult", "=", "wsHasMemberResults", ".", "getResults", "(", ")", "[", "0", "]", ";", "return", "StringUtils", ".", "equals", "(", "\"IS_MEMBER\"", ",", "wsHasMemberResult", ".", "getResultMetadata", "(", ")", ".", "getResultCode", "(", ")", ")", ";", "}", "return", "false", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.groups.IEntityGroupStore#contains(org.apereo.portal.groups.IEntityGroup, org.apereo.portal.groups.IGroupMember)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java#L88-L108", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java", "func_name": "GrouperEntityGroupStore.find", "original_string": "@Override\n    public IEntityGroup find(String key) throws GroupsException {\n\n        try {\n\n            // Search the Grouper server for groups with the specified local\n            // key\n            if (LOGGER.isDebugEnabled()) {\n                LOGGER.debug(\"Searching Grouper for a direct match for key: \" + key);\n            }\n            WsGroup wsGroup = findGroupFromKey(key);\n            if (wsGroup == null) {\n                return null;\n            }\n            IEntityGroup group = createUportalGroupFromGrouperGroup(wsGroup);\n\n            if (LOGGER.isDebugEnabled()) {\n                LOGGER.debug(\n                        \"Retrieved group from the Grouper server matching key \"\n                                + key\n                                + \": \"\n                                + group.toString());\n            }\n\n            // return the group\n            return group;\n\n        } catch (Exception e) {\n            LOGGER.warn(\n                    \"Exception while attempting to retrieve \"\n                            + \"group with key \"\n                            + key\n                            + \" from Grouper web services: \"\n                            + e.getMessage());\n            return null;\n        }\n    }", "language": "java", "code": "@Override\n    public IEntityGroup find(String key) throws GroupsException {\n\n        try {\n\n            // Search the Grouper server for groups with the specified local\n            // key\n            if (LOGGER.isDebugEnabled()) {\n                LOGGER.debug(\"Searching Grouper for a direct match for key: \" + key);\n            }\n            WsGroup wsGroup = findGroupFromKey(key);\n            if (wsGroup == null) {\n                return null;\n            }\n            IEntityGroup group = createUportalGroupFromGrouperGroup(wsGroup);\n\n            if (LOGGER.isDebugEnabled()) {\n                LOGGER.debug(\n                        \"Retrieved group from the Grouper server matching key \"\n                                + key\n                                + \": \"\n                                + group.toString());\n            }\n\n            // return the group\n            return group;\n\n        } catch (Exception e) {\n            LOGGER.warn(\n                    \"Exception while attempting to retrieve \"\n                            + \"group with key \"\n                            + key\n                            + \" from Grouper web services: \"\n                            + e.getMessage());\n            return null;\n        }\n    }", "code_tokens": ["@", "Override", "public", "IEntityGroup", "find", "(", "String", "key", ")", "throws", "GroupsException", "{", "try", "{", "// Search the Grouper server for groups with the specified local", "// key", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"Searching Grouper for a direct match for key: \"", "+", "key", ")", ";", "}", "WsGroup", "wsGroup", "=", "findGroupFromKey", "(", "key", ")", ";", "if", "(", "wsGroup", "==", "null", ")", "{", "return", "null", ";", "}", "IEntityGroup", "group", "=", "createUportalGroupFromGrouperGroup", "(", "wsGroup", ")", ";", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"Retrieved group from the Grouper server matching key \"", "+", "key", "+", "\": \"", "+", "group", ".", "toString", "(", ")", ")", ";", "}", "// return the group", "return", "group", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOGGER", ".", "warn", "(", "\"Exception while attempting to retrieve \"", "+", "\"group with key \"", "+", "key", "+", "\" from Grouper web services: \"", "+", "e", ".", "getMessage", "(", ")", ")", ";", "return", "null", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.groups.IEntityGroupStore#find(java.lang.String)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java#L113-L149", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java", "func_name": "GrouperEntityGroupStore.findParentGroups", "original_string": "@Override\n    @SuppressWarnings(\"unchecked\")\n    public Iterator findParentGroups(IGroupMember gm) throws GroupsException {\n\n        final List<IEntityGroup> parents = new LinkedList<IEntityGroup>();\n\n        GcGetGroups getGroups = new GcGetGroups();\n\n        String uportalStem = getStemPrefix();\n\n        // if only searching in a specific stem\n        if (!StringUtils.isBlank(uportalStem)) {\n            getGroups.assignStemScope(StemScope.ALL_IN_SUBTREE);\n            getGroups.assignWsStemLookup(new WsStemLookup(uportalStem, null));\n        }\n\n        String key = null;\n        String subjectSourceId = null;\n        if (gm.isGroup()) {\n\n            key = ((IEntityGroup) gm).getLocalKey();\n\n            if (!validKey(key)) {\n                return parents.iterator();\n            }\n            subjectSourceId = \"g:gsa\";\n        } else {\n\n            // Determine the key to use for this entity. If the entity is a\n            // group, we should use the group's local key (excluding the\n            // \"grouper.\" portion of the full key. If the entity is not a\n            // group type, just use the key.\n            key = gm.getKey();\n        }\n        getGroups.addSubjectLookup(new WsSubjectLookup(null, subjectSourceId, key));\n\n        if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"Searching Grouper for parent groups of the entity with key: \" + key);\n        }\n\n        try {\n\n            WsGetGroupsResults results = getGroups.execute();\n\n            if (results == null\n                    || results.getResults() == null\n                    || results.getResults().length != 1) {\n                LOGGER.debug(\"Grouper service returned no matches for key \" + key);\n                return parents.iterator();\n            }\n            WsGetGroupsResult wsg = results.getResults()[0];\n            if (wsg.getWsGroups() != null) {\n                for (WsGroup g : wsg.getWsGroups()) {\n                    if (LOGGER.isDebugEnabled()) {\n                        LOGGER.trace(\"Retrieved group: \" + g.getName());\n                    }\n                    IEntityGroup parent = createUportalGroupFromGrouperGroup(g);\n                    parents.add(parent);\n                }\n            }\n\n            if (LOGGER.isDebugEnabled()) {\n                LOGGER.debug(\n                        \"Retrieved \" + parents.size() + \" parent groups of entity with key \" + key);\n            }\n\n        } catch (Exception e) {\n            LOGGER.warn(\n                    \"Exception while attempting to retrieve \"\n                            + \"parents for entity with key \"\n                            + key\n                            + \" from Grouper web services: \"\n                            + e.getMessage());\n            return Collections.<IEntityGroup>emptyList().iterator();\n        }\n\n        return parents.iterator();\n    }", "language": "java", "code": "@Override\n    @SuppressWarnings(\"unchecked\")\n    public Iterator findParentGroups(IGroupMember gm) throws GroupsException {\n\n        final List<IEntityGroup> parents = new LinkedList<IEntityGroup>();\n\n        GcGetGroups getGroups = new GcGetGroups();\n\n        String uportalStem = getStemPrefix();\n\n        // if only searching in a specific stem\n        if (!StringUtils.isBlank(uportalStem)) {\n            getGroups.assignStemScope(StemScope.ALL_IN_SUBTREE);\n            getGroups.assignWsStemLookup(new WsStemLookup(uportalStem, null));\n        }\n\n        String key = null;\n        String subjectSourceId = null;\n        if (gm.isGroup()) {\n\n            key = ((IEntityGroup) gm).getLocalKey();\n\n            if (!validKey(key)) {\n                return parents.iterator();\n            }\n            subjectSourceId = \"g:gsa\";\n        } else {\n\n            // Determine the key to use for this entity. If the entity is a\n            // group, we should use the group's local key (excluding the\n            // \"grouper.\" portion of the full key. If the entity is not a\n            // group type, just use the key.\n            key = gm.getKey();\n        }\n        getGroups.addSubjectLookup(new WsSubjectLookup(null, subjectSourceId, key));\n\n        if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"Searching Grouper for parent groups of the entity with key: \" + key);\n        }\n\n        try {\n\n            WsGetGroupsResults results = getGroups.execute();\n\n            if (results == null\n                    || results.getResults() == null\n                    || results.getResults().length != 1) {\n                LOGGER.debug(\"Grouper service returned no matches for key \" + key);\n                return parents.iterator();\n            }\n            WsGetGroupsResult wsg = results.getResults()[0];\n            if (wsg.getWsGroups() != null) {\n                for (WsGroup g : wsg.getWsGroups()) {\n                    if (LOGGER.isDebugEnabled()) {\n                        LOGGER.trace(\"Retrieved group: \" + g.getName());\n                    }\n                    IEntityGroup parent = createUportalGroupFromGrouperGroup(g);\n                    parents.add(parent);\n                }\n            }\n\n            if (LOGGER.isDebugEnabled()) {\n                LOGGER.debug(\n                        \"Retrieved \" + parents.size() + \" parent groups of entity with key \" + key);\n            }\n\n        } catch (Exception e) {\n            LOGGER.warn(\n                    \"Exception while attempting to retrieve \"\n                            + \"parents for entity with key \"\n                            + key\n                            + \" from Grouper web services: \"\n                            + e.getMessage());\n            return Collections.<IEntityGroup>emptyList().iterator();\n        }\n\n        return parents.iterator();\n    }", "code_tokens": ["@", "Override", "@", "SuppressWarnings", "(", "\"unchecked\"", ")", "public", "Iterator", "findParentGroups", "(", "IGroupMember", "gm", ")", "throws", "GroupsException", "{", "final", "List", "<", "IEntityGroup", ">", "parents", "=", "new", "LinkedList", "<", "IEntityGroup", ">", "(", ")", ";", "GcGetGroups", "getGroups", "=", "new", "GcGetGroups", "(", ")", ";", "String", "uportalStem", "=", "getStemPrefix", "(", ")", ";", "// if only searching in a specific stem", "if", "(", "!", "StringUtils", ".", "isBlank", "(", "uportalStem", ")", ")", "{", "getGroups", ".", "assignStemScope", "(", "StemScope", ".", "ALL_IN_SUBTREE", ")", ";", "getGroups", ".", "assignWsStemLookup", "(", "new", "WsStemLookup", "(", "uportalStem", ",", "null", ")", ")", ";", "}", "String", "key", "=", "null", ";", "String", "subjectSourceId", "=", "null", ";", "if", "(", "gm", ".", "isGroup", "(", ")", ")", "{", "key", "=", "(", "(", "IEntityGroup", ")", "gm", ")", ".", "getLocalKey", "(", ")", ";", "if", "(", "!", "validKey", "(", "key", ")", ")", "{", "return", "parents", ".", "iterator", "(", ")", ";", "}", "subjectSourceId", "=", "\"g:gsa\"", ";", "}", "else", "{", "// Determine the key to use for this entity. If the entity is a", "// group, we should use the group's local key (excluding the", "// \"grouper.\" portion of the full key. If the entity is not a", "// group type, just use the key.", "key", "=", "gm", ".", "getKey", "(", ")", ";", "}", "getGroups", ".", "addSubjectLookup", "(", "new", "WsSubjectLookup", "(", "null", ",", "subjectSourceId", ",", "key", ")", ")", ";", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"Searching Grouper for parent groups of the entity with key: \"", "+", "key", ")", ";", "}", "try", "{", "WsGetGroupsResults", "results", "=", "getGroups", ".", "execute", "(", ")", ";", "if", "(", "results", "==", "null", "||", "results", ".", "getResults", "(", ")", "==", "null", "||", "results", ".", "getResults", "(", ")", ".", "length", "!=", "1", ")", "{", "LOGGER", ".", "debug", "(", "\"Grouper service returned no matches for key \"", "+", "key", ")", ";", "return", "parents", ".", "iterator", "(", ")", ";", "}", "WsGetGroupsResult", "wsg", "=", "results", ".", "getResults", "(", ")", "[", "0", "]", ";", "if", "(", "wsg", ".", "getWsGroups", "(", ")", "!=", "null", ")", "{", "for", "(", "WsGroup", "g", ":", "wsg", ".", "getWsGroups", "(", ")", ")", "{", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "trace", "(", "\"Retrieved group: \"", "+", "g", ".", "getName", "(", ")", ")", ";", "}", "IEntityGroup", "parent", "=", "createUportalGroupFromGrouperGroup", "(", "g", ")", ";", "parents", ".", "add", "(", "parent", ")", ";", "}", "}", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"Retrieved \"", "+", "parents", ".", "size", "(", ")", "+", "\" parent groups of entity with key \"", "+", "key", ")", ";", "}", "}", "catch", "(", "Exception", "e", ")", "{", "LOGGER", ".", "warn", "(", "\"Exception while attempting to retrieve \"", "+", "\"parents for entity with key \"", "+", "key", "+", "\" from Grouper web services: \"", "+", "e", ".", "getMessage", "(", ")", ")", ";", "return", "Collections", ".", "<", "IEntityGroup", ">", "emptyList", "(", ")", ".", "iterator", "(", ")", ";", "}", "return", "parents", ".", "iterator", "(", ")", ";", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.groups.IEntityGroupStore#findParentGroups(org.apereo.portal.groups.IGroupMember)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java#L154-L231", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java", "func_name": "GrouperEntityGroupStore.findEntitiesForGroup", "original_string": "@Override\n    @SuppressWarnings(\"unchecked\")\n    public Iterator findEntitiesForGroup(IEntityGroup group) throws GroupsException {\n\n        if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"Searching Grouper for members of the group with key: \" + group.getKey());\n        }\n\n        try {\n\n            // execute a search for members of the specified group\n            GcGetMembers getGroupsMembers = new GcGetMembers();\n            getGroupsMembers.addGroupName(group.getLocalKey());\n            getGroupsMembers.assignIncludeSubjectDetail(true);\n            WsGetMembersResults results = getGroupsMembers.execute();\n\n            if (results == null\n                    || results.getResults() == null\n                    || results.getResults().length == 0\n                    || results.getResults()[0].getWsSubjects() == null) {\n                LOGGER.debug(\"No members found for Grouper group with key \" + group.getLocalKey());\n                return Collections.<IGroupMember>emptyList().iterator();\n            }\n\n            WsSubject[] gInfos = results.getResults()[0].getWsSubjects();\n            final List<IGroupMember> members = new ArrayList<IGroupMember>(gInfos.length);\n\n            // add each result to the member list\n            for (WsSubject gInfo : gInfos) {\n\n                // if the member is not a group (aka person)\n                if (!StringUtils.equals(gInfo.getSourceId(), \"g:gsa\")) {\n\n                    if (LOGGER.isDebugEnabled()) {\n                        LOGGER.debug(\n                                \"creating leaf member:\"\n                                        + gInfo.getId()\n                                        + \" and name: \"\n                                        + gInfo.getName()\n                                        + \" from group: \"\n                                        + group.getLocalKey());\n                    }\n                    // use the name instead of id as it shows better in the display\n                    IGroupMember member = new EntityImpl(gInfo.getName(), IPerson.class);\n                    members.add(member);\n                }\n            }\n\n            // return an iterator for the assembled group\n            return members.iterator();\n\n        } catch (Exception e) {\n            LOGGER.warn(\n                    \"Exception while attempting to retrieve \"\n                            + \"member entities of group with key \"\n                            + group.getKey()\n                            + \" from Grouper web services: \"\n                            + e.getMessage());\n            return Collections.<IGroupMember>emptyList().iterator();\n        }\n    }", "language": "java", "code": "@Override\n    @SuppressWarnings(\"unchecked\")\n    public Iterator findEntitiesForGroup(IEntityGroup group) throws GroupsException {\n\n        if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"Searching Grouper for members of the group with key: \" + group.getKey());\n        }\n\n        try {\n\n            // execute a search for members of the specified group\n            GcGetMembers getGroupsMembers = new GcGetMembers();\n            getGroupsMembers.addGroupName(group.getLocalKey());\n            getGroupsMembers.assignIncludeSubjectDetail(true);\n            WsGetMembersResults results = getGroupsMembers.execute();\n\n            if (results == null\n                    || results.getResults() == null\n                    || results.getResults().length == 0\n                    || results.getResults()[0].getWsSubjects() == null) {\n                LOGGER.debug(\"No members found for Grouper group with key \" + group.getLocalKey());\n                return Collections.<IGroupMember>emptyList().iterator();\n            }\n\n            WsSubject[] gInfos = results.getResults()[0].getWsSubjects();\n            final List<IGroupMember> members = new ArrayList<IGroupMember>(gInfos.length);\n\n            // add each result to the member list\n            for (WsSubject gInfo : gInfos) {\n\n                // if the member is not a group (aka person)\n                if (!StringUtils.equals(gInfo.getSourceId(), \"g:gsa\")) {\n\n                    if (LOGGER.isDebugEnabled()) {\n                        LOGGER.debug(\n                                \"creating leaf member:\"\n                                        + gInfo.getId()\n                                        + \" and name: \"\n                                        + gInfo.getName()\n                                        + \" from group: \"\n                                        + group.getLocalKey());\n                    }\n                    // use the name instead of id as it shows better in the display\n                    IGroupMember member = new EntityImpl(gInfo.getName(), IPerson.class);\n                    members.add(member);\n                }\n            }\n\n            // return an iterator for the assembled group\n            return members.iterator();\n\n        } catch (Exception e) {\n            LOGGER.warn(\n                    \"Exception while attempting to retrieve \"\n                            + \"member entities of group with key \"\n                            + group.getKey()\n                            + \" from Grouper web services: \"\n                            + e.getMessage());\n            return Collections.<IGroupMember>emptyList().iterator();\n        }\n    }", "code_tokens": ["@", "Override", "@", "SuppressWarnings", "(", "\"unchecked\"", ")", "public", "Iterator", "findEntitiesForGroup", "(", "IEntityGroup", "group", ")", "throws", "GroupsException", "{", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"Searching Grouper for members of the group with key: \"", "+", "group", ".", "getKey", "(", ")", ")", ";", "}", "try", "{", "// execute a search for members of the specified group", "GcGetMembers", "getGroupsMembers", "=", "new", "GcGetMembers", "(", ")", ";", "getGroupsMembers", ".", "addGroupName", "(", "group", ".", "getLocalKey", "(", ")", ")", ";", "getGroupsMembers", ".", "assignIncludeSubjectDetail", "(", "true", ")", ";", "WsGetMembersResults", "results", "=", "getGroupsMembers", ".", "execute", "(", ")", ";", "if", "(", "results", "==", "null", "||", "results", ".", "getResults", "(", ")", "==", "null", "||", "results", ".", "getResults", "(", ")", ".", "length", "==", "0", "||", "results", ".", "getResults", "(", ")", "[", "0", "]", ".", "getWsSubjects", "(", ")", "==", "null", ")", "{", "LOGGER", ".", "debug", "(", "\"No members found for Grouper group with key \"", "+", "group", ".", "getLocalKey", "(", ")", ")", ";", "return", "Collections", ".", "<", "IGroupMember", ">", "emptyList", "(", ")", ".", "iterator", "(", ")", ";", "}", "WsSubject", "[", "]", "gInfos", "=", "results", ".", "getResults", "(", ")", "[", "0", "]", ".", "getWsSubjects", "(", ")", ";", "final", "List", "<", "IGroupMember", ">", "members", "=", "new", "ArrayList", "<", "IGroupMember", ">", "(", "gInfos", ".", "length", ")", ";", "// add each result to the member list", "for", "(", "WsSubject", "gInfo", ":", "gInfos", ")", "{", "// if the member is not a group (aka person)", "if", "(", "!", "StringUtils", ".", "equals", "(", "gInfo", ".", "getSourceId", "(", ")", ",", "\"g:gsa\"", ")", ")", "{", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"creating leaf member:\"", "+", "gInfo", ".", "getId", "(", ")", "+", "\" and name: \"", "+", "gInfo", ".", "getName", "(", ")", "+", "\" from group: \"", "+", "group", ".", "getLocalKey", "(", ")", ")", ";", "}", "// use the name instead of id as it shows better in the display", "IGroupMember", "member", "=", "new", "EntityImpl", "(", "gInfo", ".", "getName", "(", ")", ",", "IPerson", ".", "class", ")", ";", "members", ".", "add", "(", "member", ")", ";", "}", "}", "// return an iterator for the assembled group", "return", "members", ".", "iterator", "(", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOGGER", ".", "warn", "(", "\"Exception while attempting to retrieve \"", "+", "\"member entities of group with key \"", "+", "group", ".", "getKey", "(", ")", "+", "\" from Grouper web services: \"", "+", "e", ".", "getMessage", "(", ")", ")", ";", "return", "Collections", ".", "<", "IGroupMember", ">", "emptyList", "(", ")", ".", "iterator", "(", ")", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.groups.IEntityGroupStore#findEntitiesForGroup(org.apereo.portal.groups.IEntityGroup)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java#L236-L296", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java", "func_name": "GrouperEntityGroupStore.searchForGroups", "original_string": "@Override\n    public EntityIdentifier[] searchForGroups(\n            final String query,\n            final SearchMethod method,\n            @SuppressWarnings(\"unchecked\") final Class leaftype) {\n\n        // only search for groups\n        if (leaftype != IPerson.class) {\n            return new EntityIdentifier[] {};\n        }\n\n        if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"Searching Grouper for groups matching query: \" + query);\n        }\n\n        // result groups.\n        List<EntityIdentifier> groups = new ArrayList<EntityIdentifier>();\n\n        try {\n\n            // TODO: searches need to be performed against the group display\n            // name rather than the group key\n\n            GcFindGroups groupSearch = new GcFindGroups();\n            WsQueryFilter filter = new WsQueryFilter();\n            // is this an exact search or fuzzy\n            if ((method == SearchMethod.DISCRETE_CI) || (method == SearchMethod.DISCRETE)) {\n                filter.setQueryFilterType(\"FIND_BY_GROUP_NAME_EXACT\");\n            } else {\n                filter.setQueryFilterType(\"FIND_BY_GROUP_NAME_APPROXIMATE\");\n            }\n            filter.setGroupName(query);\n            groupSearch.assignQueryFilter(filter);\n            WsFindGroupsResults results = groupSearch.execute();\n\n            if (results != null && results.getGroupResults() != null) {\n                for (WsGroup g : results.getGroupResults()) {\n                    if (validKey(g.getName())) {\n                        if (LOGGER.isTraceEnabled()) {\n                            LOGGER.trace(\"Retrieved group: \" + g.getName());\n                        }\n                        groups.add(new EntityIdentifier(g.getName(), IEntityGroup.class));\n                    }\n                }\n            }\n\n            if (LOGGER.isDebugEnabled()) {\n                LOGGER.debug(\"Returning \" + groups.size() + \" results for query \" + query);\n            }\n\n            return groups.toArray(new EntityIdentifier[groups.size()]);\n\n        } catch (Exception e) {\n            LOGGER.warn(\n                    \"Exception while attempting to retrieve \"\n                            + \"search results for query \"\n                            + query\n                            + \" and entity type \"\n                            + leaftype.getCanonicalName()\n                            + \" : \"\n                            + e.getMessage());\n            return new EntityIdentifier[] {};\n        }\n    }", "language": "java", "code": "@Override\n    public EntityIdentifier[] searchForGroups(\n            final String query,\n            final SearchMethod method,\n            @SuppressWarnings(\"unchecked\") final Class leaftype) {\n\n        // only search for groups\n        if (leaftype != IPerson.class) {\n            return new EntityIdentifier[] {};\n        }\n\n        if (LOGGER.isDebugEnabled()) {\n            LOGGER.debug(\"Searching Grouper for groups matching query: \" + query);\n        }\n\n        // result groups.\n        List<EntityIdentifier> groups = new ArrayList<EntityIdentifier>();\n\n        try {\n\n            // TODO: searches need to be performed against the group display\n            // name rather than the group key\n\n            GcFindGroups groupSearch = new GcFindGroups();\n            WsQueryFilter filter = new WsQueryFilter();\n            // is this an exact search or fuzzy\n            if ((method == SearchMethod.DISCRETE_CI) || (method == SearchMethod.DISCRETE)) {\n                filter.setQueryFilterType(\"FIND_BY_GROUP_NAME_EXACT\");\n            } else {\n                filter.setQueryFilterType(\"FIND_BY_GROUP_NAME_APPROXIMATE\");\n            }\n            filter.setGroupName(query);\n            groupSearch.assignQueryFilter(filter);\n            WsFindGroupsResults results = groupSearch.execute();\n\n            if (results != null && results.getGroupResults() != null) {\n                for (WsGroup g : results.getGroupResults()) {\n                    if (validKey(g.getName())) {\n                        if (LOGGER.isTraceEnabled()) {\n                            LOGGER.trace(\"Retrieved group: \" + g.getName());\n                        }\n                        groups.add(new EntityIdentifier(g.getName(), IEntityGroup.class));\n                    }\n                }\n            }\n\n            if (LOGGER.isDebugEnabled()) {\n                LOGGER.debug(\"Returning \" + groups.size() + \" results for query \" + query);\n            }\n\n            return groups.toArray(new EntityIdentifier[groups.size()]);\n\n        } catch (Exception e) {\n            LOGGER.warn(\n                    \"Exception while attempting to retrieve \"\n                            + \"search results for query \"\n                            + query\n                            + \" and entity type \"\n                            + leaftype.getCanonicalName()\n                            + \" : \"\n                            + e.getMessage());\n            return new EntityIdentifier[] {};\n        }\n    }", "code_tokens": ["@", "Override", "public", "EntityIdentifier", "[", "]", "searchForGroups", "(", "final", "String", "query", ",", "final", "SearchMethod", "method", ",", "@", "SuppressWarnings", "(", "\"unchecked\"", ")", "final", "Class", "leaftype", ")", "{", "// only search for groups", "if", "(", "leaftype", "!=", "IPerson", ".", "class", ")", "{", "return", "new", "EntityIdentifier", "[", "]", "{", "}", ";", "}", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"Searching Grouper for groups matching query: \"", "+", "query", ")", ";", "}", "// result groups.", "List", "<", "EntityIdentifier", ">", "groups", "=", "new", "ArrayList", "<", "EntityIdentifier", ">", "(", ")", ";", "try", "{", "// TODO: searches need to be performed against the group display", "// name rather than the group key", "GcFindGroups", "groupSearch", "=", "new", "GcFindGroups", "(", ")", ";", "WsQueryFilter", "filter", "=", "new", "WsQueryFilter", "(", ")", ";", "// is this an exact search or fuzzy", "if", "(", "(", "method", "==", "SearchMethod", ".", "DISCRETE_CI", ")", "||", "(", "method", "==", "SearchMethod", ".", "DISCRETE", ")", ")", "{", "filter", ".", "setQueryFilterType", "(", "\"FIND_BY_GROUP_NAME_EXACT\"", ")", ";", "}", "else", "{", "filter", ".", "setQueryFilterType", "(", "\"FIND_BY_GROUP_NAME_APPROXIMATE\"", ")", ";", "}", "filter", ".", "setGroupName", "(", "query", ")", ";", "groupSearch", ".", "assignQueryFilter", "(", "filter", ")", ";", "WsFindGroupsResults", "results", "=", "groupSearch", ".", "execute", "(", ")", ";", "if", "(", "results", "!=", "null", "&&", "results", ".", "getGroupResults", "(", ")", "!=", "null", ")", "{", "for", "(", "WsGroup", "g", ":", "results", ".", "getGroupResults", "(", ")", ")", "{", "if", "(", "validKey", "(", "g", ".", "getName", "(", ")", ")", ")", "{", "if", "(", "LOGGER", ".", "isTraceEnabled", "(", ")", ")", "{", "LOGGER", ".", "trace", "(", "\"Retrieved group: \"", "+", "g", ".", "getName", "(", ")", ")", ";", "}", "groups", ".", "add", "(", "new", "EntityIdentifier", "(", "g", ".", "getName", "(", ")", ",", "IEntityGroup", ".", "class", ")", ")", ";", "}", "}", "}", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"Returning \"", "+", "groups", ".", "size", "(", ")", "+", "\" results for query \"", "+", "query", ")", ";", "}", "return", "groups", ".", "toArray", "(", "new", "EntityIdentifier", "[", "groups", ".", "size", "(", ")", "]", ")", ";", "}", "catch", "(", "Exception", "e", ")", "{", "LOGGER", ".", "warn", "(", "\"Exception while attempting to retrieve \"", "+", "\"search results for query \"", "+", "query", "+", "\" and entity type \"", "+", "leaftype", ".", "getCanonicalName", "(", ")", "+", "\" : \"", "+", "e", ".", "getMessage", "(", ")", ")", ";", "return", "new", "EntityIdentifier", "[", "]", "{", "}", ";", "}", "}"], "docstring": "/* (non-Javadoc)\n@see org.apereo.portal.groups.IEntityGroupStore#searchForGroups(java.lang.String, int, java.lang.Class)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java#L382-L445", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java", "func_name": "GrouperEntityGroupStore.createUportalGroupFromGrouperGroup", "original_string": "protected IEntityGroup createUportalGroupFromGrouperGroup(WsGroup wsGroup) {\n        IEntityGroup iEntityGroup = new EntityGroupImpl(wsGroup.getName(), IPerson.class);\n\n        // need to set the group name and description to the actual\n        // display name and description\n        iEntityGroup.setName(wsGroup.getDisplayName());\n        iEntityGroup.setDescription(wsGroup.getDescription());\n        return iEntityGroup;\n    }", "language": "java", "code": "protected IEntityGroup createUportalGroupFromGrouperGroup(WsGroup wsGroup) {\n        IEntityGroup iEntityGroup = new EntityGroupImpl(wsGroup.getName(), IPerson.class);\n\n        // need to set the group name and description to the actual\n        // display name and description\n        iEntityGroup.setName(wsGroup.getDisplayName());\n        iEntityGroup.setDescription(wsGroup.getDescription());\n        return iEntityGroup;\n    }", "code_tokens": ["protected", "IEntityGroup", "createUportalGroupFromGrouperGroup", "(", "WsGroup", "wsGroup", ")", "{", "IEntityGroup", "iEntityGroup", "=", "new", "EntityGroupImpl", "(", "wsGroup", ".", "getName", "(", ")", ",", "IPerson", ".", "class", ")", ";", "// need to set the group name and description to the actual", "// display name and description", "iEntityGroup", ".", "setName", "(", "wsGroup", ".", "getDisplayName", "(", ")", ")", ";", "iEntityGroup", ".", "setDescription", "(", "wsGroup", ".", "getDescription", "(", ")", ")", ";", "return", "iEntityGroup", ";", "}"], "docstring": "Construct an IEntityGroup from a Grouper WsGroup.\n\n@param wsGroup\n@return the group", "docstring_tokens": ["Construct", "an", "IEntityGroup", "from", "a", "Grouper", "WsGroup", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java#L508-L516", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java", "func_name": "GrouperEntityGroupStore.findGroupFromKey", "original_string": "protected WsGroup findGroupFromKey(String key) {\n        WsGroup wsGroup = null;\n\n        if (key != null) {\n\n            GcFindGroups gcFindGroups = new GcFindGroups();\n            gcFindGroups.addGroupName(key);\n            WsFindGroupsResults results = gcFindGroups.execute();\n\n            // if no results were returned, return null\n            if (results != null\n                    && results.getGroupResults() != null\n                    && results.getGroupResults().length > 0) {\n\n                if (LOGGER.isDebugEnabled()) {\n                    LOGGER.debug(\n                            \"found group from key \" + key + \": \" + results.getGroupResults()[0]);\n                }\n\n                wsGroup = results.getGroupResults()[0];\n            }\n        }\n\n        return wsGroup;\n    }", "language": "java", "code": "protected WsGroup findGroupFromKey(String key) {\n        WsGroup wsGroup = null;\n\n        if (key != null) {\n\n            GcFindGroups gcFindGroups = new GcFindGroups();\n            gcFindGroups.addGroupName(key);\n            WsFindGroupsResults results = gcFindGroups.execute();\n\n            // if no results were returned, return null\n            if (results != null\n                    && results.getGroupResults() != null\n                    && results.getGroupResults().length > 0) {\n\n                if (LOGGER.isDebugEnabled()) {\n                    LOGGER.debug(\n                            \"found group from key \" + key + \": \" + results.getGroupResults()[0]);\n                }\n\n                wsGroup = results.getGroupResults()[0];\n            }\n        }\n\n        return wsGroup;\n    }", "code_tokens": ["protected", "WsGroup", "findGroupFromKey", "(", "String", "key", ")", "{", "WsGroup", "wsGroup", "=", "null", ";", "if", "(", "key", "!=", "null", ")", "{", "GcFindGroups", "gcFindGroups", "=", "new", "GcFindGroups", "(", ")", ";", "gcFindGroups", ".", "addGroupName", "(", "key", ")", ";", "WsFindGroupsResults", "results", "=", "gcFindGroups", ".", "execute", "(", ")", ";", "// if no results were returned, return null", "if", "(", "results", "!=", "null", "&&", "results", ".", "getGroupResults", "(", ")", "!=", "null", "&&", "results", ".", "getGroupResults", "(", ")", ".", "length", ">", "0", ")", "{", "if", "(", "LOGGER", ".", "isDebugEnabled", "(", ")", ")", "{", "LOGGER", ".", "debug", "(", "\"found group from key \"", "+", "key", "+", "\": \"", "+", "results", ".", "getGroupResults", "(", ")", "[", "0", "]", ")", ";", "}", "wsGroup", "=", "results", ".", "getGroupResults", "(", ")", "[", "0", "]", ";", "}", "}", "return", "wsGroup", ";", "}"], "docstring": "Find the Grouper group matching the specified key.\n\n@param key\n@return the group or null", "docstring_tokens": ["Find", "the", "Grouper", "group", "matching", "the", "specified", "key", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java#L524-L548", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java", "func_name": "GrouperEntityGroupStore.getStemPrefix", "original_string": "protected static String getStemPrefix() {\n\n        String uportalStem = GrouperClientUtils.propertiesValue(STEM_PREFIX, false);\n\n        // make sure it ends in colon\n        if (!StringUtils.isBlank(uportalStem)) {\n            if (uportalStem.endsWith(\":\")) {\n                uportalStem = uportalStem.substring(0, uportalStem.length() - 1);\n            }\n        }\n\n        return uportalStem;\n    }", "language": "java", "code": "protected static String getStemPrefix() {\n\n        String uportalStem = GrouperClientUtils.propertiesValue(STEM_PREFIX, false);\n\n        // make sure it ends in colon\n        if (!StringUtils.isBlank(uportalStem)) {\n            if (uportalStem.endsWith(\":\")) {\n                uportalStem = uportalStem.substring(0, uportalStem.length() - 1);\n            }\n        }\n\n        return uportalStem;\n    }", "code_tokens": ["protected", "static", "String", "getStemPrefix", "(", ")", "{", "String", "uportalStem", "=", "GrouperClientUtils", ".", "propertiesValue", "(", "STEM_PREFIX", ",", "false", ")", ";", "// make sure it ends in colon", "if", "(", "!", "StringUtils", ".", "isBlank", "(", "uportalStem", ")", ")", "{", "if", "(", "uportalStem", ".", "endsWith", "(", "\":\"", ")", ")", "{", "uportalStem", "=", "uportalStem", ".", "substring", "(", "0", ",", "uportalStem", ".", "length", "(", ")", "-", "1", ")", ";", "}", "}", "return", "uportalStem", ";", "}"], "docstring": "Get the prefix for the stem containing uPortal groups. If this value is non-empty, all groups\nwill be required to be prefixed with the specified stem name.\n\n@return the uportal stem in the registry, without trailing colon", "docstring_tokens": ["Get", "the", "prefix", "for", "the", "stem", "containing", "uPortal", "groups", ".", "If", "this", "value", "is", "non", "-", "empty", "all", "groups", "will", "be", "required", "to", "be", "prefixed", "with", "the", "specified", "stem", "name", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-groups/uPortal-groups-grouper/src/main/java/org/apereo/portal/groups/grouper/GrouperEntityGroupStore.java#L556-L568", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/LPARemoveParameter.java", "func_name": "LPARemoveParameter.perform", "original_string": "@Override\n    public void perform() throws PortalException {\n        // push the change into the PLF\n        if (nodeId.startsWith(Constants.FRAGMENT_ID_USER_PREFIX)) {\n            // we are dealing with an incorporated node\n            ParameterEditManager.removeParmEditDirective(nodeId, name, person);\n        } else {\n            // node owned by user so add parameter child directly\n            Document plf = RDBMDistributedLayoutStore.getPLF(person);\n            Element plfNode = plf.getElementById(nodeId);\n            removeParameterChild(plfNode, name);\n        }\n        // push the change into the ILF\n        removeParameterChild(ilfNode, name);\n    }", "language": "java", "code": "@Override\n    public void perform() throws PortalException {\n        // push the change into the PLF\n        if (nodeId.startsWith(Constants.FRAGMENT_ID_USER_PREFIX)) {\n            // we are dealing with an incorporated node\n            ParameterEditManager.removeParmEditDirective(nodeId, name, person);\n        } else {\n            // node owned by user so add parameter child directly\n            Document plf = RDBMDistributedLayoutStore.getPLF(person);\n            Element plfNode = plf.getElementById(nodeId);\n            removeParameterChild(plfNode, name);\n        }\n        // push the change into the ILF\n        removeParameterChild(ilfNode, name);\n    }", "code_tokens": ["@", "Override", "public", "void", "perform", "(", ")", "throws", "PortalException", "{", "// push the change into the PLF", "if", "(", "nodeId", ".", "startsWith", "(", "Constants", ".", "FRAGMENT_ID_USER_PREFIX", ")", ")", "{", "// we are dealing with an incorporated node", "ParameterEditManager", ".", "removeParmEditDirective", "(", "nodeId", ",", "name", ",", "person", ")", ";", "}", "else", "{", "// node owned by user so add parameter child directly", "Document", "plf", "=", "RDBMDistributedLayoutStore", ".", "getPLF", "(", "person", ")", ";", "Element", "plfNode", "=", "plf", ".", "getElementById", "(", "nodeId", ")", ";", "removeParameterChild", "(", "plfNode", ",", "name", ")", ";", "}", "// push the change into the ILF", "removeParameterChild", "(", "ilfNode", ",", "name", ")", ";", "}"], "docstring": "Remove the parameter from a channel in both the ILF and PLF using the appropriate mechanisms\nfor incorporated nodes versus owned nodes.", "docstring_tokens": ["Remove", "the", "parameter", "from", "a", "channel", "in", "both", "the", "ILF", "and", "PLF", "using", "the", "appropriate", "mechanisms", "for", "incorporated", "nodes", "versus", "owned", "nodes", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-layout/uPortal-layout-impl/src/main/java/org/apereo/portal/layout/dlm/LPARemoveParameter.java#L40-L54", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/layout/dlm/remoting/registry/v43/PortletCategoryBean.java", "func_name": "PortletCategoryBean.create", "original_string": "public static PortletCategoryBean create(\n            String id,\n            String name,\n            String description,\n            Set<PortletCategoryBean> subcategories,\n            Set<PortletDefinitionBean> portlets) {\n        return new PortletCategoryBean(id, name, description, subcategories, portlets);\n    }", "language": "java", "code": "public static PortletCategoryBean create(\n            String id,\n            String name,\n            String description,\n            Set<PortletCategoryBean> subcategories,\n            Set<PortletDefinitionBean> portlets) {\n        return new PortletCategoryBean(id, name, description, subcategories, portlets);\n    }", "code_tokens": ["public", "static", "PortletCategoryBean", "create", "(", "String", "id", ",", "String", "name", ",", "String", "description", ",", "Set", "<", "PortletCategoryBean", ">", "subcategories", ",", "Set", "<", "PortletDefinitionBean", ">", "portlets", ")", "{", "return", "new", "PortletCategoryBean", "(", "id", ",", "name", ",", "description", ",", "subcategories", ",", "portlets", ")", ";", "}"], "docstring": "Creates a new bean based on the provided inputs.", "docstring_tokens": ["Creates", "a", "new", "bean", "based", "on", "the", "provided", "inputs", "."], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-api/uPortal-api-internal/src/main/java/org/apereo/portal/layout/dlm/remoting/registry/v43/PortletCategoryBean.java#L57-L64", "partition": "train"}
{"repo": "Jasig/uPortal", "path": "uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/logging/AppendableLogger.java", "func_name": "AppendableLogger.append", "original_string": "@Override\n    public Appendable append(CharSequence csq, int start, int end) throws IOException {\n        this.loggingWriter.append(csq, start, end);\n        return this;\n    }", "language": "java", "code": "@Override\n    public Appendable append(CharSequence csq, int start, int end) throws IOException {\n        this.loggingWriter.append(csq, start, end);\n        return this;\n    }", "code_tokens": ["@", "Override", "public", "Appendable", "append", "(", "CharSequence", "csq", ",", "int", "start", ",", "int", "end", ")", "throws", "IOException", "{", "this", ".", "loggingWriter", ".", "append", "(", "csq", ",", "start", ",", "end", ")", ";", "return", "this", ";", "}"], "docstring": "/* (non-Javadoc)\n@see java.lang.Appendable#append(java.lang.CharSequence, int, int)", "docstring_tokens": ["/", "*", "(", "non", "-", "Javadoc", ")"], "sha": "c1986542abb9acd214268f2df21c6305ad2f262b", "url": "https://github.com/Jasig/uPortal/blob/c1986542abb9acd214268f2df21c6305ad2f262b/uPortal-utils/uPortal-utils-core/src/main/java/org/apereo/portal/logging/AppendableLogger.java#L51-L55", "partition": "train"}
